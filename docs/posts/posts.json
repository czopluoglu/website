[
  {
    "path": "posts/2020-12-04-detect/",
    "title": "Automated DETECT analysis using R",
    "description": "The post is organized as follows. First, we simulate a dataset using a multidimensional IRT model and compute the actual DETECT value using the correct item partitioning. Second, a brief description of the DETECT index is provided, and the DETECT value is calculated based on this definition based on the true item clustering for the simulated dataset. Then, we compute the same value using the original DETECT program by executing it through R. Finally, we conduct a simple simulation to demonstrate how to automate running DETECT to analyze many datasets and processing the DETECT output files in R.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2020-12-08",
    "categories": [
      "dimensionality",
      "DETECT",
      "multidimensional IRT",
      "item response theory",
      "R",
      "2020"
    ],
    "contents": "\r\n\r\nContents\r\nA. Simulating Multidimensional Data\r\nB. DETECT Index\r\nC. Analyzing the Simulated Dataset Using the DETECT program\r\nD. Automating DETECT Runs for a Simulation Study\r\n\r\n\r\n\r\nbody {\r\ntext-align: justify}\r\n\r\n\r\n\r\n\r\nIf you ever study the multidimensional item response models, you will likely read about DETECT (Zhang & Stout, 1999) at some point as an alternative procedure for dimensionality assessment. DETECT, Dimensionality Evaluation to Enumerate Contributing Traits, is a conditional covariance-based nonparametric method to assess multidimensionality. The procedure was available as part of a commercial software package, and then it has been made public a while ago (DIMPACK software). The original software has user-friendly point-and-click interface, as shown below.\r\n\r\n\r\n\r\nFigure 1: A screenshot of user interface from DIMPACK\r\n\r\n\r\n\r\nThe user-friendly interface is not very helpful for simulation studies. So, one needs to find a way to automate running the DETECT procedure. In this post, I will demonstrate how to automate DETECT analysis using R. The post is organized as follows. First, we simulate a dataset using a multidimensional IRT model and compute the actual DETECT value using the correct item partitioning. Second, a brief description of the DETECT index is provided, and the DETECT value is calculated based on this definition based on the true item clustering for the simulated dataset. Then, we compute the same value using the original DETECT program by executing it through R. Finally, we conduct a simple simulation to demonstrate how to automate running DETECT to analyze many datasets and processing the DETECT output files.1\r\nA. Simulating Multidimensional Data\r\nWe are going to use a multidimensional compensatory 4-parameter logistic model in this demonstration. For simplicity, I present the equations for a two-dimensional model. This model’s details can be found in any IRT textbook, e.g., Reckase (2009), Bonifay (2020). In this model, the probability of a correct response is given by the following equation,\r\n\\[\r\nP(Y=1 | \\theta_1,\\theta_2,a_1,a_2,d,g,u) = g + (u-g)\\frac{1}{1 + e^{-(a_1\\theta_1 + a_2 \\theta_2+d)}},\r\n\\]\r\nin which \\(\\theta_1\\) and \\(\\theta_2\\) are the person parameters for the two latent dimensions, \\(a_1\\) and \\(a_2\\) are the item discrimination parameters, \\(g\\) is the item guessing parameter (lower bound), \\(u\\) is the slipping parameter (upper bound), and \\(d\\) is the intercept parameter.\r\nBelow, I adopted and slightly modified a table of item parameters from Reckase(2009) to generate data (Table 6.1).\r\n\r\n\r\nipar <- read.csv('data/ipar.csv')\r\nipar\r\n\r\n\r\n     a1   a2     d    g    u\r\n1  0.75 0.15  0.18 0.10 0.99\r\n2  0.46 0.07 -0.19 0.05 0.98\r\n3  0.86 0.40 -0.47 0.15 0.95\r\n4  1.01 0.05 -0.43 0.10 0.97\r\n5  0.55 0.15 -0.44 0.20 0.96\r\n6  1.35 0.54 -0.58 0.20 0.94\r\n7  1.38 0.47 -1.04 0.10 0.95\r\n8  0.85 0.26  0.64 0.15 0.92\r\n9  1.01 0.20  0.01 0.10 0.98\r\n10 0.92 0.30  0.09 0.10 0.99\r\n11 0.00 0.80  0.81 0.20 0.97\r\n12 0.00 1.20 -0.19 0.10 0.96\r\n13 0.05 0.71  0.45 0.15 0.95\r\n14 0.01 2.14 -1.84 0.25 0.94\r\n15 0.03 0.86  0.41 0.20 0.93\r\n16 0.03 0.94 -0.30 0.10 0.92\r\n17 0.03 1.36 -0.18 0.20 0.91\r\n18 0.00 0.90  0.51 0.10 0.96\r\n19 0.00 0.73  1.13 0.25 0.97\r\n20 0.00 0.64  0.02 0.10 0.99\r\n\r\nDownload the item parameter file\r\n \r\nThe below code generates dichotomous response data for 1000 hypothetical test-takers using the following steps:\r\nGenerate \\(\\theta_1\\) and \\(\\theta_2\\) from a multivariate distribution with μ=(0,0) and Σ= \\(\\begin{pmatrix} 1 & 0 \\\\ 0 & 1 \\end{pmatrix}\\).\r\nCompute the probability of correct response for each test-taker given the item and person parameters.\r\nCompare the probability to a random number from a uniform distribution between 0 and 1. If the probability is higher than the random number, then assign 1. If the probability is smaller than the random number, then assign 0.\r\n\r\n\r\nrequire(MASS)\r\n\r\nresp <- matrix(nrow=1000,ncol=nrow(ipar))\r\n\r\nset.seed(34)\r\n\r\nth <- mvrnorm(1000,mu=c(0,0),Sigma=diag(2))\r\n\r\nfor(i in 1:nrow(ipar)){\r\n  \r\n  a1 <- ipar[i,]$a1\r\n  a2 <- ipar[i,]$a2\r\n  d  <- ipar[i,]$d\r\n  g  <- ipar[i,]$g\r\n  u  <- ipar[i,]$u\r\n  \r\n  z    <- a1*th[,1] + a2*th[,2] + d\r\n  prob <- g + (u-g)*(exp(z)/(1+exp(z)))\r\n  \r\n  resp[,i] <- (runif(1000,0,1)<prob)*1\r\n}\r\n\r\ncolMeans(resp)\r\n\r\n\r\n [1] 0.584 0.474 0.502 0.455 0.514 0.481 0.367 0.640 0.540 0.560 0.713\r\n[12] 0.481 0.625 0.452 0.625 0.453 0.523 0.617 0.782 0.533\r\n\r\nWe can see the two strong dimensions reflected in the scree plot based on the tetrachoric correlation matrix’s eigenvalues.\r\n\r\n\r\nrequire(qgraph)\r\n\r\ncorr <- cor_auto(resp)\r\n\r\neigens <- eigen(corr)$values\r\n\r\neigens\r\n\r\n\r\n [1] 2.7873149 2.1473382 1.1808323 1.1481684 1.0895121 1.0119774\r\n [7] 1.0035682 0.9486724 0.8881906 0.8462036 0.8433042 0.7965349\r\n[13] 0.7465649 0.7237945 0.7178061 0.6903155 0.6475087 0.6125699\r\n[19] 0.5918369 0.5779865\r\n\r\nplot(eigens)\r\n\r\n\r\n\r\n\r\nFigure 2: Scree plot based on the eigenvalues calculated from tetrachoric correlation matrix\r\n\r\n\r\n\r\nB. DETECT Index\r\nThe DETECT index is based on the optimal partitioning of a set of items. The items with positive conditional covariances are grouped in the same clusters, and the items with negative conditional covariances are grouped in different clusters. Kim (1994) proposed the following quantity for a prespecified partitioning of a set of items (P):\r\n\\[\\mathrm{D}(\\mathrm{P}) = \\frac{2}{n(n-1)}\\sum_{i=1}^{n-1}\\sum_{j=i+1}^{n}\\delta_{ij}C_{ij}(\\mathbf{\\theta_{\\alpha}}),\\] where \\(n\\) is the number of items, \\(\\theta_{\\alpha}\\) is a weighted composite of person parameters on multiple latent dimensions, \\(C_{ij}(\\mathbf{\\theta_{\\alpha}})\\) is the conditional covariance between the \\(i\\)th and \\(j\\)th items, \\(\\delta_{ij}\\) equals 1 if the \\(i\\)th and \\(j\\)th items are in the same cluster and –1 otherwise, and the summation is over all possible item pairs. We expect that a pair of items measuring the same dimension would have positive conditional covariance. In contrast, a pair of items measuring different dimensions would have a negative conditional covariance. \\(D(P)\\) value drops if pairs of items with negative conditional covariances are assigned to the same cluster, or pairs of items with positive conditional covariances are assigned to different clusters. By contrast, the \\(D(P)\\) value increases if pairs of items with negative conditional covariances are assigned to different clusters, or pairs of items with positive conditional covariances are assigned to the same cluster. Therefore, this quantity is designed to be maximized when you get the item partitioning right. Since we know the true item partitioning in the data simulated above, we can calculate this quantity in our simulated dataset based on the the true item partitioning.\r\nWhen calculating the DETECT index for a given partitioning of items, the conditional covariance for each item pair must be computed, \\(C_{ij}(\\mathbf{\\theta_{\\alpha}})\\). A sum score is used as a proxy for the weighted composite of latent dimensions (\\(\\theta_{\\alpha}\\)) in these calculations, and two different estimates are obtained by using different types of sum scores. The first estimate uses all items in the test when computing a sum score. For an \\(n\\)-item test, the possible sum scores are from 0 to \\(n\\). The whole sample is divided into \\(n+1\\) score groups based on the sum scores, and then a weighted average is computed for covariance between item \\(i\\) and item \\(j\\),\r\n\\[\\hat{C}_{ij}^{1} = \\sum_{k=0}^{n}\\frac{J_k}{N}\\hat{C}_{ij}(S=k),\\]\r\nwhere \\(J_k\\) is the number of people in the \\(k\\)th score group, \\(N\\) is the total sample size, and \\(S\\) is the sum score from all \\(n\\) items.\r\nThe second estimate is very similar to the first one. The only difference is that a different sum score is computed for each individual based on the remaining \\(n-2\\) items after excluding the \\(i\\)th and \\(j\\)th item when calculating \\(C_{ij}(\\mathbf{\\theta_{\\alpha}})\\), and this rest sum score is used for conditioning,\r\n\\[\\hat{C}_{ij}^{2} = \\sum_{k=0}^{n-2}\\frac{J_k}{N}\\hat{C}_{ij}(S_{i,j}=k),\\] where \\(S_{i,j}\\) is the rest sum score for the remaining \\(n-2\\) items after excluding item \\(i\\) and item \\(j\\).\r\n\\[C_{ij}(\\mathbf{\\theta_{\\alpha}}) = \\frac{\\hat{C}_{ij}^{1} + \\hat{C}_{ij}^{2}}{2}\\] Then, \\(D(P)\\) is an aggregate measure of pairwise local dependence for the entire test.\\(D(P)\\) should be equal to zero at the population level if the test is indeed unidimensional, and any departure from 0 is an indication of multidimensionality. \\(D(P)\\) value is multiplied by 100 to make the interpretation easier.\r\nSeveral cut-off values are given in the literature for different DETECT index levels (e.g., Stout, Nandakumar, Habing, 1996; Roussos & Ozbek, 2006), although it is questionable how useful these thresholds are in practice and whether or not they apply to all conditions. For instance, Stout et al. recommended the following classification based on the magnitude of D(P):\r\nBelow 0.10 –> unidimensionality\r\n(0.10,0.50] –> weak multidimensionality\r\n(0.50,1.00] –> moderate multidimensionality\r\n(1.00,1.50] –> strong multidimensionality\r\nAbove 1.50 –> very strong multidimensionality\r\nBelow, we compute the conditional covariance for 190 item pairs from the simulated dataset.\r\n\r\n\r\nCCOV <- matrix(nrow=20,ncol=20)\r\n\r\nfor(i in 1:19){\r\n  for(j in (i+1):20){\r\n    \r\n    ccov1 <- c()\r\n    S1    <- rowSums(resp)\r\n    \r\n    for(k in 0:20){\r\n      if(length(which(S1==k))!=0){\r\n        sub = which(S1==k)\r\n        ccov1[k] = (cov(resp[sub,i],resp[sub,j]))*(length(sub)/nrow(resp))\r\n      }\r\n    }\r\n    \r\n    \r\n    ccov2 <- c()\r\n    S2    <- rowSums(resp[,-c(i,j)])\r\n    \r\n    for(k in 0:18){\r\n      if(length(which(S2==k))!=0){\r\n        sub = which(S2==k)\r\n        ccov2[k] = (cov(resp[sub,i],resp[sub,j]))*(length(sub)/nrow(resp))\r\n      }\r\n    }\r\n    \r\n    CCOV[i,j]=(sum(ccov1,na.rm=TRUE)+sum(ccov2,na.rm=TRUE))/2\r\n  }\r\n}\r\n\r\ndata.frame(round(CCOV,3)) %>%\r\n  kbl() %>%\r\n  kable_classic(full_width = F)\r\n\r\n\r\n\r\nX1\r\n\r\n\r\nX2\r\n\r\n\r\nX3\r\n\r\n\r\nX4\r\n\r\n\r\nX5\r\n\r\n\r\nX6\r\n\r\n\r\nX7\r\n\r\n\r\nX8\r\n\r\n\r\nX9\r\n\r\n\r\nX10\r\n\r\n\r\nX11\r\n\r\n\r\nX12\r\n\r\n\r\nX13\r\n\r\n\r\nX14\r\n\r\n\r\nX15\r\n\r\n\r\nX16\r\n\r\n\r\nX17\r\n\r\n\r\nX18\r\n\r\n\r\nX19\r\n\r\n\r\nX20\r\n\r\n\r\n\r\n\r\n0.004\r\n\r\n\r\n0.015\r\n\r\n\r\n0.006\r\n\r\n\r\n0.006\r\n\r\n\r\n-0.001\r\n\r\n\r\n0.012\r\n\r\n\r\n0.007\r\n\r\n\r\n0.007\r\n\r\n\r\n0.017\r\n\r\n\r\n-0.009\r\n\r\n\r\n-0.011\r\n\r\n\r\n-0.010\r\n\r\n\r\n-0.022\r\n\r\n\r\n-0.028\r\n\r\n\r\n-0.003\r\n\r\n\r\n-0.016\r\n\r\n\r\n-0.008\r\n\r\n\r\n-0.013\r\n\r\n\r\n-0.008\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.005\r\n\r\n\r\n0.010\r\n\r\n\r\n0.001\r\n\r\n\r\n0.001\r\n\r\n\r\n0.016\r\n\r\n\r\n0.006\r\n\r\n\r\n0.012\r\n\r\n\r\n-0.001\r\n\r\n\r\n-0.018\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.013\r\n\r\n\r\n-0.005\r\n\r\n\r\n-0.008\r\n\r\n\r\n-0.020\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.010\r\n\r\n\r\n-0.008\r\n\r\n\r\n-0.014\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.017\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.006\r\n\r\n\r\n0.006\r\n\r\n\r\n0.016\r\n\r\n\r\n0.011\r\n\r\n\r\n0.013\r\n\r\n\r\n-0.001\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.009\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.002\r\n\r\n\r\n0.003\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.015\r\n\r\n\r\n-0.010\r\n\r\n\r\n-0.028\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.016\r\n\r\n\r\n0.008\r\n\r\n\r\n0.019\r\n\r\n\r\n0.011\r\n\r\n\r\n0.018\r\n\r\n\r\n0.019\r\n\r\n\r\n-0.009\r\n\r\n\r\n-0.024\r\n\r\n\r\n-0.023\r\n\r\n\r\n-0.008\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.011\r\n\r\n\r\n-0.028\r\n\r\n\r\n-0.020\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.013\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n-0.011\r\n\r\n\r\n0.002\r\n\r\n\r\n0.013\r\n\r\n\r\n0.005\r\n\r\n\r\n0.007\r\n\r\n\r\n-0.002\r\n\r\n\r\n-0.025\r\n\r\n\r\n-0.012\r\n\r\n\r\n0.007\r\n\r\n\r\n-0.009\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.019\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.005\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.006\r\n\r\n\r\n-0.001\r\n\r\n\r\n0.002\r\n\r\n\r\n-0.002\r\n\r\n\r\n-0.007\r\n\r\n\r\n-0.006\r\n\r\n\r\n0.009\r\n\r\n\r\n-0.001\r\n\r\n\r\n-0.003\r\n\r\n\r\n-0.026\r\n\r\n\r\n0.007\r\n\r\n\r\n-0.018\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.003\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.002\r\n\r\n\r\n0.018\r\n\r\n\r\n0.013\r\n\r\n\r\n-0.016\r\n\r\n\r\n-0.016\r\n\r\n\r\n-0.003\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.021\r\n\r\n\r\n-0.015\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.013\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.005\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.009\r\n\r\n\r\n0.002\r\n\r\n\r\n-0.009\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.016\r\n\r\n\r\n-0.002\r\n\r\n\r\n-0.005\r\n\r\n\r\n-0.007\r\n\r\n\r\n-0.018\r\n\r\n\r\n-0.017\r\n\r\n\r\n0.003\r\n\r\n\r\n-0.011\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.021\r\n\r\n\r\n-0.015\r\n\r\n\r\n-0.013\r\n\r\n\r\n-0.023\r\n\r\n\r\n-0.020\r\n\r\n\r\n-0.006\r\n\r\n\r\n-0.015\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.007\r\n\r\n\r\n-0.006\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n-0.011\r\n\r\n\r\n-0.005\r\n\r\n\r\n-0.010\r\n\r\n\r\n-0.019\r\n\r\n\r\n-0.015\r\n\r\n\r\n-0.014\r\n\r\n\r\n-0.011\r\n\r\n\r\n-0.012\r\n\r\n\r\n-0.011\r\n\r\n\r\n-0.003\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.003\r\n\r\n\r\n0.013\r\n\r\n\r\n-0.002\r\n\r\n\r\n-0.002\r\n\r\n\r\n0.011\r\n\r\n\r\n0.009\r\n\r\n\r\n0.001\r\n\r\n\r\n0.004\r\n\r\n\r\n0.015\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.007\r\n\r\n\r\n0.018\r\n\r\n\r\n0.014\r\n\r\n\r\n0.018\r\n\r\n\r\n0.016\r\n\r\n\r\n0.013\r\n\r\n\r\n0.000\r\n\r\n\r\n0.008\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.007\r\n\r\n\r\n0.008\r\n\r\n\r\n0.001\r\n\r\n\r\n0.017\r\n\r\n\r\n0.017\r\n\r\n\r\n0.005\r\n\r\n\r\n0.002\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.005\r\n\r\n\r\n0.014\r\n\r\n\r\n0.018\r\n\r\n\r\n0.016\r\n\r\n\r\n0.001\r\n\r\n\r\n-0.009\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.008\r\n\r\n\r\n0.015\r\n\r\n\r\n0.014\r\n\r\n\r\n0.002\r\n\r\n\r\n-0.006\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.000\r\n\r\n\r\n0.012\r\n\r\n\r\n0.009\r\n\r\n\r\n0.001\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.007\r\n\r\n\r\n0.006\r\n\r\n\r\n0.005\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.004\r\n\r\n\r\n0.001\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0.010\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n   \r\nNext, we need a similar matrix for \\(\\delta\\) values. The correct partitioning of items will be used to get the maximum DETECT value: Item 1 - Item 10 in Cluster 1 and Item 11-20 in Cluster 2. We assign 1 for the item pairs in the same cluster and -1 for the item pairs in different clusters.\r\n\r\n\r\ncl1 <- 1:10\r\ncl2 <- 11:20\r\n\r\npos.pairs <- data.frame(\r\n                        rbind(\r\n                          t(combn(cl1,2)),\r\n                          t(combn(cl2,2)))\r\n                        )\r\npos.pairs$val <- 1\r\n\r\nneg.pairs <- expand.grid(X1=cl1,X2=cl2)\r\nneg.pairs$val <- -1\r\n\r\npairs <- rbind(pos.pairs,neg.pairs)\r\n\r\ndelta <- matrix(nrow=20,ncol=20)\r\n\r\nfor(i in 1:nrow(pairs)){\r\n  delta[pairs[i,1],pairs[i,2]] = pairs[i,3]\r\n}\r\n\r\n\r\ndata.frame(delta) %>%\r\n  kbl() %>%\r\n  kable_classic(full_width = F)\r\n\r\n\r\n\r\nX1\r\n\r\n\r\nX2\r\n\r\n\r\nX3\r\n\r\n\r\nX4\r\n\r\n\r\nX5\r\n\r\n\r\nX6\r\n\r\n\r\nX7\r\n\r\n\r\nX8\r\n\r\n\r\nX9\r\n\r\n\r\nX10\r\n\r\n\r\nX11\r\n\r\n\r\nX12\r\n\r\n\r\nX13\r\n\r\n\r\nX14\r\n\r\n\r\nX15\r\n\r\n\r\nX16\r\n\r\n\r\nX17\r\n\r\n\r\nX18\r\n\r\n\r\nX19\r\n\r\n\r\nX20\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n-1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n   \r\nTo compute the DETECT index, we multiply the corresponding elements of these two matrices, take the average of this product, and multiply the average by 100.\r\n\r\n\r\nmean(delta[upper.tri(delta)]*CCOV[upper.tri(CCOV)])*100\r\n\r\n\r\n[1] 0.9428365\r\n\r\nNot surprisingly, the simulated dataset’s DETECT index is 0.943, indicating somewhat strong multidimensionality, which we already know about this dataset.\r\nC. Analyzing the Simulated Dataset Using the DETECT program\r\nWhen we know the true dimensional structure of data, it is straightforward to compute the DETECT index for a given dataset, and there is nothing that should excite us to do so. What is more exciting is to explore and try to reveal the dimensional structure when we don’t know the underlying structure. Imagine how many possible partitioning there exists for a given set of items. For instance, when you have a three-item test, there are five possible partitionings as follows:\r\nEach item loads on a different dimension: {(1),(2),(3)}\r\nItem 1 and 2 loads on one dimension, and Item 3 loads on another dimension: {(1,2),(3)}\r\nItem 1 and 3 loads on one dimension, and Item 2 loads on another dimension: {(1,3),(2)}.\r\nItem 2 and 3 loads on one dimension, and Item 2 loads on another dimension: {(2,3),(1)}.\r\nAll items load on the same dimension, {(1,2,3)}\r\nThe total number of partitions for an n-item test is equal to a Bell number in mathematics and increases incredibly as the number of elements increases. For instance, the number of possible partitions reaches 115,975 for ten items. Thus, dimensionality analysis becomes an optimization problem through an exhaustive search for the optimal partitioning of items that give the maximum DETECT value. Kim (1994) originally proposed using some prior judgments with cluster analysis to begin. Then, (Zhang & Stout, 1999) developed a more sound solution by using a genetic algorithm to optimize the maximum DETECT value among all possible partitions of a set of items. In this optimization process, an informed choice of a partition is specified by the user (e.g., based on cluster analysis) to start. Then the genetic algorithm is used to find the optimum partitioning.\r\nI wish I could have the skills to demonstrate how this algorithm works by walking you through some R code, but unfortunately, I don’t (maybe one day, there is always hope!). The original Fortran code for the software is available if you download the DIMPACK software. detect4.exe is a compiled Fortran code that requires a text file as an input to run the analysis for a given dataset.\r\nDownload the detect4.exe file\r\nDownload the Fortran source code for the detect4.exe file\r\nThe input text file for the detect4.exe program should look like this, and the extension of the file should be .in. In the next section, we will automate the creation of this input text file.\r\n\r\nname of data file\r\nC:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/resp.dat\r\nno.of items\r\n20\r\nno.of examinees\r\n1000\r\nmincell\r\n2\r\nmutations\r\n4\r\nmax dimensions\r\n12\r\ndropflag\r\n0\r\nno.of items to drop from the analysis\r\n0\r\nitems to be dropped\r\n0\r\nconfimatory flag\r\n0\r\ncrosflag\r\n0\r\nno.of examinees to set aside for cross validation\r\n0\r\nseed\r\n99991\r\nname of detect summary output file\r\nC:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/resp.out\r\ncluster output flag\r\n0\r\ncovariance output flag\r\n0\r\n\r\nDownload the DETECT input file\r\nThe inputs in this file are:\r\nname of data file –> a path to the sample dataset to be analyzed\r\nno.of items –> number of items in the sample dataset\r\nno.of examinees –> number of examinees in the sample dataset\r\nmincell –> the minimum number of examinees required to be present in any one cell when calculating the conditional covariances\r\nmutations –> number of vectors mutated in the genetic algorithm. A fifth of the number of items recommended.\r\nmax dimensions –> maximum number of dimensions to expand the search. Twelve is the maximum allowed.\r\ndropflag –> 0/1, 0 means no items dropped and the next 4 lines are ignored\r\nconfimatory flag –> 0/1, 0 means exploratory DETECT analysis, 1 means confirmatory DETECT analysis. For confirmatory DETECT analysis, item clusters must be provided in a separate file.\r\ncrosflag –> 0/1, 0 means no cross validation and next 2 lines ignored.\r\nno.of examinees to set aside for cross validation –> if crossflag is 1, then this is the number of examinees in the dataset to be used for cross validation\r\nseed –> seed number for random number generation. This number is used in the genetic algorithm random search mechanism and/or in randomly splitting the data if cross-validation is requested.\r\nname of detect summary output file –> the name for the output file to be written\r\ncluster output flag –> 0/1, 0 means no separate output file, 1 creates a separate file ‘cluster.out’ for item clusters\r\ncovariance output flag –> 0/1 0 means no covariance output file, 1 creates ‘cov.out’ for conditional covariances calculated\r\nOnce this input file is created, we also need the data file to exist in the same directory. For DETECT analysis, I always prepare my datasets in fixed-width format such that each character corresponds to an item. You can use the following code to write the sample data file in fixed-width format.\r\n\r\n\r\n  require(gdata)\r\n\r\n  write.fwf(resp,\r\n            here('_posts/2020-12-04-detect/test/resp.dat'),\r\n            width=rep(1,ncol(resp)),\r\n            na=' ',\r\n            sep='',\r\n            rownames=FALSE,colnames=FALSE)\r\n\r\n\r\n\r\nOur data in fixed-width format should look like this.\r\n\r\n\r\n\r\nFigure 3: A screenshot of fixed-width format data file\r\n\r\n\r\n\r\nTo run detect4.exe from R, you need to have these three files in the same folder.\r\nThe dataset as a text file in a fixed-width format (e.g., resp.dat)\r\nThe DETECT input file (detect.in)\r\ndetect4.exe file\r\nFinally, we can invoke a system command to execute the analysis using the detect4.exe file for the given input file. In this case, I created a test folder, and all these files, including the detect4.exe, are located in .../_posts/2020-12-04-detect/test/.\r\n\r\n\r\n    system(here('_posts/2020-12-04-detect/test/detect4.exe'))\r\n\r\n\r\n\r\n\r\n\r\n\r\nFigure 4: Necessary files to run detect4.exe file\r\n\r\n\r\n\r\nWhen the Fortran code is examined, it appears that detect4.exe specifically searches for a file labeled as detect.in in the same folder when it is invoked and always runs that file. Therefore, the input file in the folder must always be labeled as detect.in. This information is important for the next section when you analyze many datasets. You have to update the information in the detect.in file every time you analyze a different dataset. Once the analysis is done, the DETECT output file (resp.out) should be written in the same folder after the analysis.\r\n\r\n-------------------------------------------------------\r\n                  DETECT SUMMARY OUTPUT\r\n-------------------------------------------------------\r\n \r\n                    Data File Name: C:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/resp.dat                                           \r\n\r\n              Number of Items used:       20\r\n\r\n           Number of Items dropped:        0\r\n\r\n               Number of Examinees:     1000\r\n\r\n                 Minimum Number of \r\n                Examinees per Cell:        2\r\n\r\n         Number of Vectors Mutated:        4\r\n\r\n      Maximum Number of Dimensions:       12\r\n\r\n                Randomization Seed:    99991\r\n\r\n   Minimum percentage of examinees\r\n         used after deleting cells\r\n     having less than  2 examinees:    99.70\r\n\r\n   Average percentage of examinees\r\n         used after deleting cells\r\n     having less than  2 examinees:    99.97\r\n \r\n-------------------------------------------------------\r\n\r\n NUMBER OF DIMENSIONS THAT MAXIMIZE DETECT:  3\r\n \r\n  Exploratory DETECT Statistics:\r\n\r\n              Maximum DETECT value:   0.9344\r\n                   IDN index value:   0.9158\r\n                           Ratio r:   0.9205\r\n\r\n PARTITION WITH MAXIMUM DETECT VALUE:\r\n....\r\n\r\nDownload the DETECT output file\r\nFor this particular simulated dataset, DETECT analysis found three dimensions. It got pretty close to the true structure. The only issue is that the analysis isolated Item 6 on its own from the other two clusters and incorrectly didn’t assign it to where it belongs. That is OK as there is no guarantee that the DETECT procedure will do a perfect job in revealing the underlying structure, and we can speculate that this is probably a sampling error in this case. The maximum DETECT value is reported as 0.9344. This number is slightly different than the maximum DETECT value of 0.9428 we calculated above for the correct partitioning. So, DETECT reports the value for what it thinks the optimal partitioning. Since DETECT couldn’t recover the true partitioning 100%, there is a slight deviation from the DETECT value we calculated for the true partitioning of items.\r\nD. Automating DETECT Runs for a Simulation Study\r\nWe have now a basic sense of what a DETECT input file and input dataset should look like and how we run it using the R system() command. This is all we need to automate many DETECT runs. In this post, I will consider studying the small sample performance of DETECT. For instance, how does the DETECT estimate’s sampling distribution look like when you have a small sample size (e.g., 250)? Is the DETECT estimate biased? How large is the standard error? The study by Roussos and Ozbek (2006) looked at this but for a sample size of 120,000. So, we will just replicate a small piece of it, but for the sample size of 250. Note that I am not aware of any large-sample theory developed for the DETECT statistic. We don’t have equations to calculate its standard error for given sample size, or we don’t necessarily know its distribution. A simulation-based approach seems to be the only way to do it.\r\nWe will need a few things to accomplish this. First, we would have to figure out the population level DETECT parameter for a given set of multidimensional item parameters. Roussos and Ozbek (2006) provide the equations to compute it, but they involve double integration. I can’t calculate it as they did in their paper using these equations (I am working on it!). Another way to get an idea about the population DETECT parameter for a given set of multidimensional item parameters is to simulate a dataset with a considerable sample size (e.g., 500,000) and then analyze it using the DETECT program. We can hope that the DETECT obtained from such a big dataset is pretty close to the population DETECT parameter given the set of item parameters used to generate the dataset. When I did that, I got an estimate of 0.899. The original DETECT program has a limit of 120,000 for sample size. So, I had to re-compile the original Fortran code by changing the limit from 120,000 to 500,000. So, let’s suppose that 0.899 is the population DETECT parameter for this particular set of multidimensional item parameters.\r\nSecond, we need a function to simulate data and write the simulated data in a proper format. Below is a function that takes sample size (N), item parameter matrix (ip), a path for a folder to store all the files generated (dir), and a file name (name).\r\n\r\n\r\nsim.m4pl <- function(N,ip,dir,name){\r\n  \r\n  #    N, sample size, integer\r\n  \r\n  #   ip, item parameter matrix, five columns (a1, a2, d, g, and u)\r\n  #       each row represents an item\r\n  \r\n  #  dir, path to a folder to store the files\r\n  #   e.g., C:/Users/cengiz/Desktop/test\r\n  \r\n  # name, a name for the files to be used while writing the data into the folder\r\n\r\n  resp <- matrix(nrow=N,ncol=nrow(ip))\r\n\r\n  th <- mvrnorm(N,mu=c(0,0),Sigma=diag(2))\r\n\r\n  for(i in 1:nrow(ip)){\r\n  \r\n    a1 <- ip[i,]$a1\r\n    a2 <- ip[i,]$a2\r\n    d  <- ip[i,]$d\r\n    g  <- ip[i,]$g\r\n    u  <- ip[i,]$u\r\n  \r\n    z    <- a1*th[,1] + a2*th[,2] + d\r\n    prob <- g + (u-g)*(exp(z)/(1+exp(z)))\r\n  \r\n    resp[,i] <- (runif(N,0,1)<prob)*1\r\n  }\r\n\r\n  write.fwf(resp,\r\n            paste0(dir,'/',name,'.dat'),\r\n            width=rep(1,ncol(resp)),\r\n            na=' ',\r\n            sep='',\r\n            rownames=FALSE,colnames=FALSE)\r\n\r\n  return(resp=resp)\r\n\r\n}\r\n\r\n\r\n\r\nOnce we have the function, we can simulate data using the multidimensional 4PL model with two dimensions for any given sample size and item parameter matrix. The following code will generate a dataset for 250 hypothetical individuals using the item parameter matrix we used before and export it to a text file (rep1.dat) in the specified folder using a fixed-width format.\r\n\r\n\r\nd <- sim.m4pl(N=250,\r\n             ip=ipar,\r\n             dir= here('_posts/2020-12-04-detect/test'),\r\n             name='rep1')\r\n\r\n\r\n\r\nThird, we need a function to update the detect.in file so that the program analyzes the right dataset every time we invoke the detect4.exe file. Below is a function that takes the generated dataset from the previous function (data), the name being used for saving the dataset, and the path for the same folder the dataset was saved (dir).\r\n\r\n\r\nwrt.inp <- function(data,name,dir){\r\n  \r\n  # data, item response data matrix with N rows and k items\r\n  # name, name for the text file the data is saved\r\n  # dir, path to the same folder the data is stored\r\n  \r\n  ctl <- c(\"name of data file\")\r\n  ctl <- rbind(ctl,paste0(dir,\"/\",name,\".dat\",sep=\"\"))\r\n  ctl <- rbind(ctl,c(\"no.of items\"))\r\n  ctl <- rbind(ctl,ncol(data))\r\n  ctl <- rbind(ctl,c(\"no.of examinees\"))\r\n  ctl <- rbind(ctl,nrow(data))\r\n  ctl <- rbind(ctl,c(\"mincell\"))\r\n  ctl <- rbind(ctl,2)\r\n  ctl <- rbind(ctl,c(\"mutations\"))\r\n  ctl <- rbind(ctl,ncol(data)/5)\r\n  ctl <- rbind(ctl,c(\"max dimensions\"))\r\n  ctl <- rbind(ctl,12)\r\n  ctl <- rbind(ctl,c(\"dropflag\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"no.of items to drop from the analysis\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"items to be dropped\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"confimatory flag\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"crosflag\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"no.of examinees to set aside for cross validation\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"seed\"))\r\n  ctl <- rbind(ctl,99991 )\r\n  ctl <- rbind(ctl,c(\"name of detect summary output file\"))\r\n  ctl <- rbind(ctl,paste0(dir,\"/\",name,\".out\",sep=\"\"))\r\n  ctl <- rbind(ctl,c(\"cluster output flag\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- rbind(ctl,c(\"covariance output flag\"))\r\n  ctl <- rbind(ctl,0)\r\n  ctl <- noquote(ctl)\r\n  write(ctl,paste0(dir,\"/detect.in\",sep=\"\"))  \r\n}\r\n\r\n\r\n\r\nWhen we run the following code, it reproduces the detect.in file by overwriting the information for the following arguments according to the dataset and name provided:\r\nname of data file\r\nno.of items\r\nno.of examinees\r\nname of detect summary output file\r\n\r\n\r\nwrt.inp(data=d,\r\n        name='rep1',\r\n        dir=here('_posts/2020-12-04-detect/test'))\r\n\r\n\r\n\r\n\r\nname of data file\r\nC:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/rep1.dat\r\nno.of items\r\n20\r\nno.of examinees\r\n250\r\nmincell\r\n2\r\nmutations\r\n4\r\nmax dimensions\r\n12\r\ndropflag\r\n0\r\nno.of items to drop from the analysis\r\n0\r\nitems to be dropped\r\n0\r\nconfimatory flag\r\n0\r\ncrosflag\r\n0\r\nno.of examinees to set aside for cross validation\r\n0\r\nseed\r\n99991\r\nname of detect summary output file\r\nC:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/rep1.out\r\ncluster output flag\r\n0\r\ncovariance output flag\r\n0\r\n\r\nWe can now invoke a system command again to execute the analysis using detect4.exe for the dataset we just generated with a sample size of 250 using the same item parameters.\r\n\r\n\r\n    system(here('_posts/2020-12-04-detect/test/detect4.exe'))\r\n\r\n\r\n\r\n\r\n-------------------------------------------------------\r\n                  DETECT SUMMARY OUTPUT\r\n-------------------------------------------------------\r\n \r\n                    Data File Name: C:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/rep1.dat                                           \r\n\r\n              Number of Items used:       20\r\n\r\n           Number of Items dropped:        0\r\n\r\n               Number of Examinees:      250\r\n\r\n                 Minimum Number of \r\n                Examinees per Cell:        2\r\n\r\n         Number of Vectors Mutated:        4\r\n\r\n      Maximum Number of Dimensions:       12\r\n\r\n                Randomization Seed:    99991\r\n\r\n   Minimum percentage of examinees\r\n         used after deleting cells\r\n     having less than  2 examinees:    98.80\r\n\r\n   Average percentage of examinees\r\n         used after deleting cells\r\n     having less than  2 examinees:    99.50\r\n \r\n-------------------------------------------------------\r\n\r\n NUMBER OF DIMENSIONS THAT MAXIMIZE DETECT:  4\r\n \r\n  Exploratory DETECT Statistics:\r\n\r\n              Maximum DETECT value:   0.7276\r\n                   IDN index value:   0.6842\r\n                           Ratio r:   0.5866\r\n\r\n PARTITION WITH MAXIMUM DETECT VALUE:\r\n....\r\n\r\nThis outcome is only for one replication. What would happen if we repeated the same process 1000 times? We can now generate 1000 datasets, update the detect.in for each one of them, and then invoke a system command again to execute the analysis. With all the machinery we described above, it is straightforward through a for loop. Note that this may take a long time depending on your computer configurations. So, you have to be patient. Alternatively, we may parallelize this process to take advantage of multiple cores in most computers. Suppose your computer has 16 cores. We can utilize 10 of those cores and divide this for loop such that it runs 100 replications in each core simultaneously. Parallelizing would significantly reduce the computational time but requires some more coding experience. So, I will leave it to another post.\r\n\r\n\r\nfor(i in 1:1000){\r\n\r\n  filename <- paste0('rep',i)\r\n\r\n  d <- sim.m4pl(N=250,\r\n               ip=ipar,\r\n               dir= here('_posts/2020-12-04-detect/test'),\r\n               name=filename)\r\n\r\n  wrt.inp(data=d,\r\n        name=filename,\r\n        dir=here('_posts/2020-12-04-detect/test'))\r\n\r\n   system(here('_posts/2020-12-04-detect/test/detect4.exe'))\r\n   \r\n   print(i)\r\n}\r\n\r\n\r\n\r\nOnce this process is done, you should have a folder with thousands of files, and it should look like this. Each file with an extension .out is the DETECT output file for the corresponding dataset.\r\n\r\n\r\n\r\nFigure 5: Simulated datasets and corresponding DETECT output files\r\n\r\n\r\n\r\nWe are getting closer to the finish line. We still need to do some coding to extract all the information we need from these output files. Something that makes the extraction easier is that the output files are standardized and have almost the same structure. Here is how I approach it. First, I read an output file as a vector using the scan() function.\r\n\r\n\r\n\r\noutput <- scan(here('_posts/2020-12-04-detect/test/rep1.out'),what=c('raw'))\r\n\r\noutput\r\n\r\n\r\n[1] “——————————————————-”\r\n[2] “DETECT”\r\n[3] “SUMMARY”\r\n[4] “OUTPUT”\r\n[5] “——————————————————-”\r\n[6] “Data”\r\n[7] “File”\r\n[8] “Name:”\r\n[9] \"C:/Users/cengiz/Desktop/Github/website/_posts/2020-12-04-detect/test/rep1.dat\" [10] “Number”\r\n[11] “of”\r\n[12] “Items”\r\n[13] “used:”\r\n[14] “20”\r\n[15] “Number”\r\n[16] “of”\r\n[17] “Items”\r\n[18] “dropped:”\r\n[19] “0”\r\n[20] “Number”\r\n[21] “of”\r\n[22] “Examinees:”\r\n[23] “250”\r\n[24] “Minimum”\r\n[25] “Number”\r\n[26] “of”\r\n[27] “Examinees”\r\n[28] “per”\r\n[29] “Cell:”\r\n[30] “2”\r\n[31] “Number”\r\n[32] “of”\r\n[33] “Vectors”\r\n[34] “Mutated:”\r\n[35] “4”\r\n[36] “Maximum”\r\n[37] “Number”\r\n[38] “of”\r\n[39] “Dimensions:”\r\n[40] “12”\r\n[41] “Randomization”\r\n[42] “Seed:”\r\n[43] “99991”\r\n[44] “Minimum”\r\n[45] “percentage”\r\n[46] “of”\r\n[47] “examinees”\r\n[48] “used”\r\n[49] “after”\r\n[50] “deleting”\r\n[51] “cells”\r\n[52] “having”\r\n[53] “less”\r\n[54] “than”\r\n[55] “2”\r\n[56] “examinees:”\r\n[57] “98.80”\r\n[58] “Average”\r\n[59] “percentage”\r\n[60] “of”\r\n[61] “examinees”\r\n[62] “used”\r\n[63] “after”\r\n[64] “deleting”\r\n[65] “cells”\r\n[66] “having”\r\n[67] “less”\r\n[68] “than”\r\n[69] “2”\r\n[70] “examinees:”\r\n[71] “99.50”\r\n[72] “——————————————————-”\r\n[73] “NUMBER”\r\n[74] “OF”\r\n[75] “DIMENSIONS”\r\n[76] “THAT”\r\n[77] “MAXIMIZE”\r\n[78] “DETECT:”\r\n[79] “4”\r\n[80] “Exploratory”\r\n[81] “DETECT”\r\n[82] “Statistics:”\r\n[83] “Maximum”\r\n[84] “DETECT”\r\n[85] “value:”\r\n[86] “0.7276”\r\n[87] “IDN”\r\n[88] “index”\r\n[89] “value:”\r\n[90] “0.6842”\r\n[91] “Ratio”\r\n[92] “r:”\r\n[93] “0.5866”\r\n[94] “PARTITION”\r\n[95] “WITH”\r\n[96] “MAXIMUM”\r\n[97] “DETECT”\r\n[98] “VALUE:”\r\n[99] “1”\r\n[100] “2”\r\n[101] “2”\r\n[102] “2”\r\n[103] “1”\r\n[104] “1”\r\n[105] “2”\r\n[106] “1”\r\n[107] “2”\r\n[108] “2”\r\n[109] “3”\r\n[110] “3”\r\n[111] “3”\r\n[112] “4”\r\n[113] “3”\r\n[114] “3”\r\n[115] “3”\r\n[116] “3”\r\n[117] “4”\r\n[118] “3”\r\n[119] “CLUSTER”\r\n[120] “MEMBERSHIPS:”\r\n[121] “———–CLUSTER”\r\n[122] “1————-”\r\n[123] “1”\r\n[124] “5”\r\n[125] “6”\r\n[126] “8”\r\n[127] “———–CLUSTER”\r\n[128] “2————-”\r\n[129] “2”\r\n[130] “3”\r\n[131] “4”\r\n[132] “7”\r\n[133] “9”\r\n[134] “10”\r\n[135] “———–CLUSTER”\r\n[136] “3————-”\r\n[137] “11”\r\n[138] “12”\r\n[139] “13”\r\n[140] “15”\r\n[141] “16”\r\n[142] “17”\r\n[143] “18”\r\n[144] “20”\r\n[145] “———–CLUSTER”\r\n[146] “4————-”\r\n[147] “14”\r\n[148] “19”\r\n[149] “———————————-”\r\n[150] “Covariance”\r\n[151] “Sign”\r\n[152] “Pattern”\r\n[153] “Matrix:”\r\n[154] “d++—-++–+-+—-+-”\r\n[155] “+d+-++-+-+—+—++-”\r\n[156] “++d++–+-+–+-+—++”\r\n[157] “–+d-+++—+-+–+—”\r\n[158] “-++-d+-+++—–++—”\r\n[159] “-+-++d+-+—–+–+-+”\r\n[160] “—+-+d-++-+——-+”\r\n[161] “+++++–d++-++-+-+—”\r\n[162] “+—++++d–+—+-+-+”\r\n[163] “-++-+-++-d-+——++”\r\n[164] “———-d+++++-++-”\r\n[165] “+–+–+++++d++-+++-+”\r\n[166] “–+—-+–++d++-++++”\r\n[167] “++-+——+++d++++–”\r\n[168] “–+–+-+–+-++d+–+-”\r\n[169] “—-+—+-++-++d++–”\r\n[170] “—++–+—+++-+d+–”\r\n[171] “-+—+–+-++++-++d–”\r\n[172] “+++——++-+-+—d+”\r\n[173] “–+–++-++-++—–+d”\r\n[174] “No”\r\n[175] “cross”\r\n[176] “validation”\r\n[177] “for”\r\n[178] “this”\r\n[179] “DETECT”\r\n[180] “run”\r\n\r\n\r\nThis vector will look alike for almost all datasets being analyzed. I am interested in three pieces of information in this output.\r\nDETECT estimate\r\nNumber of dimensions\r\nThe proportion of item pairs correctly assigned to clusters\r\nFor instance, the DETECT estimate is reported as element 86 for this particular output file; however, its position may slightly change from file to file. We need a unique text that appears in the output file to help identify its position. For instance, the word Statistics: only appears once in this output file, and the DETECT estimate is reported four elements after Statistics: no matter what dataset being analyzed. I can use Statistics: as a reference point to extract the DETECT estimate like the following.\r\n\r\n\r\n as.numeric(output[which(output=='Statistics:')+4])\r\n\r\n\r\n[1] 0.7276\r\n\r\nI can use a similar approach for extracting the estimated number of dimensions. The word MAXIMIZE only appears once in this output file, and the number of estimated dimensions is reported two elements after MAXIMIZE.\r\n\r\n\r\n as.numeric(output[which(output=='MAXIMIZE')+2])\r\n\r\n\r\n[1] 4\r\n\r\nItem partitioning is a little trickier but still possible. The word PARTITION only appears once in this output file, and the first element of partitioning information is reported five elements after PARTITION. The word MEMBERSHIPS: only appears once in this output file, and the last element of partitioning information is reported two elements before MEMBERSHIPS:.\r\n\r\n\r\n first <- which(output=='PARTITION')+5\r\n last  <- which(output=='MEMBERSHIPS:')-2\r\n\r\n  as.numeric(output[first:last])\r\n\r\n\r\n[1] 1 2 2 2 1 1 2 1 2 2 3 3 3 4 3 3 3 3 4 3\r\n\r\nThis vector displays the assigned cluster for each item. We can compare it to true partitioning. This may be done in many ways. Below is my approach. I create a vector for true cluster assignments (true.cl), and I also store the estimated cluster assignments as a vector (est.cl). Then, I create two 20 by 20 matrix, one for true assignments (pop.cl) and one for estimated assignments (sam.cl). I run a double for loop to check each item pair. If two items are in the same cluster, I assign 1 and 0 otherwise for both the true and estimated cluster assignments. In the end, I compare two matrices. The item pairs with matching code (either 1 or 0) are the correct assignments based on the analysis. We can divide the total number of correct assignments by 190 (all possible pairs for 20 items) to find the proportion of item pairs correctly assigned by the analysis. For this particular dataset, 78.9% of all possible item pairs are correctly assigned by DETECT.\r\n\r\n\r\n  est.cl <- as.numeric(output[first:last])\r\n\r\n  true.cl <- c(rep(1,10),rep(2,10))\r\n   \r\n  pop.cl <- matrix(nrow=20,ncol=20)\r\n  sam.cl <- matrix(nrow=20,ncol=20)\r\n  \r\n    for(i in 1:19){\r\n      for(j in (i+1):20){\r\n        pop.cl[i,j] = ifelse(true.cl[i]==true.cl[j],1,0)\r\n        sam.cl[i,j] = ifelse(est.cl[i]==est.cl[j],1,0)\r\n      }\r\n    }\r\n\r\n  \r\ndata.frame(pop.cl) %>%\r\n  kbl() %>%\r\n  kable_classic(full_width = F)\r\n\r\n\r\n\r\nX1\r\n\r\n\r\nX2\r\n\r\n\r\nX3\r\n\r\n\r\nX4\r\n\r\n\r\nX5\r\n\r\n\r\nX6\r\n\r\n\r\nX7\r\n\r\n\r\nX8\r\n\r\n\r\nX9\r\n\r\n\r\nX10\r\n\r\n\r\nX11\r\n\r\n\r\nX12\r\n\r\n\r\nX13\r\n\r\n\r\nX14\r\n\r\n\r\nX15\r\n\r\n\r\nX16\r\n\r\n\r\nX17\r\n\r\n\r\nX18\r\n\r\n\r\nX19\r\n\r\n\r\nX20\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\ndata.frame(sam.cl) %>%\r\n  kbl() %>%\r\n  kable_classic(full_width = F)\r\n\r\n\r\n\r\nX1\r\n\r\n\r\nX2\r\n\r\n\r\nX3\r\n\r\n\r\nX4\r\n\r\n\r\nX5\r\n\r\n\r\nX6\r\n\r\n\r\nX7\r\n\r\n\r\nX8\r\n\r\n\r\nX9\r\n\r\n\r\nX10\r\n\r\n\r\nX11\r\n\r\n\r\nX12\r\n\r\n\r\nX13\r\n\r\n\r\nX14\r\n\r\n\r\nX15\r\n\r\n\r\nX16\r\n\r\n\r\nX17\r\n\r\n\r\nX18\r\n\r\n\r\nX19\r\n\r\n\r\nX20\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n1\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n0\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  nacc = sum(pop.cl[upper.tri(pop.cl)]==sam.cl[upper.tri(sam.cl)])\r\n\r\n  nacc/190\r\n\r\n\r\n[1] 0.7894737\r\n\r\nWe can now run this for each output file and store the information in different objects for further analysis.\r\n\r\n\r\ndetect   <- c()  # vector to store DETECT estimates from 1000 runs\r\nndim     <- c()  # vector to store estimated number of dimensions from 1000 runs\r\naccuracy <- c()  # vector to accuracy of cluster assignments\r\n\r\nfor(r in 1:1000){\r\n  \r\n  filename    <- paste0('rep',r,'.out')\r\n  \r\n  output      <- scan(here('_posts/2020-12-04-detect/test/',filename),what=c('raw'))\r\n  \r\n  detect[r]   <-  as.numeric(output[which(output=='Statistics:')+4])\r\n  \r\n  ndim[r]     <-  as.numeric(output[which(output=='MAXIMIZE')+2])\r\n\r\n    est.cl  <- as.numeric(output[first:last])\r\n\r\n    true.cl <- c(rep(1,10),rep(2,10))\r\n   \r\n    pop.cl <- matrix(nrow=20,ncol=20)\r\n    sam.cl <- matrix(nrow=20,ncol=20)\r\n  \r\n      for(i in 1:19){\r\n        for(j in (i+1):20){\r\n          pop.cl[i,j] = ifelse(true.cl[i]==true.cl[j],1,0)\r\n          sam.cl[i,j] = ifelse(est.cl[i]==est.cl[j],1,0)\r\n        }\r\n      }\r\n\r\n    nacc = sum(pop.cl[upper.tri(pop.cl)]==sam.cl[upper.tri(sam.cl)])\r\n\r\n  accuracy[r] <- nacc/190\r\n  \r\n}\r\n\r\n\r\n\r\nLet’s check the distribution of DETECT estimates for 1000 datasets with a sample size of 250. The mean is 0.899, which is identical to the population value I approximated with a sample size of 500,000. We also get the standard deviation of 0.13, which may be used to approximate the DETECT estimate’s standard error when the sample size is 250 for this particular set of multidimensional item parameters.\r\n\r\n\r\nhist(detect,prob=TRUE,col='white')\r\nlines(density(detect))\r\n\r\n\r\n\r\n\r\nFigure 6: Sampling distribution of DETECT estimate (N=250) for a particular set of multidimensional item parameters\r\n\r\n\r\n\r\nmean(detect)\r\n\r\n\r\n[1] 0.8994012\r\n\r\nsd(detect)\r\n\r\n\r\n[1] 0.1311087\r\n\r\nHow about the number of estimated dimensions? It appears that DETECT has found 2 dimensions for 14% of our replications. It may be concerning that DETECT found either 3 or 4 dimensions for the majority of replications. These replications with 3 or 4 dimensions probably include only one or two items in the extra dimensions and may practically be considered as two dimensions. However, one must write more code to dive into this issue and explore it further. I am not doing it here, as I start feeling that this post will never end.\r\n\r\n\r\ntable(ndim)/1000\r\n\r\n\r\nndim\r\n    2     3     4     5     6 \r\n0.141 0.533 0.288 0.036 0.002 \r\n\r\nFinally, we can check the distribution of cluster assignment accuracy. On average, DETECT assigned 84% of all item pairs to the correct clusters.\r\n\r\n\r\nhist(accuracy,prob=TRUE,col='white')\r\nlines(density(accuracy))\r\n\r\n\r\n\r\n\r\nFigure 7: Sampling distribution of cluster assignment accuracy for a particular set of multidimensional item parameters\r\n\r\n\r\n\r\nmean(accuracy)\r\n\r\n\r\n[1] 0.8404421\r\n\r\nsd(accuracy)\r\n\r\n\r\n[1] 0.1059856\r\n\r\nI can’t believe you have read the whole thing! I hope it was worth your time. Thank you.\r\n\r\n The sirt package in R has two functions, expl.detect() and conf.detect(), for running the DETECT procedure. In a recent attempt, I could not reproduce some of the analysis I conducted in the original DETECT software using these functions. I had some concerns about what these functions produce, particularly the function for the exploratory DETECT procedure. You can find more detail about these concerns at this link. ↩︎\r\n",
    "preview": "posts/2020-12-04-detect/download.png",
    "last_modified": "2020-12-08T11:28:44-08:00",
    "input_file": "detect.utf8.md",
    "preview_width": 1152,
    "preview_height": 1152
  },
  {
    "path": "posts/crm-equating/",
    "title": "Equating Oral Reading Fluency Scores from Reading Passages",
    "description": "A non-peer reviewed opinion about how one can equate oral reading fluency scores from two reading passages with different difficulty levels using Samejima's Continuous Response Model.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2020-05-05",
    "categories": [
      "item response theory",
      "continuous response model",
      "equating",
      "R",
      "2020"
    ],
    "contents": "\r\n\r\n\r\nbody {\r\ntext-align: justify}\r\n\r\n\r\n\r\n\r\nSuppose you fit Samejima’s Continous Response Model (CRM) to several reading passages (or MAZE forms) and estimated item parameters for all passages/forms in a way that they are all on the same scale. There are a couple of ways you can do this (concurrent calibration, chain equating, or more traditional methods, as explained in this paper by Shojima). You can read this post to learn more about this model, how to estimate its parameters, and what these parameters mean.\r\nSo, let’s assume that the parameters for all reading passages are on the same scale, and you have 20 of these reading passages (Form 1, Form 2, …, Form 20).\r\n\r\n\r\n\r\n\r\n\\(a\\)\r\n\r\n\r\n\\(b\\)\r\n\r\n\r\n\\(\\alpha\\)\r\n\r\n\r\nForm 1\r\n\r\n\r\n1.246\r\n\r\n\r\n-1.068\r\n\r\n\r\n0.965\r\n\r\n\r\nForm 2\r\n\r\n\r\n1.469\r\n\r\n\r\n-0.218\r\n\r\n\r\n0.990\r\n\r\n\r\nForm 3\r\n\r\n\r\n3.594\r\n\r\n\r\n-1.026\r\n\r\n\r\n0.937\r\n\r\n\r\nForm 4\r\n\r\n\r\n1.708\r\n\r\n\r\n-0.729\r\n\r\n\r\n1.108\r\n\r\n\r\nForm 5\r\n\r\n\r\n1.759\r\n\r\n\r\n-0.625\r\n\r\n\r\n1.060\r\n\r\n\r\nForm 6\r\n\r\n\r\n3.887\r\n\r\n\r\n-1.687\r\n\r\n\r\n0.944\r\n\r\n\r\nForm 7\r\n\r\n\r\n2.076\r\n\r\n\r\n0.838\r\n\r\n\r\n0.980\r\n\r\n\r\nForm 8\r\n\r\n\r\n0.876\r\n\r\n\r\n0.153\r\n\r\n\r\n0.977\r\n\r\n\r\nForm 9\r\n\r\n\r\n1.169\r\n\r\n\r\n-1.138\r\n\r\n\r\n1.039\r\n\r\n\r\nForm 10\r\n\r\n\r\n1.319\r\n\r\n\r\n1.254\r\n\r\n\r\n0.996\r\n\r\n\r\nForm 11\r\n\r\n\r\n3.041\r\n\r\n\r\n0.426\r\n\r\n\r\n1.013\r\n\r\n\r\nForm 12\r\n\r\n\r\n1.974\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.999\r\n\r\n\r\nForm 13\r\n\r\n\r\n2.015\r\n\r\n\r\n0.895\r\n\r\n\r\n0.998\r\n\r\n\r\nForm 14\r\n\r\n\r\n1.743\r\n\r\n\r\n0.878\r\n\r\n\r\n1.068\r\n\r\n\r\nForm 15\r\n\r\n\r\n1.249\r\n\r\n\r\n0.822\r\n\r\n\r\n0.989\r\n\r\n\r\nForm 16\r\n\r\n\r\n4.029\r\n\r\n\r\n0.689\r\n\r\n\r\n1.076\r\n\r\n\r\nForm 17\r\n\r\n\r\n2.115\r\n\r\n\r\n0.554\r\n\r\n\r\n0.923\r\n\r\n\r\nForm 18\r\n\r\n\r\n0.617\r\n\r\n\r\n-0.062\r\n\r\n\r\n1.029\r\n\r\n\r\nForm 19\r\n\r\n\r\n2.341\r\n\r\n\r\n-0.306\r\n\r\n\r\n1.006\r\n\r\n\r\nForm 20\r\n\r\n\r\n1.302\r\n\r\n\r\n-0.380\r\n\r\n\r\n1.011\r\n\r\n\r\nLet’s say that Form 4 is administered in the Fall semester, and Form 11 semester is administered in the Spring Semester. The scores from these two reading passages may not be directly comparable because they may differ in their difficulty (\\(b\\) parameter), and also in other characteristics (\\(a\\) parameter and \\(\\alpha\\)). The difference in the \\(b\\) parameter is probably most critical here. It wouldn’t make much sense to compare the ORF scores from Fall and Spring without any equating between the two forms, and practitioners would probably appreciate an easy to understand score conversion table between two reading passages. I don’t know much about CBM-Reading literature. I am aware that there are already methods used and published to create such a table using traditional equating methods (e.g., Albano and Rodriguez, 2012). There may also be other works published. Here, I would like to accomplish the same thing using an IRT approach when Samejima’s CRM is used to scale many reading passages.\r\nForm 4 and Form 11 has the following item parameters:\r\n\\[(a_4,b_4,\\alpha_4)=(1.708,-0.729,1.108)\\] \\[(a_{11},b_{11},\\alpha_{11})=(3.041,0.426,1.013)\\]\r\nAlso, let’s assume that the maximum possible ORF score is 250 for both forms.\r\nWe need to remember a few formulas for CRM. In this model, the probability of an individual with a latent parameter \\(\\theta_i\\) obtaining a score of \\(x\\) or higher on an item with three parameters (\\(a\\), \\(b\\), and \\(\\alpha\\)) is specified as,\r\n\\[\\begin{equation} \r\n  P_{ij}(X\\geq x|\\theta_{i},a_j,b_j,\\alpha_j)=\\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^{v}{e^{-\\frac{t^2}{2}}dt}\r\n  \\tag{1}\r\n\\end{equation}\\]\r\n\\[\\begin{equation} \r\n  v=a_j\\times (\\theta_i-b_j-\\frac{1}{\\alpha_j}ln\\frac{x_{ij}}{k_j-x_{ij}})\r\n  \\tag{2}\r\n\\end{equation}\\]\r\nwhere \\(k_j\\) is the maximum possible score for the item.\r\n\\(x_{ij}^*\\) is a nonlinear transformation of the observed continous score,\r\n\\[\\begin{equation} \r\n  x_{ij}^* = ln(\\frac{x_{ij}}{k_j-x_{ij}}),\r\n  \\tag{3}\r\n\\end{equation}\\]\r\nand its conditional PDF is a normal distribution with a mean of \\(\\alpha_j(\\theta_i - b_j)\\) and standard deviation of \\(\\alpha_j/a_j\\).\r\n\\[\\begin{equation} \r\n  x^* \\sim N(\\alpha_j(\\theta_i - b_j),\\alpha_j/a_j).\r\n  \\tag{4}\r\n\\end{equation}\\]\r\nLet’s also remember that the maximum likelihood estimate of \\(\\theta\\) in CRM has a closed formula and can easily be computed based on the item parameters.\r\n\\[\\begin{equation} \r\n  \\hat\\theta_i = \\frac{\\sum_{j=1}^{n}a_j^2(b_j+\\frac{x_{ij}^*}{\\alpha_j})}{\\sum_{j=1}^{n}a_j^2}\r\n  \\tag{5}\r\n\\end{equation}\\]\r\nNow, given that what we know, let’s do a quick exercise. Let’s say a student got a score of 120 from Form 4. What would be the expected score if we administered Form 11 to the same student?\r\nStep 1: Transform the observed score from Form 4 (Eq. 3).\r\n\\[x_{ij}^* = ln(\\frac{120}{250-120})=-0.080\\]\r\nStep 2: Given the item parameters for Form 4 and the transformed score, obtain an estimate of latent ability, \\(\\hat\\theta_i\\) (Eg. 5). I know it will sound absurd for those who are familiar with other IRT models to estimate latent trait using a single item. We can do it in CRM. Note that when there is only one item, the ML estimate simplifies. So, if you write Eq.5 for a single item, the estimate is equal to \\[\\hat\\theta_i = b_j + \\frac{x_{ij}^*}{\\alpha_j}.\\]\r\nAlternatively, you can think about it as the following. For a given \\(x_{ij}^*\\), we know its expected value is \\(\\alpha_j(\\theta_i - b_j)\\). So, we can get the same equation if we solve the following equation for \\(\\theta\\),\r\n\\[x_{ij}^* = \\alpha_j(\\theta_i - b_j).\\] Either way, we can get the estimate of \\(\\theta\\) based on the Form 4 score.\r\n\\[\\hat\\theta_i = -0.729 + \\frac{-0.08}{1.108}= -0.801 \\]\r\nStep 3: Given the theta estimate in Step 2 and item parameters for Form 11, compute the expected transformed score (mean of the conditional distribution) in Form 11.\r\n\\[x_{ij}^* = \\alpha_j(\\theta_i - b_j) = 1.013*(-0.801-0.426) = -1.243\\]\r\nStep 4: Transform the expected score in Form 11 back to its original scale.\r\n\\[ x_{ij} = \\frac{e^{x_{ij}^*}*k_j}{e^{x_{ij}^*}+1}\\]\r\n\\[ x_{ij} = \\frac{e^{-1.243}*250}{e^{-1.243}+1}=55.98\\]\r\nThis indicates that a student who received a score of 120 from Form 4 is expected to receive a score of 55.98 (~ 56) from Form 11. This is not surprising as Form 11 is more difficult than Form 4.\r\nBelow is an R code to produce some sort of conversion table for all possible scores from 1 to 249. You can change the item parameters and maximum score to get the conversion table for any hypothetical two forms.\r\n\r\n\r\n# Generate CRM item parameters\r\n\r\nset.seed(123)\r\n\r\na     <- rlnorm(20,.5,.5)\r\nb     <- rnorm(20,0,1)\r\nalpha <- rnorm(20,1,.05)\r\n\r\nipar <- cbind(a,b,alpha)\r\n\r\ncolnames(ipar) = NULL\r\nrownames(ipar) <- paste0(\"Form \",1:20)\r\n\r\n#################################\r\n\r\n# two forms to be equated\r\n\r\n  form1 = 4\r\n  form2 = 11\r\n\r\nipar1 <- ipar[form1,]\r\nipar2 <- ipar[form2,]\r\nmax.score = 250\r\n\r\nraw <- as.data.frame(as.matrix(1:249))\r\nraw$Form2 = NA\r\nraw$Theta = NA\r\ncolnames(raw)[1] <- \"Form1\"\r\n\r\nfor(i in 1:nrow(raw)){\r\n  z1 = log(raw[i,1]/(max.score-raw[i,1]))\r\n  theta = (z1/ipar1[3])+ipar1[2]\r\n  z2 = ipar2[3]*(theta-ipar2[2])\r\n  raw[i,2]=(exp(z2)*max.score)/(exp(z2)+1)\r\n  raw[i,3]= theta\r\n}\r\n\r\nround(raw,2)\r\n\r\n    Form1  Form2 Theta\r\n1       1   0.50 -5.71\r\n2       2   0.95 -5.08\r\n3       3   1.37 -4.71\r\n4       4   1.79 -4.44\r\n5       5   2.20 -4.24\r\n6       6   2.60 -4.07\r\n7       7   3.00 -3.93\r\n8       8   3.40 -3.80\r\n9       9   3.79 -3.69\r\n10     10   4.18 -3.60\r\n11     11   4.57 -3.51\r\n12     12   4.96 -3.42\r\n13     13   5.35 -3.35\r\n14     14   5.74 -3.28\r\n15     15   6.13 -3.21\r\n16     16   6.52 -3.15\r\n17     17   6.90 -3.09\r\n18     18   7.29 -3.04\r\n19     19   7.68 -2.98\r\n20     20   8.06 -2.93\r\n21     21   8.45 -2.88\r\n22     22   8.84 -2.84\r\n23     23   9.23 -2.79\r\n24     24   9.62 -2.75\r\n25     25  10.01 -2.71\r\n26     26  10.40 -2.67\r\n27     27  10.79 -2.63\r\n28     28  11.18 -2.60\r\n29     29  11.57 -2.56\r\n30     30  11.97 -2.53\r\n31     31  12.36 -2.49\r\n32     32  12.76 -2.46\r\n33     33  13.15 -2.43\r\n34     34  13.55 -2.40\r\n35     35  13.95 -2.37\r\n36     36  14.35 -2.34\r\n37     37  14.75 -2.31\r\n38     38  15.16 -2.28\r\n39     39  15.56 -2.25\r\n....\r\n\r\nWe can also plot the expected score for both forms as a function of theta.\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/crm-equating/image.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 1108,
    "preview_height": 825
  },
  {
    "path": "posts/scraping-turkey.gov.tr/",
    "title": "Tracking the Number of Deceased People by Scraping Data from www.turkiye.gov.tr",
    "description": "A Shiny app is designed to track the number of deceased individuals from 11 major cities in Turkey by scraping data from www.turkiye.gov.tr. By using this Shiny app, you can compare the number of deceased individuals for any given day or date range in 2020 to the number of deceased individuals in the past 10 years on the same day or same date range.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2020-03-28",
    "categories": [
      "2020",
      "web scraping",
      "covid19"
    ],
    "contents": "\r\nShort Story\r\nYou can track the number of deceased individuals in Turkey using the shiny app at this link:\r\nhttps://cengiz-shiny.app/shiny/deceased_turkey/\r\nThe app uses a dataset scraped and compiled from the numbers reported on https://www.turkiye.gov.tr. The app reports the numbers from 11 major cities in which the data are available on https://www.turkiye.gov.tr. These cities are:\r\nBursa\r\nDenizli\r\nDiyarbakir\r\nErzurum\r\nIstanbul\r\nKahramanmaras\r\nKocaeli\r\nKonya\r\nMalatya\r\nSakarya\r\nTekirdag\r\nBy using this app, you can compare the number of deceased individuals for any given day or date range in 2020 to the number of deceased individuals in the past 10 years on the same day or same date range. You can look at the total number for all 11 cities, or you can examine city by city. The R code used to scrape the dataset can be downloaded from the link below:\r\nDOWNLOAD THE R CODE USED TO SCRAPE THE DATASET\r\nThe database is automatically updated on a daily basis by running another script and adding the new information for the past day. Also, due to the lag in reporting by the original source, the numbers for the prior 45 days are checked everyday and automatically updated on a daily basis.\r\nDOWNLOAD THE R CODE USED TO UPDATE THE DATASET ON A DAILY BASIS\r\nLong Story\r\nThe information about COVID-19 provided by authorities is very limited in Turkey. The only source of information is currently a tweet once a day by Dr. Fahretting Koca, the Minister of Health. At the time of this writing, the last tweet indicates that there were 3,672 tests made on Mar 23, and 293 individuals were positive, and there were seven individuals deceased because of Covid-19.\r\n\r\n\r\nSON 24 SAATTE 3.672 test sonuçlandı. 293 yeni tanı kondu. Çabalarımıza rağmen, hastalığa yenik düşen 7 insanımız daha oldu. GENÇLERE UYARIMIZ VAR: Salgının dışında değilsiniz. Hayatınızı yavaşlatın. Risk ortamına girmeyin. Riski evinize taşımayın. Evde kalın. Hayat eve sığar.\r\n\r\n— Dr. Fahrettin Koca (@drfahrettinkoca) March 23, 2020\r\n\r\nFunction&&Function.prototype&&Function.prototype.bind&&(/(MSIE ([6789]|10|11))|Trident/.test(navigator.userAgent)||(window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.loaded&&window.twttr.widgets.load&&window.twttr.widgets.load(),window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.init||function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,c=[];a<o.length;a++)i=o[a],r[i]&&c.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=o);var s,a=document.getElementsByTagName(\"head\")[0],u=document.createElement(\"script\");u.charset=\"utf-8\",u.timeout=120,i.nc&&u.setAttribute(\"nonce\",i.nc),u.src=function(t){return i.p+\"js/\"+({0:\"moment~timeline~tweet\",2:\"dm_button\",3:\"button\",4:\"moment\",5:\"periscope_on_air\",6:\"timeline\",7:\"horizon_tweet\",8:\"tweet\"}[t]||t)+\".\"+{0:\"99ce5e0e4617985354c5c426d7e1b9f4\",2:\"aafdbac8c0ca30b0345ffadfb46abaae\",3:\"93a0c25c2d2f3081c705c98c2d9dec0e\",4:\"70d46e46bb6e5d32428d274e29d33a7a\",5:\"a924982376e532afeee4636c794ea5da\",6:\"d228dcf3573461f298b082c9a5c0a42c\",7:\"77381373f964eee9b43728b3d43d642f\",8:\"9aa9eda3c163ec539c16aef0d822d807\"}[t]+\".js\"}(t),s=function(e){u.onerror=u.onload=null,clearTimeout(c);var n=r[t];if(0!==n){if(n){var i=e&&(\"load\"===e.type?\"missing\":e.type),o=e&&e.target&&e.target.src,s=new Error(\"Loading chunk \"+t+\" failed.\\n(\"+i+\": \"+o+\")\");s.type=i,s.request=o,n[1](s)}r[t]=void 0}};var c=setTimeout(function(){s({type:\"timeout\",target:u})},12e4);u.onerror=u.onload=s,a.appendChild(u)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"https://platform.twitter.com/\",i.oe=function(t){throw console.error(t),t};var o=window.__twttrll=window.__twttrll||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var u=s;i(i.s=96)}([function(t,e,n){var r=n(1);function i(t,e){var n;for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||e(n,t[n]);return t}function o(t){return{}.toString.call(t).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()}function s(t){return t===Object(t)}function a(t){var e;if(!s(t))return!1;if(Object.keys)return!Object.keys(t).length;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t){return t?Array.prototype.slice.call(t):[]}t.exports={aug:function(t){return u(arguments).slice(1).forEach(function(e){i(e,function(e,n){t[e]=n})}),t},async:function(t,e){r.setTimeout(function(){t.call(e||null)},0)},compact:function t(e){return i(e,function(n,r){s(r)&&(t(r),a(r)&&delete e[n]),void 0!==r&&null!==r&&\"\"!==r||delete e[n]}),e},contains:function(t,e){return!(!t||!t.indexOf)&&t.indexOf(e)>-1},forIn:i,isObject:s,isEmptyObject:a,toType:o,isType:function(t,e){return t==o(e)},toRealArray:u}},function(t,e){t.exports=window},function(t,e,n){var r=n(6);t.exports=function(){var t=this;this.promise=new r(function(e,n){t.resolve=e,t.reject=n})}},function(t,e,n){var r=n(11),i=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?(?:\\/intent\\/(?:follow|user)\\/?\\?screen_name=|(?:\\/#!)?\\/))@?([\\w]+)(?:\\?|&|$)/i,o=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?\\/(?:#!\\/)?[\\w_]+\\/status(?:es)?\\/)(\\d+)/i,s=/^http(s?):\\/\\/(\\w+\\.)*twitter\\.com([:/]|$)/i,a=/^http(s?):\\/\\/(ton|pbs)\\.twimg\\.com/,u=/^#?([^.,<>!\\s/#\\-()'\"]+)$/,c=/twitter\\.com(?::\\d{2,4})?\\/intent\\/(\\w+)/,d=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/\\w+\\/timelines\\/(\\d+)/i,f=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/moments\\/(\\d+)/i,l=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/(?:likes|favorites)/i,h=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/lists\\/([\\w-%]+)/i,p=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/live\\/(\\d+)/i,m=/^https?:\\/\\/syndication\\.twitter\\.com\\/settings/i,v=/^https?:\\/\\/(localhost|platform)\\.twitter\\.com(?::\\d+)?\\/widgets\\/widget_iframe\\.(.+)/i,g=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/search\\?q=(\\w+)/i;function w(t){return\"string\"==typeof t&&i.test(t)&&RegExp.$1.length<=20}function y(t){if(w(t))return RegExp.$1}function b(t,e){var n=r.decodeURL(t);if(e=e||!1,n.screen_name=y(t),n.screen_name)return r.url(\"https://twitter.com/intent/\"+(e?\"follow\":\"user\"),n)}function _(t){return\"string\"==typeof t&&u.test(t)}function E(t){return\"string\"==typeof t&&o.test(t)}t.exports={isHashTag:_,hashTag:function(t,e){if(e=void 0===e||e,_(t))return(e?\"#\":\"\")+RegExp.$1},isScreenName:w,screenName:y,isStatus:E,status:function(t){return E(t)&&RegExp.$1},intentForProfileURL:b,intentForFollowURL:function(t){return b(t,!0)},isTwitterURL:function(t){return s.test(t)},isTwimgURL:function(t){return a.test(t)},isIntentURL:function(t){return c.test(t)},isSettingsURL:function(t){return m.test(t)},isWidgetIframeURL:function(t){return v.test(t)},isSearchUrl:function(t){return g.test(t)},regexen:{profile:i},momentId:function(t){return f.test(t)&&RegExp.$1},collectionId:function(t){return d.test(t)&&RegExp.$1},intentType:function(t){return c.test(t)&&RegExp.$1},likesScreenName:function(t){return l.test(t)&&RegExp.$1},listScreenNameAndSlug:function(t){var e,n,r;if(h.test(t)){e=RegExp.$1,n=RegExp.$2;try{r=decodeURIComponent(n)}catch(t){}return{ownerScreenName:e,slug:r||n}}return!1},eventId:function(t){return p.test(t)&&RegExp.$1}}},function(t,e){t.exports=document},function(t,e,n){var r=n(0),i=[!0,1,\"1\",\"on\",\"ON\",\"true\",\"TRUE\",\"yes\",\"YES\"],o=[!1,0,\"0\",\"off\",\"OFF\",\"false\",\"FALSE\",\"no\",\"NO\"];function s(t){return void 0!==t&&null!==t&&\"\"!==t}function a(t){return c(t)&&t%1==0}function u(t){return c(t)&&!a(t)}function c(t){return s(t)&&!isNaN(t)}function d(t){return r.contains(o,t)}function f(t){return r.contains(i,t)}t.exports={hasValue:s,isInt:a,isFloat:u,isNumber:c,isString:function(t){return\"string\"===r.toType(t)},isArray:function(t){return s(t)&&\"array\"==r.toType(t)},isTruthValue:f,isFalseValue:d,asInt:function(t){if(a(t))return parseInt(t,10)},asFloat:function(t){if(u(t))return t},asNumber:function(t){if(c(t))return t},asBoolean:function(t){return!(!s(t)||!f(t)&&(d(t)||!t))}}},function(t,e,n){var r=n(1),i=n(22),o=n(48);i.hasPromiseSupport()||(r.Promise=o),t.exports=r.Promise},function(t,e,n){var r=n(0);t.exports=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){var i=r.toRealArray(arguments);return t.apply(e,n.concat(i))}}},function(t,e){t.exports=location},function(t,e,n){var r=n(50);t.exports=new r(\"__twttr\")},function(t,e,n){var r=n(0),i=/\\b([\\w-_]+)\\b/g;function o(t){return new RegExp(\"\\\\b\"+t+\"\\\\b\",\"g\")}function s(t,e){t.classList?t.classList.add(e):o(e).test(t.className)||(t.className+=\" \"+e)}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(o(e),\" \")}function u(t,e){return t.classList?t.classList.contains(e):r.contains(c(t),e)}function c(t){return r.toRealArray(t.classList?t.classList:t.className.match(i))}t.exports={add:s,remove:a,replace:function(t,e,n){if(t.classList&&u(t,e))return a(t,e),void s(t,n);t.className=t.className.replace(o(e),n)},toggle:function(t,e,n){return void 0===n&&t.classList&&t.classList.toggle?t.classList.toggle(e,n):(n?s(t,e):a(t,e),n)},present:u,list:c}},function(t,e,n){var r=n(5),i=n(0);function o(t){return encodeURIComponent(t).replace(/\\+/g,\"%2B\").replace(/'/g,\"%27\")}function s(t){return decodeURIComponent(t)}function a(t){var e=[];return i.forIn(t,function(t,n){var s=o(t);i.isType(\"array\",n)||(n=[n]),n.forEach(function(t){r.hasValue(t)&&e.push(s+\"=\"+o(t))})}),e.sort().join(\"&\")}function u(t){var e={};return t?(t.split(\"&\").forEach(function(t){var n=t.split(\"=\"),r=s(n[0]),o=s(n[1]);if(2==n.length){if(!i.isType(\"array\",e[r]))return r in e?(e[r]=[e[r]],void e[r].push(o)):void(e[r]=o);e[r].push(o)}}),e):{}}t.exports={url:function(t,e){return a(e).length>0?i.contains(t,\"?\")?t+\"&\"+a(e):t+\"?\"+a(e):t},decodeURL:function(t){var e=t&&t.split(\"?\");return 2==e.length?u(e[1]):{}},decode:u,encode:a,encodePart:o,decodePart:s}},function(t,e,n){var r=n(8),i=n(1),o=n(0),s={},a=o.contains(r.href,\"tw_debug=true\");function u(){}function c(){}function d(){return i.performance&&+i.performance.now()||+new Date}function f(t,e){if(i.console&&i.console[t])switch(e.length){case 1:i.console[t](e[0]);break;case 2:i.console[t](e[0],e[1]);break;case 3:i.console[t](e[0],e[1],e[2]);break;case 4:i.console[t](e[0],e[1],e[2],e[3]);break;case 5:i.console[t](e[0],e[1],e[2],e[3],e[4]);break;default:0!==e.length&&i.console.warn&&i.console.warn(\"too many params passed to logger.\"+t)}}t.exports={devError:u,devInfo:c,devObject:function(t,e){},publicError:function(){f(\"error\",o.toRealArray(arguments))},publicLog:function(){f(\"info\",o.toRealArray(arguments))},time:function(t){a&&(s[t]=d())},timeEnd:function(t){a&&s[t]&&(d(),s[t])}}},function(t,e,n){var r=n(20),i=n(5),o=n(11),s=n(0),a=n(121);t.exports=function(t){var e=t.href&&t.href.split(\"?\")[1],n=e?o.decode(e):{},u={lang:a(t),width:t.getAttribute(\"data-width\")||t.getAttribute(\"width\"),height:t.getAttribute(\"data-height\")||t.getAttribute(\"height\"),related:t.getAttribute(\"data-related\"),partner:t.getAttribute(\"data-partner\")};return i.asBoolean(t.getAttribute(\"data-dnt\"))&&r.setOn(),s.forIn(u,function(t,e){var r=n[t];n[t]=i.hasValue(r)?r:e}),s.compact(n)}},function(t,e,n){var r=n(82),i=n(24);t.exports=function(){var t=\"data-twitter-extracted-\"+i.generate();return function(e,n){return r(e,n).filter(function(e){return!e.hasAttribute(t)}).map(function(e){return e.setAttribute(t,\"true\"),e})}}},function(t,e){function n(t,e,n,r,i,o,s){this.factory=t,this.Sandbox=e,this.srcEl=o,this.targetEl=i,this.parameters=r,this.className=n,this.options=s}n.prototype.destroy=function(){this.srcEl=this.targetEl=null},t.exports=n},function(t,e){t.exports={DM_BUTTON:\"twitter-dm-button\",FOLLOW_BUTTON:\"twitter-follow-button\",HASHTAG_BUTTON:\"twitter-hashtag-button\",MENTION_BUTTON:\"twitter-mention-button\",MOMENT:\"twitter-moment\",PERISCOPE:\"periscope-on-air\",SHARE_BUTTON:\"twitter-share-button\",TIMELINE:\"twitter-timeline\",TWEET:\"twitter-tweet\"}},function(t,e,n){var r=n(6),i=n(20),o=n(52),s=n(31),a=n(5),u=n(0);t.exports=function(t,e,n){var c;return t=t||[],e=e||{},c=\"ƒ(\"+t.join(\", \")+\", target, [options]);\",function(){var d,f,l,h,p=Array.prototype.slice.apply(arguments,[0,t.length]),m=Array.prototype.slice.apply(arguments,[t.length]);return m.forEach(function(t){t&&(t.nodeType!==Node.ELEMENT_NODE?u.isType(\"function\",t)?d=t:u.isType(\"object\",t)&&(f=t):l=t)}),p.length!==t.length||0===m.length?(d&&u.async(function(){d(!1)}),r.reject(new Error(\"Not enough parameters. Expected: \"+c))):l?(f=u.aug({},f||{},e),t.forEach(function(t){f[t]=p.shift()}),a.asBoolean(f.dnt)&&i.setOn(),h=s.getExperiments().then(function(t){return o.addWidget(n(f,l,void 0,t))}),d&&h.then(d,function(){d(!1)}),h):(d&&u.async(function(){d(!1)}),r.reject(new Error(\"No target element specified. Expected: \"+c)))}}},function(t,e,n){var r=n(104),i=n(2),o=n(0);function s(t,e){return function(){try{e.resolve(t.call(this))}catch(t){e.reject(t)}}}t.exports={sync:function(t,e){t.call(e)},read:function(t,e){var n=new i;return r.read(s(t,n),e),n.promise},write:function(t,e){var n=new i;return r.write(s(t,n),e),n.promise},defer:function(t,e,n){var a=new i;return o.isType(\"function\",t)&&(n=e,e=t,t=1),r.defer(t,s(e,a),n),a.promise}}},function(t,e,n){var r=n(9),i=[\"https://syndication.twitter.com\",\"https://cdn.syndication.twimg.com\",\"https://localhost.twitter.com:8444\"],o=[\"https://syndication.twitter.com\",\"https://localhost.twitter.com:8445\"],s=[\"https://platform.twitter.com/embed/index.html\",\"https://localhost.twitter.com\",/https:\\/\\/ton\\.smf1\\.twitter\\.com\\/syndication-internal\\/embed-iframe\\/[0-9A-Za-z_-]+\\/app\\/index\\.html/],a=function(t,e){return t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},u=function(){var t=r.get(\"backendHost\");return t&&a(i,t)?t:\"https://cdn.syndication.twimg.com\"},c=function(){var t=r.get(\"settingsSvcHost\");return t&&a(o,t)?t:\"https://syndication.twitter.com\"},d=function(){var t=r.get(\"embedIframeURL\");return t&&a(s,t)?t:\"https://platform.twitter.com/embed/index.html\"};function f(t,e){var n=[t];return e.forEach(function(t){n.push(function(t){var e=(t||\"\").toString(),n=\"/\"===e.slice(0,1)?1:0,r=function(t){return\"/\"===t.slice(-1)}(e)?-1:void 0;return e.slice(n,r)}(t))}),n.join(\"/\")}t.exports={cookieConsent:function(t){var e=t||[];return e.unshift(\"cookie/consent\"),f(c(),e)},embedIframe:function(){return d()},eventVideo:function(t){var e=t||[];return e.unshift(\"video/event\"),f(u(),e)},grid:function(t){var e=t||[];return e.unshift(\"grid/collection\"),f(u(),e)},moment:function(t){var e=t||[];return e.unshift(\"moments\"),f(u(),e)},settings:function(t){var e=t||[];return e.unshift(\"settings\"),f(c(),e)},timeline:function(t){var e=t||[];return e.unshift(\"timeline\"),f(u(),e)},tweetBatch:function(t){var e=t||[];return e.unshift(\"tweets.json\"),f(u(),e)},video:function(t){var e=t||[];return e.unshift(\"widgets/video\"),f(u(),e)}}},function(t,e,n){var r=n(4),i=n(8),o=n(39),s=n(80),a=n(5),u=n(35),c=!1,d=/https?:\\/\\/([^/]+).*/i;t.exports={setOn:function(){c=!0},enabled:function(t,e){return!!(c||a.asBoolean(u.val(\"dnt\"))||s.isUrlSensitive(e||i.host)||o.isFramed()&&s.isUrlSensitive(o.rootDocumentLocation())||(t=d.test(t||r.referrer)&&RegExp.$1)&&s.isUrlSensitive(t))}}},function(t,e,n){var r=n(47),i=n(4),o=n(20),s=n(34),a=n(72),u=n(33),c=n(9),d=n(3),f=n(0),l=1,h=r.version,p=c.get(\"clientEventEndpoint\")||\"https://syndication.twitter.com/i/jot\";function m(t){return f.aug({client:\"tfw\"},t||{})}function v(t,e,n){return e=e||{},f.aug({},e,{_category_:t,triggered_on:e.triggered_on||+new Date,dnt:o.enabled(n)})}t.exports={extractTermsFromDOM:function t(e,n){var r;return n=n||{},e&&e.nodeType===Node.ELEMENT_NODE?((r=e.getAttribute(\"data-scribe\"))&&r.split(\" \").forEach(function(t){var e=t.trim().split(\":\"),r=e[0],i=e[1];r&&i&&!n[r]&&(n[r]=i)}),t(e.parentNode,n)):n},clickEventElement:function(t){var e=s.closest(\"[data-expanded-url]\",t),n=e&&e.getAttribute(\"data-expanded-url\");return n&&d.isTwitterURL(n)?\"twitter_url\":\"url\"},flattenClientEventPayload:function(t,e){return f.aug({},e,{event_namespace:t})},formatGenericEventData:v,formatClientEventData:function(t,e,n){var r=t&&t.widget_origin||i.referrer;return(t=v(\"tfw_client_event\",t,r)).client_version=h,t.format_version=void 0!==n?n:1,e||(t.widget_origin=r),t},formatClientEventNamespace:m,formatHorizonTweetData:function(t){var e={item_ids:[],item_details:{}};return e.item_ids.push(t),e.item_details[t]={item_type:a.TWEET},e},formatTweetAssociation:function(t,e){var n={};return(e=e||{}).association_namespace=m(t),n[l]=e,n},noticeSeen:function(t){return\"notice\"===t.element&&\"seen\"===t.action},splitLogEntry:function(t){var e,n,r,i,o;return t.item_ids&&t.item_ids.length>1?(e=Math.floor(t.item_ids.length/2),n=t.item_ids.slice(0,e),r={},i=t.item_ids.slice(e),o={},n.forEach(function(e){r[e]=t.item_details[e]}),i.forEach(function(e){o[e]=t.item_details[e]}),[f.aug({},t,{item_ids:n,item_details:r}),f.aug({},t,{item_ids:i,item_details:o})]):[t]},stringify:function(t){var e,n=Array.prototype.toJSON;return delete Array.prototype.toJSON,e=u.stringify(t),n&&(Array.prototype.toJSON=n),e},AUDIENCE_ENDPOINT:\"https://syndication.twitter.com/i/jot/syndication\",CLIENT_EVENT_ENDPOINT:p,RUFOUS_REDIRECT:\"https://platform.twitter.com/jot.html\"}},function(t,e,n){var r=n(4),i=n(12),o=n(97),s=n(1),a=n(0),u=o.userAgent;function c(t){return/(Trident|MSIE|Edge[/ ]?\\d)/.test(t=t||u)}t.exports={retina:function(t){return(t=t||s).devicePixelRatio?t.devicePixelRatio>=1.5:!!t.matchMedia&&t.matchMedia(\"only screen and (min-resolution: 144dpi)\").matches},anyIE:c,ie9:function(t){return/MSIE 9/.test(t=t||u)},ie10:function(t){return/MSIE 10/.test(t=t||u)},ios:function(t){return/(iPad|iPhone|iPod)/.test(t=t||u)},android:function(t){return/^Mozilla\\/5\\.0 \\(Linux; (U; )?Android/.test(t=t||u)},canPostMessage:function(t,e){return t=t||s,e=e||u,t.postMessage&&!(c(e)&&t.opener)},touch:function(t,e,n){return t=t||s,e=e||o,n=n||u,\"ontouchstart\"in t||/Opera Mini/.test(n)||e.msMaxTouchPoints>0},cssTransitions:function(){var t=r.body.style;return void 0!==t.transition||void 0!==t.webkitTransition||void 0!==t.mozTransition||void 0!==t.oTransition||void 0!==t.msTransition},hasPromiseSupport:function(){return!!(s.Promise&&s.Promise.resolve&&s.Promise.reject&&s.Promise.all&&s.Promise.race&&(new s.Promise(function(e){t=e}),a.isType(\"function\",t)));var t},hasIntersectionObserverSupport:function(){return!!s.IntersectionObserver},hasPerformanceInformation:function(){return s.performance&&s.performance.getEntriesByType},hasLocalStorageSupport:function(){try{return s.localStorage.setItem(\"local_storage_support_test\",\"true\"),void 0!==s.localStorage}catch(t){return i.devError(\"window.localStorage is not supported:\",t),!1}}}},function(t,e,n){var r=n(6),i=n(2);function o(t,e){return t.then(e,e)}function s(t){return t instanceof r}t.exports={always:o,allResolved:function(t){var e;return void 0===t?r.reject(new Error(\"undefined is not an object\")):Array.isArray(t)?(e=t.length)?new r(function(n,r){var i=0,o=[];function a(){(i+=1)===e&&(0===o.length?r():n(o))}function u(t){o.push(t),a()}t.forEach(function(t){s(t)?t.then(u,a):u(t)})}):r.resolve([]):r.reject(new Error(\"Type error\"))},some:function(t){var e;return e=(t=t||[]).length,t=t.filter(s),e?e!==t.length?r.reject(\"non-Promise passed to .some\"):new r(function(e,n){var r=0;function i(){(r+=1)===t.length&&n()}t.forEach(function(t){t.then(e,i)})}):r.reject(\"no promises passed to .some\")},isPromise:s,allSettled:function(t){function e(){}return r.all((t||[]).map(function(t){return o(t,e)}))},timeout:function(t,e){var n=new i;return setTimeout(function(){n.reject(new Error(\"Promise timed out\"))},e),t.then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}},function(t,e){var n=\"i\",r=0,i=0;t.exports={generate:function(){return n+String(+new Date)+Math.floor(1e5*Math.random())+r++},deterministic:function(){return n+String(i++)}}},function(t,e,n){var r=n(49),i=n(51),o=n(0);t.exports=o.aug(r.get(\"events\")||{},i.Emitter)},function(t,e,n){var r=n(27),i=n(112);t.exports=r.build([i])},function(t,e,n){var r=n(40),i=n(109),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(40),i=n(41),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(84),i=n(76),o=n(85),s=n(8),a=n(71),u=n(75),c=n(20),d=n(5),f=n(24),l=n(0);function h(t){if(!t||!t.headers)throw new Error(\"unexpected response schema\");return{html:t.body,config:t.config,pollInterval:1e3*parseInt(t.headers.xPolling,10)||null,maxCursorPosition:t.headers.maxPosition,minCursorPosition:t.headers.minPosition}}function p(t){if(t&&t.headers)throw new Error(t.headers.status);throw t instanceof Error?t:new Error(t)}t.exports=function(t){t.params({instanceId:{required:!0,fallback:f.deterministic},lang:{required:!0,transform:a.matchLanguage,fallback:\"en\"},tweetLimit:{transform:d.asInt}}),t.defineProperty(\"endpoint\",{get:function(){throw new Error(\"endpoint not specified\")}}),t.defineProperty(\"pollEndpoint\",{get:function(){return this.endpoint}}),t.define(\"cbId\",function(t){var e=t?\"_new\":\"_old\";return\"tl_\"+this.params.instanceId+\"_\"+this.id+e}),t.define(\"queryParams\",function(){return{lang:this.params.lang,tz:u.getTimezoneOffset(),t:r(),domain:s.host,tweet_limit:this.params.tweetLimit,dnt:c.enabled()}}),t.define(\"fetch\",function(){return i.fetch(this.endpoint,this.queryParams(),o,this.cbId()).then(h,p)}),t.define(\"poll\",function(t,e){var n,r;return n={since_id:(t=t||{}).sinceId,max_id:t.maxId,min_position:t.minPosition,max_position:t.maxPosition},r=l.aug(this.queryParams(),n),i.fetch(this.pollEndpoint,r,o,this.cbId(e)).then(h,p)})}},function(t,e,n){var r=n(51).makeEmitter();t.exports={emitter:r,START:\"start\",ALL_WIDGETS_RENDER_START:\"all_widgets_render_start\",ALL_WIDGETS_RENDER_END:\"all_widgets_render_end\",ALL_WIDGETS_AND_IMAGES_LOADED:\"all_widgets_and_images_loaded\"}},function(t,e,n){var r=n(115),i=n(118);function o(t){return r.settingsLoaded().then(function(e){return e[t]})}function s(){return o(\"experiments\")}t.exports={shouldObtainCookieConsent:function(){return o(\"shouldObtainCookieConsent\")},getExperiments:s,getExperiment:function(t){return s().then(function(e){if(!e[t])throw new Error(\"Experiment not found\");return e[t]})},getActiveExperimentDataString:function(){return s().then(function(t){var e=Object.keys(t).reduce(function(e,n){var r;return t[n].version&&(r=n.split(\"_\").slice(-1)[0],e.push(r+\";\"+t[n].bucket)),e},[]);return i(e.join(\",\"))})},getExperimentKeys:function(){return s().then(function(t){return Object.keys(t)})},load:function(){r.load()}}},function(t,e,n){var r=n(4),i=n(0);t.exports=function(t,e,n){var o;if(n=n||r,t=t||{},e=e||{},t.name){try{o=n.createElement('<iframe name=\"'+t.name+'\"><\/iframe>')}catch(e){(o=n.createElement(\"iframe\")).name=t.name}delete t.name}else o=n.createElement(\"iframe\");return t.id&&(o.id=t.id,delete t.id),o.allowtransparency=\"true\",o.scrolling=\"no\",o.setAttribute(\"frameBorder\",0),o.setAttribute(\"allowTransparency\",!0),i.forIn(t,function(t,e){o.setAttribute(t,e)}),i.forIn(e,function(t,e){o.style[t]=e}),o}},function(t,e,n){var r=n(1).JSON;t.exports={stringify:r.stringify||r.encode,parse:r.parse||r.decode}},function(t,e,n){var r=n(0),i=n(43);t.exports={closest:function t(e,n,o){var s;if(n)return o=o||n&&n.ownerDocument,s=r.isType(\"function\",e)?e:function(t){return function(e){return!!e.tagName&&i(e,t)}}(e),n===o?s(n)?n:void 0:s(n)?n:t(s,n.parentNode,o)}}},function(t,e,n){var r,i=n(4);function o(t){var e,n,o,s=0;for(r={},e=(t=t||i).getElementsByTagName(\"meta\");e[s];s++){if(n=e[s],/^twitter:/.test(n.getAttribute(\"name\")))o=n.getAttribute(\"name\").replace(/^twitter:/,\"\");else{if(!/^twitter:/.test(n.getAttribute(\"property\")))continue;o=n.getAttribute(\"property\").replace(/^twitter:/,\"\")}r[o]=n.getAttribute(\"content\")||n.getAttribute(\"value\")}}o(),t.exports={init:o,val:function(t){return r[t]}}},function(t,e,n){var r=n(10),i={},o=-1,s={};function a(t){var e=t.getAttribute(\"data-twitter-event-id\");return e||(t.setAttribute(\"data-twitter-event-id\",++o),o)}function u(t,e,n){var r=0,i=t&&t.length||0;for(r=0;r<i;r++)if(t[r].call(e,n,e),n.ceaseImmediately)return!1}function c(t,e,n){for(var i=n||t.target||t.srcElement,o=r.list(i).map(function(t){return\".\"+t}).concat(i.tagName),s=0,a=o.length;s<a;s++)if(!1===u(e[o[s]],i,t))return;t.cease||i!==this&&c.call(this,t,e,i.parentElement||i.parentNode)}function d(t,e,n,r){function i(r){c.call(t,r,n[e])}!function(t,e,n,r){t.id&&(s[t.id]=s[t.id]||[],s[t.id].push({el:t,listener:e,type:n,rootId:r}))}(t,i,e,r),t.addEventListener(e,i,!1)}function f(t){t&&t.preventDefault?t.preventDefault():t.returnValue=!1}function l(t){t&&(t.cease=!0)&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}t.exports={stop:function(t){return l(t),f(t),!1},stopPropagation:l,stopImmediatePropagation:function(t){t&&(t.ceaseImmediately=!0,l(t),t.stopImmediatePropagation())},preventDefault:f,delegate:function(t,e,n,r){var o=a(t);i[o]=i[o]||{},i[o][e]||(i[o][e]={},d(t,e,i[o],o)),i[o][e][n]=i[o][e][n]||[],i[o][e][n].push(r)},simulate:function(t,e,n){var r=a(e),o=i[r]&&i[r];c.call(e,{target:n},o[t])},removeDelegatesForWidget:function(t){var e=s[t];e&&(e.forEach(function(t){t.el.removeEventListener(t.type,t.listener,!1),delete i[t.rootId]}),delete s[t])}}},function(t,e,n){var r=n(78),i=n(106),o=n(81),s=n(21),a=new(n(114))(function(t){var e,n,a;if(0!==t.length){if(u(t))return c(t);e=r(t,function(t){return s.noticeSeen(t.input.namespace)}),n=e.true,a=e.false,n&&n.length>0&&(n=n.slice(0,1),o.canFlushOneItem(n[0])||(n[0].input.data.message=\"\"),c(n)),a&&(u(a)?c:function(t){i.init(),t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,o=t.input.version;i.clientEvent(e,n,r,o)}),i.flush().then(function(){t.forEach(function(t){t.taskDoneDeferred.resolve()})},function(){t.forEach(function(t){t.taskDoneDeferred.reject()})})})(a)}});function u(t){return 1===t.length&&o.canFlushOneItem(t[0])}function c(t){t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,i=t.input.version;o.clientEvent(e,n,r,i),t.taskDoneDeferred.resolve()})}t.exports={scribe:function(t,e,n,r){return a.add({namespace:t,data:e,offsite:n,version:r})},pause:function(){a.pause()},resume:function(){a.resume()}}},function(t,e,n){var r=n(27),i=n(127);t.exports=r.build([i])},function(t,e,n){var r=n(8),i=n(79),o=n(0),s=i.getCanonicalURL()||r.href,a=s;t.exports={isFramed:function(){return s!==a},rootDocumentLocation:function(t){return t&&o.isType(\"string\",t)&&(s=t),s},currentDocumentLocation:function(){return a}}},function(t,e,n){var r=n(107),i=n(108),o=n(0);t.exports={couple:function(){return o.toRealArray(arguments)},build:function(t,e,n){var o=new t;return(e=i(r(e||[]))).forEach(function(t){t.call(null,o)}),o.build(n)}}},function(t,e,n){var r=n(110),i=n(0),o=n(42);function s(){this.Component=this.factory(),this._adviceArgs=[],this._lastArgs=[]}i.aug(s.prototype,{factory:o,build:function(t){var e=this;return this.Component,i.aug(this.Component.prototype.boundParams,t),this._adviceArgs.concat(this._lastArgs).forEach(function(t){(function(t,e,n){var r=this[e];if(!r)throw new Error(e+\" does not exist\");this[e]=t(r,n)}).apply(e.Component.prototype,t)}),delete this._lastArgs,delete this._adviceArgs,this.Component},params:function(t){var e=this.Component.prototype.paramConfigs;t=t||{},this.Component.prototype.paramConfigs=i.aug({},t,e)},define:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.override(t,e)},defineStatic:function(t,e){this.Component[t]=e},override:function(t,e){this.Component.prototype[t]=e},defineProperty:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.overrideProperty(t,e)},overrideProperty:function(t,e){var n=i.aug({configurable:!0},e);Object.defineProperty(this.Component.prototype,t,n)},before:function(t,e){this._adviceArgs.push([r.before,t,e])},after:function(t,e){this._adviceArgs.push([r.after,t,e])},around:function(t,e){this._adviceArgs.push([r.around,t,e])},last:function(t,e){this._lastArgs.push([r.after,t,e])}}),t.exports=s},function(t,e,n){var r=n(0);function i(){return!0}function o(t){return t}t.exports=function(){function t(t){var e=this;t=t||{},this.params=Object.keys(this.paramConfigs).reduce(function(n,s){var a=[],u=e.boundParams,c=e.paramConfigs[s],d=c.validate||i,f=c.transform||o;if(s in u&&a.push(u[s]),s in t&&a.push(t[s]),a=\"fallback\"in c?a.concat(c.fallback):a,n[s]=function(t,e,n){var i=null;return t.some(function(t){if(t=r.isType(\"function\",t)?t():t,e(t))return i=n(t),!0}),i}(a,d,f),c.required&&null==n[s])throw new Error(s+\" is a required parameter\");return n},{}),this.initialize()}return r.aug(t.prototype,{paramConfigs:{},boundParams:{},initialize:function(){}}),t}},function(t,e,n){var r=n(1).HTMLElement,i=r.prototype.matches||r.prototype.matchesSelector||r.prototype.webkitMatchesSelector||r.prototype.mozMatchesSelector||r.prototype.msMatchesSelector||r.prototype.oMatchesSelector;t.exports=function(t,e){if(i)return i.call(t,e)}},function(t,e,n){var r,i=n(10),o=n(4),s=n(1),a=n(35),u=n(53),c=n(5),d=n(24),f=\"csptest\";t.exports={inlineStyle:function(){var t=f+d.generate(),e=o.createElement(\"div\"),n=o.createElement(\"style\"),l=\".\"+t+\" { visibility: hidden; }\";return!!o.body&&(c.asBoolean(a.val(\"widgets:csp\"))&&(r=!1),void 0!==r?r:(e.style.display=\"none\",i.add(e,t),n.type=\"text/css\",n.appendChild(o.createTextNode(l)),o.body.appendChild(n),o.body.appendChild(e),r=\"hidden\"===s.getComputedStyle(e).visibility,u(e),u(n),r))}}},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var i,o=0;return n=n||null,function s(){var a=n||this,u=arguments,c=+new Date;if(r.clearTimeout(i),c-o>e)return o=c,void t.apply(a,u);i=r.setTimeout(function(){s.apply(a,u)},e)}}},function(t,e){t.exports=function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}},function(t){t.exports={version:\"5c0e8d3:1584649541982\"}},function(t,e,n){\r\n/*!\r\n * @overview es6-promise - a tiny implementation of Promises/A+.\r\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\r\n * @license   Licensed under MIT license\r\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\r\n * @version   v4.2.5+7f2b526d\r\n */var r;r=function(){\"use strict\";function t(t){return\"function\"==typeof t}var e=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(h):w())},s=\"undefined\"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c=\"undefined\"==typeof self&&\"undefined\"!=typeof process&&\"[object process]\"==={}.toString.call(process),d=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(h,1)}}var l=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var p,m,v,g,w=void 0;function y(t,e){var n=this,r=new this.constructor(E);void 0===r[_]&&k(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,n._result)})}else j(n,r,t,e);return r}function b(t){if(t&&\"object\"==typeof t&&t.constructor===this)return t;var e=new this(E);return C(e,t),e}c?w=function(){return process.nextTick(h)}:u?(m=0,v=new u(h),g=document.createTextNode(\"\"),v.observe(g,{characterData:!0}),w=function(){g.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=h,w=function(){return p.port2.postMessage(0)}):w=void 0===s?function(){try{var t=Function(\"return this\")().require(\"vertx\");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(h)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function E(){}var x=void 0,T=1,A=2,S={error:null};function R(t){try{return t.then}catch(t){return S.error=t,S}}function N(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===b?function(t,e){e._state===T?L(t,e._result):e._state===A?I(t,e._result):j(e,void 0,function(e){return C(t,e)},function(e){return I(t,e)})}(e,n):r===S?(I(e,S.error),S.error=null):void 0===r?L(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):L(t,n))},function(e){r||(r=!0,I(t,e))},t._label);!r&&i&&(r=!0,I(t,i))},t)}(e,n,r):L(e,n)}function C(t,e){var n,r;t===e?I(t,new TypeError(\"You cannot resolve a promise with itself\")):(r=typeof(n=e),null===n||\"object\"!==r&&\"function\"!==r?L(t,e):N(t,e,R(e)))}function P(t){t._onerror&&t._onerror(t._result),O(t)}function L(t,e){t._state===x&&(t._result=e,t._state=T,0!==t._subscribers.length&&o(O,t))}function I(t,e){t._state===x&&(t._state=A,t._result=e,o(P,t))}function j(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+T]=n,i[s+A]=r,0===s&&t._state&&o(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return S.error=t,S}}(r,i))===S?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void I(n,new TypeError(\"A promises callback cannot return that same promise.\"))}else s=i,u=!0;n._state!==x||(o&&u?C(n,s):c?I(n,a):e===T?L(n,s):e===A&&I(n,s))}var z=0;function k(t){t[_]=z++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[_]||k(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&L(this.promise,this._result))):I(this.promise,new Error(\"Array Methods must be provided an Array\"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=R(t);if(i===y&&t._state!==x)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var o=new n(E);N(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===A?I(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){return n._settledAt(T,e,t)},function(t){return n._settledAt(A,e,t)})},t}(),U=function(){function e(t){this[_]=z++,this._result=this._state=void 0,this._subscribers=[],E!==t&&(\"function\"!=typeof t&&function(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}(),this instanceof e?function(t,e){try{e(function(e){C(t,e)},function(e){I(t,e)})}catch(e){I(t,e)}}(this,t):function(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new M(this,t).promise},U.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})},U.resolve=b,U.reject=function(t){var e=new this(E);return I(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(\"undefined\"!=typeof global)t=global;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U},t.exports=r()},function(t,e,n){var r=n(50);t.exports=new r(\"twttr\")},function(t,e,n){var r=n(1),i=n(0);function o(t){return i.isType(\"string\",t)?t.split(\".\"):i.isType(\"array\",t)?t:[]}function s(t,e){(e=e||r)[t]=e[t]||{},Object.defineProperty(this,\"base\",{value:e[t]}),Object.defineProperty(this,\"name\",{value:t})}i.aug(s.prototype,{get:function(t){return o(t).reduce(function(t,e){if(i.isObject(t))return t[e]},this.base)},set:function(t,e,n){var r=o(t),s=function(t,e){var n=o(e).slice(0,-1);return n.reduce(function(t,e,r){if(t[e]=t[e]||{},!i.isObject(t[e]))throw new Error(n.slice(0,r+1).join(\".\")+\" is already defined with a value.\");return t[e]},t)}(this.base,t),a=r.slice(-1);return n&&a in s?s[a]:s[a]=e},init:function(t,e){return this.set(t,e,!0)},unset:function(t){var e=o(t),n=this.get(e.slice(0,-1));n&&delete n[e.slice(-1)]},aug:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(e=void 0!==e?e:{},n.unshift(e),!n.every(i.isObject))throw new Error(\"Cannot augment non-object.\");return this.set(t,i.aug.apply(null,n))},call:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(!i.isType(\"function\",e))throw new Error(\"Function \"+t+\"does not exist.\");return e.apply(null,n)},fullPath:function(t){var e=o(t);return e.unshift(this.name),e.join(\".\")}}),t.exports=s},function(t,e,n){var r=n(0),i=n(7),o={bind:function(t,e){return this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)},unbind:function(t,e){var n;this._handlers&&this._handlers[t]&&(e?(n=this._handlers[t].indexOf(e))>=0&&this._handlers[t].splice(n,1):this._handlers[t]=[])},trigger:function(t,e){var n=this._handlers&&this._handlers[t];(e=e||{}).type=t,n&&n.forEach(function(t){r.async(i(t,this,e))})}};t.exports={Emitter:o,makeEmitter:function(){return r.aug(function(){},o)}}},function(t,e,n){var r=n(103),i=n(77),o=n(6),s=n(23),a=n(7),u=n(0),c=new i(function(t){var e=function(t){return t.reduce(function(t,e){return t[e._className]=t[e._className]||[],t[e._className].push(e),t},{})}(t.map(r.fromRawTask));u.forIn(e,function(t,e){s.allSettled(e.map(function(t){return t.initialize()})).then(function(){e.forEach(function(t){o.all([t.hydrate(),t.insertIntoDom()]).then(a(t.render,t)).then(a(t.success,t),a(t.fail,t))})})})});t.exports={addWidget:function(t){return c.add(t)}}},function(t,e,n){var r=n(18);t.exports=function(t){return r.write(function(){t&&t.parentNode&&t.parentNode.removeChild(t)})}},function(t,e,n){n(12),t.exports={log:function(t,e){}}},function(t,e,n){var r=n(1);function i(t){return(t=t||r).getSelection&&t.getSelection()}t.exports={getSelection:i,getSelectedText:function(t){var e=i(t);return e?e.toString():\"\"}}},function(t,e,n){var r=n(4),i=n(1),o=n(2),s=2e4;t.exports=function(t){var e=new o,n=r.createElement(\"img\");return n.onload=n.onerror=function(){i.setTimeout(e.resolve,50)},n.src=t,i.setTimeout(e.reject,s),e.promise}},function(t,e,n){var r=n(113);t.exports=function(t){t.define(\"createElement\",r),t.define(\"createFragment\",r),t.define(\"htmlToElement\",r),t.define(\"hasSelectedText\",r),t.define(\"addRootClass\",r),t.define(\"removeRootClass\",r),t.define(\"hasRootClass\",r),t.define(\"prependStyleSheet\",r),t.define(\"appendStyleSheet\",r),t.define(\"prependCss\",r),t.define(\"appendCss\",r),t.define(\"makeVisible\",r),t.define(\"injectWidgetEl\",r),t.define(\"matchHeightToContent\",r),t.define(\"matchWidthToContent\",r)}},function(t,e){t.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}}},function(t,e,n){var r=n(15),i=n(122),o=n(60),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.DM_BUTTON,t,e,n)}},function(t,e,n){var r=n(61),i=n(26);t.exports=r.isSupported()?r:i},function(t,e,n){var r=n(27),i=n(123);t.exports=r.build([i])},function(t,e,n){var r=n(15),i=n(126),o=n(38),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.FOLLOW_BUTTON,t,e,n)}},function(t,e,n){var r=n(15),i=n(134),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.MOMENT,t,e,n)}},function(t,e,n){var r=n(15),i=n(136),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.PERISCOPE,t,e,n)}},function(t,e,n){var r=n(83),i=n(138),o=n(142),s=n(144),a=n(146),u=n(148),c={collection:i,event:o,likes:s,list:a,profile:u,url:f},d=[u,s,i,a,o];function f(t){return r(d,function(e){try{return new e(t)}catch(t){}})}t.exports=function(t){return t?function(t){var e,n;return e=(t.sourceType+\"\").toLowerCase(),(n=c[e])?new n(t):null}(t)||f(t):null}},function(t,e,n){var r=n(15),i=n(150),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.TIMELINE,t,e,n)}},function(t,e,n){var r=n(4),i=n(68),o=n(152),s=n(15),a=n(38),u=n(153),c=n(60),d=n(154),f=n(16);t.exports=function(t,e,n,l){var h,p=i.isHorizonTweetEnabled(l);return o(l,t.tweetId),p?(h=r.createElement(\"div\"),new s(u,a,f.TWEET,t,e,n,{sandboxWrapperEl:h})):new s(d,c,f.TWEET,t,e,n)}},function(t,e){var n=\"tfw_horizon_tweet_embed_9555\";t.exports={isHorizonTweetEnabled:function(t){return!(!t||!t[n]||\"hte\"!==t[n].bucket)}}},function(t,e,n){var r=n(15),i=n(156),o=n(38),s=n(16);t.exports=function(t,e,n){var a=t&&t.type||\"share\",u=\"hashtag\"==a?s.HASHTAG_BUTTON:\"mention\"==a?s.MENTION_BUTTON:s.SHARE_BUTTON;return new r(i,o,u,t,e,n)}},function(t,e,n){var r=n(37),i=n(39),o=n(0),s=n(68),a=n(31);t.exports=function(t){var e={widget_origin:i.rootDocumentLocation(),widget_frame:i.isFramed()?i.currentDocumentLocation():null,duration_ms:t.duration,item_ids:t.widgetIds||[]},n=o.aug(t.namespace,{page:\"page\",component:\"performance\"});return a.getExperiments().then(function(t){var i=s.isHorizonTweetEnabled(t)?o.aug(e,{context:\"horizon\"}):e;r.scribe(n,i)})}},function(t,e,n){var r=n(0),i=n(139),o=[\"ar\",\"fa\",\"he\",\"ur\"];t.exports={isRtlLang:function(t){return t=String(t).toLowerCase(),r.contains(o,t)},matchLanguage:function(t){return t=(t=(t||\"\").toLowerCase()).replace(\"_\",\"-\"),i(t)?t:(t=t.replace(/-.*/,\"\"),i(t)?t:\"en\")}}},function(t){t.exports={TWEET:0,RETWEET:10,CUSTOM_TIMELINE:17,LIVE_VIDEO_EVENT:28,QUOTE_TWEET:23}},function(t){t.exports={tweetButtonHtmlPath:\"/widgets/tweet_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",followButtonHtmlPath:\"/widgets/follow_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",hubHtmlPath:\"/widgets/hub.html\",widgetIframeHtmlPath:\"/widgets/widget_iframe.d0f13be8321eb432fba28cfc1c3351b1.html\",resourceBaseUrl:\"https://platform.twitter.com\"}},function(t,e,n){var r=n(3),i=n(100),o=n(25),s=n(11),a={favorite:[\"favorite\",\"like\"],follow:[\"follow\"],like:[\"favorite\",\"like\"],retweet:[\"retweet\"],tweet:[\"tweet\"]};function u(t){this.srcEl=[],this.element=t}u.open=function(t,e,n){var u=(r.intentType(t)||\"\").toLowerCase();r.isTwitterURL(t)&&(function(t,e){i.open(t,{},e)}(t,n),e&&o.trigger(\"click\",{target:e,region:\"intent\",type:\"click\",data:{}}),e&&a[u]&&a[u].forEach(function(n){o.trigger(n,{target:e,region:\"intent\",type:n,data:function(t,e){var n=s.decodeURL(e);switch(t){case\"favorite\":case\"like\":return{tweet_id:n.tweet_id};case\"follow\":return{screen_name:n.screen_name,user_id:n.user_id};case\"retweet\":return{source_tweet_id:n.tweet_id};default:return{}}}(u,t)})}))},t.exports=u},function(t,e){t.exports={getTimezoneOffset:function(){var t=(new Date).toString().match(/(GMT[+-]?\\d+)/);return t&&t[0]||\"GMT\"}}},function(t,e,n){var r=n(4),i=n(9),o=n(2),s=n(0),a=n(11),u=\"cb\",c=0;t.exports={fetch:function(t,e,n,d){var f,l,h;return d=function(t){if(t)return t.replace(/[^\\w$]/g,\"_\")}(d||u+c++),f=i.fullPath([\"callbacks\",d]),l=r.createElement(\"script\"),h=new o,e=s.aug({},e,{callback:f,suppress_response_codes:!0}),i.set([\"callbacks\",d],function(t){var e;t=(e=n(t||!1)).resp,e.success?h.resolve(t):h.reject(t),l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i.unset([\"callbacks\",d])}),l.onerror=function(){h.reject(new Error(\"failed to fetch \"+l.src))},l.src=a.url(t,e),l.async=\"async\",r.body.appendChild(l),h.promise}}},function(t,e,n){var r=n(2),i=n(105),o=n(7);function s(t){this._inputsQueue=[],this._task=t,this._hasFlushBeenScheduled=!1}s.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._hasFlushBeenScheduled||(this._hasFlushBeenScheduled=!0,i(o(this._flush,this))),e.promise},s.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._hasFlushBeenScheduled=!1},t.exports=s},function(t,e){t.exports=function(t,e){return t.reduce(function(t,n){var r=e(n);return t[r]=t[r]||[],t[r].push(n),t},{})}},function(t,e,n){var r=n(4),i=n(8),o=n(3);function s(t,e){var n,r;return e=e||i,/^https?:\\/\\//.test(t)?t:/^\\/\\//.test(t)?e.protocol+t:(n=e.host+(e.port.length?\":\"+e.port:\"\"),0!==t.indexOf(\"/\")&&((r=e.pathname.split(\"/\")).pop(),r.push(t),t=\"/\"+r.join(\"/\")),[e.protocol,\"//\",n,t].join(\"\"))}t.exports={absolutize:s,getCanonicalURL:function(){for(var t,e=r.getElementsByTagName(\"link\"),n=0;e[n];n++)if(\"canonical\"==(t=e[n]).rel)return s(t.href)},getScreenNameFromPage:function(){for(var t,e,n,i=[r.getElementsByTagName(\"a\"),r.getElementsByTagName(\"link\")],s=0,a=0,u=/\\bme\\b/;t=i[s];s++)for(a=0;e=t[a];a++)if(u.test(e.rel)&&(n=o.screenName(e.href)))return n}}},function(t,e,n){var r=n(8),i=/^[^#?]*\\.(gov|mil)(:\\d+)?([#?].*)?$/i,o={};function s(t){return t in o?o[t]:o[t]=i.test(t)}t.exports={isUrlSensitive:s,isHostPageSensitive:function(){return s(r.host)}}},function(t,e,n){var r=n(20),i=n(54),o=n(11),s=n(21),a=n(0),u=n(9).get(\"scribeCallback\"),c=2083,d=[],f=o.url(s.CLIENT_EVENT_ENDPOINT,{dnt:0,l:\"\"}),l=encodeURIComponent(f).length;function h(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);i||o||(u&&u(arguments),p(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r),s.CLIENT_EVENT_ENDPOINT))}function p(t,e,n){var r,u;n&&a.isObject(t)&&a.isObject(e)&&(i.log(t,e),r=s.flattenClientEventPayload(t,e),u={l:s.stringify(r)},s.noticeSeen(t)&&(u.notice_seen=!0),r.dnt&&(u.dnt=1),w(o.url(n,u)))}function m(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);if(!i&&!o)return v(s.flattenClientEventPayload(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r)))}function v(t){return d.push(t),d}function g(t){return encodeURIComponent(t).length+3}function w(t){return(new Image).src=t}t.exports={canFlushOneItem:function(t){var e=g(s.stringify(t));return l+e<c},_enqueueRawObject:v,scribe:p,clientEvent:h,clientEvent2:function(t,e,n){return h(t,e,n,2)},enqueueClientEvent:m,flushClientEvents:function(){var t;return d.length>1&&m({page:\"widgets_js\",component:\"scribe_pixel\",action:\"batch_log\"},{}),t=d,d=[],t.reduce(function(e,n,r){var i=e.length,o=i&&e[i-1];return r+1==t.length&&n.event_namespace&&\"batch_log\"==n.event_namespace.action&&(n.message=[\"entries:\"+r,\"requests:\"+i].join(\"/\")),function t(e){return Array.isArray(e)||(e=[e]),e.reduce(function(e,n){var r,i=s.stringify(n),o=g(i);return l+o<c?e=e.concat(i):(r=s.splitLogEntry(n)).length>1&&(e=e.concat(t(r))),e},[])}(n).forEach(function(t){var n=g(t);(!o||o.urlLength+n>c)&&(o={urlLength:l,items:[]},e.push(o)),o.urlLength+=n,o.items.push(t)}),e},[]).map(function(t){var e={l:t.items};return r.enabled()&&(e.dnt=1),w(o.url(s.CLIENT_EVENT_ENDPOINT,e))})},interaction:function(t,e,n,r){var i=s.extractTermsFromDOM(t.target||t.srcElement);i.action=r||\"click\",h(i,e,n)}}},function(t,e,n){var r=n(0),i=n(43);t.exports=function(t,e){return i(t,e)?[t]:r.toRealArray(t.querySelectorAll(e))}},function(t,e){t.exports=function(t,e,n){for(var r,i=0;i<t.length;i++)if(r=e.call(n,t[i],i,t))return r}},function(t,e){t.exports=function(){return Math.floor(+new Date/9e5)}},function(t,e,n){var r=n(12);t.exports=function(t){var e,n;return e=t.headers&&t.headers.status,!(n=t&&!t.error&&200===e)&&t.headers&&t.headers.message&&r.publicError(t.headers.message),{success:n,resp:t}}},function(t,e,n){var r=n(37),i=n(21);t.exports=function(t,e,n,o){r.scribe(i.formatClientEventNamespace({client:\"tfw\",page:\"ddg\",section:t,action:\"experiment\"}),{experiment_key:t,bucket:e,version:n,data:o},!0)}},function(t,e,n){var r,i=n(30),o=0;function s(){r&&r.length===o&&(i.emitter.trigger(i.ALL_WIDGETS_AND_IMAGES_LOADED,r),r=null)}i.emitter.bind(i.ALL_WIDGETS_RENDER_END,function(t){r=t.widgets,s()}),t.exports={reportImagesLoadForAWidget:function(){o++,s()}}},,,,,,,,,function(t,e,n){var r,i=n(2),o=n(4),s=n(98),a=n(49),u=n(9),c=n(99),d=n(25),f=n(102),l=n(157),h=n(165),p=n(166),m=n(30),v=n(31);n(167),m.emitter.trigger(m.START),u.set(\"widgets.init\",!0),a.set(\"init\",!0),p(),r=new i,s.exposeReadyPromise(r.promise,a.base,\"_e\"),a.set(\"widgets\",l),a.set(\"widgets.load\",f.load),a.set(\"events\",d),h(function(){v.load(),r.resolve(a.base),c.attachTo(o),f.loadPage()})},function(t,e){t.exports=navigator},function(t,e,n){var r=n(7);t.exports={exposeReadyPromise:function(t,e,n){e.ready=r(t.then,t),n&&Array.isArray(e[n])&&(e[n].forEach(r(t.then,t)),delete e[n])}}},function(t,e,n){var r=n(8),i=n(36),o=n(34),s=n(74),a=n(3);function u(t){var e,n,u;t.altKey||t.metaKey||t.shiftKey||(e=o.closest(function(t){return\"A\"===t.tagName||\"AREA\"===t.tagName},t.target))&&a.isIntentURL(e.href)&&(n=(n=(n=[u=e.href,\"original_referer=\"+r.href].join(-1==u.indexOf(\"?\")?\"?\":\"&\")).replace(/^http[:]/,\"https:\")).replace(/^\\/\\//,\"https://\"),s.open(n,e),i.preventDefault(t))}t.exports={attachTo:function(t){t.addEventListener(\"click\",u,!1)}}},function(t,e,n){var r,i=n(1),o=n(101),s=n(36),a=n(34),u=n(22),c=n(3),d=n(24),f=n(0),l=\"intent_\",h=i.screen.width,p=i.screen.height;function m(t,e){function n(t){return Math.round(t/2)}return t>e?{coordinate:0,size:e}:{coordinate:n(e)-n(t),size:t}}function v(t,e,n){var i,o;e=r.parse(e),n=n||{},i=m(e.width,n.width||h),e.left=i.coordinate,e.width=i.size,o=m(e.height,n.height||p),e.top=o.coordinate,e.height=o.size,this.win=t,this.features=function(t){var e=[];return f.forIn(t,function(t,n){e.push(t+\"=\"+n)}),e.join(\",\")}(e)}r=(new o).defaults({width:550,height:520,personalbar:\"0\",toolbar:\"0\",location:\"1\",scrollbars:\"1\",resizable:\"1\"}),v.prototype.open=function(t,e){var n=e&&\"click\"==e.type&&a.closest(\"a\",e.target),r=e&&(e.altKey||e.metaKey||e.shiftKey),i=n&&(u.ios()||u.android());if(c.isTwitterURL(t))return r||i?this:(this.name=l+d.generate(),this.popup=this.win.open(t,this.name,this.features),e&&s.preventDefault(e),this)},v.open=function(t,e,n){return new v(i,e).open(t,n)},t.exports=v},function(t,e,n){var r=n(5),i=n(0);function o(){this.assertions=[],this._defaults={}}o.prototype.assert=function(t,e){return this.assertions.push({fn:t,msg:e||\"assertion failed\"}),this},o.prototype.defaults=function(t){return this._defaults=t||this._defaults,this},o.prototype.require=function(t){var e=this;return(t=Array.isArray(t)?t:i.toRealArray(arguments)).forEach(function(t){e.assert(function(t){return function(e){return r.hasValue(e[t])}}(t),\"required: \"+t)}),this},o.prototype.parse=function(t){var e,n;if(e=i.aug({},this._defaults,t||{}),(n=this.assertions.reduce(function(t,n){return n.fn(e)||t.push(n.msg),t},[])).length>0)throw new Error(n.join(\"\\n\"));return e},t.exports=o},function(t,e,n){var r=n(4),i=n(6),o=n(23),s=n(52),a=n(35),u=n(9),c=n(37),d=n(25),f=n(5),l=n(0),h=n(31),p=n(119),m=n(30);function v(){var t=a.val(\"widgets:autoload\")||!0;return!f.isFalseValue(t)&&(f.isTruthValue(t)?r.body:r.querySelectorAll(t))}function g(t,e){var n,i;return t=(t=t||r.body).length?l.toRealArray(t):[t],c.pause(),i=function(t,e){return t.reduce(function(t,n){return t.concat(p.reduce(function(t,r){return t.concat(r(n,e))},[]))},[])}(t,e),m.emitter.trigger(m.ALL_WIDGETS_RENDER_START,{widgets:i}),n=o.allResolved(i.map(function(t){return s.addWidget(t)})).then(function(t){d.trigger(\"loaded\",{widgets:t}),t&&t.length&&m.emitter.trigger(m.ALL_WIDGETS_RENDER_END,{widgets:t})}),o.always(n,function(){c.resume()}),n}function w(t){return h.getExperiments().then(function(e){return g(t,e)})}t.exports={load:w,loadPage:function(){var t=v();return!1===t?i.resolve():(u.set(\"widgets.loaded\",!0),w(t))},_getPageLoadTarget:v}},function(t,e,n){var r=n(10),i=n(18),o=n(25),s=n(53),a=n(6),u=n(23);function c(t,e){this._widget=null,this._sandbox=null,this._hydrated=!1,this._insertedIntoDom=!1,this._Sandbox=t.Sandbox,this._factory=t.factory,this._widgetParams=t.parameters,this._resolve=e,this._className=t.className,this._renderedClassName=t.className+\"-rendered\",this._errorClassName=t.className+\"-error\",this._srcEl=t.srcEl,this._targetGlobal=function(t){return(t.srcEl||t.targetEl).ownerDocument.defaultView}(t),this._sandboxWrapperEl=t.options?t.options.sandboxWrapperEl:null,this._insertionStrategy=function(e){var n,r=t.srcEl,i=t.targetEl,o=t.options?t.options.sandboxWrapperEl:null;o?(o.appendChild(e),n=o):n=e,r?i.insertBefore(n,r):i.appendChild(n)}}c.fromRawTask=function(t){return new c(t.input,t.taskDoneDeferred.resolve)},c.prototype.initialize=function(){var t=this,e=new this._Sandbox(this._targetGlobal);return this._factory(this._widgetParams,e).then(function(n){return t._widget=n,t._sandbox=e,n._sandboxWrapperEl=t._sandboxWrapperEl,n})},c.prototype.insertIntoDom=function(){var t=this;return this._widget?this._sandbox.insert(this._widget.id,{class:[this._className,this._renderedClassName].join(\" \")},null,this._insertionStrategy).then(function(){t._insertedIntoDom=!0}):a.reject(new Error(\"cannot insert widget into DOM before it is initialized\"))},c.prototype.hydrate=function(){var t=this;return this._widget?this._widget.hydrate().then(function(){t._hydrated=!0}):a.reject(new Error(\"cannot hydrate widget before it is initialized\"))},c.prototype.render=function(){var t=this;function e(e){return s(t._sandbox.sandboxEl).then(function(){return a.reject(e)})}return this._hydrated?this._insertedIntoDom?t._widget.render(t._sandbox).then(function(){return t._sandbox.onResize(function(){return t._widget.resize().then(function(){o.trigger(\"resize\",{target:t._sandbox.sandboxEl})})}),t._widget.show()}).then(function(){return s(t._srcEl).then(function(){return t._sandbox.sandboxEl})},e):e(new Error(\"cannot render widget before DOM insertion\")):e(new Error(\"cannot render widget before hydration\"))},c.prototype.fail=function(){var t=this;return this._srcEl?u.always(i.write(function(){r.add(t._srcEl,t._errorClassName)}),function(){o.trigger(\"rendered\",{target:t._srcEl}),t._resolve(t._srcEl)}):(t._resolve(),a.resolve())},c.prototype.success=function(){o.trigger(\"rendered\",{target:this._sandbox.sandboxEl}),this._resolve(this._sandbox.sandboxEl)},t.exports=c},function(t,e,n){var r;!function(){\"use strict\";var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};function o(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}o.prototype.read=function(t,e){var n=this.add(\"read\",t,e),r=n.id;return this.batch.read.push(n.id),\"reading\"===this.batch.mode||this.batch.scheduled?r:(this.scheduleBatch(),r)},o.prototype.write=function(t,e){var n=this.add(\"write\",t,e),r=this.batch.mode,i=n.id;return this.batch.write.push(n.id),\"writing\"===r||\"reading\"===r||this.batch.scheduled?i:(this.scheduleBatch(),i)},o.prototype.defer=function(t,e,n){\"function\"==typeof t&&(n=e,e=t,t=1);var r=this,i=t-1;return this.schedule(i,function(){r.run({fn:e,ctx:n})})},o.prototype.clear=function(t){if(\"function\"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var n=this.batch[e.type],r=n.indexOf(t);delete this.batch.hash[t],~r&&n.splice(r,1)}},o.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},o.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},o.prototype.uniqueId=function(){return++this.lastId},o.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},o.prototype.runBatch=function(){try{this.batch.mode=\"reading\",this.flush(this.batch.read),this.batch.mode=\"writing\",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},o.prototype.add=function(t,e,n){var r=this.uniqueId();return this.batch.hash[r]={id:r,fn:e,ctx:n,type:t}},o.prototype.run=function(t){var e=t.ctx||this,n=t.fn;if(delete this.batch.hash[t.id],!this.onError)return n.call(e);try{n.call(e)}catch(t){this.onError(t)}},o.prototype.loop=function(){var t,e=this,n=this.raf,r=!1;function i(){var t=e.frames.shift();e.frames.length?n(i):e.looping=!1,t&&t()}this.looping||(t=setTimeout(function(){r=!0,i()},500),n(function(){r||(clearTimeout(t),i())}),this.looping=!0)},o.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)};var s=new o;void 0!==t&&t.exports?t.exports=s:void 0===(r=function(){return s}.call(e,n,e,t))||(t.exports=r)}()},function(t,e,n){var r=n(48).Promise;t.exports=r._asap},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=n(32),c=n(20),d=n(2),f=n(6),l=n(54),h=n(21),p=n(0),m=n(26),v=n(9).get(\"scribeCallback\"),g=Math.floor(1e3*Math.random())+\"_\",w=\"rufous-frame-\"+g+\"-\",y=\"rufous-form-\"+g+\"-\",b=0,_=!1,E=new d;function x(){var t=o.createElement(\"form\"),e=o.createElement(\"input\"),n=o.createElement(\"input\");return b++,t.action=h.CLIENT_EVENT_ENDPOINT,t.method=\"POST\",t.target=w+b,t.id=y+b,e.type=\"hidden\",e.name=\"dnt\",e.value=c.enabled(),n.type=\"hidden\",n.name=\"tfw_redirect\",n.value=h.RUFOUS_REDIRECT,t.appendChild(e),t.appendChild(n),t}function T(){var t=w+b;return u({id:t,name:t,width:0,height:0,border:0},{display:\"none\"},o.doc)}t.exports={clientEvent:function(t,e,n,i){(function(t,e){var n=!p.isObject(t),r=!!e&&!p.isObject(e),i=n||r;return i})(t,e)||(v&&v(arguments),E.promise.then(function(){!function(t,e){var n,i,s;p.isObject(t)&&p.isObject(e)&&(l.log(t,e),s=h.flattenClientEventPayload(t,e),(n=r.firstChild).value=+(+n.value||s.dnt||0),(i=o.createElement(\"input\")).type=\"hidden\",i.name=\"l\",i.value=h.stringify(s),r.appendChild(i))}(h.formatClientEventNamespace(t),h.formatClientEventData(e,n,i))}))},flush:function(){return E.promise.then(function(){var t;return r.children.length<=2?f.reject():(t=f.all([o.doc.body.appendChild(r),o.doc.body.appendChild(i)]).then(function(t){var e=t[0],n=t[1];return n.addEventListener(\"load\",function(){!function(t,e){return function(){var n=t.parentNode;n&&(n.removeChild(t),n.removeChild(e))}}(e,n)()}),e.submit(),t}),r=x(),i=T(),t)})},init:function(){return _?E.promise:((o=new m(a)).insert(\"rufous-sandbox\",null,{display:\"none\"},function(t){s.body.appendChild(t)}).then(function(){o.setTitle(\"Twitter analytics iframe\"),r=x(),i=T(),E.resolve([r,i])}),_=!0,E.promise)}}},function(t,e,n){var r=n(0);t.exports=function t(e){var n=[];return e.forEach(function(e){var i=r.isType(\"array\",e)?t(e):[e];n=n.concat(i)}),n}},function(t,e){t.exports=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}},function(t,e,n){var r=n(41),i=n(0),o=n(111);function s(){r.apply(this,arguments)}s.prototype=Object.create(r.prototype),i.aug(s.prototype,{factory:o}),t.exports=s},function(t,e,n){var r=n(23),i=n(0),o=n(7);t.exports={before:function(t,e){return function(){var n,i=this,o=arguments;return n=e.apply(this,arguments),r.isPromise(n)?n.then(function(){return t.apply(i,o)}):t.apply(this,arguments)}},after:function(t,e){return function(){var n,i=this,o=arguments;function s(t,e){return r.isPromise(e)?e.then(function(){return t}):t}return n=t.apply(this,arguments),r.isPromise(n)?n.then(function(t){return s(t,e.apply(i,o))}):s(n,e.apply(this,arguments))}},around:function(t,e){return function(){var n=i.toRealArray(arguments);return n.unshift(o(t,this)),e.apply(this,n)}}}},function(t,e,n){var r=n(10),i=n(18),o=n(42),s=n(6),a=n(0);t.exports=function(){var t=o();function e(e){t.apply(this,arguments),Object.defineProperty(this,\"targetGlobal\",{value:e})}return e.prototype=Object.create(t.prototype),a.aug(e.prototype,{id:null,initialized:!1,width:0,height:0,sandboxEl:null,insert:function(){return s.reject()},onResize:function(){},addClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.add(e,t)})})},removeClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.remove(e,t)})})},styleSelf:function(t){var e=this;return i.write(function(){a.forIn(t,function(t,n){e.sandboxEl.style[t]=n})})}}),e}},function(t,e,n){var r=n(4),i=n(10),o=n(18),s=n(55),a=n(27),u=n(56),c=n(44),d=n(45),f=n(32),l=n(12),h=n(46),p=n(2),m=n(6),v=n(0),g=n(9),w=n(24),y=n(7),b={allowfullscreen:\"true\"},_={position:\"absolute\",visibility:\"hidden\",display:\"block\",width:\"0px\",height:\"0px\",padding:\"0\",border:\"none\"},E={position:\"static\",visibility:\"visible\"},x=\"SandboxRoot\",T=\".SandboxRoot { display: none; }\",A=50;function S(t,e,n,r){return e=v.aug({id:t},b,e),n=v.aug({},_,n),f(e,n,r)}function R(t,e,n,i,s){var a=new p,u=w.generate(),c=S(t,e,n,s);return g.set([\"sandbox\",u],function(){var t=c.contentWindow.document;o.write(function(){t.write(\"<!DOCTYPE html><html><head><\/head><body><\/body><\/html>\")}).then(function(){t.close(),a.resolve(c)})}),c.src=[\"javascript:\",'document.write(\"\");',\"try { window.parent.document; }\",'catch (e) { document.domain=\"'+r.domain+'\"; }',\"window.parent.\"+g.fullPath([\"sandbox\",u])+\"();\"].join(\"\"),c.addEventListener(\"error\",a.reject,!1),o.write(function(){i.parentNode.replaceChild(c,i)}),a.promise}t.exports=a.couple(n(57),function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.win}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"rootEl\",{get:function(){return this.doc&&this.doc.documentElement}}),t.defineProperty(\"widgetEl\",{get:function(){return this.doc&&this.doc.body.firstElementChild}}),t.defineProperty(\"win\",{get:function(){return this.iframeEl&&this.iframeEl.contentWindow}}),t.defineProperty(\"doc\",{get:function(){return this.win&&this.win.document}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return o.read(function(){var e,n=h(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=h(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_setTargetToBlank\",function(){var t=this.createElement(\"base\");t.target=\"_blank\",this.doc.head.appendChild(t)}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.override(\"createElement\",function(t){return this.doc.createElement(t)}),t.override(\"createFragment\",function(){return this.doc.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!s.getSelectedText(this.win)}),t.override(\"addRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return i.present(this.rootEl,t)}),t.define(\"addStyleSheet\",function(t,e){var n,r=new p;return this.initialized?((n=this.createElement(\"link\")).type=\"text/css\",n.rel=\"stylesheet\",n.href=t,n.addEventListener(\"load\",r.resolve,!1),n.addEventListener(\"error\",r.reject,!1),o.write(y(e,null,n)).then(function(){return u(t).then(r.resolve,r.reject),r.promise})):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){return e.head.appendChild(t)})}),t.define(\"addCss\",function(t,e){var n;return c.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.doc.createTextNode(t)),o.write(y(e,null,n))):(l.devError(\"CSP enabled; cannot embed inline styles\"),m.resolve())}),t.override(\"prependCss\",function(t){var e=this.doc;return this.addCss(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this.doc;return this.addCss(t,function(t){return e.head.appendChild(t)})}),t.override(\"makeVisible\",function(){var t=this;return this.styleSelf(E).then(function(){t._updateCachedDimensions()})}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this.widgetEl?m.reject(new Error(\"widget already injected\")):o.write(function(){e.doc.body.appendChild(t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).height:0}),o.write(function(){e.sandboxEl.style.height=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.override(\"matchWidthToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).width:0}),o.write(function(){e.sandboxEl.style.width=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.after(\"initialize\",function(){this._iframe=null,this._width=this._height=0,this._resizeHandlers=[]}),t.override(\"insert\",function(t,e,n,r){var i=this,s=new p,a=this.targetGlobal.document,u=S(t,e,n,a);return o.write(y(r,null,u)),u.addEventListener(\"load\",function(){(function(t){try{t.contentWindow.document}catch(t){return m.reject(t)}return m.resolve(t)})(u).then(null,y(R,null,t,e,n,u,a)).then(s.resolve,s.reject)},!1),u.addEventListener(\"error\",s.reject,!1),s.promise.then(function(t){var e=d(i._didResize,A,i);return i._iframe=t,i.win.addEventListener(\"resize\",e,!1),m.all([i._setTargetToBlank(),i.addRootClass(x),i.prependCss(T)])})}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){t.exports=function(){throw new Error(\"unimplemented method\")}},function(t,e,n){var r=n(2),i=n(7),o=100,s=3e3;function a(t,e){this._inputsQueue=[],this._task=t,this._isPaused=!1,this._flushDelay=e&&e.flushDelay||o,this._pauseLength=e&&e.pauseLength||s,this._flushTimeout=void 0}a.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._scheduleFlush(),e.promise},a.prototype._scheduleFlush=function(){this._isPaused||(clearTimeout(this._flushTimeout),this._flushTimeout=setTimeout(i(this._flush,this),this._flushDelay))},a.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._flushTimeout=void 0},a.prototype.pause=function(t){clearTimeout(this._flushTimeout),this._isPaused=!0,!t&&this._pauseLength&&setTimeout(i(this.resume,this),this._pauseLength)},a.prototype.resume=function(){this._isPaused=!1,this._scheduleFlush()},t.exports=a},function(t,e,n){var r,i=n(73),o=n(32),s=n(2),a=n(4),u=n(19),c=n(22),d=n(33),f=n(8),l=n(12),h=n(116),p=n(58),m=n(9),v=n(11),g=n(117),w=n(3),y=n(0),b=n(1),_=p(function(){return new s});function E(t){var e=t||{should_obtain_cookie_consent:!0,experiments:{}};return new g(e.should_obtain_cookie_consent,e.experiments)}t.exports={load:function(){var t,e,n,s;if(c.ie9()||c.ie10()||\"http:\"!==f.protocol&&\"https:\"!==f.protocol)return l.devError(\"Using default settings due to unsupported browser or protocol.\"),r=E(),void _().resolve();t={origin:f.origin},u.settings().indexOf(\"localhost\")>-1&&(t.localSettings=!0),e=v.url(i.resourceBaseUrl+i.widgetIframeHtmlPath,t),n=function(t){var n,i,o,s;if(i=w.isTwitterURL(t.origin),o=e.substr(0,t.origin.length)===t.origin,s=w.isTwimgURL(t.origin),o&&i||s)try{(n=\"string\"==typeof t.data?d.parse(t.data):t.data).namespace===h.settings&&(r=E(n.settings),_().resolve())}catch(t){l.devError(t)}},b.addEventListener(\"message\",n),s=o({src:e,title:\"Twitter settings iframe\"},{display:\"none\"}),a.body.appendChild(s)},settingsLoaded:function(){var t,e,n;return t=new s,e=m.get(\"experimentOverride\"),_().promise.then(function(){e&&e.name&&e.assignment&&((n={})[e.name]={bucket:e.assignment},r.experiments=y.aug(r.experiments,n)),t.resolve(r)}).catch(function(e){t.reject(e)}),t.promise}}},function(t,e){t.exports={settings:\"twttr.settings\"}},function(t,e){t.exports=function(t,e){this.shouldObtainCookieConsent=t,this.experiments=e||{}}},function(t,e){t.exports=function(t){return t.split(\"\").map(function(t){return t.charCodeAt(0).toString(16)}).join(\"\")}},function(t,e,n){t.exports=[n(120),n(125),n(133),n(135),n(137),n(151),n(155)]},function(t,e,n){var r=n(11),i=n(5),o=n(0),s=n(13),a=n(14)(),u=n(59),c=\"a.twitter-dm-button\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=t.getAttribute(\"data-show-screen-name\"),n=s(t),a=t.getAttribute(\"href\"),u=t.getAttribute(\"data-screen-name\"),c=e?i.asBoolean(e):null,d=t.getAttribute(\"data-size\"),f=r.decodeURL(a),l=f.recipient_id,h=t.getAttribute(\"data-text\")||f.text,p=t.getAttribute(\"data-welcome-message-id\")||f.welcomeMessageId;return o.aug(n,{screenName:u,showScreenName:c,size:d,text:h,userId:l,welcomeMessageId:p})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(0);t.exports=function t(e){var n;if(e)return n=e.lang||e.getAttribute(\"data-lang\"),r.isType(\"string\",n)?n:t(e.parentElement)}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(2).then(function(r){var o;try{o=n(88),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(124),i=n(1),o=n(10),s=n(36),a=n(18),u=n(55),c=n(27),d=n(56),f=n(44),l=n(46),h=n(7),p=n(45),m=n(6),v=n(0),g=50,w={position:\"absolute\",visibility:\"hidden\",display:\"block\",transform:\"rotate(0deg)\"},y={position:\"static\",visibility:\"visible\"},b=\"twitter-widget\",_=\"open\",E=\"SandboxRoot\",x=\".SandboxRoot { display: none; max-height: 10000px; }\";t.exports=c.couple(n(57),function(t){t.defineStatic(\"isSupported\",function(){return!!i.HTMLElement.prototype.attachShadow&&f.inlineStyle()}),t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this._shadowHost}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this._shadowHost}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return a.read(function(){var e,n=l(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=l(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.override(\"createElement\",function(t){return this.targetGlobal.document.createElement(t)}),t.override(\"createFragment\",function(){return this.targetGlobal.document.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!u.getSelectedText(this.targetGlobal)}),t.override(\"addRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return o.present(this._shadowRootBody,t)}),t.override(\"addStyleSheet\",function(t,e){return this.addCss('@import url(\"'+t+'\");',e).then(function(){return d(t)})}),t.override(\"prependStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){return e.appendChild(t)})}),t.override(\"addCss\",function(t,e){var n;return this.initialized?f.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.targetGlobal.document.createTextNode(t)),a.write(h(e,null,n))):m.resolve():m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){return e.appendChild(t)})}),t.override(\"makeVisible\",function(){return this.styleSelf(y)}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this._shadowRootBody.firstElementChild?m.reject(new Error(\"widget already injected\")):a.write(function(){e._shadowRootBody.appendChild(t)}).then(function(){return e._updateCachedDimensions()}).then(function(){var t=p(e._didResize,g,e);new r(e._shadowRootBody,t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){return m.resolve()}),t.override(\"matchWidthToContent\",function(){return m.resolve()}),t.override(\"insert\",function(t,e,n,r){var i=this.targetGlobal.document,o=this._shadowHost=i.createElement(b),u=this._shadowRoot=o.attachShadow({mode:_}),c=this._shadowRootBody=i.createElement(\"div\");return v.forIn(e||{},function(t,e){o.setAttribute(t,e)}),o.id=t,u.appendChild(c),s.delegate(c,\"click\",\"A\",function(t,e){e.hasAttribute(\"target\")||e.setAttribute(\"target\",\"_blank\")}),m.all([this.styleSelf(w),this.addRootClass(E),this.prependCss(x),a.write(r.bind(null,o))])}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"initialize\",function(){this._shadowHost=this._shadowRoot=this._shadowRootBody=null,this._width=this._height=0,this._resizeHandlers=[]}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){var n;(n=function(t,e){function r(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new function(){var t,e;this.q=[],this.add=function(t){this.q.push(t)},this.call=function(){for(t=0,e=this.q.length;t<e;t++)this.q[t].call()}},t.resizedAttached.add(e);t.resizeSensor=document.createElement(\"div\"),t.resizeSensor.className=\"resize-sensor\";var n=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;\",r=\"position: absolute; left: 0; top: 0; transition: 0s;\";t.resizeSensor.style.cssText=n,t.resizeSensor.innerHTML='<div class=\"resize-sensor-expand\" style=\"'+n+'\"><div style=\"'+r+'\"><\/div><\/div><div class=\"resize-sensor-shrink\" style=\"'+n+'\"><div style=\"'+r+' width: 200%; height: 200%\"><\/div><\/div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}(t,\"position\")]||(t.style.position=\"relative\");var i,o,s=t.resizeSensor.childNodes[0],a=s.childNodes[0],u=t.resizeSensor.childNodes[1],c=(u.childNodes[0],function(){a.style.width=s.offsetWidth+10+\"px\",a.style.height=s.offsetHeight+10+\"px\",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,i=t.offsetWidth,o=t.offsetHeight});c();var d=function(t,e,n){t.attachEvent?t.attachEvent(\"on\"+e,n):t.addEventListener(e,n)},f=function(){t.offsetWidth==i&&t.offsetHeight==o||t.resizedAttached&&t.resizedAttached.call(),c()};d(s,\"scroll\",f),d(u,\"scroll\",f)}var i=Object.prototype.toString.call(t),o=\"[object Array]\"===i||\"[object NodeList]\"===i||\"[object HTMLCollection]\"===i||\"undefined\"!=typeof jQuery&&t instanceof jQuery||\"undefined\"!=typeof Elements&&t instanceof Elements;if(o)for(var s=0,a=t.length;s<a;s++)r(t[s],e);else r(t,e);this.detach=function(){if(o)for(var e=0,r=t.length;e<r;e++)n.detach(t[e]);else n.detach(t)}}).detach=function(t){t.resizeSensor&&(t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)},void 0!==t&&void 0!==t.exports?t.exports=n:window.ResizeSensor=n},function(t,e,n){var r=n(3),i=n(0),o=n(13),s=n(14)(),a=n(62),u=n(5),c=\"a.twitter-follow-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:r.screenName(t.href),showScreenName:\"false\"!==t.getAttribute(\"data-show-screen-name\"),showCount:\"false\"!==t.getAttribute(\"data-show-count\"),size:t.getAttribute(\"data-size\"),count:t.getAttribute(\"data-count\"),preview:t.getAttribute(\"data-preview\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(89),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(18),i=n(128),o=n(58),s=n(32),a=n(2),u=n(6),c=n(7),d=n(0),f={allowfullscreen:\"true\"},l={position:\"absolute\",visibility:\"hidden\",width:\"0px\",height:\"0px\"},h={position:\"static\",visibility:\"visible\"},p={};i(function(t,e,n){var r=p[t];if(r)return e=e||1,n=n||1,r.styleSelf({width:e+\"px\",height:n+\"px\"}).then(function(){r.didResize()})},function(t){var e=p[t];if(e)return e._rendered.resolve()},function(t,e){var n=p[t];n&&e&&n.setIframeVersion(e)}),t.exports=function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.iframeEl}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"iframeVersion\",{get:function(){return this._iframeVersion}}),t.define(\"updateCachedDimensions\",function(){var t=this;return this.initialized?r.read(function(){t._width=t.sandboxEl.offsetWidth,t._height=t.sandboxEl.offsetHeight}):u.resolve()}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.define(\"setWaitToSwapUntilRendered\",function(t){this._waitToSwapUntilRendered=t}),t.define(\"setIframeVersion\",function(t){this._iframeVersion=t}),t.define(\"isRendered\",function(){return this._rendered.promise}),t.define(\"makeVisible\",function(){return this.styleSelf(h)}),t.define(\"didResize\",function(){var t=this,e=t._resizeHandlers.length>0;return this.updateCachedDimensions().then(function(){e&&t._resizeHandlers.forEach(function(e){e(t)})})}),t.define(\"loadDocument\",function(t){var e=new a;return this.initialized?this.iframeEl.src?u.reject(new Error(\"widget already loaded\")):(this.iframeEl.addEventListener(\"load\",e.resolve,!1),this.iframeEl.addEventListener(\"error\",e.reject,!1),this.iframeEl.src=t,e.promise):u.reject(new Error(\"sandbox not initialized\"))}),t.after(\"initialize\",function(){var t=new a;this._iframe=null,this._iframeVersion=null,this._width=this._height=0,this._resizeHandlers=[],this._rendered=t,this._waitToSwapUntilRendered=!1}),t.override(\"insert\",function(t,e,n,i){var a=this;return e=d.aug({id:t},f,e),n=d.aug({},l,n),this._iframe=s(e,n),p[t]=this,a._waitToSwapUntilRendered||this.onResize(o(function(){a.makeVisible()})),r.write(c(i,null,this._iframe))}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this.updateCachedDimensions()})}},function(t,e,n){var r=n(1),i=n(129),o=n(131),s=n(25),a=n(5),u=n(132);t.exports=function(t,e,n){function c(t,e){var n=u(this);s.trigger(t,{target:n,region:e,type:t,data:{}})}function d(e){var n=u(this),r=n&&n.id,i=a.asInt(e.width),o=a.asInt(e.height);r&&void 0!==i&&void 0!==o&&t(r,i,o)}(new i).attachReceiver(new o.Receiver(r,\"twttr.button\")).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.resizeButton\",d),(new i).attachReceiver(new o.Receiver(r,\"twttr.embed\")).bind(\"twttr.private.initialized\",function(t){var e=u(this),r=e&&e.id,i=t.iframe_version;r&&i&&n&&n(r,i)}).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.rendered\",function(){var t=u(this),n=t&&t.id;n&&e&&e(n)}).bind(\"twttr.private.resize\",d)}},function(t,e,n){var r=n(33),i=n(130),o=n(0),s=n(6),a=n(23),u=\"2.0\";function c(t){this.registry=t||{}}function d(t){var e,n;return e=o.isType(\"string\",t),n=o.isType(\"number\",t),e||n||null===t}function f(t,e){return{jsonrpc:u,id:d(t)?t:null,error:e}}c.prototype._invoke=function(t,e){var n,r,i;n=this.registry[t.method],r=t.params||[],r=o.isType(\"array\",r)?r:[r];try{i=n.apply(e.source||null,r)}catch(t){i=s.reject(t.message)}return a.isPromise(i)?i:s.resolve(i)},c.prototype._processRequest=function(t,e){var n,r;return function(t){var e,n,r;return!!o.isObject(t)&&(e=t.jsonrpc===u,n=o.isType(\"string\",t.method),r=!(\"id\"in t)||d(t.id),e&&n&&r)}(t)?(n=\"params\"in t&&(r=t.params,!o.isObject(r)||o.isType(\"function\",r))?s.resolve(f(t.id,i.INVALID_PARAMS)):this.registry[t.method]?this._invoke(t,{source:e}).then(function(e){return n=t.id,{jsonrpc:u,id:n,result:e};var n},function(){return f(t.id,i.INTERNAL_ERROR)}):s.resolve(f(t.id,i.METHOD_NOT_FOUND)),null!=t.id?n:s.resolve()):s.resolve(f(t.id,i.INVALID_REQUEST))},c.prototype.attachReceiver=function(t){return t.attachTo(this),this},c.prototype.bind=function(t,e){return this.registry[t]=e,this},c.prototype.receive=function(t,e){var n,a,u,c=this;try{u=t,t=o.isType(\"string\",u)?r.parse(u):u}catch(t){return s.resolve(f(null,i.PARSE_ERROR))}return e=e||null,a=((n=o.isType(\"array\",t))?t:[t]).map(function(t){return c._processRequest(t,e)}),n?function(t){return s.all(t).then(function(t){return(t=t.filter(function(t){return void 0!==t})).length?t:void 0})}(a):a[0]},t.exports=c},function(t){t.exports={PARSE_ERROR:{code:-32700,message:\"Parse error\"},INVALID_REQUEST:{code:-32600,message:\"Invalid Request\"},INVALID_PARAMS:{code:-32602,message:\"Invalid params\"},METHOD_NOT_FOUND:{code:-32601,message:\"Method not found\"},INTERNAL_ERROR:{code:-32603,message:\"Internal error\"}}},function(t,e,n){var r=n(8),i=n(1),o=n(33),s=n(2),a=n(22),u=n(0),c=n(3),d=n(7),f=a.ie9();function l(t,e,n){var r;t&&t.postMessage&&(f?r=(n||\"\")+o.stringify(e):n?(r={})[n]=e:r=e,t.postMessage(r,\"*\"))}function h(t){return u.isType(\"string\",t)?t:\"JSONRPC\"}function p(t,e){return e?u.isType(\"string\",t)&&0===t.indexOf(e)?t.substring(e.length):t&&t[e]?t[e]:void 0:t}function m(t,e){var n=t.document;this.filter=h(e),this.server=null,this.isTwitterFrame=c.isTwitterURL(n.location.href),t.addEventListener(\"message\",d(this._onMessage,this),!1)}function v(t,e){this.pending={},this.target=t,this.isTwitterHost=c.isTwitterURL(r.href),this.filter=h(e),i.addEventListener(\"message\",d(this._onMessage,this),!1)}u.aug(m.prototype,{_onMessage:function(t){var e,n=this;this.server&&(this.isTwitterFrame&&!c.isTwitterURL(t.origin)||(e=p(t.data,this.filter))&&this.server.receive(e,t.source).then(function(e){e&&l(t.source,e,n.filter)}))},attachTo:function(t){this.server=t},detach:function(){this.server=null}}),u.aug(v.prototype,{_processResponse:function(t){var e=this.pending[t.id];e&&(e.resolve(t),delete this.pending[t.id])},_onMessage:function(t){var e;if((!this.isTwitterHost||c.isTwitterURL(t.origin))&&(e=p(t.data,this.filter))){if(u.isType(\"string\",e))try{e=o.parse(e)}catch(t){return}(e=u.isType(\"array\",e)?e:[e]).forEach(d(this._processResponse,this))}},send:function(t){var e=new s;return t.id?this.pending[t.id]=e:e.resolve(),l(this.target,t,this.filter),e.promise}}),t.exports={Receiver:m,Dispatcher:v,_stringifyPayload:function(t){return arguments.length>0&&(f=!!t),f}}},function(t,e,n){var r=n(4);t.exports=function(t){for(var e,n=r.getElementsByTagName(\"iframe\"),i=0;n[i];i++)if((e=n[i]).contentWindow===t)return e}},function(t,e,n){var r=n(5),i=n(0),o=n(3),s=n(13),a=n(14)(),u=n(63),c=\"a.twitter-moment\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=s(t),n={momentId:o.momentId(t.href),chrome:t.getAttribute(\"data-chrome\"),limit:t.getAttribute(\"data-limit\")};return i.forIn(n,function(t,n){var i=e[t];e[t]=r.hasValue(i)?i:n}),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(4)]).then(function(r){var o;try{o=n(90),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0),i=n(13),o=n(14)(),s=n(64),a=\"a.periscope-on-air\",u=/^https?:\\/\\/(?:www\\.)?(?:periscope|pscp)\\.tv\\/@?([a-zA-Z0-9_]+)\\/?$/i;t.exports=function(t){return o(t,a).map(function(t){return s(function(t){var e=i(t),n=t.getAttribute(\"href\"),o=t.getAttribute(\"data-size\"),s=u.exec(n)[1];return r.aug(e,{username:s,size:o})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(5).then(function(r){var o;try{o=n(91),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(5),i=n(0),o=n(65),s=n(13),a=n(14)(),u=n(66),c=n(3),d=n(12),f=\"a.twitter-timeline,div.twitter-timeline,a.twitter-grid\",l=\"Embedded Search timelines have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",h=\"You may have been affected by an update to settings in embedded timelines. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",p=\"Embedded grids have been deprecated and will now render as timelines. Please update your embed code to use the twitter-timeline class. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\";t.exports=function(t){return a(t,f).map(function(t){return u(function(t){var e=s(t),n=t.getAttribute(\"data-show-replies\"),a={isPreconfigured:!!t.getAttribute(\"data-widget-id\"),chrome:t.getAttribute(\"data-chrome\"),tweetLimit:t.getAttribute(\"data-tweet-limit\")||t.getAttribute(\"data-limit\"),ariaLive:t.getAttribute(\"data-aria-polite\"),theme:t.getAttribute(\"data-theme\"),borderColor:t.getAttribute(\"data-border-color\"),showReplies:n?r.asBoolean(n):null,profileScreenName:t.getAttribute(\"data-screen-name\"),profileUserId:t.getAttribute(\"data-user-id\"),favoritesScreenName:t.getAttribute(\"data-favorites-screen-name\"),favoritesUserId:t.getAttribute(\"data-favorites-user-id\"),likesScreenName:t.getAttribute(\"data-likes-screen-name\"),likesUserId:t.getAttribute(\"data-likes-user-id\"),listOwnerScreenName:t.getAttribute(\"data-list-owner-screen-name\"),listOwnerUserId:t.getAttribute(\"data-list-owner-id\"),listId:t.getAttribute(\"data-list-id\"),listSlug:t.getAttribute(\"data-list-slug\"),customTimelineId:t.getAttribute(\"data-custom-timeline-id\"),staticContent:t.getAttribute(\"data-static-content\"),url:t.href};return a.isPreconfigured&&(c.isSearchUrl(a.url)?d.publicError(l,t):d.publicLog(h,t)),\"twitter-grid\"===t.className&&d.publicLog(p,t),(a=i.aug(a,e)).dataSource=o(a),a.id=a.dataSource&&a.dataSource.id,a}(t),t.parentNode,t)})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(141)])},function(t,e,n){var r=n(0),i=n(140);t.exports=function(t){return\"en\"===t||r.contains(i,t)}},function(t,e){t.exports=[\"hi\",\"zh-cn\",\"fr\",\"zh-tw\",\"msa\",\"fil\",\"fi\",\"sv\",\"pl\",\"ja\",\"ko\",\"de\",\"it\",\"pt\",\"es\",\"ru\",\"id\",\"tr\",\"da\",\"no\",\"nl\",\"hu\",\"fa\",\"ar\",\"ur\",\"he\",\"th\",\"cs\",\"uk\",\"vi\",\"ro\",\"bn\",\"el\",\"en-gb\",\"gu\",\"kn\",\"mr\",\"ta\",\"bg\",\"ca\",\"hr\",\"sr\",\"sk\"]},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"collection:\";function a(t,e){return r.collectionId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"collection\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{collection_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(143)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"event:\";function a(t,e){return r.eventId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"event\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{event_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(145)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"likes:\";function a(t){return r.likesScreenName(t.url)||t.screenName}t.exports=function(t){t.params({screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params)||this.params.userId;return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"likes\"])}}),t.define(\"_getLikesQueryParam\",function(){var t=a(this.params);return t?{screen_name:t}:{user_id:this.params.userId}}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getLikesQueryParam())}),t.before(\"initialize\",function(){if(!a(this.params)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(147)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"list:\";function a(t){var e=r.listScreenNameAndSlug(t.url)||t;return i.compact({screen_name:e.ownerScreenName,user_id:e.ownerUserId,list_slug:e.slug})}t.exports=function(t){t.params({id:{},ownerScreenName:{},ownerUserId:{},slug:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t,e,n;return this.params.id?s+this.params.id:(e=(t=a(this.params))&&t.list_slug.replace(/-/g,\"_\"),n=t&&(t.screen_name||t.user_id),s+(n+\":\")+e)}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"list\"])}}),t.define(\"_getListQueryParam\",function(){return this.params.id?{list_id:this.params.id}:a(this.params)}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getListQueryParam())}),t.before(\"initialize\",function(){var t=a(this.params);if(i.isEmptyObject(t)&&!this.params.id)throw new Error(\"qualified slug or list id required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(149)])},function(t,e,n){var r=n(3),i=n(5),o=n(0),s=n(19),a=\"profile:\";function u(t,e){return r.screenName(t)||e}t.exports=function(t){t.params({showReplies:{fallback:!1,transform:i.asBoolean},screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=u(this.params.url,this.params.screenName);return a+(t||this.params.userId)}}),t.overrideProperty(\"endpoint\",{get:function(){return s.timeline([\"profile\"])}}),t.define(\"_getProfileQueryParam\",function(){var t=u(this.params.url,this.params.screenName),e=t?{screen_name:t}:{user_id:this.params.userId};return o.aug(e,{with_replies:this.params.showReplies?\"true\":\"false\"})}),t.around(\"queryParams\",function(t){return o.aug(t(),this._getProfileQueryParam())}),t.before(\"initialize\",function(){if(!u(this.params.url,this.params.screenName)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(6)]).then(function(r){var o;try{o=n(92),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(3),o=n(0),s=n(13),a=n(14)(),u=n(67),c=\"blockquote.twitter-tweet, blockquote.twitter-video\",d=/\\btw-align-(left|right|center)\\b/;t.exports=function(t,e){return a(t,c).map(function(t){return u(function(t){var e=s(t),n=t.getElementsByTagName(\"A\"),a=n&&n[n.length-1],u=a&&i.status(a.href),c=t.getAttribute(\"data-conversation\"),f=\"none\"==c||\"hidden\"==c||r.present(t,\"tw-hide-thread\"),l=t.getAttribute(\"data-cards\"),h=\"none\"==l||\"hidden\"==l||r.present(t,\"tw-hide-media\"),p=t.getAttribute(\"data-align\")||t.getAttribute(\"align\"),m=t.getAttribute(\"data-theme\");return!p&&d.test(t.className)&&(p=RegExp.$1),o.aug(e,{tweetId:u,hideThread:f,hideCard:h,align:p,theme:m,id:u})}(t),t.parentNode,t,e)})}},function(t,e,n){var r=n(86),i=n(21),o=\"tfw_horizon_tweet_embed_9555\";t.exports=function(t,e){var n;t&&(n=t[o])&&n.bucket&&r(o,n.bucket,n.version,i.formatHorizonTweetData(e))}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(7).then(function(r){var o;try{o=n(93),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(8)]).then(function(r){var o;try{o=n(94),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(0),o=n(13),s=n(14)(),a=n(69),u=n(5),c=\"a.twitter-share-button, a.twitter-mention-button, a.twitter-hashtag-button\",d=\"twitter-hashtag-button\",f=\"twitter-mention-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:t.getAttribute(\"data-button-screen-name\"),text:t.getAttribute(\"data-text\"),type:t.getAttribute(\"data-type\"),size:t.getAttribute(\"data-size\"),url:t.getAttribute(\"data-url\"),hashtags:t.getAttribute(\"data-hashtags\"),via:t.getAttribute(\"data-via\"),buttonHashtag:t.getAttribute(\"data-button-hashtag\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e.buttonHashtag=e.buttonHashtag||e.button_hashtag||e.hashtag,r.present(t,d)&&(e.type=\"hashtag\"),r.present(t,f)&&(e.type=\"mention\"),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(95),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0);t.exports=r.aug({},n(158),n(159),n(160),n(161),n(162),n(163),n(164))},function(t,e,n){var r=n(59),i=n(17)([\"userId\"],{},r);t.exports={createDMButton:i}},function(t,e,n){var r=n(62),i=n(17)([\"screenName\"],{},r);t.exports={createFollowButton:i}},function(t,e,n){var r=n(63),i=n(17)([\"momentId\"],{},r);t.exports={createMoment:i}},function(t,e,n){var r=n(64),i=n(17)([\"username\"],{},r);t.exports={createPeriscopeOnAirButton:i}},function(t,e,n){var r=n(8),i=n(12),o=n(3),s=n(0),a=n(5),u=n(65),c=n(66),d=n(17)([],{},c),f=n(6),l=\"Embedded grids have been deprecated. Please use twttr.widgets.createTimeline instead. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\",h={createTimeline:p,createGridFromCollection:function(t){var e=s.toRealArray(arguments).slice(1),n={sourceType:\"collection\",id:t};return e.unshift(n),i.publicLog(l),p.apply(this,e)}};function p(t){var e,n=s.toRealArray(arguments).slice(1);return a.isString(t)||a.isNumber(t)?f.reject(\"Embedded timelines with widget settings have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\"):s.isObject(t)?(t=t||{},n.forEach(function(t){s.isType(\"object\",t)&&function(t){t.ariaLive=t.ariaPolite}(e=t)}),e||(e={},n.push(e)),t.lang=e.lang,t.tweetLimit=e.tweetLimit,t.showReplies=e.showReplies,e.dataSource=u(t),d.apply(this,n)):f.reject(\"data source must be an object.\")}o.isTwitterURL(r.href)&&(h.createTimelinePreview=function(t,e,n){var r={previewParams:t,useLegacyDefaults:!0,isPreviewTimeline:!0};return r.dataSource=u(r),d(e,r,n)}),t.exports=h},function(t,e,n){var r,i=n(0),o=n(67),s=n(17),a=(r=s([\"tweetId\"],{},o),function(){return i.toRealArray(arguments).slice(1).forEach(function(t){i.isType(\"object\",t)&&(t.hideCard=\"none\"==t.cards||\"hidden\"==t.cards,t.hideThread=\"none\"==t.conversation||\"hidden\"==t.conversation)}),r.apply(this,arguments)});t.exports={createTweet:a,createTweetEmbed:a,createVideo:a}},function(t,e,n){var r=n(0),i=n(69),o=n(17),s=o([\"url\"],{type:\"share\"},i),a=o([\"buttonHashtag\"],{type:\"hashtag\"},i),u=o([\"screenName\"],{type:\"mention\"},i);function c(t){return function(){return r.toRealArray(arguments).slice(1).forEach(function(t){r.isType(\"object\",t)&&(t.screenName=t.screenName||t.screen_name,t.buttonHashtag=t.buttonHashtag||t.button_hashtag||t.hashtag)}),t.apply(this,arguments)}}t.exports={createShareButton:c(s),createHashtagButton:c(a),createMentionButton:c(u)}},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=0,c=[],d=s.createElement(\"a\");function f(){var t,e;for(u=1,t=0,e=c.length;t<e;t++)c[t]()}/^loade|c/.test(s.readyState)&&(u=1),s.addEventListener&&s.addEventListener(\"DOMContentLoaded\",i=function(){s.removeEventListener(\"DOMContentLoaded\",i,!1),f()},!1),d.doScroll&&s.attachEvent(\"onreadystatechange\",r=function(){/^c/.test(s.readyState)&&(s.detachEvent(\"onreadystatechange\",r),f())}),o=d.doScroll?function(t){a.self!=a.top?u?t():c.push(t):function(){try{d.doScroll(\"left\")}catch(e){return setTimeout(function(){o(t)},50)}t()}()}:function(t){u?t():c.push(t)},t.exports=o},function(t,e,n){var r=n(47),i=n(9);t.exports=function(){i.set(\"buildVersion\",r.version)}},function(t,e,n){n(168),n(87),n(171)},function(t,e,n){var r=n(169),i=n(30),o=n(70),s=new r,a=function(t){t.widgets&&1===t.widgets.length&&(s.start(),i.emitter.unbind(i.ALL_WIDGETS_RENDER_START,a))},u=function(t){var e;t.widgets&&1===t.widgets.length&&(e=t.widgets[0],s.end(),e.dataset&&e.dataset.tweetId&&o({duration:s.duration(),namespace:{element:\"tweet\",action:\"render\"},widgetIds:[e.dataset.tweetId]})),i.emitter.unbind(i.ALL_WIDGETS_RENDER_END,u)};i.emitter.bind(i.ALL_WIDGETS_RENDER_START,a),i.emitter.bind(i.ALL_WIDGETS_RENDER_END,u)},function(t,e,n){var r=n(170);function i(){}i.prototype.start=function(){this._startTime=r()},i.prototype.end=function(){this._duration=r()-this._startTime},i.prototype.duration=function(){return this._duration},t.exports=i},function(t,e,n){var r=n(1);t.exports=function(){return r.performance&&r.performance.now?r.performance.now():Date.now()}},function(t,e,n){var r=n(30),i=n(70),o=n(172),s=n(3),a=n(1),u=n(0),c=n(22),d=n(61);function f(t){return t.performance.getEntriesByType(\"resource\").filter(function(t){return s.isTwimgURL(t.name)||s.isTwitterURL(t.name)}).reduce(function(t,e){return t[e.name]=e.duration,t},{})}r.emitter.bind(r.ALL_WIDGETS_AND_IMAGES_LOADED,function(t){var e,n,r=[];c.hasPerformanceInformation()&&(e=f(a),d.isSupported()||(r=function(t){return t.reduce(function(t,e){return u.aug(t,f(e.contentDocument.defaultView))},{})}(t)),n=u.aug({},e,r),Object.keys(o).forEach(function(t){!function(t,e,n){var r=Object.keys(t).reduce(function(e,r){return n(r)?e+t[r]:e},0);i({duration:r,namespace:{element:e,action:\"resource\"}})}(n,t,o[t])}))})},function(t,e,n){var r=n(3),i={all:function(){return!0},image:function(t){return r.isTwimgURL(t)},settings:function(t){return r.isSettingsURL(t)},widget_iframe:function(t){return r.isWidgetIframeURL(t)}};t.exports=i}])));The Minister of Health announced the first positive case on Mar 11, and he is tweeting daily about the number of tests, positive cases, and number of deceased since Mar 16. Most people believe that Covid-19 was spreading much earlier and the government downplayed and delayed the announcement. Also, most people do not trust the numbers announced on a daily basis. I have seen on Twitter that a few people wondered whether or not it is possible to cross-check the numbers by using the official records of the number of deceased people. For instance, Dr. Abdullah Aydogan asked how we can find these statistics (in Turkish):\r\n\r\n\r\nSon bir kaç yılda Istanbul (veya Turkiye) geneli ay ay (mumkunse hafta hafta) kaç kişinin öldüğüne dair bir veriyi nereden bulabiliriz? Mümkünse yaş aralıklarına göre. Fikri olan var mı?@istatistikofisi mümkün mü?\r\n\r\n— Abdullah Aydogan (@abdaydgn) March 21, 2020\r\n\r\nFunction&&Function.prototype&&Function.prototype.bind&&(/(MSIE ([6789]|10|11))|Trident/.test(navigator.userAgent)||(window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.loaded&&window.twttr.widgets.load&&window.twttr.widgets.load(),window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.init||function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,c=[];a<o.length;a++)i=o[a],r[i]&&c.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=o);var s,a=document.getElementsByTagName(\"head\")[0],u=document.createElement(\"script\");u.charset=\"utf-8\",u.timeout=120,i.nc&&u.setAttribute(\"nonce\",i.nc),u.src=function(t){return i.p+\"js/\"+({0:\"moment~timeline~tweet\",2:\"dm_button\",3:\"button\",4:\"moment\",5:\"periscope_on_air\",6:\"timeline\",7:\"horizon_tweet\",8:\"tweet\"}[t]||t)+\".\"+{0:\"99ce5e0e4617985354c5c426d7e1b9f4\",2:\"aafdbac8c0ca30b0345ffadfb46abaae\",3:\"93a0c25c2d2f3081c705c98c2d9dec0e\",4:\"70d46e46bb6e5d32428d274e29d33a7a\",5:\"a924982376e532afeee4636c794ea5da\",6:\"d228dcf3573461f298b082c9a5c0a42c\",7:\"77381373f964eee9b43728b3d43d642f\",8:\"9aa9eda3c163ec539c16aef0d822d807\"}[t]+\".js\"}(t),s=function(e){u.onerror=u.onload=null,clearTimeout(c);var n=r[t];if(0!==n){if(n){var i=e&&(\"load\"===e.type?\"missing\":e.type),o=e&&e.target&&e.target.src,s=new Error(\"Loading chunk \"+t+\" failed.\\n(\"+i+\": \"+o+\")\");s.type=i,s.request=o,n[1](s)}r[t]=void 0}};var c=setTimeout(function(){s({type:\"timeout\",target:u})},12e4);u.onerror=u.onload=s,a.appendChild(u)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"https://platform.twitter.com/\",i.oe=function(t){throw console.error(t),t};var o=window.__twttrll=window.__twttrll||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var u=s;i(i.s=96)}([function(t,e,n){var r=n(1);function i(t,e){var n;for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||e(n,t[n]);return t}function o(t){return{}.toString.call(t).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()}function s(t){return t===Object(t)}function a(t){var e;if(!s(t))return!1;if(Object.keys)return!Object.keys(t).length;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t){return t?Array.prototype.slice.call(t):[]}t.exports={aug:function(t){return u(arguments).slice(1).forEach(function(e){i(e,function(e,n){t[e]=n})}),t},async:function(t,e){r.setTimeout(function(){t.call(e||null)},0)},compact:function t(e){return i(e,function(n,r){s(r)&&(t(r),a(r)&&delete e[n]),void 0!==r&&null!==r&&\"\"!==r||delete e[n]}),e},contains:function(t,e){return!(!t||!t.indexOf)&&t.indexOf(e)>-1},forIn:i,isObject:s,isEmptyObject:a,toType:o,isType:function(t,e){return t==o(e)},toRealArray:u}},function(t,e){t.exports=window},function(t,e,n){var r=n(6);t.exports=function(){var t=this;this.promise=new r(function(e,n){t.resolve=e,t.reject=n})}},function(t,e,n){var r=n(11),i=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?(?:\\/intent\\/(?:follow|user)\\/?\\?screen_name=|(?:\\/#!)?\\/))@?([\\w]+)(?:\\?|&|$)/i,o=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?\\/(?:#!\\/)?[\\w_]+\\/status(?:es)?\\/)(\\d+)/i,s=/^http(s?):\\/\\/(\\w+\\.)*twitter\\.com([:/]|$)/i,a=/^http(s?):\\/\\/(ton|pbs)\\.twimg\\.com/,u=/^#?([^.,<>!\\s/#\\-()'\"]+)$/,c=/twitter\\.com(?::\\d{2,4})?\\/intent\\/(\\w+)/,d=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/\\w+\\/timelines\\/(\\d+)/i,f=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/moments\\/(\\d+)/i,l=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/(?:likes|favorites)/i,h=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/lists\\/([\\w-%]+)/i,p=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/live\\/(\\d+)/i,m=/^https?:\\/\\/syndication\\.twitter\\.com\\/settings/i,v=/^https?:\\/\\/(localhost|platform)\\.twitter\\.com(?::\\d+)?\\/widgets\\/widget_iframe\\.(.+)/i,g=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/search\\?q=(\\w+)/i;function w(t){return\"string\"==typeof t&&i.test(t)&&RegExp.$1.length<=20}function y(t){if(w(t))return RegExp.$1}function b(t,e){var n=r.decodeURL(t);if(e=e||!1,n.screen_name=y(t),n.screen_name)return r.url(\"https://twitter.com/intent/\"+(e?\"follow\":\"user\"),n)}function _(t){return\"string\"==typeof t&&u.test(t)}function E(t){return\"string\"==typeof t&&o.test(t)}t.exports={isHashTag:_,hashTag:function(t,e){if(e=void 0===e||e,_(t))return(e?\"#\":\"\")+RegExp.$1},isScreenName:w,screenName:y,isStatus:E,status:function(t){return E(t)&&RegExp.$1},intentForProfileURL:b,intentForFollowURL:function(t){return b(t,!0)},isTwitterURL:function(t){return s.test(t)},isTwimgURL:function(t){return a.test(t)},isIntentURL:function(t){return c.test(t)},isSettingsURL:function(t){return m.test(t)},isWidgetIframeURL:function(t){return v.test(t)},isSearchUrl:function(t){return g.test(t)},regexen:{profile:i},momentId:function(t){return f.test(t)&&RegExp.$1},collectionId:function(t){return d.test(t)&&RegExp.$1},intentType:function(t){return c.test(t)&&RegExp.$1},likesScreenName:function(t){return l.test(t)&&RegExp.$1},listScreenNameAndSlug:function(t){var e,n,r;if(h.test(t)){e=RegExp.$1,n=RegExp.$2;try{r=decodeURIComponent(n)}catch(t){}return{ownerScreenName:e,slug:r||n}}return!1},eventId:function(t){return p.test(t)&&RegExp.$1}}},function(t,e){t.exports=document},function(t,e,n){var r=n(0),i=[!0,1,\"1\",\"on\",\"ON\",\"true\",\"TRUE\",\"yes\",\"YES\"],o=[!1,0,\"0\",\"off\",\"OFF\",\"false\",\"FALSE\",\"no\",\"NO\"];function s(t){return void 0!==t&&null!==t&&\"\"!==t}function a(t){return c(t)&&t%1==0}function u(t){return c(t)&&!a(t)}function c(t){return s(t)&&!isNaN(t)}function d(t){return r.contains(o,t)}function f(t){return r.contains(i,t)}t.exports={hasValue:s,isInt:a,isFloat:u,isNumber:c,isString:function(t){return\"string\"===r.toType(t)},isArray:function(t){return s(t)&&\"array\"==r.toType(t)},isTruthValue:f,isFalseValue:d,asInt:function(t){if(a(t))return parseInt(t,10)},asFloat:function(t){if(u(t))return t},asNumber:function(t){if(c(t))return t},asBoolean:function(t){return!(!s(t)||!f(t)&&(d(t)||!t))}}},function(t,e,n){var r=n(1),i=n(22),o=n(48);i.hasPromiseSupport()||(r.Promise=o),t.exports=r.Promise},function(t,e,n){var r=n(0);t.exports=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){var i=r.toRealArray(arguments);return t.apply(e,n.concat(i))}}},function(t,e){t.exports=location},function(t,e,n){var r=n(50);t.exports=new r(\"__twttr\")},function(t,e,n){var r=n(0),i=/\\b([\\w-_]+)\\b/g;function o(t){return new RegExp(\"\\\\b\"+t+\"\\\\b\",\"g\")}function s(t,e){t.classList?t.classList.add(e):o(e).test(t.className)||(t.className+=\" \"+e)}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(o(e),\" \")}function u(t,e){return t.classList?t.classList.contains(e):r.contains(c(t),e)}function c(t){return r.toRealArray(t.classList?t.classList:t.className.match(i))}t.exports={add:s,remove:a,replace:function(t,e,n){if(t.classList&&u(t,e))return a(t,e),void s(t,n);t.className=t.className.replace(o(e),n)},toggle:function(t,e,n){return void 0===n&&t.classList&&t.classList.toggle?t.classList.toggle(e,n):(n?s(t,e):a(t,e),n)},present:u,list:c}},function(t,e,n){var r=n(5),i=n(0);function o(t){return encodeURIComponent(t).replace(/\\+/g,\"%2B\").replace(/'/g,\"%27\")}function s(t){return decodeURIComponent(t)}function a(t){var e=[];return i.forIn(t,function(t,n){var s=o(t);i.isType(\"array\",n)||(n=[n]),n.forEach(function(t){r.hasValue(t)&&e.push(s+\"=\"+o(t))})}),e.sort().join(\"&\")}function u(t){var e={};return t?(t.split(\"&\").forEach(function(t){var n=t.split(\"=\"),r=s(n[0]),o=s(n[1]);if(2==n.length){if(!i.isType(\"array\",e[r]))return r in e?(e[r]=[e[r]],void e[r].push(o)):void(e[r]=o);e[r].push(o)}}),e):{}}t.exports={url:function(t,e){return a(e).length>0?i.contains(t,\"?\")?t+\"&\"+a(e):t+\"?\"+a(e):t},decodeURL:function(t){var e=t&&t.split(\"?\");return 2==e.length?u(e[1]):{}},decode:u,encode:a,encodePart:o,decodePart:s}},function(t,e,n){var r=n(8),i=n(1),o=n(0),s={},a=o.contains(r.href,\"tw_debug=true\");function u(){}function c(){}function d(){return i.performance&&+i.performance.now()||+new Date}function f(t,e){if(i.console&&i.console[t])switch(e.length){case 1:i.console[t](e[0]);break;case 2:i.console[t](e[0],e[1]);break;case 3:i.console[t](e[0],e[1],e[2]);break;case 4:i.console[t](e[0],e[1],e[2],e[3]);break;case 5:i.console[t](e[0],e[1],e[2],e[3],e[4]);break;default:0!==e.length&&i.console.warn&&i.console.warn(\"too many params passed to logger.\"+t)}}t.exports={devError:u,devInfo:c,devObject:function(t,e){},publicError:function(){f(\"error\",o.toRealArray(arguments))},publicLog:function(){f(\"info\",o.toRealArray(arguments))},time:function(t){a&&(s[t]=d())},timeEnd:function(t){a&&s[t]&&(d(),s[t])}}},function(t,e,n){var r=n(20),i=n(5),o=n(11),s=n(0),a=n(121);t.exports=function(t){var e=t.href&&t.href.split(\"?\")[1],n=e?o.decode(e):{},u={lang:a(t),width:t.getAttribute(\"data-width\")||t.getAttribute(\"width\"),height:t.getAttribute(\"data-height\")||t.getAttribute(\"height\"),related:t.getAttribute(\"data-related\"),partner:t.getAttribute(\"data-partner\")};return i.asBoolean(t.getAttribute(\"data-dnt\"))&&r.setOn(),s.forIn(u,function(t,e){var r=n[t];n[t]=i.hasValue(r)?r:e}),s.compact(n)}},function(t,e,n){var r=n(82),i=n(24);t.exports=function(){var t=\"data-twitter-extracted-\"+i.generate();return function(e,n){return r(e,n).filter(function(e){return!e.hasAttribute(t)}).map(function(e){return e.setAttribute(t,\"true\"),e})}}},function(t,e){function n(t,e,n,r,i,o,s){this.factory=t,this.Sandbox=e,this.srcEl=o,this.targetEl=i,this.parameters=r,this.className=n,this.options=s}n.prototype.destroy=function(){this.srcEl=this.targetEl=null},t.exports=n},function(t,e){t.exports={DM_BUTTON:\"twitter-dm-button\",FOLLOW_BUTTON:\"twitter-follow-button\",HASHTAG_BUTTON:\"twitter-hashtag-button\",MENTION_BUTTON:\"twitter-mention-button\",MOMENT:\"twitter-moment\",PERISCOPE:\"periscope-on-air\",SHARE_BUTTON:\"twitter-share-button\",TIMELINE:\"twitter-timeline\",TWEET:\"twitter-tweet\"}},function(t,e,n){var r=n(6),i=n(20),o=n(52),s=n(31),a=n(5),u=n(0);t.exports=function(t,e,n){var c;return t=t||[],e=e||{},c=\"ƒ(\"+t.join(\", \")+\", target, [options]);\",function(){var d,f,l,h,p=Array.prototype.slice.apply(arguments,[0,t.length]),m=Array.prototype.slice.apply(arguments,[t.length]);return m.forEach(function(t){t&&(t.nodeType!==Node.ELEMENT_NODE?u.isType(\"function\",t)?d=t:u.isType(\"object\",t)&&(f=t):l=t)}),p.length!==t.length||0===m.length?(d&&u.async(function(){d(!1)}),r.reject(new Error(\"Not enough parameters. Expected: \"+c))):l?(f=u.aug({},f||{},e),t.forEach(function(t){f[t]=p.shift()}),a.asBoolean(f.dnt)&&i.setOn(),h=s.getExperiments().then(function(t){return o.addWidget(n(f,l,void 0,t))}),d&&h.then(d,function(){d(!1)}),h):(d&&u.async(function(){d(!1)}),r.reject(new Error(\"No target element specified. Expected: \"+c)))}}},function(t,e,n){var r=n(104),i=n(2),o=n(0);function s(t,e){return function(){try{e.resolve(t.call(this))}catch(t){e.reject(t)}}}t.exports={sync:function(t,e){t.call(e)},read:function(t,e){var n=new i;return r.read(s(t,n),e),n.promise},write:function(t,e){var n=new i;return r.write(s(t,n),e),n.promise},defer:function(t,e,n){var a=new i;return o.isType(\"function\",t)&&(n=e,e=t,t=1),r.defer(t,s(e,a),n),a.promise}}},function(t,e,n){var r=n(9),i=[\"https://syndication.twitter.com\",\"https://cdn.syndication.twimg.com\",\"https://localhost.twitter.com:8444\"],o=[\"https://syndication.twitter.com\",\"https://localhost.twitter.com:8445\"],s=[\"https://platform.twitter.com/embed/index.html\",\"https://localhost.twitter.com\",/https:\\/\\/ton\\.smf1\\.twitter\\.com\\/syndication-internal\\/embed-iframe\\/[0-9A-Za-z_-]+\\/app\\/index\\.html/],a=function(t,e){return t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},u=function(){var t=r.get(\"backendHost\");return t&&a(i,t)?t:\"https://cdn.syndication.twimg.com\"},c=function(){var t=r.get(\"settingsSvcHost\");return t&&a(o,t)?t:\"https://syndication.twitter.com\"},d=function(){var t=r.get(\"embedIframeURL\");return t&&a(s,t)?t:\"https://platform.twitter.com/embed/index.html\"};function f(t,e){var n=[t];return e.forEach(function(t){n.push(function(t){var e=(t||\"\").toString(),n=\"/\"===e.slice(0,1)?1:0,r=function(t){return\"/\"===t.slice(-1)}(e)?-1:void 0;return e.slice(n,r)}(t))}),n.join(\"/\")}t.exports={cookieConsent:function(t){var e=t||[];return e.unshift(\"cookie/consent\"),f(c(),e)},embedIframe:function(){return d()},eventVideo:function(t){var e=t||[];return e.unshift(\"video/event\"),f(u(),e)},grid:function(t){var e=t||[];return e.unshift(\"grid/collection\"),f(u(),e)},moment:function(t){var e=t||[];return e.unshift(\"moments\"),f(u(),e)},settings:function(t){var e=t||[];return e.unshift(\"settings\"),f(c(),e)},timeline:function(t){var e=t||[];return e.unshift(\"timeline\"),f(u(),e)},tweetBatch:function(t){var e=t||[];return e.unshift(\"tweets.json\"),f(u(),e)},video:function(t){var e=t||[];return e.unshift(\"widgets/video\"),f(u(),e)}}},function(t,e,n){var r=n(4),i=n(8),o=n(39),s=n(80),a=n(5),u=n(35),c=!1,d=/https?:\\/\\/([^/]+).*/i;t.exports={setOn:function(){c=!0},enabled:function(t,e){return!!(c||a.asBoolean(u.val(\"dnt\"))||s.isUrlSensitive(e||i.host)||o.isFramed()&&s.isUrlSensitive(o.rootDocumentLocation())||(t=d.test(t||r.referrer)&&RegExp.$1)&&s.isUrlSensitive(t))}}},function(t,e,n){var r=n(47),i=n(4),o=n(20),s=n(34),a=n(72),u=n(33),c=n(9),d=n(3),f=n(0),l=1,h=r.version,p=c.get(\"clientEventEndpoint\")||\"https://syndication.twitter.com/i/jot\";function m(t){return f.aug({client:\"tfw\"},t||{})}function v(t,e,n){return e=e||{},f.aug({},e,{_category_:t,triggered_on:e.triggered_on||+new Date,dnt:o.enabled(n)})}t.exports={extractTermsFromDOM:function t(e,n){var r;return n=n||{},e&&e.nodeType===Node.ELEMENT_NODE?((r=e.getAttribute(\"data-scribe\"))&&r.split(\" \").forEach(function(t){var e=t.trim().split(\":\"),r=e[0],i=e[1];r&&i&&!n[r]&&(n[r]=i)}),t(e.parentNode,n)):n},clickEventElement:function(t){var e=s.closest(\"[data-expanded-url]\",t),n=e&&e.getAttribute(\"data-expanded-url\");return n&&d.isTwitterURL(n)?\"twitter_url\":\"url\"},flattenClientEventPayload:function(t,e){return f.aug({},e,{event_namespace:t})},formatGenericEventData:v,formatClientEventData:function(t,e,n){var r=t&&t.widget_origin||i.referrer;return(t=v(\"tfw_client_event\",t,r)).client_version=h,t.format_version=void 0!==n?n:1,e||(t.widget_origin=r),t},formatClientEventNamespace:m,formatHorizonTweetData:function(t){var e={item_ids:[],item_details:{}};return e.item_ids.push(t),e.item_details[t]={item_type:a.TWEET},e},formatTweetAssociation:function(t,e){var n={};return(e=e||{}).association_namespace=m(t),n[l]=e,n},noticeSeen:function(t){return\"notice\"===t.element&&\"seen\"===t.action},splitLogEntry:function(t){var e,n,r,i,o;return t.item_ids&&t.item_ids.length>1?(e=Math.floor(t.item_ids.length/2),n=t.item_ids.slice(0,e),r={},i=t.item_ids.slice(e),o={},n.forEach(function(e){r[e]=t.item_details[e]}),i.forEach(function(e){o[e]=t.item_details[e]}),[f.aug({},t,{item_ids:n,item_details:r}),f.aug({},t,{item_ids:i,item_details:o})]):[t]},stringify:function(t){var e,n=Array.prototype.toJSON;return delete Array.prototype.toJSON,e=u.stringify(t),n&&(Array.prototype.toJSON=n),e},AUDIENCE_ENDPOINT:\"https://syndication.twitter.com/i/jot/syndication\",CLIENT_EVENT_ENDPOINT:p,RUFOUS_REDIRECT:\"https://platform.twitter.com/jot.html\"}},function(t,e,n){var r=n(4),i=n(12),o=n(97),s=n(1),a=n(0),u=o.userAgent;function c(t){return/(Trident|MSIE|Edge[/ ]?\\d)/.test(t=t||u)}t.exports={retina:function(t){return(t=t||s).devicePixelRatio?t.devicePixelRatio>=1.5:!!t.matchMedia&&t.matchMedia(\"only screen and (min-resolution: 144dpi)\").matches},anyIE:c,ie9:function(t){return/MSIE 9/.test(t=t||u)},ie10:function(t){return/MSIE 10/.test(t=t||u)},ios:function(t){return/(iPad|iPhone|iPod)/.test(t=t||u)},android:function(t){return/^Mozilla\\/5\\.0 \\(Linux; (U; )?Android/.test(t=t||u)},canPostMessage:function(t,e){return t=t||s,e=e||u,t.postMessage&&!(c(e)&&t.opener)},touch:function(t,e,n){return t=t||s,e=e||o,n=n||u,\"ontouchstart\"in t||/Opera Mini/.test(n)||e.msMaxTouchPoints>0},cssTransitions:function(){var t=r.body.style;return void 0!==t.transition||void 0!==t.webkitTransition||void 0!==t.mozTransition||void 0!==t.oTransition||void 0!==t.msTransition},hasPromiseSupport:function(){return!!(s.Promise&&s.Promise.resolve&&s.Promise.reject&&s.Promise.all&&s.Promise.race&&(new s.Promise(function(e){t=e}),a.isType(\"function\",t)));var t},hasIntersectionObserverSupport:function(){return!!s.IntersectionObserver},hasPerformanceInformation:function(){return s.performance&&s.performance.getEntriesByType},hasLocalStorageSupport:function(){try{return s.localStorage.setItem(\"local_storage_support_test\",\"true\"),void 0!==s.localStorage}catch(t){return i.devError(\"window.localStorage is not supported:\",t),!1}}}},function(t,e,n){var r=n(6),i=n(2);function o(t,e){return t.then(e,e)}function s(t){return t instanceof r}t.exports={always:o,allResolved:function(t){var e;return void 0===t?r.reject(new Error(\"undefined is not an object\")):Array.isArray(t)?(e=t.length)?new r(function(n,r){var i=0,o=[];function a(){(i+=1)===e&&(0===o.length?r():n(o))}function u(t){o.push(t),a()}t.forEach(function(t){s(t)?t.then(u,a):u(t)})}):r.resolve([]):r.reject(new Error(\"Type error\"))},some:function(t){var e;return e=(t=t||[]).length,t=t.filter(s),e?e!==t.length?r.reject(\"non-Promise passed to .some\"):new r(function(e,n){var r=0;function i(){(r+=1)===t.length&&n()}t.forEach(function(t){t.then(e,i)})}):r.reject(\"no promises passed to .some\")},isPromise:s,allSettled:function(t){function e(){}return r.all((t||[]).map(function(t){return o(t,e)}))},timeout:function(t,e){var n=new i;return setTimeout(function(){n.reject(new Error(\"Promise timed out\"))},e),t.then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}},function(t,e){var n=\"i\",r=0,i=0;t.exports={generate:function(){return n+String(+new Date)+Math.floor(1e5*Math.random())+r++},deterministic:function(){return n+String(i++)}}},function(t,e,n){var r=n(49),i=n(51),o=n(0);t.exports=o.aug(r.get(\"events\")||{},i.Emitter)},function(t,e,n){var r=n(27),i=n(112);t.exports=r.build([i])},function(t,e,n){var r=n(40),i=n(109),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(40),i=n(41),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(84),i=n(76),o=n(85),s=n(8),a=n(71),u=n(75),c=n(20),d=n(5),f=n(24),l=n(0);function h(t){if(!t||!t.headers)throw new Error(\"unexpected response schema\");return{html:t.body,config:t.config,pollInterval:1e3*parseInt(t.headers.xPolling,10)||null,maxCursorPosition:t.headers.maxPosition,minCursorPosition:t.headers.minPosition}}function p(t){if(t&&t.headers)throw new Error(t.headers.status);throw t instanceof Error?t:new Error(t)}t.exports=function(t){t.params({instanceId:{required:!0,fallback:f.deterministic},lang:{required:!0,transform:a.matchLanguage,fallback:\"en\"},tweetLimit:{transform:d.asInt}}),t.defineProperty(\"endpoint\",{get:function(){throw new Error(\"endpoint not specified\")}}),t.defineProperty(\"pollEndpoint\",{get:function(){return this.endpoint}}),t.define(\"cbId\",function(t){var e=t?\"_new\":\"_old\";return\"tl_\"+this.params.instanceId+\"_\"+this.id+e}),t.define(\"queryParams\",function(){return{lang:this.params.lang,tz:u.getTimezoneOffset(),t:r(),domain:s.host,tweet_limit:this.params.tweetLimit,dnt:c.enabled()}}),t.define(\"fetch\",function(){return i.fetch(this.endpoint,this.queryParams(),o,this.cbId()).then(h,p)}),t.define(\"poll\",function(t,e){var n,r;return n={since_id:(t=t||{}).sinceId,max_id:t.maxId,min_position:t.minPosition,max_position:t.maxPosition},r=l.aug(this.queryParams(),n),i.fetch(this.pollEndpoint,r,o,this.cbId(e)).then(h,p)})}},function(t,e,n){var r=n(51).makeEmitter();t.exports={emitter:r,START:\"start\",ALL_WIDGETS_RENDER_START:\"all_widgets_render_start\",ALL_WIDGETS_RENDER_END:\"all_widgets_render_end\",ALL_WIDGETS_AND_IMAGES_LOADED:\"all_widgets_and_images_loaded\"}},function(t,e,n){var r=n(115),i=n(118);function o(t){return r.settingsLoaded().then(function(e){return e[t]})}function s(){return o(\"experiments\")}t.exports={shouldObtainCookieConsent:function(){return o(\"shouldObtainCookieConsent\")},getExperiments:s,getExperiment:function(t){return s().then(function(e){if(!e[t])throw new Error(\"Experiment not found\");return e[t]})},getActiveExperimentDataString:function(){return s().then(function(t){var e=Object.keys(t).reduce(function(e,n){var r;return t[n].version&&(r=n.split(\"_\").slice(-1)[0],e.push(r+\";\"+t[n].bucket)),e},[]);return i(e.join(\",\"))})},getExperimentKeys:function(){return s().then(function(t){return Object.keys(t)})},load:function(){r.load()}}},function(t,e,n){var r=n(4),i=n(0);t.exports=function(t,e,n){var o;if(n=n||r,t=t||{},e=e||{},t.name){try{o=n.createElement('<iframe name=\"'+t.name+'\"><\/iframe>')}catch(e){(o=n.createElement(\"iframe\")).name=t.name}delete t.name}else o=n.createElement(\"iframe\");return t.id&&(o.id=t.id,delete t.id),o.allowtransparency=\"true\",o.scrolling=\"no\",o.setAttribute(\"frameBorder\",0),o.setAttribute(\"allowTransparency\",!0),i.forIn(t,function(t,e){o.setAttribute(t,e)}),i.forIn(e,function(t,e){o.style[t]=e}),o}},function(t,e,n){var r=n(1).JSON;t.exports={stringify:r.stringify||r.encode,parse:r.parse||r.decode}},function(t,e,n){var r=n(0),i=n(43);t.exports={closest:function t(e,n,o){var s;if(n)return o=o||n&&n.ownerDocument,s=r.isType(\"function\",e)?e:function(t){return function(e){return!!e.tagName&&i(e,t)}}(e),n===o?s(n)?n:void 0:s(n)?n:t(s,n.parentNode,o)}}},function(t,e,n){var r,i=n(4);function o(t){var e,n,o,s=0;for(r={},e=(t=t||i).getElementsByTagName(\"meta\");e[s];s++){if(n=e[s],/^twitter:/.test(n.getAttribute(\"name\")))o=n.getAttribute(\"name\").replace(/^twitter:/,\"\");else{if(!/^twitter:/.test(n.getAttribute(\"property\")))continue;o=n.getAttribute(\"property\").replace(/^twitter:/,\"\")}r[o]=n.getAttribute(\"content\")||n.getAttribute(\"value\")}}o(),t.exports={init:o,val:function(t){return r[t]}}},function(t,e,n){var r=n(10),i={},o=-1,s={};function a(t){var e=t.getAttribute(\"data-twitter-event-id\");return e||(t.setAttribute(\"data-twitter-event-id\",++o),o)}function u(t,e,n){var r=0,i=t&&t.length||0;for(r=0;r<i;r++)if(t[r].call(e,n,e),n.ceaseImmediately)return!1}function c(t,e,n){for(var i=n||t.target||t.srcElement,o=r.list(i).map(function(t){return\".\"+t}).concat(i.tagName),s=0,a=o.length;s<a;s++)if(!1===u(e[o[s]],i,t))return;t.cease||i!==this&&c.call(this,t,e,i.parentElement||i.parentNode)}function d(t,e,n,r){function i(r){c.call(t,r,n[e])}!function(t,e,n,r){t.id&&(s[t.id]=s[t.id]||[],s[t.id].push({el:t,listener:e,type:n,rootId:r}))}(t,i,e,r),t.addEventListener(e,i,!1)}function f(t){t&&t.preventDefault?t.preventDefault():t.returnValue=!1}function l(t){t&&(t.cease=!0)&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}t.exports={stop:function(t){return l(t),f(t),!1},stopPropagation:l,stopImmediatePropagation:function(t){t&&(t.ceaseImmediately=!0,l(t),t.stopImmediatePropagation())},preventDefault:f,delegate:function(t,e,n,r){var o=a(t);i[o]=i[o]||{},i[o][e]||(i[o][e]={},d(t,e,i[o],o)),i[o][e][n]=i[o][e][n]||[],i[o][e][n].push(r)},simulate:function(t,e,n){var r=a(e),o=i[r]&&i[r];c.call(e,{target:n},o[t])},removeDelegatesForWidget:function(t){var e=s[t];e&&(e.forEach(function(t){t.el.removeEventListener(t.type,t.listener,!1),delete i[t.rootId]}),delete s[t])}}},function(t,e,n){var r=n(78),i=n(106),o=n(81),s=n(21),a=new(n(114))(function(t){var e,n,a;if(0!==t.length){if(u(t))return c(t);e=r(t,function(t){return s.noticeSeen(t.input.namespace)}),n=e.true,a=e.false,n&&n.length>0&&(n=n.slice(0,1),o.canFlushOneItem(n[0])||(n[0].input.data.message=\"\"),c(n)),a&&(u(a)?c:function(t){i.init(),t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,o=t.input.version;i.clientEvent(e,n,r,o)}),i.flush().then(function(){t.forEach(function(t){t.taskDoneDeferred.resolve()})},function(){t.forEach(function(t){t.taskDoneDeferred.reject()})})})(a)}});function u(t){return 1===t.length&&o.canFlushOneItem(t[0])}function c(t){t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,i=t.input.version;o.clientEvent(e,n,r,i),t.taskDoneDeferred.resolve()})}t.exports={scribe:function(t,e,n,r){return a.add({namespace:t,data:e,offsite:n,version:r})},pause:function(){a.pause()},resume:function(){a.resume()}}},function(t,e,n){var r=n(27),i=n(127);t.exports=r.build([i])},function(t,e,n){var r=n(8),i=n(79),o=n(0),s=i.getCanonicalURL()||r.href,a=s;t.exports={isFramed:function(){return s!==a},rootDocumentLocation:function(t){return t&&o.isType(\"string\",t)&&(s=t),s},currentDocumentLocation:function(){return a}}},function(t,e,n){var r=n(107),i=n(108),o=n(0);t.exports={couple:function(){return o.toRealArray(arguments)},build:function(t,e,n){var o=new t;return(e=i(r(e||[]))).forEach(function(t){t.call(null,o)}),o.build(n)}}},function(t,e,n){var r=n(110),i=n(0),o=n(42);function s(){this.Component=this.factory(),this._adviceArgs=[],this._lastArgs=[]}i.aug(s.prototype,{factory:o,build:function(t){var e=this;return this.Component,i.aug(this.Component.prototype.boundParams,t),this._adviceArgs.concat(this._lastArgs).forEach(function(t){(function(t,e,n){var r=this[e];if(!r)throw new Error(e+\" does not exist\");this[e]=t(r,n)}).apply(e.Component.prototype,t)}),delete this._lastArgs,delete this._adviceArgs,this.Component},params:function(t){var e=this.Component.prototype.paramConfigs;t=t||{},this.Component.prototype.paramConfigs=i.aug({},t,e)},define:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.override(t,e)},defineStatic:function(t,e){this.Component[t]=e},override:function(t,e){this.Component.prototype[t]=e},defineProperty:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.overrideProperty(t,e)},overrideProperty:function(t,e){var n=i.aug({configurable:!0},e);Object.defineProperty(this.Component.prototype,t,n)},before:function(t,e){this._adviceArgs.push([r.before,t,e])},after:function(t,e){this._adviceArgs.push([r.after,t,e])},around:function(t,e){this._adviceArgs.push([r.around,t,e])},last:function(t,e){this._lastArgs.push([r.after,t,e])}}),t.exports=s},function(t,e,n){var r=n(0);function i(){return!0}function o(t){return t}t.exports=function(){function t(t){var e=this;t=t||{},this.params=Object.keys(this.paramConfigs).reduce(function(n,s){var a=[],u=e.boundParams,c=e.paramConfigs[s],d=c.validate||i,f=c.transform||o;if(s in u&&a.push(u[s]),s in t&&a.push(t[s]),a=\"fallback\"in c?a.concat(c.fallback):a,n[s]=function(t,e,n){var i=null;return t.some(function(t){if(t=r.isType(\"function\",t)?t():t,e(t))return i=n(t),!0}),i}(a,d,f),c.required&&null==n[s])throw new Error(s+\" is a required parameter\");return n},{}),this.initialize()}return r.aug(t.prototype,{paramConfigs:{},boundParams:{},initialize:function(){}}),t}},function(t,e,n){var r=n(1).HTMLElement,i=r.prototype.matches||r.prototype.matchesSelector||r.prototype.webkitMatchesSelector||r.prototype.mozMatchesSelector||r.prototype.msMatchesSelector||r.prototype.oMatchesSelector;t.exports=function(t,e){if(i)return i.call(t,e)}},function(t,e,n){var r,i=n(10),o=n(4),s=n(1),a=n(35),u=n(53),c=n(5),d=n(24),f=\"csptest\";t.exports={inlineStyle:function(){var t=f+d.generate(),e=o.createElement(\"div\"),n=o.createElement(\"style\"),l=\".\"+t+\" { visibility: hidden; }\";return!!o.body&&(c.asBoolean(a.val(\"widgets:csp\"))&&(r=!1),void 0!==r?r:(e.style.display=\"none\",i.add(e,t),n.type=\"text/css\",n.appendChild(o.createTextNode(l)),o.body.appendChild(n),o.body.appendChild(e),r=\"hidden\"===s.getComputedStyle(e).visibility,u(e),u(n),r))}}},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var i,o=0;return n=n||null,function s(){var a=n||this,u=arguments,c=+new Date;if(r.clearTimeout(i),c-o>e)return o=c,void t.apply(a,u);i=r.setTimeout(function(){s.apply(a,u)},e)}}},function(t,e){t.exports=function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}},function(t){t.exports={version:\"5c0e8d3:1584649541982\"}},function(t,e,n){\r\n/*!\r\n * @overview es6-promise - a tiny implementation of Promises/A+.\r\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\r\n * @license   Licensed under MIT license\r\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\r\n * @version   v4.2.5+7f2b526d\r\n */var r;r=function(){\"use strict\";function t(t){return\"function\"==typeof t}var e=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(h):w())},s=\"undefined\"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c=\"undefined\"==typeof self&&\"undefined\"!=typeof process&&\"[object process]\"==={}.toString.call(process),d=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(h,1)}}var l=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var p,m,v,g,w=void 0;function y(t,e){var n=this,r=new this.constructor(E);void 0===r[_]&&k(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,n._result)})}else j(n,r,t,e);return r}function b(t){if(t&&\"object\"==typeof t&&t.constructor===this)return t;var e=new this(E);return C(e,t),e}c?w=function(){return process.nextTick(h)}:u?(m=0,v=new u(h),g=document.createTextNode(\"\"),v.observe(g,{characterData:!0}),w=function(){g.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=h,w=function(){return p.port2.postMessage(0)}):w=void 0===s?function(){try{var t=Function(\"return this\")().require(\"vertx\");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(h)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function E(){}var x=void 0,T=1,A=2,S={error:null};function R(t){try{return t.then}catch(t){return S.error=t,S}}function N(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===b?function(t,e){e._state===T?L(t,e._result):e._state===A?I(t,e._result):j(e,void 0,function(e){return C(t,e)},function(e){return I(t,e)})}(e,n):r===S?(I(e,S.error),S.error=null):void 0===r?L(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):L(t,n))},function(e){r||(r=!0,I(t,e))},t._label);!r&&i&&(r=!0,I(t,i))},t)}(e,n,r):L(e,n)}function C(t,e){var n,r;t===e?I(t,new TypeError(\"You cannot resolve a promise with itself\")):(r=typeof(n=e),null===n||\"object\"!==r&&\"function\"!==r?L(t,e):N(t,e,R(e)))}function P(t){t._onerror&&t._onerror(t._result),O(t)}function L(t,e){t._state===x&&(t._result=e,t._state=T,0!==t._subscribers.length&&o(O,t))}function I(t,e){t._state===x&&(t._state=A,t._result=e,o(P,t))}function j(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+T]=n,i[s+A]=r,0===s&&t._state&&o(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return S.error=t,S}}(r,i))===S?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void I(n,new TypeError(\"A promises callback cannot return that same promise.\"))}else s=i,u=!0;n._state!==x||(o&&u?C(n,s):c?I(n,a):e===T?L(n,s):e===A&&I(n,s))}var z=0;function k(t){t[_]=z++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[_]||k(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&L(this.promise,this._result))):I(this.promise,new Error(\"Array Methods must be provided an Array\"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=R(t);if(i===y&&t._state!==x)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var o=new n(E);N(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===A?I(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){return n._settledAt(T,e,t)},function(t){return n._settledAt(A,e,t)})},t}(),U=function(){function e(t){this[_]=z++,this._result=this._state=void 0,this._subscribers=[],E!==t&&(\"function\"!=typeof t&&function(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}(),this instanceof e?function(t,e){try{e(function(e){C(t,e)},function(e){I(t,e)})}catch(e){I(t,e)}}(this,t):function(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new M(this,t).promise},U.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})},U.resolve=b,U.reject=function(t){var e=new this(E);return I(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(\"undefined\"!=typeof global)t=global;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U},t.exports=r()},function(t,e,n){var r=n(50);t.exports=new r(\"twttr\")},function(t,e,n){var r=n(1),i=n(0);function o(t){return i.isType(\"string\",t)?t.split(\".\"):i.isType(\"array\",t)?t:[]}function s(t,e){(e=e||r)[t]=e[t]||{},Object.defineProperty(this,\"base\",{value:e[t]}),Object.defineProperty(this,\"name\",{value:t})}i.aug(s.prototype,{get:function(t){return o(t).reduce(function(t,e){if(i.isObject(t))return t[e]},this.base)},set:function(t,e,n){var r=o(t),s=function(t,e){var n=o(e).slice(0,-1);return n.reduce(function(t,e,r){if(t[e]=t[e]||{},!i.isObject(t[e]))throw new Error(n.slice(0,r+1).join(\".\")+\" is already defined with a value.\");return t[e]},t)}(this.base,t),a=r.slice(-1);return n&&a in s?s[a]:s[a]=e},init:function(t,e){return this.set(t,e,!0)},unset:function(t){var e=o(t),n=this.get(e.slice(0,-1));n&&delete n[e.slice(-1)]},aug:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(e=void 0!==e?e:{},n.unshift(e),!n.every(i.isObject))throw new Error(\"Cannot augment non-object.\");return this.set(t,i.aug.apply(null,n))},call:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(!i.isType(\"function\",e))throw new Error(\"Function \"+t+\"does not exist.\");return e.apply(null,n)},fullPath:function(t){var e=o(t);return e.unshift(this.name),e.join(\".\")}}),t.exports=s},function(t,e,n){var r=n(0),i=n(7),o={bind:function(t,e){return this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)},unbind:function(t,e){var n;this._handlers&&this._handlers[t]&&(e?(n=this._handlers[t].indexOf(e))>=0&&this._handlers[t].splice(n,1):this._handlers[t]=[])},trigger:function(t,e){var n=this._handlers&&this._handlers[t];(e=e||{}).type=t,n&&n.forEach(function(t){r.async(i(t,this,e))})}};t.exports={Emitter:o,makeEmitter:function(){return r.aug(function(){},o)}}},function(t,e,n){var r=n(103),i=n(77),o=n(6),s=n(23),a=n(7),u=n(0),c=new i(function(t){var e=function(t){return t.reduce(function(t,e){return t[e._className]=t[e._className]||[],t[e._className].push(e),t},{})}(t.map(r.fromRawTask));u.forIn(e,function(t,e){s.allSettled(e.map(function(t){return t.initialize()})).then(function(){e.forEach(function(t){o.all([t.hydrate(),t.insertIntoDom()]).then(a(t.render,t)).then(a(t.success,t),a(t.fail,t))})})})});t.exports={addWidget:function(t){return c.add(t)}}},function(t,e,n){var r=n(18);t.exports=function(t){return r.write(function(){t&&t.parentNode&&t.parentNode.removeChild(t)})}},function(t,e,n){n(12),t.exports={log:function(t,e){}}},function(t,e,n){var r=n(1);function i(t){return(t=t||r).getSelection&&t.getSelection()}t.exports={getSelection:i,getSelectedText:function(t){var e=i(t);return e?e.toString():\"\"}}},function(t,e,n){var r=n(4),i=n(1),o=n(2),s=2e4;t.exports=function(t){var e=new o,n=r.createElement(\"img\");return n.onload=n.onerror=function(){i.setTimeout(e.resolve,50)},n.src=t,i.setTimeout(e.reject,s),e.promise}},function(t,e,n){var r=n(113);t.exports=function(t){t.define(\"createElement\",r),t.define(\"createFragment\",r),t.define(\"htmlToElement\",r),t.define(\"hasSelectedText\",r),t.define(\"addRootClass\",r),t.define(\"removeRootClass\",r),t.define(\"hasRootClass\",r),t.define(\"prependStyleSheet\",r),t.define(\"appendStyleSheet\",r),t.define(\"prependCss\",r),t.define(\"appendCss\",r),t.define(\"makeVisible\",r),t.define(\"injectWidgetEl\",r),t.define(\"matchHeightToContent\",r),t.define(\"matchWidthToContent\",r)}},function(t,e){t.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}}},function(t,e,n){var r=n(15),i=n(122),o=n(60),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.DM_BUTTON,t,e,n)}},function(t,e,n){var r=n(61),i=n(26);t.exports=r.isSupported()?r:i},function(t,e,n){var r=n(27),i=n(123);t.exports=r.build([i])},function(t,e,n){var r=n(15),i=n(126),o=n(38),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.FOLLOW_BUTTON,t,e,n)}},function(t,e,n){var r=n(15),i=n(134),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.MOMENT,t,e,n)}},function(t,e,n){var r=n(15),i=n(136),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.PERISCOPE,t,e,n)}},function(t,e,n){var r=n(83),i=n(138),o=n(142),s=n(144),a=n(146),u=n(148),c={collection:i,event:o,likes:s,list:a,profile:u,url:f},d=[u,s,i,a,o];function f(t){return r(d,function(e){try{return new e(t)}catch(t){}})}t.exports=function(t){return t?function(t){var e,n;return e=(t.sourceType+\"\").toLowerCase(),(n=c[e])?new n(t):null}(t)||f(t):null}},function(t,e,n){var r=n(15),i=n(150),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.TIMELINE,t,e,n)}},function(t,e,n){var r=n(4),i=n(68),o=n(152),s=n(15),a=n(38),u=n(153),c=n(60),d=n(154),f=n(16);t.exports=function(t,e,n,l){var h,p=i.isHorizonTweetEnabled(l);return o(l,t.tweetId),p?(h=r.createElement(\"div\"),new s(u,a,f.TWEET,t,e,n,{sandboxWrapperEl:h})):new s(d,c,f.TWEET,t,e,n)}},function(t,e){var n=\"tfw_horizon_tweet_embed_9555\";t.exports={isHorizonTweetEnabled:function(t){return!(!t||!t[n]||\"hte\"!==t[n].bucket)}}},function(t,e,n){var r=n(15),i=n(156),o=n(38),s=n(16);t.exports=function(t,e,n){var a=t&&t.type||\"share\",u=\"hashtag\"==a?s.HASHTAG_BUTTON:\"mention\"==a?s.MENTION_BUTTON:s.SHARE_BUTTON;return new r(i,o,u,t,e,n)}},function(t,e,n){var r=n(37),i=n(39),o=n(0),s=n(68),a=n(31);t.exports=function(t){var e={widget_origin:i.rootDocumentLocation(),widget_frame:i.isFramed()?i.currentDocumentLocation():null,duration_ms:t.duration,item_ids:t.widgetIds||[]},n=o.aug(t.namespace,{page:\"page\",component:\"performance\"});return a.getExperiments().then(function(t){var i=s.isHorizonTweetEnabled(t)?o.aug(e,{context:\"horizon\"}):e;r.scribe(n,i)})}},function(t,e,n){var r=n(0),i=n(139),o=[\"ar\",\"fa\",\"he\",\"ur\"];t.exports={isRtlLang:function(t){return t=String(t).toLowerCase(),r.contains(o,t)},matchLanguage:function(t){return t=(t=(t||\"\").toLowerCase()).replace(\"_\",\"-\"),i(t)?t:(t=t.replace(/-.*/,\"\"),i(t)?t:\"en\")}}},function(t){t.exports={TWEET:0,RETWEET:10,CUSTOM_TIMELINE:17,LIVE_VIDEO_EVENT:28,QUOTE_TWEET:23}},function(t){t.exports={tweetButtonHtmlPath:\"/widgets/tweet_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",followButtonHtmlPath:\"/widgets/follow_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",hubHtmlPath:\"/widgets/hub.html\",widgetIframeHtmlPath:\"/widgets/widget_iframe.d0f13be8321eb432fba28cfc1c3351b1.html\",resourceBaseUrl:\"https://platform.twitter.com\"}},function(t,e,n){var r=n(3),i=n(100),o=n(25),s=n(11),a={favorite:[\"favorite\",\"like\"],follow:[\"follow\"],like:[\"favorite\",\"like\"],retweet:[\"retweet\"],tweet:[\"tweet\"]};function u(t){this.srcEl=[],this.element=t}u.open=function(t,e,n){var u=(r.intentType(t)||\"\").toLowerCase();r.isTwitterURL(t)&&(function(t,e){i.open(t,{},e)}(t,n),e&&o.trigger(\"click\",{target:e,region:\"intent\",type:\"click\",data:{}}),e&&a[u]&&a[u].forEach(function(n){o.trigger(n,{target:e,region:\"intent\",type:n,data:function(t,e){var n=s.decodeURL(e);switch(t){case\"favorite\":case\"like\":return{tweet_id:n.tweet_id};case\"follow\":return{screen_name:n.screen_name,user_id:n.user_id};case\"retweet\":return{source_tweet_id:n.tweet_id};default:return{}}}(u,t)})}))},t.exports=u},function(t,e){t.exports={getTimezoneOffset:function(){var t=(new Date).toString().match(/(GMT[+-]?\\d+)/);return t&&t[0]||\"GMT\"}}},function(t,e,n){var r=n(4),i=n(9),o=n(2),s=n(0),a=n(11),u=\"cb\",c=0;t.exports={fetch:function(t,e,n,d){var f,l,h;return d=function(t){if(t)return t.replace(/[^\\w$]/g,\"_\")}(d||u+c++),f=i.fullPath([\"callbacks\",d]),l=r.createElement(\"script\"),h=new o,e=s.aug({},e,{callback:f,suppress_response_codes:!0}),i.set([\"callbacks\",d],function(t){var e;t=(e=n(t||!1)).resp,e.success?h.resolve(t):h.reject(t),l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i.unset([\"callbacks\",d])}),l.onerror=function(){h.reject(new Error(\"failed to fetch \"+l.src))},l.src=a.url(t,e),l.async=\"async\",r.body.appendChild(l),h.promise}}},function(t,e,n){var r=n(2),i=n(105),o=n(7);function s(t){this._inputsQueue=[],this._task=t,this._hasFlushBeenScheduled=!1}s.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._hasFlushBeenScheduled||(this._hasFlushBeenScheduled=!0,i(o(this._flush,this))),e.promise},s.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._hasFlushBeenScheduled=!1},t.exports=s},function(t,e){t.exports=function(t,e){return t.reduce(function(t,n){var r=e(n);return t[r]=t[r]||[],t[r].push(n),t},{})}},function(t,e,n){var r=n(4),i=n(8),o=n(3);function s(t,e){var n,r;return e=e||i,/^https?:\\/\\//.test(t)?t:/^\\/\\//.test(t)?e.protocol+t:(n=e.host+(e.port.length?\":\"+e.port:\"\"),0!==t.indexOf(\"/\")&&((r=e.pathname.split(\"/\")).pop(),r.push(t),t=\"/\"+r.join(\"/\")),[e.protocol,\"//\",n,t].join(\"\"))}t.exports={absolutize:s,getCanonicalURL:function(){for(var t,e=r.getElementsByTagName(\"link\"),n=0;e[n];n++)if(\"canonical\"==(t=e[n]).rel)return s(t.href)},getScreenNameFromPage:function(){for(var t,e,n,i=[r.getElementsByTagName(\"a\"),r.getElementsByTagName(\"link\")],s=0,a=0,u=/\\bme\\b/;t=i[s];s++)for(a=0;e=t[a];a++)if(u.test(e.rel)&&(n=o.screenName(e.href)))return n}}},function(t,e,n){var r=n(8),i=/^[^#?]*\\.(gov|mil)(:\\d+)?([#?].*)?$/i,o={};function s(t){return t in o?o[t]:o[t]=i.test(t)}t.exports={isUrlSensitive:s,isHostPageSensitive:function(){return s(r.host)}}},function(t,e,n){var r=n(20),i=n(54),o=n(11),s=n(21),a=n(0),u=n(9).get(\"scribeCallback\"),c=2083,d=[],f=o.url(s.CLIENT_EVENT_ENDPOINT,{dnt:0,l:\"\"}),l=encodeURIComponent(f).length;function h(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);i||o||(u&&u(arguments),p(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r),s.CLIENT_EVENT_ENDPOINT))}function p(t,e,n){var r,u;n&&a.isObject(t)&&a.isObject(e)&&(i.log(t,e),r=s.flattenClientEventPayload(t,e),u={l:s.stringify(r)},s.noticeSeen(t)&&(u.notice_seen=!0),r.dnt&&(u.dnt=1),w(o.url(n,u)))}function m(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);if(!i&&!o)return v(s.flattenClientEventPayload(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r)))}function v(t){return d.push(t),d}function g(t){return encodeURIComponent(t).length+3}function w(t){return(new Image).src=t}t.exports={canFlushOneItem:function(t){var e=g(s.stringify(t));return l+e<c},_enqueueRawObject:v,scribe:p,clientEvent:h,clientEvent2:function(t,e,n){return h(t,e,n,2)},enqueueClientEvent:m,flushClientEvents:function(){var t;return d.length>1&&m({page:\"widgets_js\",component:\"scribe_pixel\",action:\"batch_log\"},{}),t=d,d=[],t.reduce(function(e,n,r){var i=e.length,o=i&&e[i-1];return r+1==t.length&&n.event_namespace&&\"batch_log\"==n.event_namespace.action&&(n.message=[\"entries:\"+r,\"requests:\"+i].join(\"/\")),function t(e){return Array.isArray(e)||(e=[e]),e.reduce(function(e,n){var r,i=s.stringify(n),o=g(i);return l+o<c?e=e.concat(i):(r=s.splitLogEntry(n)).length>1&&(e=e.concat(t(r))),e},[])}(n).forEach(function(t){var n=g(t);(!o||o.urlLength+n>c)&&(o={urlLength:l,items:[]},e.push(o)),o.urlLength+=n,o.items.push(t)}),e},[]).map(function(t){var e={l:t.items};return r.enabled()&&(e.dnt=1),w(o.url(s.CLIENT_EVENT_ENDPOINT,e))})},interaction:function(t,e,n,r){var i=s.extractTermsFromDOM(t.target||t.srcElement);i.action=r||\"click\",h(i,e,n)}}},function(t,e,n){var r=n(0),i=n(43);t.exports=function(t,e){return i(t,e)?[t]:r.toRealArray(t.querySelectorAll(e))}},function(t,e){t.exports=function(t,e,n){for(var r,i=0;i<t.length;i++)if(r=e.call(n,t[i],i,t))return r}},function(t,e){t.exports=function(){return Math.floor(+new Date/9e5)}},function(t,e,n){var r=n(12);t.exports=function(t){var e,n;return e=t.headers&&t.headers.status,!(n=t&&!t.error&&200===e)&&t.headers&&t.headers.message&&r.publicError(t.headers.message),{success:n,resp:t}}},function(t,e,n){var r=n(37),i=n(21);t.exports=function(t,e,n,o){r.scribe(i.formatClientEventNamespace({client:\"tfw\",page:\"ddg\",section:t,action:\"experiment\"}),{experiment_key:t,bucket:e,version:n,data:o},!0)}},function(t,e,n){var r,i=n(30),o=0;function s(){r&&r.length===o&&(i.emitter.trigger(i.ALL_WIDGETS_AND_IMAGES_LOADED,r),r=null)}i.emitter.bind(i.ALL_WIDGETS_RENDER_END,function(t){r=t.widgets,s()}),t.exports={reportImagesLoadForAWidget:function(){o++,s()}}},,,,,,,,,function(t,e,n){var r,i=n(2),o=n(4),s=n(98),a=n(49),u=n(9),c=n(99),d=n(25),f=n(102),l=n(157),h=n(165),p=n(166),m=n(30),v=n(31);n(167),m.emitter.trigger(m.START),u.set(\"widgets.init\",!0),a.set(\"init\",!0),p(),r=new i,s.exposeReadyPromise(r.promise,a.base,\"_e\"),a.set(\"widgets\",l),a.set(\"widgets.load\",f.load),a.set(\"events\",d),h(function(){v.load(),r.resolve(a.base),c.attachTo(o),f.loadPage()})},function(t,e){t.exports=navigator},function(t,e,n){var r=n(7);t.exports={exposeReadyPromise:function(t,e,n){e.ready=r(t.then,t),n&&Array.isArray(e[n])&&(e[n].forEach(r(t.then,t)),delete e[n])}}},function(t,e,n){var r=n(8),i=n(36),o=n(34),s=n(74),a=n(3);function u(t){var e,n,u;t.altKey||t.metaKey||t.shiftKey||(e=o.closest(function(t){return\"A\"===t.tagName||\"AREA\"===t.tagName},t.target))&&a.isIntentURL(e.href)&&(n=(n=(n=[u=e.href,\"original_referer=\"+r.href].join(-1==u.indexOf(\"?\")?\"?\":\"&\")).replace(/^http[:]/,\"https:\")).replace(/^\\/\\//,\"https://\"),s.open(n,e),i.preventDefault(t))}t.exports={attachTo:function(t){t.addEventListener(\"click\",u,!1)}}},function(t,e,n){var r,i=n(1),o=n(101),s=n(36),a=n(34),u=n(22),c=n(3),d=n(24),f=n(0),l=\"intent_\",h=i.screen.width,p=i.screen.height;function m(t,e){function n(t){return Math.round(t/2)}return t>e?{coordinate:0,size:e}:{coordinate:n(e)-n(t),size:t}}function v(t,e,n){var i,o;e=r.parse(e),n=n||{},i=m(e.width,n.width||h),e.left=i.coordinate,e.width=i.size,o=m(e.height,n.height||p),e.top=o.coordinate,e.height=o.size,this.win=t,this.features=function(t){var e=[];return f.forIn(t,function(t,n){e.push(t+\"=\"+n)}),e.join(\",\")}(e)}r=(new o).defaults({width:550,height:520,personalbar:\"0\",toolbar:\"0\",location:\"1\",scrollbars:\"1\",resizable:\"1\"}),v.prototype.open=function(t,e){var n=e&&\"click\"==e.type&&a.closest(\"a\",e.target),r=e&&(e.altKey||e.metaKey||e.shiftKey),i=n&&(u.ios()||u.android());if(c.isTwitterURL(t))return r||i?this:(this.name=l+d.generate(),this.popup=this.win.open(t,this.name,this.features),e&&s.preventDefault(e),this)},v.open=function(t,e,n){return new v(i,e).open(t,n)},t.exports=v},function(t,e,n){var r=n(5),i=n(0);function o(){this.assertions=[],this._defaults={}}o.prototype.assert=function(t,e){return this.assertions.push({fn:t,msg:e||\"assertion failed\"}),this},o.prototype.defaults=function(t){return this._defaults=t||this._defaults,this},o.prototype.require=function(t){var e=this;return(t=Array.isArray(t)?t:i.toRealArray(arguments)).forEach(function(t){e.assert(function(t){return function(e){return r.hasValue(e[t])}}(t),\"required: \"+t)}),this},o.prototype.parse=function(t){var e,n;if(e=i.aug({},this._defaults,t||{}),(n=this.assertions.reduce(function(t,n){return n.fn(e)||t.push(n.msg),t},[])).length>0)throw new Error(n.join(\"\\n\"));return e},t.exports=o},function(t,e,n){var r=n(4),i=n(6),o=n(23),s=n(52),a=n(35),u=n(9),c=n(37),d=n(25),f=n(5),l=n(0),h=n(31),p=n(119),m=n(30);function v(){var t=a.val(\"widgets:autoload\")||!0;return!f.isFalseValue(t)&&(f.isTruthValue(t)?r.body:r.querySelectorAll(t))}function g(t,e){var n,i;return t=(t=t||r.body).length?l.toRealArray(t):[t],c.pause(),i=function(t,e){return t.reduce(function(t,n){return t.concat(p.reduce(function(t,r){return t.concat(r(n,e))},[]))},[])}(t,e),m.emitter.trigger(m.ALL_WIDGETS_RENDER_START,{widgets:i}),n=o.allResolved(i.map(function(t){return s.addWidget(t)})).then(function(t){d.trigger(\"loaded\",{widgets:t}),t&&t.length&&m.emitter.trigger(m.ALL_WIDGETS_RENDER_END,{widgets:t})}),o.always(n,function(){c.resume()}),n}function w(t){return h.getExperiments().then(function(e){return g(t,e)})}t.exports={load:w,loadPage:function(){var t=v();return!1===t?i.resolve():(u.set(\"widgets.loaded\",!0),w(t))},_getPageLoadTarget:v}},function(t,e,n){var r=n(10),i=n(18),o=n(25),s=n(53),a=n(6),u=n(23);function c(t,e){this._widget=null,this._sandbox=null,this._hydrated=!1,this._insertedIntoDom=!1,this._Sandbox=t.Sandbox,this._factory=t.factory,this._widgetParams=t.parameters,this._resolve=e,this._className=t.className,this._renderedClassName=t.className+\"-rendered\",this._errorClassName=t.className+\"-error\",this._srcEl=t.srcEl,this._targetGlobal=function(t){return(t.srcEl||t.targetEl).ownerDocument.defaultView}(t),this._sandboxWrapperEl=t.options?t.options.sandboxWrapperEl:null,this._insertionStrategy=function(e){var n,r=t.srcEl,i=t.targetEl,o=t.options?t.options.sandboxWrapperEl:null;o?(o.appendChild(e),n=o):n=e,r?i.insertBefore(n,r):i.appendChild(n)}}c.fromRawTask=function(t){return new c(t.input,t.taskDoneDeferred.resolve)},c.prototype.initialize=function(){var t=this,e=new this._Sandbox(this._targetGlobal);return this._factory(this._widgetParams,e).then(function(n){return t._widget=n,t._sandbox=e,n._sandboxWrapperEl=t._sandboxWrapperEl,n})},c.prototype.insertIntoDom=function(){var t=this;return this._widget?this._sandbox.insert(this._widget.id,{class:[this._className,this._renderedClassName].join(\" \")},null,this._insertionStrategy).then(function(){t._insertedIntoDom=!0}):a.reject(new Error(\"cannot insert widget into DOM before it is initialized\"))},c.prototype.hydrate=function(){var t=this;return this._widget?this._widget.hydrate().then(function(){t._hydrated=!0}):a.reject(new Error(\"cannot hydrate widget before it is initialized\"))},c.prototype.render=function(){var t=this;function e(e){return s(t._sandbox.sandboxEl).then(function(){return a.reject(e)})}return this._hydrated?this._insertedIntoDom?t._widget.render(t._sandbox).then(function(){return t._sandbox.onResize(function(){return t._widget.resize().then(function(){o.trigger(\"resize\",{target:t._sandbox.sandboxEl})})}),t._widget.show()}).then(function(){return s(t._srcEl).then(function(){return t._sandbox.sandboxEl})},e):e(new Error(\"cannot render widget before DOM insertion\")):e(new Error(\"cannot render widget before hydration\"))},c.prototype.fail=function(){var t=this;return this._srcEl?u.always(i.write(function(){r.add(t._srcEl,t._errorClassName)}),function(){o.trigger(\"rendered\",{target:t._srcEl}),t._resolve(t._srcEl)}):(t._resolve(),a.resolve())},c.prototype.success=function(){o.trigger(\"rendered\",{target:this._sandbox.sandboxEl}),this._resolve(this._sandbox.sandboxEl)},t.exports=c},function(t,e,n){var r;!function(){\"use strict\";var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};function o(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}o.prototype.read=function(t,e){var n=this.add(\"read\",t,e),r=n.id;return this.batch.read.push(n.id),\"reading\"===this.batch.mode||this.batch.scheduled?r:(this.scheduleBatch(),r)},o.prototype.write=function(t,e){var n=this.add(\"write\",t,e),r=this.batch.mode,i=n.id;return this.batch.write.push(n.id),\"writing\"===r||\"reading\"===r||this.batch.scheduled?i:(this.scheduleBatch(),i)},o.prototype.defer=function(t,e,n){\"function\"==typeof t&&(n=e,e=t,t=1);var r=this,i=t-1;return this.schedule(i,function(){r.run({fn:e,ctx:n})})},o.prototype.clear=function(t){if(\"function\"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var n=this.batch[e.type],r=n.indexOf(t);delete this.batch.hash[t],~r&&n.splice(r,1)}},o.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},o.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},o.prototype.uniqueId=function(){return++this.lastId},o.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},o.prototype.runBatch=function(){try{this.batch.mode=\"reading\",this.flush(this.batch.read),this.batch.mode=\"writing\",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},o.prototype.add=function(t,e,n){var r=this.uniqueId();return this.batch.hash[r]={id:r,fn:e,ctx:n,type:t}},o.prototype.run=function(t){var e=t.ctx||this,n=t.fn;if(delete this.batch.hash[t.id],!this.onError)return n.call(e);try{n.call(e)}catch(t){this.onError(t)}},o.prototype.loop=function(){var t,e=this,n=this.raf,r=!1;function i(){var t=e.frames.shift();e.frames.length?n(i):e.looping=!1,t&&t()}this.looping||(t=setTimeout(function(){r=!0,i()},500),n(function(){r||(clearTimeout(t),i())}),this.looping=!0)},o.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)};var s=new o;void 0!==t&&t.exports?t.exports=s:void 0===(r=function(){return s}.call(e,n,e,t))||(t.exports=r)}()},function(t,e,n){var r=n(48).Promise;t.exports=r._asap},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=n(32),c=n(20),d=n(2),f=n(6),l=n(54),h=n(21),p=n(0),m=n(26),v=n(9).get(\"scribeCallback\"),g=Math.floor(1e3*Math.random())+\"_\",w=\"rufous-frame-\"+g+\"-\",y=\"rufous-form-\"+g+\"-\",b=0,_=!1,E=new d;function x(){var t=o.createElement(\"form\"),e=o.createElement(\"input\"),n=o.createElement(\"input\");return b++,t.action=h.CLIENT_EVENT_ENDPOINT,t.method=\"POST\",t.target=w+b,t.id=y+b,e.type=\"hidden\",e.name=\"dnt\",e.value=c.enabled(),n.type=\"hidden\",n.name=\"tfw_redirect\",n.value=h.RUFOUS_REDIRECT,t.appendChild(e),t.appendChild(n),t}function T(){var t=w+b;return u({id:t,name:t,width:0,height:0,border:0},{display:\"none\"},o.doc)}t.exports={clientEvent:function(t,e,n,i){(function(t,e){var n=!p.isObject(t),r=!!e&&!p.isObject(e),i=n||r;return i})(t,e)||(v&&v(arguments),E.promise.then(function(){!function(t,e){var n,i,s;p.isObject(t)&&p.isObject(e)&&(l.log(t,e),s=h.flattenClientEventPayload(t,e),(n=r.firstChild).value=+(+n.value||s.dnt||0),(i=o.createElement(\"input\")).type=\"hidden\",i.name=\"l\",i.value=h.stringify(s),r.appendChild(i))}(h.formatClientEventNamespace(t),h.formatClientEventData(e,n,i))}))},flush:function(){return E.promise.then(function(){var t;return r.children.length<=2?f.reject():(t=f.all([o.doc.body.appendChild(r),o.doc.body.appendChild(i)]).then(function(t){var e=t[0],n=t[1];return n.addEventListener(\"load\",function(){!function(t,e){return function(){var n=t.parentNode;n&&(n.removeChild(t),n.removeChild(e))}}(e,n)()}),e.submit(),t}),r=x(),i=T(),t)})},init:function(){return _?E.promise:((o=new m(a)).insert(\"rufous-sandbox\",null,{display:\"none\"},function(t){s.body.appendChild(t)}).then(function(){o.setTitle(\"Twitter analytics iframe\"),r=x(),i=T(),E.resolve([r,i])}),_=!0,E.promise)}}},function(t,e,n){var r=n(0);t.exports=function t(e){var n=[];return e.forEach(function(e){var i=r.isType(\"array\",e)?t(e):[e];n=n.concat(i)}),n}},function(t,e){t.exports=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}},function(t,e,n){var r=n(41),i=n(0),o=n(111);function s(){r.apply(this,arguments)}s.prototype=Object.create(r.prototype),i.aug(s.prototype,{factory:o}),t.exports=s},function(t,e,n){var r=n(23),i=n(0),o=n(7);t.exports={before:function(t,e){return function(){var n,i=this,o=arguments;return n=e.apply(this,arguments),r.isPromise(n)?n.then(function(){return t.apply(i,o)}):t.apply(this,arguments)}},after:function(t,e){return function(){var n,i=this,o=arguments;function s(t,e){return r.isPromise(e)?e.then(function(){return t}):t}return n=t.apply(this,arguments),r.isPromise(n)?n.then(function(t){return s(t,e.apply(i,o))}):s(n,e.apply(this,arguments))}},around:function(t,e){return function(){var n=i.toRealArray(arguments);return n.unshift(o(t,this)),e.apply(this,n)}}}},function(t,e,n){var r=n(10),i=n(18),o=n(42),s=n(6),a=n(0);t.exports=function(){var t=o();function e(e){t.apply(this,arguments),Object.defineProperty(this,\"targetGlobal\",{value:e})}return e.prototype=Object.create(t.prototype),a.aug(e.prototype,{id:null,initialized:!1,width:0,height:0,sandboxEl:null,insert:function(){return s.reject()},onResize:function(){},addClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.add(e,t)})})},removeClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.remove(e,t)})})},styleSelf:function(t){var e=this;return i.write(function(){a.forIn(t,function(t,n){e.sandboxEl.style[t]=n})})}}),e}},function(t,e,n){var r=n(4),i=n(10),o=n(18),s=n(55),a=n(27),u=n(56),c=n(44),d=n(45),f=n(32),l=n(12),h=n(46),p=n(2),m=n(6),v=n(0),g=n(9),w=n(24),y=n(7),b={allowfullscreen:\"true\"},_={position:\"absolute\",visibility:\"hidden\",display:\"block\",width:\"0px\",height:\"0px\",padding:\"0\",border:\"none\"},E={position:\"static\",visibility:\"visible\"},x=\"SandboxRoot\",T=\".SandboxRoot { display: none; }\",A=50;function S(t,e,n,r){return e=v.aug({id:t},b,e),n=v.aug({},_,n),f(e,n,r)}function R(t,e,n,i,s){var a=new p,u=w.generate(),c=S(t,e,n,s);return g.set([\"sandbox\",u],function(){var t=c.contentWindow.document;o.write(function(){t.write(\"<!DOCTYPE html><html><head><\/head><body><\/body><\/html>\")}).then(function(){t.close(),a.resolve(c)})}),c.src=[\"javascript:\",'document.write(\"\");',\"try { window.parent.document; }\",'catch (e) { document.domain=\"'+r.domain+'\"; }',\"window.parent.\"+g.fullPath([\"sandbox\",u])+\"();\"].join(\"\"),c.addEventListener(\"error\",a.reject,!1),o.write(function(){i.parentNode.replaceChild(c,i)}),a.promise}t.exports=a.couple(n(57),function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.win}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"rootEl\",{get:function(){return this.doc&&this.doc.documentElement}}),t.defineProperty(\"widgetEl\",{get:function(){return this.doc&&this.doc.body.firstElementChild}}),t.defineProperty(\"win\",{get:function(){return this.iframeEl&&this.iframeEl.contentWindow}}),t.defineProperty(\"doc\",{get:function(){return this.win&&this.win.document}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return o.read(function(){var e,n=h(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=h(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_setTargetToBlank\",function(){var t=this.createElement(\"base\");t.target=\"_blank\",this.doc.head.appendChild(t)}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.override(\"createElement\",function(t){return this.doc.createElement(t)}),t.override(\"createFragment\",function(){return this.doc.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!s.getSelectedText(this.win)}),t.override(\"addRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return i.present(this.rootEl,t)}),t.define(\"addStyleSheet\",function(t,e){var n,r=new p;return this.initialized?((n=this.createElement(\"link\")).type=\"text/css\",n.rel=\"stylesheet\",n.href=t,n.addEventListener(\"load\",r.resolve,!1),n.addEventListener(\"error\",r.reject,!1),o.write(y(e,null,n)).then(function(){return u(t).then(r.resolve,r.reject),r.promise})):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){return e.head.appendChild(t)})}),t.define(\"addCss\",function(t,e){var n;return c.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.doc.createTextNode(t)),o.write(y(e,null,n))):(l.devError(\"CSP enabled; cannot embed inline styles\"),m.resolve())}),t.override(\"prependCss\",function(t){var e=this.doc;return this.addCss(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this.doc;return this.addCss(t,function(t){return e.head.appendChild(t)})}),t.override(\"makeVisible\",function(){var t=this;return this.styleSelf(E).then(function(){t._updateCachedDimensions()})}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this.widgetEl?m.reject(new Error(\"widget already injected\")):o.write(function(){e.doc.body.appendChild(t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).height:0}),o.write(function(){e.sandboxEl.style.height=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.override(\"matchWidthToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).width:0}),o.write(function(){e.sandboxEl.style.width=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.after(\"initialize\",function(){this._iframe=null,this._width=this._height=0,this._resizeHandlers=[]}),t.override(\"insert\",function(t,e,n,r){var i=this,s=new p,a=this.targetGlobal.document,u=S(t,e,n,a);return o.write(y(r,null,u)),u.addEventListener(\"load\",function(){(function(t){try{t.contentWindow.document}catch(t){return m.reject(t)}return m.resolve(t)})(u).then(null,y(R,null,t,e,n,u,a)).then(s.resolve,s.reject)},!1),u.addEventListener(\"error\",s.reject,!1),s.promise.then(function(t){var e=d(i._didResize,A,i);return i._iframe=t,i.win.addEventListener(\"resize\",e,!1),m.all([i._setTargetToBlank(),i.addRootClass(x),i.prependCss(T)])})}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){t.exports=function(){throw new Error(\"unimplemented method\")}},function(t,e,n){var r=n(2),i=n(7),o=100,s=3e3;function a(t,e){this._inputsQueue=[],this._task=t,this._isPaused=!1,this._flushDelay=e&&e.flushDelay||o,this._pauseLength=e&&e.pauseLength||s,this._flushTimeout=void 0}a.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._scheduleFlush(),e.promise},a.prototype._scheduleFlush=function(){this._isPaused||(clearTimeout(this._flushTimeout),this._flushTimeout=setTimeout(i(this._flush,this),this._flushDelay))},a.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._flushTimeout=void 0},a.prototype.pause=function(t){clearTimeout(this._flushTimeout),this._isPaused=!0,!t&&this._pauseLength&&setTimeout(i(this.resume,this),this._pauseLength)},a.prototype.resume=function(){this._isPaused=!1,this._scheduleFlush()},t.exports=a},function(t,e,n){var r,i=n(73),o=n(32),s=n(2),a=n(4),u=n(19),c=n(22),d=n(33),f=n(8),l=n(12),h=n(116),p=n(58),m=n(9),v=n(11),g=n(117),w=n(3),y=n(0),b=n(1),_=p(function(){return new s});function E(t){var e=t||{should_obtain_cookie_consent:!0,experiments:{}};return new g(e.should_obtain_cookie_consent,e.experiments)}t.exports={load:function(){var t,e,n,s;if(c.ie9()||c.ie10()||\"http:\"!==f.protocol&&\"https:\"!==f.protocol)return l.devError(\"Using default settings due to unsupported browser or protocol.\"),r=E(),void _().resolve();t={origin:f.origin},u.settings().indexOf(\"localhost\")>-1&&(t.localSettings=!0),e=v.url(i.resourceBaseUrl+i.widgetIframeHtmlPath,t),n=function(t){var n,i,o,s;if(i=w.isTwitterURL(t.origin),o=e.substr(0,t.origin.length)===t.origin,s=w.isTwimgURL(t.origin),o&&i||s)try{(n=\"string\"==typeof t.data?d.parse(t.data):t.data).namespace===h.settings&&(r=E(n.settings),_().resolve())}catch(t){l.devError(t)}},b.addEventListener(\"message\",n),s=o({src:e,title:\"Twitter settings iframe\"},{display:\"none\"}),a.body.appendChild(s)},settingsLoaded:function(){var t,e,n;return t=new s,e=m.get(\"experimentOverride\"),_().promise.then(function(){e&&e.name&&e.assignment&&((n={})[e.name]={bucket:e.assignment},r.experiments=y.aug(r.experiments,n)),t.resolve(r)}).catch(function(e){t.reject(e)}),t.promise}}},function(t,e){t.exports={settings:\"twttr.settings\"}},function(t,e){t.exports=function(t,e){this.shouldObtainCookieConsent=t,this.experiments=e||{}}},function(t,e){t.exports=function(t){return t.split(\"\").map(function(t){return t.charCodeAt(0).toString(16)}).join(\"\")}},function(t,e,n){t.exports=[n(120),n(125),n(133),n(135),n(137),n(151),n(155)]},function(t,e,n){var r=n(11),i=n(5),o=n(0),s=n(13),a=n(14)(),u=n(59),c=\"a.twitter-dm-button\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=t.getAttribute(\"data-show-screen-name\"),n=s(t),a=t.getAttribute(\"href\"),u=t.getAttribute(\"data-screen-name\"),c=e?i.asBoolean(e):null,d=t.getAttribute(\"data-size\"),f=r.decodeURL(a),l=f.recipient_id,h=t.getAttribute(\"data-text\")||f.text,p=t.getAttribute(\"data-welcome-message-id\")||f.welcomeMessageId;return o.aug(n,{screenName:u,showScreenName:c,size:d,text:h,userId:l,welcomeMessageId:p})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(0);t.exports=function t(e){var n;if(e)return n=e.lang||e.getAttribute(\"data-lang\"),r.isType(\"string\",n)?n:t(e.parentElement)}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(2).then(function(r){var o;try{o=n(88),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(124),i=n(1),o=n(10),s=n(36),a=n(18),u=n(55),c=n(27),d=n(56),f=n(44),l=n(46),h=n(7),p=n(45),m=n(6),v=n(0),g=50,w={position:\"absolute\",visibility:\"hidden\",display:\"block\",transform:\"rotate(0deg)\"},y={position:\"static\",visibility:\"visible\"},b=\"twitter-widget\",_=\"open\",E=\"SandboxRoot\",x=\".SandboxRoot { display: none; max-height: 10000px; }\";t.exports=c.couple(n(57),function(t){t.defineStatic(\"isSupported\",function(){return!!i.HTMLElement.prototype.attachShadow&&f.inlineStyle()}),t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this._shadowHost}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this._shadowHost}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return a.read(function(){var e,n=l(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=l(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.override(\"createElement\",function(t){return this.targetGlobal.document.createElement(t)}),t.override(\"createFragment\",function(){return this.targetGlobal.document.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!u.getSelectedText(this.targetGlobal)}),t.override(\"addRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return o.present(this._shadowRootBody,t)}),t.override(\"addStyleSheet\",function(t,e){return this.addCss('@import url(\"'+t+'\");',e).then(function(){return d(t)})}),t.override(\"prependStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){return e.appendChild(t)})}),t.override(\"addCss\",function(t,e){var n;return this.initialized?f.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.targetGlobal.document.createTextNode(t)),a.write(h(e,null,n))):m.resolve():m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){return e.appendChild(t)})}),t.override(\"makeVisible\",function(){return this.styleSelf(y)}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this._shadowRootBody.firstElementChild?m.reject(new Error(\"widget already injected\")):a.write(function(){e._shadowRootBody.appendChild(t)}).then(function(){return e._updateCachedDimensions()}).then(function(){var t=p(e._didResize,g,e);new r(e._shadowRootBody,t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){return m.resolve()}),t.override(\"matchWidthToContent\",function(){return m.resolve()}),t.override(\"insert\",function(t,e,n,r){var i=this.targetGlobal.document,o=this._shadowHost=i.createElement(b),u=this._shadowRoot=o.attachShadow({mode:_}),c=this._shadowRootBody=i.createElement(\"div\");return v.forIn(e||{},function(t,e){o.setAttribute(t,e)}),o.id=t,u.appendChild(c),s.delegate(c,\"click\",\"A\",function(t,e){e.hasAttribute(\"target\")||e.setAttribute(\"target\",\"_blank\")}),m.all([this.styleSelf(w),this.addRootClass(E),this.prependCss(x),a.write(r.bind(null,o))])}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"initialize\",function(){this._shadowHost=this._shadowRoot=this._shadowRootBody=null,this._width=this._height=0,this._resizeHandlers=[]}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){var n;(n=function(t,e){function r(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new function(){var t,e;this.q=[],this.add=function(t){this.q.push(t)},this.call=function(){for(t=0,e=this.q.length;t<e;t++)this.q[t].call()}},t.resizedAttached.add(e);t.resizeSensor=document.createElement(\"div\"),t.resizeSensor.className=\"resize-sensor\";var n=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;\",r=\"position: absolute; left: 0; top: 0; transition: 0s;\";t.resizeSensor.style.cssText=n,t.resizeSensor.innerHTML='<div class=\"resize-sensor-expand\" style=\"'+n+'\"><div style=\"'+r+'\"><\/div><\/div><div class=\"resize-sensor-shrink\" style=\"'+n+'\"><div style=\"'+r+' width: 200%; height: 200%\"><\/div><\/div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}(t,\"position\")]||(t.style.position=\"relative\");var i,o,s=t.resizeSensor.childNodes[0],a=s.childNodes[0],u=t.resizeSensor.childNodes[1],c=(u.childNodes[0],function(){a.style.width=s.offsetWidth+10+\"px\",a.style.height=s.offsetHeight+10+\"px\",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,i=t.offsetWidth,o=t.offsetHeight});c();var d=function(t,e,n){t.attachEvent?t.attachEvent(\"on\"+e,n):t.addEventListener(e,n)},f=function(){t.offsetWidth==i&&t.offsetHeight==o||t.resizedAttached&&t.resizedAttached.call(),c()};d(s,\"scroll\",f),d(u,\"scroll\",f)}var i=Object.prototype.toString.call(t),o=\"[object Array]\"===i||\"[object NodeList]\"===i||\"[object HTMLCollection]\"===i||\"undefined\"!=typeof jQuery&&t instanceof jQuery||\"undefined\"!=typeof Elements&&t instanceof Elements;if(o)for(var s=0,a=t.length;s<a;s++)r(t[s],e);else r(t,e);this.detach=function(){if(o)for(var e=0,r=t.length;e<r;e++)n.detach(t[e]);else n.detach(t)}}).detach=function(t){t.resizeSensor&&(t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)},void 0!==t&&void 0!==t.exports?t.exports=n:window.ResizeSensor=n},function(t,e,n){var r=n(3),i=n(0),o=n(13),s=n(14)(),a=n(62),u=n(5),c=\"a.twitter-follow-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:r.screenName(t.href),showScreenName:\"false\"!==t.getAttribute(\"data-show-screen-name\"),showCount:\"false\"!==t.getAttribute(\"data-show-count\"),size:t.getAttribute(\"data-size\"),count:t.getAttribute(\"data-count\"),preview:t.getAttribute(\"data-preview\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(89),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(18),i=n(128),o=n(58),s=n(32),a=n(2),u=n(6),c=n(7),d=n(0),f={allowfullscreen:\"true\"},l={position:\"absolute\",visibility:\"hidden\",width:\"0px\",height:\"0px\"},h={position:\"static\",visibility:\"visible\"},p={};i(function(t,e,n){var r=p[t];if(r)return e=e||1,n=n||1,r.styleSelf({width:e+\"px\",height:n+\"px\"}).then(function(){r.didResize()})},function(t){var e=p[t];if(e)return e._rendered.resolve()},function(t,e){var n=p[t];n&&e&&n.setIframeVersion(e)}),t.exports=function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.iframeEl}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"iframeVersion\",{get:function(){return this._iframeVersion}}),t.define(\"updateCachedDimensions\",function(){var t=this;return this.initialized?r.read(function(){t._width=t.sandboxEl.offsetWidth,t._height=t.sandboxEl.offsetHeight}):u.resolve()}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.define(\"setWaitToSwapUntilRendered\",function(t){this._waitToSwapUntilRendered=t}),t.define(\"setIframeVersion\",function(t){this._iframeVersion=t}),t.define(\"isRendered\",function(){return this._rendered.promise}),t.define(\"makeVisible\",function(){return this.styleSelf(h)}),t.define(\"didResize\",function(){var t=this,e=t._resizeHandlers.length>0;return this.updateCachedDimensions().then(function(){e&&t._resizeHandlers.forEach(function(e){e(t)})})}),t.define(\"loadDocument\",function(t){var e=new a;return this.initialized?this.iframeEl.src?u.reject(new Error(\"widget already loaded\")):(this.iframeEl.addEventListener(\"load\",e.resolve,!1),this.iframeEl.addEventListener(\"error\",e.reject,!1),this.iframeEl.src=t,e.promise):u.reject(new Error(\"sandbox not initialized\"))}),t.after(\"initialize\",function(){var t=new a;this._iframe=null,this._iframeVersion=null,this._width=this._height=0,this._resizeHandlers=[],this._rendered=t,this._waitToSwapUntilRendered=!1}),t.override(\"insert\",function(t,e,n,i){var a=this;return e=d.aug({id:t},f,e),n=d.aug({},l,n),this._iframe=s(e,n),p[t]=this,a._waitToSwapUntilRendered||this.onResize(o(function(){a.makeVisible()})),r.write(c(i,null,this._iframe))}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this.updateCachedDimensions()})}},function(t,e,n){var r=n(1),i=n(129),o=n(131),s=n(25),a=n(5),u=n(132);t.exports=function(t,e,n){function c(t,e){var n=u(this);s.trigger(t,{target:n,region:e,type:t,data:{}})}function d(e){var n=u(this),r=n&&n.id,i=a.asInt(e.width),o=a.asInt(e.height);r&&void 0!==i&&void 0!==o&&t(r,i,o)}(new i).attachReceiver(new o.Receiver(r,\"twttr.button\")).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.resizeButton\",d),(new i).attachReceiver(new o.Receiver(r,\"twttr.embed\")).bind(\"twttr.private.initialized\",function(t){var e=u(this),r=e&&e.id,i=t.iframe_version;r&&i&&n&&n(r,i)}).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.rendered\",function(){var t=u(this),n=t&&t.id;n&&e&&e(n)}).bind(\"twttr.private.resize\",d)}},function(t,e,n){var r=n(33),i=n(130),o=n(0),s=n(6),a=n(23),u=\"2.0\";function c(t){this.registry=t||{}}function d(t){var e,n;return e=o.isType(\"string\",t),n=o.isType(\"number\",t),e||n||null===t}function f(t,e){return{jsonrpc:u,id:d(t)?t:null,error:e}}c.prototype._invoke=function(t,e){var n,r,i;n=this.registry[t.method],r=t.params||[],r=o.isType(\"array\",r)?r:[r];try{i=n.apply(e.source||null,r)}catch(t){i=s.reject(t.message)}return a.isPromise(i)?i:s.resolve(i)},c.prototype._processRequest=function(t,e){var n,r;return function(t){var e,n,r;return!!o.isObject(t)&&(e=t.jsonrpc===u,n=o.isType(\"string\",t.method),r=!(\"id\"in t)||d(t.id),e&&n&&r)}(t)?(n=\"params\"in t&&(r=t.params,!o.isObject(r)||o.isType(\"function\",r))?s.resolve(f(t.id,i.INVALID_PARAMS)):this.registry[t.method]?this._invoke(t,{source:e}).then(function(e){return n=t.id,{jsonrpc:u,id:n,result:e};var n},function(){return f(t.id,i.INTERNAL_ERROR)}):s.resolve(f(t.id,i.METHOD_NOT_FOUND)),null!=t.id?n:s.resolve()):s.resolve(f(t.id,i.INVALID_REQUEST))},c.prototype.attachReceiver=function(t){return t.attachTo(this),this},c.prototype.bind=function(t,e){return this.registry[t]=e,this},c.prototype.receive=function(t,e){var n,a,u,c=this;try{u=t,t=o.isType(\"string\",u)?r.parse(u):u}catch(t){return s.resolve(f(null,i.PARSE_ERROR))}return e=e||null,a=((n=o.isType(\"array\",t))?t:[t]).map(function(t){return c._processRequest(t,e)}),n?function(t){return s.all(t).then(function(t){return(t=t.filter(function(t){return void 0!==t})).length?t:void 0})}(a):a[0]},t.exports=c},function(t){t.exports={PARSE_ERROR:{code:-32700,message:\"Parse error\"},INVALID_REQUEST:{code:-32600,message:\"Invalid Request\"},INVALID_PARAMS:{code:-32602,message:\"Invalid params\"},METHOD_NOT_FOUND:{code:-32601,message:\"Method not found\"},INTERNAL_ERROR:{code:-32603,message:\"Internal error\"}}},function(t,e,n){var r=n(8),i=n(1),o=n(33),s=n(2),a=n(22),u=n(0),c=n(3),d=n(7),f=a.ie9();function l(t,e,n){var r;t&&t.postMessage&&(f?r=(n||\"\")+o.stringify(e):n?(r={})[n]=e:r=e,t.postMessage(r,\"*\"))}function h(t){return u.isType(\"string\",t)?t:\"JSONRPC\"}function p(t,e){return e?u.isType(\"string\",t)&&0===t.indexOf(e)?t.substring(e.length):t&&t[e]?t[e]:void 0:t}function m(t,e){var n=t.document;this.filter=h(e),this.server=null,this.isTwitterFrame=c.isTwitterURL(n.location.href),t.addEventListener(\"message\",d(this._onMessage,this),!1)}function v(t,e){this.pending={},this.target=t,this.isTwitterHost=c.isTwitterURL(r.href),this.filter=h(e),i.addEventListener(\"message\",d(this._onMessage,this),!1)}u.aug(m.prototype,{_onMessage:function(t){var e,n=this;this.server&&(this.isTwitterFrame&&!c.isTwitterURL(t.origin)||(e=p(t.data,this.filter))&&this.server.receive(e,t.source).then(function(e){e&&l(t.source,e,n.filter)}))},attachTo:function(t){this.server=t},detach:function(){this.server=null}}),u.aug(v.prototype,{_processResponse:function(t){var e=this.pending[t.id];e&&(e.resolve(t),delete this.pending[t.id])},_onMessage:function(t){var e;if((!this.isTwitterHost||c.isTwitterURL(t.origin))&&(e=p(t.data,this.filter))){if(u.isType(\"string\",e))try{e=o.parse(e)}catch(t){return}(e=u.isType(\"array\",e)?e:[e]).forEach(d(this._processResponse,this))}},send:function(t){var e=new s;return t.id?this.pending[t.id]=e:e.resolve(),l(this.target,t,this.filter),e.promise}}),t.exports={Receiver:m,Dispatcher:v,_stringifyPayload:function(t){return arguments.length>0&&(f=!!t),f}}},function(t,e,n){var r=n(4);t.exports=function(t){for(var e,n=r.getElementsByTagName(\"iframe\"),i=0;n[i];i++)if((e=n[i]).contentWindow===t)return e}},function(t,e,n){var r=n(5),i=n(0),o=n(3),s=n(13),a=n(14)(),u=n(63),c=\"a.twitter-moment\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=s(t),n={momentId:o.momentId(t.href),chrome:t.getAttribute(\"data-chrome\"),limit:t.getAttribute(\"data-limit\")};return i.forIn(n,function(t,n){var i=e[t];e[t]=r.hasValue(i)?i:n}),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(4)]).then(function(r){var o;try{o=n(90),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0),i=n(13),o=n(14)(),s=n(64),a=\"a.periscope-on-air\",u=/^https?:\\/\\/(?:www\\.)?(?:periscope|pscp)\\.tv\\/@?([a-zA-Z0-9_]+)\\/?$/i;t.exports=function(t){return o(t,a).map(function(t){return s(function(t){var e=i(t),n=t.getAttribute(\"href\"),o=t.getAttribute(\"data-size\"),s=u.exec(n)[1];return r.aug(e,{username:s,size:o})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(5).then(function(r){var o;try{o=n(91),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(5),i=n(0),o=n(65),s=n(13),a=n(14)(),u=n(66),c=n(3),d=n(12),f=\"a.twitter-timeline,div.twitter-timeline,a.twitter-grid\",l=\"Embedded Search timelines have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",h=\"You may have been affected by an update to settings in embedded timelines. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",p=\"Embedded grids have been deprecated and will now render as timelines. Please update your embed code to use the twitter-timeline class. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\";t.exports=function(t){return a(t,f).map(function(t){return u(function(t){var e=s(t),n=t.getAttribute(\"data-show-replies\"),a={isPreconfigured:!!t.getAttribute(\"data-widget-id\"),chrome:t.getAttribute(\"data-chrome\"),tweetLimit:t.getAttribute(\"data-tweet-limit\")||t.getAttribute(\"data-limit\"),ariaLive:t.getAttribute(\"data-aria-polite\"),theme:t.getAttribute(\"data-theme\"),borderColor:t.getAttribute(\"data-border-color\"),showReplies:n?r.asBoolean(n):null,profileScreenName:t.getAttribute(\"data-screen-name\"),profileUserId:t.getAttribute(\"data-user-id\"),favoritesScreenName:t.getAttribute(\"data-favorites-screen-name\"),favoritesUserId:t.getAttribute(\"data-favorites-user-id\"),likesScreenName:t.getAttribute(\"data-likes-screen-name\"),likesUserId:t.getAttribute(\"data-likes-user-id\"),listOwnerScreenName:t.getAttribute(\"data-list-owner-screen-name\"),listOwnerUserId:t.getAttribute(\"data-list-owner-id\"),listId:t.getAttribute(\"data-list-id\"),listSlug:t.getAttribute(\"data-list-slug\"),customTimelineId:t.getAttribute(\"data-custom-timeline-id\"),staticContent:t.getAttribute(\"data-static-content\"),url:t.href};return a.isPreconfigured&&(c.isSearchUrl(a.url)?d.publicError(l,t):d.publicLog(h,t)),\"twitter-grid\"===t.className&&d.publicLog(p,t),(a=i.aug(a,e)).dataSource=o(a),a.id=a.dataSource&&a.dataSource.id,a}(t),t.parentNode,t)})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(141)])},function(t,e,n){var r=n(0),i=n(140);t.exports=function(t){return\"en\"===t||r.contains(i,t)}},function(t,e){t.exports=[\"hi\",\"zh-cn\",\"fr\",\"zh-tw\",\"msa\",\"fil\",\"fi\",\"sv\",\"pl\",\"ja\",\"ko\",\"de\",\"it\",\"pt\",\"es\",\"ru\",\"id\",\"tr\",\"da\",\"no\",\"nl\",\"hu\",\"fa\",\"ar\",\"ur\",\"he\",\"th\",\"cs\",\"uk\",\"vi\",\"ro\",\"bn\",\"el\",\"en-gb\",\"gu\",\"kn\",\"mr\",\"ta\",\"bg\",\"ca\",\"hr\",\"sr\",\"sk\"]},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"collection:\";function a(t,e){return r.collectionId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"collection\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{collection_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(143)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"event:\";function a(t,e){return r.eventId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"event\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{event_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(145)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"likes:\";function a(t){return r.likesScreenName(t.url)||t.screenName}t.exports=function(t){t.params({screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params)||this.params.userId;return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"likes\"])}}),t.define(\"_getLikesQueryParam\",function(){var t=a(this.params);return t?{screen_name:t}:{user_id:this.params.userId}}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getLikesQueryParam())}),t.before(\"initialize\",function(){if(!a(this.params)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(147)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"list:\";function a(t){var e=r.listScreenNameAndSlug(t.url)||t;return i.compact({screen_name:e.ownerScreenName,user_id:e.ownerUserId,list_slug:e.slug})}t.exports=function(t){t.params({id:{},ownerScreenName:{},ownerUserId:{},slug:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t,e,n;return this.params.id?s+this.params.id:(e=(t=a(this.params))&&t.list_slug.replace(/-/g,\"_\"),n=t&&(t.screen_name||t.user_id),s+(n+\":\")+e)}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"list\"])}}),t.define(\"_getListQueryParam\",function(){return this.params.id?{list_id:this.params.id}:a(this.params)}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getListQueryParam())}),t.before(\"initialize\",function(){var t=a(this.params);if(i.isEmptyObject(t)&&!this.params.id)throw new Error(\"qualified slug or list id required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(149)])},function(t,e,n){var r=n(3),i=n(5),o=n(0),s=n(19),a=\"profile:\";function u(t,e){return r.screenName(t)||e}t.exports=function(t){t.params({showReplies:{fallback:!1,transform:i.asBoolean},screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=u(this.params.url,this.params.screenName);return a+(t||this.params.userId)}}),t.overrideProperty(\"endpoint\",{get:function(){return s.timeline([\"profile\"])}}),t.define(\"_getProfileQueryParam\",function(){var t=u(this.params.url,this.params.screenName),e=t?{screen_name:t}:{user_id:this.params.userId};return o.aug(e,{with_replies:this.params.showReplies?\"true\":\"false\"})}),t.around(\"queryParams\",function(t){return o.aug(t(),this._getProfileQueryParam())}),t.before(\"initialize\",function(){if(!u(this.params.url,this.params.screenName)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(6)]).then(function(r){var o;try{o=n(92),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(3),o=n(0),s=n(13),a=n(14)(),u=n(67),c=\"blockquote.twitter-tweet, blockquote.twitter-video\",d=/\\btw-align-(left|right|center)\\b/;t.exports=function(t,e){return a(t,c).map(function(t){return u(function(t){var e=s(t),n=t.getElementsByTagName(\"A\"),a=n&&n[n.length-1],u=a&&i.status(a.href),c=t.getAttribute(\"data-conversation\"),f=\"none\"==c||\"hidden\"==c||r.present(t,\"tw-hide-thread\"),l=t.getAttribute(\"data-cards\"),h=\"none\"==l||\"hidden\"==l||r.present(t,\"tw-hide-media\"),p=t.getAttribute(\"data-align\")||t.getAttribute(\"align\"),m=t.getAttribute(\"data-theme\");return!p&&d.test(t.className)&&(p=RegExp.$1),o.aug(e,{tweetId:u,hideThread:f,hideCard:h,align:p,theme:m,id:u})}(t),t.parentNode,t,e)})}},function(t,e,n){var r=n(86),i=n(21),o=\"tfw_horizon_tweet_embed_9555\";t.exports=function(t,e){var n;t&&(n=t[o])&&n.bucket&&r(o,n.bucket,n.version,i.formatHorizonTweetData(e))}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(7).then(function(r){var o;try{o=n(93),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(8)]).then(function(r){var o;try{o=n(94),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(0),o=n(13),s=n(14)(),a=n(69),u=n(5),c=\"a.twitter-share-button, a.twitter-mention-button, a.twitter-hashtag-button\",d=\"twitter-hashtag-button\",f=\"twitter-mention-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:t.getAttribute(\"data-button-screen-name\"),text:t.getAttribute(\"data-text\"),type:t.getAttribute(\"data-type\"),size:t.getAttribute(\"data-size\"),url:t.getAttribute(\"data-url\"),hashtags:t.getAttribute(\"data-hashtags\"),via:t.getAttribute(\"data-via\"),buttonHashtag:t.getAttribute(\"data-button-hashtag\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e.buttonHashtag=e.buttonHashtag||e.button_hashtag||e.hashtag,r.present(t,d)&&(e.type=\"hashtag\"),r.present(t,f)&&(e.type=\"mention\"),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(95),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0);t.exports=r.aug({},n(158),n(159),n(160),n(161),n(162),n(163),n(164))},function(t,e,n){var r=n(59),i=n(17)([\"userId\"],{},r);t.exports={createDMButton:i}},function(t,e,n){var r=n(62),i=n(17)([\"screenName\"],{},r);t.exports={createFollowButton:i}},function(t,e,n){var r=n(63),i=n(17)([\"momentId\"],{},r);t.exports={createMoment:i}},function(t,e,n){var r=n(64),i=n(17)([\"username\"],{},r);t.exports={createPeriscopeOnAirButton:i}},function(t,e,n){var r=n(8),i=n(12),o=n(3),s=n(0),a=n(5),u=n(65),c=n(66),d=n(17)([],{},c),f=n(6),l=\"Embedded grids have been deprecated. Please use twttr.widgets.createTimeline instead. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\",h={createTimeline:p,createGridFromCollection:function(t){var e=s.toRealArray(arguments).slice(1),n={sourceType:\"collection\",id:t};return e.unshift(n),i.publicLog(l),p.apply(this,e)}};function p(t){var e,n=s.toRealArray(arguments).slice(1);return a.isString(t)||a.isNumber(t)?f.reject(\"Embedded timelines with widget settings have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\"):s.isObject(t)?(t=t||{},n.forEach(function(t){s.isType(\"object\",t)&&function(t){t.ariaLive=t.ariaPolite}(e=t)}),e||(e={},n.push(e)),t.lang=e.lang,t.tweetLimit=e.tweetLimit,t.showReplies=e.showReplies,e.dataSource=u(t),d.apply(this,n)):f.reject(\"data source must be an object.\")}o.isTwitterURL(r.href)&&(h.createTimelinePreview=function(t,e,n){var r={previewParams:t,useLegacyDefaults:!0,isPreviewTimeline:!0};return r.dataSource=u(r),d(e,r,n)}),t.exports=h},function(t,e,n){var r,i=n(0),o=n(67),s=n(17),a=(r=s([\"tweetId\"],{},o),function(){return i.toRealArray(arguments).slice(1).forEach(function(t){i.isType(\"object\",t)&&(t.hideCard=\"none\"==t.cards||\"hidden\"==t.cards,t.hideThread=\"none\"==t.conversation||\"hidden\"==t.conversation)}),r.apply(this,arguments)});t.exports={createTweet:a,createTweetEmbed:a,createVideo:a}},function(t,e,n){var r=n(0),i=n(69),o=n(17),s=o([\"url\"],{type:\"share\"},i),a=o([\"buttonHashtag\"],{type:\"hashtag\"},i),u=o([\"screenName\"],{type:\"mention\"},i);function c(t){return function(){return r.toRealArray(arguments).slice(1).forEach(function(t){r.isType(\"object\",t)&&(t.screenName=t.screenName||t.screen_name,t.buttonHashtag=t.buttonHashtag||t.button_hashtag||t.hashtag)}),t.apply(this,arguments)}}t.exports={createShareButton:c(s),createHashtagButton:c(a),createMentionButton:c(u)}},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=0,c=[],d=s.createElement(\"a\");function f(){var t,e;for(u=1,t=0,e=c.length;t<e;t++)c[t]()}/^loade|c/.test(s.readyState)&&(u=1),s.addEventListener&&s.addEventListener(\"DOMContentLoaded\",i=function(){s.removeEventListener(\"DOMContentLoaded\",i,!1),f()},!1),d.doScroll&&s.attachEvent(\"onreadystatechange\",r=function(){/^c/.test(s.readyState)&&(s.detachEvent(\"onreadystatechange\",r),f())}),o=d.doScroll?function(t){a.self!=a.top?u?t():c.push(t):function(){try{d.doScroll(\"left\")}catch(e){return setTimeout(function(){o(t)},50)}t()}()}:function(t){u?t():c.push(t)},t.exports=o},function(t,e,n){var r=n(47),i=n(9);t.exports=function(){i.set(\"buildVersion\",r.version)}},function(t,e,n){n(168),n(87),n(171)},function(t,e,n){var r=n(169),i=n(30),o=n(70),s=new r,a=function(t){t.widgets&&1===t.widgets.length&&(s.start(),i.emitter.unbind(i.ALL_WIDGETS_RENDER_START,a))},u=function(t){var e;t.widgets&&1===t.widgets.length&&(e=t.widgets[0],s.end(),e.dataset&&e.dataset.tweetId&&o({duration:s.duration(),namespace:{element:\"tweet\",action:\"render\"},widgetIds:[e.dataset.tweetId]})),i.emitter.unbind(i.ALL_WIDGETS_RENDER_END,u)};i.emitter.bind(i.ALL_WIDGETS_RENDER_START,a),i.emitter.bind(i.ALL_WIDGETS_RENDER_END,u)},function(t,e,n){var r=n(170);function i(){}i.prototype.start=function(){this._startTime=r()},i.prototype.end=function(){this._duration=r()-this._startTime},i.prototype.duration=function(){return this._duration},t.exports=i},function(t,e,n){var r=n(1);t.exports=function(){return r.performance&&r.performance.now?r.performance.now():Date.now()}},function(t,e,n){var r=n(30),i=n(70),o=n(172),s=n(3),a=n(1),u=n(0),c=n(22),d=n(61);function f(t){return t.performance.getEntriesByType(\"resource\").filter(function(t){return s.isTwimgURL(t.name)||s.isTwitterURL(t.name)}).reduce(function(t,e){return t[e.name]=e.duration,t},{})}r.emitter.bind(r.ALL_WIDGETS_AND_IMAGES_LOADED,function(t){var e,n,r=[];c.hasPerformanceInformation()&&(e=f(a),d.isSupported()||(r=function(t){return t.reduce(function(t,e){return u.aug(t,f(e.contentDocument.defaultView))},{})}(t)),n=u.aug({},e,r),Object.keys(o).forEach(function(t){!function(t,e,n){var r=Object.keys(t).reduce(function(e,r){return n(r)?e+t[r]:e},0);i({duration:r,namespace:{element:e,action:\"resource\"}})}(n,t,o[t])}))})},function(t,e,n){var r=n(3),i={all:function(){return!0},image:function(t){return r.isTwimgURL(t)},settings:function(t){return r.isSettingsURL(t)},widget_iframe:function(t){return r.isWidgetIframeURL(t)}};t.exports=i}])));Also, Talha Oz, a PhD student at George Mason University, tweeted a brief report using data compiled from a government website (https://www.turkiye.gov.tr/):\r\n\r\n\r\nHow can we know about the death toll from #coronavirus and fact-check the governments? Here is an idea, a dataset, and some interesting results from an early study on Turkey. https://t.co/xDck4OAO5B pic.twitter.com/TH0ApLEZXE\r\n\r\n— Talha Oz (@tozCSS) March 23, 2020\r\n\r\nFunction&&Function.prototype&&Function.prototype.bind&&(/(MSIE ([6789]|10|11))|Trident/.test(navigator.userAgent)||(window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.loaded&&window.twttr.widgets.load&&window.twttr.widgets.load(),window.__twttr&&window.__twttr.widgets&&window.__twttr.widgets.init||function(t){function e(e){for(var n,i,o=e[0],s=e[1],a=0,c=[];a<o.length;a++)i=o[a],r[i]&&c.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(u&&u(e);c.length;)c.shift()()}var n={},r={1:0};function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var o=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=o);var s,a=document.getElementsByTagName(\"head\")[0],u=document.createElement(\"script\");u.charset=\"utf-8\",u.timeout=120,i.nc&&u.setAttribute(\"nonce\",i.nc),u.src=function(t){return i.p+\"js/\"+({0:\"moment~timeline~tweet\",2:\"dm_button\",3:\"button\",4:\"moment\",5:\"periscope_on_air\",6:\"timeline\",7:\"horizon_tweet\",8:\"tweet\"}[t]||t)+\".\"+{0:\"99ce5e0e4617985354c5c426d7e1b9f4\",2:\"aafdbac8c0ca30b0345ffadfb46abaae\",3:\"93a0c25c2d2f3081c705c98c2d9dec0e\",4:\"70d46e46bb6e5d32428d274e29d33a7a\",5:\"a924982376e532afeee4636c794ea5da\",6:\"d228dcf3573461f298b082c9a5c0a42c\",7:\"77381373f964eee9b43728b3d43d642f\",8:\"9aa9eda3c163ec539c16aef0d822d807\"}[t]+\".js\"}(t),s=function(e){u.onerror=u.onload=null,clearTimeout(c);var n=r[t];if(0!==n){if(n){var i=e&&(\"load\"===e.type?\"missing\":e.type),o=e&&e.target&&e.target.src,s=new Error(\"Loading chunk \"+t+\" failed.\\n(\"+i+\": \"+o+\")\");s.type=i,s.request=o,n[1](s)}r[t]=void 0}};var c=setTimeout(function(){s({type:\"timeout\",target:u})},12e4);u.onerror=u.onload=s,a.appendChild(u)}return Promise.all(e)},i.m=t,i.c=n,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"https://platform.twitter.com/\",i.oe=function(t){throw console.error(t),t};var o=window.__twttrll=window.__twttrll||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var a=0;a<o.length;a++)e(o[a]);var u=s;i(i.s=96)}([function(t,e,n){var r=n(1);function i(t,e){var n;for(n in t)t.hasOwnProperty&&!t.hasOwnProperty(n)||e(n,t[n]);return t}function o(t){return{}.toString.call(t).match(/\\s([a-zA-Z]+)/)[1].toLowerCase()}function s(t){return t===Object(t)}function a(t){var e;if(!s(t))return!1;if(Object.keys)return!Object.keys(t).length;for(e in t)if(t.hasOwnProperty(e))return!1;return!0}function u(t){return t?Array.prototype.slice.call(t):[]}t.exports={aug:function(t){return u(arguments).slice(1).forEach(function(e){i(e,function(e,n){t[e]=n})}),t},async:function(t,e){r.setTimeout(function(){t.call(e||null)},0)},compact:function t(e){return i(e,function(n,r){s(r)&&(t(r),a(r)&&delete e[n]),void 0!==r&&null!==r&&\"\"!==r||delete e[n]}),e},contains:function(t,e){return!(!t||!t.indexOf)&&t.indexOf(e)>-1},forIn:i,isObject:s,isEmptyObject:a,toType:o,isType:function(t,e){return t==o(e)},toRealArray:u}},function(t,e){t.exports=window},function(t,e,n){var r=n(6);t.exports=function(){var t=this;this.promise=new r(function(e,n){t.resolve=e,t.reject=n})}},function(t,e,n){var r=n(11),i=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?(?:\\/intent\\/(?:follow|user)\\/?\\?screen_name=|(?:\\/#!)?\\/))@?([\\w]+)(?:\\?|&|$)/i,o=/(?:^|(?:https?:)?\\/\\/(?:www\\.)?twitter\\.com(?::\\d+)?\\/(?:#!\\/)?[\\w_]+\\/status(?:es)?\\/)(\\d+)/i,s=/^http(s?):\\/\\/(\\w+\\.)*twitter\\.com([:/]|$)/i,a=/^http(s?):\\/\\/(ton|pbs)\\.twimg\\.com/,u=/^#?([^.,<>!\\s/#\\-()'\"]+)$/,c=/twitter\\.com(?::\\d{2,4})?\\/intent\\/(\\w+)/,d=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/\\w+\\/timelines\\/(\\d+)/i,f=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/moments\\/(\\d+)/i,l=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/(?:likes|favorites)/i,h=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/(\\w+)\\/lists\\/([\\w-%]+)/i,p=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/i\\/live\\/(\\d+)/i,m=/^https?:\\/\\/syndication\\.twitter\\.com\\/settings/i,v=/^https?:\\/\\/(localhost|platform)\\.twitter\\.com(?::\\d+)?\\/widgets\\/widget_iframe\\.(.+)/i,g=/^https?:\\/\\/(?:www\\.)?twitter\\.com\\/search\\?q=(\\w+)/i;function w(t){return\"string\"==typeof t&&i.test(t)&&RegExp.$1.length<=20}function y(t){if(w(t))return RegExp.$1}function b(t,e){var n=r.decodeURL(t);if(e=e||!1,n.screen_name=y(t),n.screen_name)return r.url(\"https://twitter.com/intent/\"+(e?\"follow\":\"user\"),n)}function _(t){return\"string\"==typeof t&&u.test(t)}function E(t){return\"string\"==typeof t&&o.test(t)}t.exports={isHashTag:_,hashTag:function(t,e){if(e=void 0===e||e,_(t))return(e?\"#\":\"\")+RegExp.$1},isScreenName:w,screenName:y,isStatus:E,status:function(t){return E(t)&&RegExp.$1},intentForProfileURL:b,intentForFollowURL:function(t){return b(t,!0)},isTwitterURL:function(t){return s.test(t)},isTwimgURL:function(t){return a.test(t)},isIntentURL:function(t){return c.test(t)},isSettingsURL:function(t){return m.test(t)},isWidgetIframeURL:function(t){return v.test(t)},isSearchUrl:function(t){return g.test(t)},regexen:{profile:i},momentId:function(t){return f.test(t)&&RegExp.$1},collectionId:function(t){return d.test(t)&&RegExp.$1},intentType:function(t){return c.test(t)&&RegExp.$1},likesScreenName:function(t){return l.test(t)&&RegExp.$1},listScreenNameAndSlug:function(t){var e,n,r;if(h.test(t)){e=RegExp.$1,n=RegExp.$2;try{r=decodeURIComponent(n)}catch(t){}return{ownerScreenName:e,slug:r||n}}return!1},eventId:function(t){return p.test(t)&&RegExp.$1}}},function(t,e){t.exports=document},function(t,e,n){var r=n(0),i=[!0,1,\"1\",\"on\",\"ON\",\"true\",\"TRUE\",\"yes\",\"YES\"],o=[!1,0,\"0\",\"off\",\"OFF\",\"false\",\"FALSE\",\"no\",\"NO\"];function s(t){return void 0!==t&&null!==t&&\"\"!==t}function a(t){return c(t)&&t%1==0}function u(t){return c(t)&&!a(t)}function c(t){return s(t)&&!isNaN(t)}function d(t){return r.contains(o,t)}function f(t){return r.contains(i,t)}t.exports={hasValue:s,isInt:a,isFloat:u,isNumber:c,isString:function(t){return\"string\"===r.toType(t)},isArray:function(t){return s(t)&&\"array\"==r.toType(t)},isTruthValue:f,isFalseValue:d,asInt:function(t){if(a(t))return parseInt(t,10)},asFloat:function(t){if(u(t))return t},asNumber:function(t){if(c(t))return t},asBoolean:function(t){return!(!s(t)||!f(t)&&(d(t)||!t))}}},function(t,e,n){var r=n(1),i=n(22),o=n(48);i.hasPromiseSupport()||(r.Promise=o),t.exports=r.Promise},function(t,e,n){var r=n(0);t.exports=function(t,e){var n=Array.prototype.slice.call(arguments,2);return function(){var i=r.toRealArray(arguments);return t.apply(e,n.concat(i))}}},function(t,e){t.exports=location},function(t,e,n){var r=n(50);t.exports=new r(\"__twttr\")},function(t,e,n){var r=n(0),i=/\\b([\\w-_]+)\\b/g;function o(t){return new RegExp(\"\\\\b\"+t+\"\\\\b\",\"g\")}function s(t,e){t.classList?t.classList.add(e):o(e).test(t.className)||(t.className+=\" \"+e)}function a(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(o(e),\" \")}function u(t,e){return t.classList?t.classList.contains(e):r.contains(c(t),e)}function c(t){return r.toRealArray(t.classList?t.classList:t.className.match(i))}t.exports={add:s,remove:a,replace:function(t,e,n){if(t.classList&&u(t,e))return a(t,e),void s(t,n);t.className=t.className.replace(o(e),n)},toggle:function(t,e,n){return void 0===n&&t.classList&&t.classList.toggle?t.classList.toggle(e,n):(n?s(t,e):a(t,e),n)},present:u,list:c}},function(t,e,n){var r=n(5),i=n(0);function o(t){return encodeURIComponent(t).replace(/\\+/g,\"%2B\").replace(/'/g,\"%27\")}function s(t){return decodeURIComponent(t)}function a(t){var e=[];return i.forIn(t,function(t,n){var s=o(t);i.isType(\"array\",n)||(n=[n]),n.forEach(function(t){r.hasValue(t)&&e.push(s+\"=\"+o(t))})}),e.sort().join(\"&\")}function u(t){var e={};return t?(t.split(\"&\").forEach(function(t){var n=t.split(\"=\"),r=s(n[0]),o=s(n[1]);if(2==n.length){if(!i.isType(\"array\",e[r]))return r in e?(e[r]=[e[r]],void e[r].push(o)):void(e[r]=o);e[r].push(o)}}),e):{}}t.exports={url:function(t,e){return a(e).length>0?i.contains(t,\"?\")?t+\"&\"+a(e):t+\"?\"+a(e):t},decodeURL:function(t){var e=t&&t.split(\"?\");return 2==e.length?u(e[1]):{}},decode:u,encode:a,encodePart:o,decodePart:s}},function(t,e,n){var r=n(8),i=n(1),o=n(0),s={},a=o.contains(r.href,\"tw_debug=true\");function u(){}function c(){}function d(){return i.performance&&+i.performance.now()||+new Date}function f(t,e){if(i.console&&i.console[t])switch(e.length){case 1:i.console[t](e[0]);break;case 2:i.console[t](e[0],e[1]);break;case 3:i.console[t](e[0],e[1],e[2]);break;case 4:i.console[t](e[0],e[1],e[2],e[3]);break;case 5:i.console[t](e[0],e[1],e[2],e[3],e[4]);break;default:0!==e.length&&i.console.warn&&i.console.warn(\"too many params passed to logger.\"+t)}}t.exports={devError:u,devInfo:c,devObject:function(t,e){},publicError:function(){f(\"error\",o.toRealArray(arguments))},publicLog:function(){f(\"info\",o.toRealArray(arguments))},time:function(t){a&&(s[t]=d())},timeEnd:function(t){a&&s[t]&&(d(),s[t])}}},function(t,e,n){var r=n(20),i=n(5),o=n(11),s=n(0),a=n(121);t.exports=function(t){var e=t.href&&t.href.split(\"?\")[1],n=e?o.decode(e):{},u={lang:a(t),width:t.getAttribute(\"data-width\")||t.getAttribute(\"width\"),height:t.getAttribute(\"data-height\")||t.getAttribute(\"height\"),related:t.getAttribute(\"data-related\"),partner:t.getAttribute(\"data-partner\")};return i.asBoolean(t.getAttribute(\"data-dnt\"))&&r.setOn(),s.forIn(u,function(t,e){var r=n[t];n[t]=i.hasValue(r)?r:e}),s.compact(n)}},function(t,e,n){var r=n(82),i=n(24);t.exports=function(){var t=\"data-twitter-extracted-\"+i.generate();return function(e,n){return r(e,n).filter(function(e){return!e.hasAttribute(t)}).map(function(e){return e.setAttribute(t,\"true\"),e})}}},function(t,e){function n(t,e,n,r,i,o,s){this.factory=t,this.Sandbox=e,this.srcEl=o,this.targetEl=i,this.parameters=r,this.className=n,this.options=s}n.prototype.destroy=function(){this.srcEl=this.targetEl=null},t.exports=n},function(t,e){t.exports={DM_BUTTON:\"twitter-dm-button\",FOLLOW_BUTTON:\"twitter-follow-button\",HASHTAG_BUTTON:\"twitter-hashtag-button\",MENTION_BUTTON:\"twitter-mention-button\",MOMENT:\"twitter-moment\",PERISCOPE:\"periscope-on-air\",SHARE_BUTTON:\"twitter-share-button\",TIMELINE:\"twitter-timeline\",TWEET:\"twitter-tweet\"}},function(t,e,n){var r=n(6),i=n(20),o=n(52),s=n(31),a=n(5),u=n(0);t.exports=function(t,e,n){var c;return t=t||[],e=e||{},c=\"ƒ(\"+t.join(\", \")+\", target, [options]);\",function(){var d,f,l,h,p=Array.prototype.slice.apply(arguments,[0,t.length]),m=Array.prototype.slice.apply(arguments,[t.length]);return m.forEach(function(t){t&&(t.nodeType!==Node.ELEMENT_NODE?u.isType(\"function\",t)?d=t:u.isType(\"object\",t)&&(f=t):l=t)}),p.length!==t.length||0===m.length?(d&&u.async(function(){d(!1)}),r.reject(new Error(\"Not enough parameters. Expected: \"+c))):l?(f=u.aug({},f||{},e),t.forEach(function(t){f[t]=p.shift()}),a.asBoolean(f.dnt)&&i.setOn(),h=s.getExperiments().then(function(t){return o.addWidget(n(f,l,void 0,t))}),d&&h.then(d,function(){d(!1)}),h):(d&&u.async(function(){d(!1)}),r.reject(new Error(\"No target element specified. Expected: \"+c)))}}},function(t,e,n){var r=n(104),i=n(2),o=n(0);function s(t,e){return function(){try{e.resolve(t.call(this))}catch(t){e.reject(t)}}}t.exports={sync:function(t,e){t.call(e)},read:function(t,e){var n=new i;return r.read(s(t,n),e),n.promise},write:function(t,e){var n=new i;return r.write(s(t,n),e),n.promise},defer:function(t,e,n){var a=new i;return o.isType(\"function\",t)&&(n=e,e=t,t=1),r.defer(t,s(e,a),n),a.promise}}},function(t,e,n){var r=n(9),i=[\"https://syndication.twitter.com\",\"https://cdn.syndication.twimg.com\",\"https://localhost.twitter.com:8444\"],o=[\"https://syndication.twitter.com\",\"https://localhost.twitter.com:8445\"],s=[\"https://platform.twitter.com/embed/index.html\",\"https://localhost.twitter.com\",/https:\\/\\/ton\\.smf1\\.twitter\\.com\\/syndication-internal\\/embed-iframe\\/[0-9A-Za-z_-]+\\/app\\/index\\.html/],a=function(t,e){return t.some(function(t){return t instanceof RegExp?t.test(e):t===e})},u=function(){var t=r.get(\"backendHost\");return t&&a(i,t)?t:\"https://cdn.syndication.twimg.com\"},c=function(){var t=r.get(\"settingsSvcHost\");return t&&a(o,t)?t:\"https://syndication.twitter.com\"},d=function(){var t=r.get(\"embedIframeURL\");return t&&a(s,t)?t:\"https://platform.twitter.com/embed/index.html\"};function f(t,e){var n=[t];return e.forEach(function(t){n.push(function(t){var e=(t||\"\").toString(),n=\"/\"===e.slice(0,1)?1:0,r=function(t){return\"/\"===t.slice(-1)}(e)?-1:void 0;return e.slice(n,r)}(t))}),n.join(\"/\")}t.exports={cookieConsent:function(t){var e=t||[];return e.unshift(\"cookie/consent\"),f(c(),e)},embedIframe:function(){return d()},eventVideo:function(t){var e=t||[];return e.unshift(\"video/event\"),f(u(),e)},grid:function(t){var e=t||[];return e.unshift(\"grid/collection\"),f(u(),e)},moment:function(t){var e=t||[];return e.unshift(\"moments\"),f(u(),e)},settings:function(t){var e=t||[];return e.unshift(\"settings\"),f(c(),e)},timeline:function(t){var e=t||[];return e.unshift(\"timeline\"),f(u(),e)},tweetBatch:function(t){var e=t||[];return e.unshift(\"tweets.json\"),f(u(),e)},video:function(t){var e=t||[];return e.unshift(\"widgets/video\"),f(u(),e)}}},function(t,e,n){var r=n(4),i=n(8),o=n(39),s=n(80),a=n(5),u=n(35),c=!1,d=/https?:\\/\\/([^/]+).*/i;t.exports={setOn:function(){c=!0},enabled:function(t,e){return!!(c||a.asBoolean(u.val(\"dnt\"))||s.isUrlSensitive(e||i.host)||o.isFramed()&&s.isUrlSensitive(o.rootDocumentLocation())||(t=d.test(t||r.referrer)&&RegExp.$1)&&s.isUrlSensitive(t))}}},function(t,e,n){var r=n(47),i=n(4),o=n(20),s=n(34),a=n(72),u=n(33),c=n(9),d=n(3),f=n(0),l=1,h=r.version,p=c.get(\"clientEventEndpoint\")||\"https://syndication.twitter.com/i/jot\";function m(t){return f.aug({client:\"tfw\"},t||{})}function v(t,e,n){return e=e||{},f.aug({},e,{_category_:t,triggered_on:e.triggered_on||+new Date,dnt:o.enabled(n)})}t.exports={extractTermsFromDOM:function t(e,n){var r;return n=n||{},e&&e.nodeType===Node.ELEMENT_NODE?((r=e.getAttribute(\"data-scribe\"))&&r.split(\" \").forEach(function(t){var e=t.trim().split(\":\"),r=e[0],i=e[1];r&&i&&!n[r]&&(n[r]=i)}),t(e.parentNode,n)):n},clickEventElement:function(t){var e=s.closest(\"[data-expanded-url]\",t),n=e&&e.getAttribute(\"data-expanded-url\");return n&&d.isTwitterURL(n)?\"twitter_url\":\"url\"},flattenClientEventPayload:function(t,e){return f.aug({},e,{event_namespace:t})},formatGenericEventData:v,formatClientEventData:function(t,e,n){var r=t&&t.widget_origin||i.referrer;return(t=v(\"tfw_client_event\",t,r)).client_version=h,t.format_version=void 0!==n?n:1,e||(t.widget_origin=r),t},formatClientEventNamespace:m,formatHorizonTweetData:function(t){var e={item_ids:[],item_details:{}};return e.item_ids.push(t),e.item_details[t]={item_type:a.TWEET},e},formatTweetAssociation:function(t,e){var n={};return(e=e||{}).association_namespace=m(t),n[l]=e,n},noticeSeen:function(t){return\"notice\"===t.element&&\"seen\"===t.action},splitLogEntry:function(t){var e,n,r,i,o;return t.item_ids&&t.item_ids.length>1?(e=Math.floor(t.item_ids.length/2),n=t.item_ids.slice(0,e),r={},i=t.item_ids.slice(e),o={},n.forEach(function(e){r[e]=t.item_details[e]}),i.forEach(function(e){o[e]=t.item_details[e]}),[f.aug({},t,{item_ids:n,item_details:r}),f.aug({},t,{item_ids:i,item_details:o})]):[t]},stringify:function(t){var e,n=Array.prototype.toJSON;return delete Array.prototype.toJSON,e=u.stringify(t),n&&(Array.prototype.toJSON=n),e},AUDIENCE_ENDPOINT:\"https://syndication.twitter.com/i/jot/syndication\",CLIENT_EVENT_ENDPOINT:p,RUFOUS_REDIRECT:\"https://platform.twitter.com/jot.html\"}},function(t,e,n){var r=n(4),i=n(12),o=n(97),s=n(1),a=n(0),u=o.userAgent;function c(t){return/(Trident|MSIE|Edge[/ ]?\\d)/.test(t=t||u)}t.exports={retina:function(t){return(t=t||s).devicePixelRatio?t.devicePixelRatio>=1.5:!!t.matchMedia&&t.matchMedia(\"only screen and (min-resolution: 144dpi)\").matches},anyIE:c,ie9:function(t){return/MSIE 9/.test(t=t||u)},ie10:function(t){return/MSIE 10/.test(t=t||u)},ios:function(t){return/(iPad|iPhone|iPod)/.test(t=t||u)},android:function(t){return/^Mozilla\\/5\\.0 \\(Linux; (U; )?Android/.test(t=t||u)},canPostMessage:function(t,e){return t=t||s,e=e||u,t.postMessage&&!(c(e)&&t.opener)},touch:function(t,e,n){return t=t||s,e=e||o,n=n||u,\"ontouchstart\"in t||/Opera Mini/.test(n)||e.msMaxTouchPoints>0},cssTransitions:function(){var t=r.body.style;return void 0!==t.transition||void 0!==t.webkitTransition||void 0!==t.mozTransition||void 0!==t.oTransition||void 0!==t.msTransition},hasPromiseSupport:function(){return!!(s.Promise&&s.Promise.resolve&&s.Promise.reject&&s.Promise.all&&s.Promise.race&&(new s.Promise(function(e){t=e}),a.isType(\"function\",t)));var t},hasIntersectionObserverSupport:function(){return!!s.IntersectionObserver},hasPerformanceInformation:function(){return s.performance&&s.performance.getEntriesByType},hasLocalStorageSupport:function(){try{return s.localStorage.setItem(\"local_storage_support_test\",\"true\"),void 0!==s.localStorage}catch(t){return i.devError(\"window.localStorage is not supported:\",t),!1}}}},function(t,e,n){var r=n(6),i=n(2);function o(t,e){return t.then(e,e)}function s(t){return t instanceof r}t.exports={always:o,allResolved:function(t){var e;return void 0===t?r.reject(new Error(\"undefined is not an object\")):Array.isArray(t)?(e=t.length)?new r(function(n,r){var i=0,o=[];function a(){(i+=1)===e&&(0===o.length?r():n(o))}function u(t){o.push(t),a()}t.forEach(function(t){s(t)?t.then(u,a):u(t)})}):r.resolve([]):r.reject(new Error(\"Type error\"))},some:function(t){var e;return e=(t=t||[]).length,t=t.filter(s),e?e!==t.length?r.reject(\"non-Promise passed to .some\"):new r(function(e,n){var r=0;function i(){(r+=1)===t.length&&n()}t.forEach(function(t){t.then(e,i)})}):r.reject(\"no promises passed to .some\")},isPromise:s,allSettled:function(t){function e(){}return r.all((t||[]).map(function(t){return o(t,e)}))},timeout:function(t,e){var n=new i;return setTimeout(function(){n.reject(new Error(\"Promise timed out\"))},e),t.then(function(t){n.resolve(t)},function(t){n.reject(t)}),n.promise}}},function(t,e){var n=\"i\",r=0,i=0;t.exports={generate:function(){return n+String(+new Date)+Math.floor(1e5*Math.random())+r++},deterministic:function(){return n+String(i++)}}},function(t,e,n){var r=n(49),i=n(51),o=n(0);t.exports=o.aug(r.get(\"events\")||{},i.Emitter)},function(t,e,n){var r=n(27),i=n(112);t.exports=r.build([i])},function(t,e,n){var r=n(40),i=n(109),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(40),i=n(41),o=n(7);(r=Object.create(r)).build=o(r.build,null,i),t.exports=r},function(t,e,n){var r=n(84),i=n(76),o=n(85),s=n(8),a=n(71),u=n(75),c=n(20),d=n(5),f=n(24),l=n(0);function h(t){if(!t||!t.headers)throw new Error(\"unexpected response schema\");return{html:t.body,config:t.config,pollInterval:1e3*parseInt(t.headers.xPolling,10)||null,maxCursorPosition:t.headers.maxPosition,minCursorPosition:t.headers.minPosition}}function p(t){if(t&&t.headers)throw new Error(t.headers.status);throw t instanceof Error?t:new Error(t)}t.exports=function(t){t.params({instanceId:{required:!0,fallback:f.deterministic},lang:{required:!0,transform:a.matchLanguage,fallback:\"en\"},tweetLimit:{transform:d.asInt}}),t.defineProperty(\"endpoint\",{get:function(){throw new Error(\"endpoint not specified\")}}),t.defineProperty(\"pollEndpoint\",{get:function(){return this.endpoint}}),t.define(\"cbId\",function(t){var e=t?\"_new\":\"_old\";return\"tl_\"+this.params.instanceId+\"_\"+this.id+e}),t.define(\"queryParams\",function(){return{lang:this.params.lang,tz:u.getTimezoneOffset(),t:r(),domain:s.host,tweet_limit:this.params.tweetLimit,dnt:c.enabled()}}),t.define(\"fetch\",function(){return i.fetch(this.endpoint,this.queryParams(),o,this.cbId()).then(h,p)}),t.define(\"poll\",function(t,e){var n,r;return n={since_id:(t=t||{}).sinceId,max_id:t.maxId,min_position:t.minPosition,max_position:t.maxPosition},r=l.aug(this.queryParams(),n),i.fetch(this.pollEndpoint,r,o,this.cbId(e)).then(h,p)})}},function(t,e,n){var r=n(51).makeEmitter();t.exports={emitter:r,START:\"start\",ALL_WIDGETS_RENDER_START:\"all_widgets_render_start\",ALL_WIDGETS_RENDER_END:\"all_widgets_render_end\",ALL_WIDGETS_AND_IMAGES_LOADED:\"all_widgets_and_images_loaded\"}},function(t,e,n){var r=n(115),i=n(118);function o(t){return r.settingsLoaded().then(function(e){return e[t]})}function s(){return o(\"experiments\")}t.exports={shouldObtainCookieConsent:function(){return o(\"shouldObtainCookieConsent\")},getExperiments:s,getExperiment:function(t){return s().then(function(e){if(!e[t])throw new Error(\"Experiment not found\");return e[t]})},getActiveExperimentDataString:function(){return s().then(function(t){var e=Object.keys(t).reduce(function(e,n){var r;return t[n].version&&(r=n.split(\"_\").slice(-1)[0],e.push(r+\";\"+t[n].bucket)),e},[]);return i(e.join(\",\"))})},getExperimentKeys:function(){return s().then(function(t){return Object.keys(t)})},load:function(){r.load()}}},function(t,e,n){var r=n(4),i=n(0);t.exports=function(t,e,n){var o;if(n=n||r,t=t||{},e=e||{},t.name){try{o=n.createElement('<iframe name=\"'+t.name+'\"><\/iframe>')}catch(e){(o=n.createElement(\"iframe\")).name=t.name}delete t.name}else o=n.createElement(\"iframe\");return t.id&&(o.id=t.id,delete t.id),o.allowtransparency=\"true\",o.scrolling=\"no\",o.setAttribute(\"frameBorder\",0),o.setAttribute(\"allowTransparency\",!0),i.forIn(t,function(t,e){o.setAttribute(t,e)}),i.forIn(e,function(t,e){o.style[t]=e}),o}},function(t,e,n){var r=n(1).JSON;t.exports={stringify:r.stringify||r.encode,parse:r.parse||r.decode}},function(t,e,n){var r=n(0),i=n(43);t.exports={closest:function t(e,n,o){var s;if(n)return o=o||n&&n.ownerDocument,s=r.isType(\"function\",e)?e:function(t){return function(e){return!!e.tagName&&i(e,t)}}(e),n===o?s(n)?n:void 0:s(n)?n:t(s,n.parentNode,o)}}},function(t,e,n){var r,i=n(4);function o(t){var e,n,o,s=0;for(r={},e=(t=t||i).getElementsByTagName(\"meta\");e[s];s++){if(n=e[s],/^twitter:/.test(n.getAttribute(\"name\")))o=n.getAttribute(\"name\").replace(/^twitter:/,\"\");else{if(!/^twitter:/.test(n.getAttribute(\"property\")))continue;o=n.getAttribute(\"property\").replace(/^twitter:/,\"\")}r[o]=n.getAttribute(\"content\")||n.getAttribute(\"value\")}}o(),t.exports={init:o,val:function(t){return r[t]}}},function(t,e,n){var r=n(10),i={},o=-1,s={};function a(t){var e=t.getAttribute(\"data-twitter-event-id\");return e||(t.setAttribute(\"data-twitter-event-id\",++o),o)}function u(t,e,n){var r=0,i=t&&t.length||0;for(r=0;r<i;r++)if(t[r].call(e,n,e),n.ceaseImmediately)return!1}function c(t,e,n){for(var i=n||t.target||t.srcElement,o=r.list(i).map(function(t){return\".\"+t}).concat(i.tagName),s=0,a=o.length;s<a;s++)if(!1===u(e[o[s]],i,t))return;t.cease||i!==this&&c.call(this,t,e,i.parentElement||i.parentNode)}function d(t,e,n,r){function i(r){c.call(t,r,n[e])}!function(t,e,n,r){t.id&&(s[t.id]=s[t.id]||[],s[t.id].push({el:t,listener:e,type:n,rootId:r}))}(t,i,e,r),t.addEventListener(e,i,!1)}function f(t){t&&t.preventDefault?t.preventDefault():t.returnValue=!1}function l(t){t&&(t.cease=!0)&&t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}t.exports={stop:function(t){return l(t),f(t),!1},stopPropagation:l,stopImmediatePropagation:function(t){t&&(t.ceaseImmediately=!0,l(t),t.stopImmediatePropagation())},preventDefault:f,delegate:function(t,e,n,r){var o=a(t);i[o]=i[o]||{},i[o][e]||(i[o][e]={},d(t,e,i[o],o)),i[o][e][n]=i[o][e][n]||[],i[o][e][n].push(r)},simulate:function(t,e,n){var r=a(e),o=i[r]&&i[r];c.call(e,{target:n},o[t])},removeDelegatesForWidget:function(t){var e=s[t];e&&(e.forEach(function(t){t.el.removeEventListener(t.type,t.listener,!1),delete i[t.rootId]}),delete s[t])}}},function(t,e,n){var r=n(78),i=n(106),o=n(81),s=n(21),a=new(n(114))(function(t){var e,n,a;if(0!==t.length){if(u(t))return c(t);e=r(t,function(t){return s.noticeSeen(t.input.namespace)}),n=e.true,a=e.false,n&&n.length>0&&(n=n.slice(0,1),o.canFlushOneItem(n[0])||(n[0].input.data.message=\"\"),c(n)),a&&(u(a)?c:function(t){i.init(),t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,o=t.input.version;i.clientEvent(e,n,r,o)}),i.flush().then(function(){t.forEach(function(t){t.taskDoneDeferred.resolve()})},function(){t.forEach(function(t){t.taskDoneDeferred.reject()})})})(a)}});function u(t){return 1===t.length&&o.canFlushOneItem(t[0])}function c(t){t.forEach(function(t){var e=t.input.namespace,n=t.input.data,r=t.input.offsite,i=t.input.version;o.clientEvent(e,n,r,i),t.taskDoneDeferred.resolve()})}t.exports={scribe:function(t,e,n,r){return a.add({namespace:t,data:e,offsite:n,version:r})},pause:function(){a.pause()},resume:function(){a.resume()}}},function(t,e,n){var r=n(27),i=n(127);t.exports=r.build([i])},function(t,e,n){var r=n(8),i=n(79),o=n(0),s=i.getCanonicalURL()||r.href,a=s;t.exports={isFramed:function(){return s!==a},rootDocumentLocation:function(t){return t&&o.isType(\"string\",t)&&(s=t),s},currentDocumentLocation:function(){return a}}},function(t,e,n){var r=n(107),i=n(108),o=n(0);t.exports={couple:function(){return o.toRealArray(arguments)},build:function(t,e,n){var o=new t;return(e=i(r(e||[]))).forEach(function(t){t.call(null,o)}),o.build(n)}}},function(t,e,n){var r=n(110),i=n(0),o=n(42);function s(){this.Component=this.factory(),this._adviceArgs=[],this._lastArgs=[]}i.aug(s.prototype,{factory:o,build:function(t){var e=this;return this.Component,i.aug(this.Component.prototype.boundParams,t),this._adviceArgs.concat(this._lastArgs).forEach(function(t){(function(t,e,n){var r=this[e];if(!r)throw new Error(e+\" does not exist\");this[e]=t(r,n)}).apply(e.Component.prototype,t)}),delete this._lastArgs,delete this._adviceArgs,this.Component},params:function(t){var e=this.Component.prototype.paramConfigs;t=t||{},this.Component.prototype.paramConfigs=i.aug({},t,e)},define:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.override(t,e)},defineStatic:function(t,e){this.Component[t]=e},override:function(t,e){this.Component.prototype[t]=e},defineProperty:function(t,e){if(t in this.Component.prototype)throw new Error(t+\" has previously been defined\");this.overrideProperty(t,e)},overrideProperty:function(t,e){var n=i.aug({configurable:!0},e);Object.defineProperty(this.Component.prototype,t,n)},before:function(t,e){this._adviceArgs.push([r.before,t,e])},after:function(t,e){this._adviceArgs.push([r.after,t,e])},around:function(t,e){this._adviceArgs.push([r.around,t,e])},last:function(t,e){this._lastArgs.push([r.after,t,e])}}),t.exports=s},function(t,e,n){var r=n(0);function i(){return!0}function o(t){return t}t.exports=function(){function t(t){var e=this;t=t||{},this.params=Object.keys(this.paramConfigs).reduce(function(n,s){var a=[],u=e.boundParams,c=e.paramConfigs[s],d=c.validate||i,f=c.transform||o;if(s in u&&a.push(u[s]),s in t&&a.push(t[s]),a=\"fallback\"in c?a.concat(c.fallback):a,n[s]=function(t,e,n){var i=null;return t.some(function(t){if(t=r.isType(\"function\",t)?t():t,e(t))return i=n(t),!0}),i}(a,d,f),c.required&&null==n[s])throw new Error(s+\" is a required parameter\");return n},{}),this.initialize()}return r.aug(t.prototype,{paramConfigs:{},boundParams:{},initialize:function(){}}),t}},function(t,e,n){var r=n(1).HTMLElement,i=r.prototype.matches||r.prototype.matchesSelector||r.prototype.webkitMatchesSelector||r.prototype.mozMatchesSelector||r.prototype.msMatchesSelector||r.prototype.oMatchesSelector;t.exports=function(t,e){if(i)return i.call(t,e)}},function(t,e,n){var r,i=n(10),o=n(4),s=n(1),a=n(35),u=n(53),c=n(5),d=n(24),f=\"csptest\";t.exports={inlineStyle:function(){var t=f+d.generate(),e=o.createElement(\"div\"),n=o.createElement(\"style\"),l=\".\"+t+\" { visibility: hidden; }\";return!!o.body&&(c.asBoolean(a.val(\"widgets:csp\"))&&(r=!1),void 0!==r?r:(e.style.display=\"none\",i.add(e,t),n.type=\"text/css\",n.appendChild(o.createTextNode(l)),o.body.appendChild(n),o.body.appendChild(e),r=\"hidden\"===s.getComputedStyle(e).visibility,u(e),u(n),r))}}},function(t,e,n){var r=n(1);t.exports=function(t,e,n){var i,o=0;return n=n||null,function s(){var a=n||this,u=arguments,c=+new Date;if(r.clearTimeout(i),c-o>e)return o=c,void t.apply(a,u);i=r.setTimeout(function(){s.apply(a,u)},e)}}},function(t,e){t.exports=function(t){var e=t.getBoundingClientRect();return{width:e.width,height:e.height}}},function(t){t.exports={version:\"5c0e8d3:1584649541982\"}},function(t,e,n){\r\n/*!\r\n * @overview es6-promise - a tiny implementation of Promises/A+.\r\n * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)\r\n * @license   Licensed under MIT license\r\n *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE\r\n * @version   v4.2.5+7f2b526d\r\n */var r;r=function(){\"use strict\";function t(t){return\"function\"==typeof t}var e=Array.isArray?Array.isArray:function(t){return\"[object Array]\"===Object.prototype.toString.call(t)},n=0,r=void 0,i=void 0,o=function(t,e){l[n]=t,l[n+1]=e,2===(n+=2)&&(i?i(h):w())},s=\"undefined\"!=typeof window?window:void 0,a=s||{},u=a.MutationObserver||a.WebKitMutationObserver,c=\"undefined\"==typeof self&&\"undefined\"!=typeof process&&\"[object process]\"==={}.toString.call(process),d=\"undefined\"!=typeof Uint8ClampedArray&&\"undefined\"!=typeof importScripts&&\"undefined\"!=typeof MessageChannel;function f(){var t=setTimeout;return function(){return t(h,1)}}var l=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,l[t])(l[t+1]),l[t]=void 0,l[t+1]=void 0;n=0}var p,m,v,g,w=void 0;function y(t,e){var n=this,r=new this.constructor(E);void 0===r[_]&&k(r);var i=n._state;if(i){var s=arguments[i-1];o(function(){return D(i,r,s,n._result)})}else j(n,r,t,e);return r}function b(t){if(t&&\"object\"==typeof t&&t.constructor===this)return t;var e=new this(E);return C(e,t),e}c?w=function(){return process.nextTick(h)}:u?(m=0,v=new u(h),g=document.createTextNode(\"\"),v.observe(g,{characterData:!0}),w=function(){g.data=m=++m%2}):d?((p=new MessageChannel).port1.onmessage=h,w=function(){return p.port2.postMessage(0)}):w=void 0===s?function(){try{var t=Function(\"return this\")().require(\"vertx\");return void 0!==(r=t.runOnLoop||t.runOnContext)?function(){r(h)}:f()}catch(t){return f()}}():f();var _=Math.random().toString(36).substring(2);function E(){}var x=void 0,T=1,A=2,S={error:null};function R(t){try{return t.then}catch(t){return S.error=t,S}}function N(e,n,r){n.constructor===e.constructor&&r===y&&n.constructor.resolve===b?function(t,e){e._state===T?L(t,e._result):e._state===A?I(t,e._result):j(e,void 0,function(e){return C(t,e)},function(e){return I(t,e)})}(e,n):r===S?(I(e,S.error),S.error=null):void 0===r?L(e,n):t(r)?function(t,e,n){o(function(t){var r=!1,i=function(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}(n,e,function(n){r||(r=!0,e!==n?C(t,n):L(t,n))},function(e){r||(r=!0,I(t,e))},t._label);!r&&i&&(r=!0,I(t,i))},t)}(e,n,r):L(e,n)}function C(t,e){var n,r;t===e?I(t,new TypeError(\"You cannot resolve a promise with itself\")):(r=typeof(n=e),null===n||\"object\"!==r&&\"function\"!==r?L(t,e):N(t,e,R(e)))}function P(t){t._onerror&&t._onerror(t._result),O(t)}function L(t,e){t._state===x&&(t._result=e,t._state=T,0!==t._subscribers.length&&o(O,t))}function I(t,e){t._state===x&&(t._state=A,t._result=e,o(P,t))}function j(t,e,n,r){var i=t._subscribers,s=i.length;t._onerror=null,i[s]=e,i[s+T]=n,i[s+A]=r,0===s&&t._state&&o(O,t)}function O(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,i=void 0,o=t._result,s=0;s<e.length;s+=3)r=e[s],i=e[s+n],r?D(n,r,i,o):i(o);t._subscribers.length=0}}function D(e,n,r,i){var o=t(r),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if((s=function(t,e){try{return t(e)}catch(t){return S.error=t,S}}(r,i))===S?(c=!0,a=s.error,s.error=null):u=!0,n===s)return void I(n,new TypeError(\"A promises callback cannot return that same promise.\"))}else s=i,u=!0;n._state!==x||(o&&u?C(n,s):c?I(n,a):e===T?L(n,s):e===A&&I(n,s))}var z=0;function k(t){t[_]=z++,t._state=void 0,t._result=void 0,t._subscribers=[]}var M=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[_]||k(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?L(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&L(this.promise,this._result))):I(this.promise,new Error(\"Array Methods must be provided an Array\"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===x&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===b){var i=R(t);if(i===y&&t._state!==x)this._settledAt(t._state,e,t._result);else if(\"function\"!=typeof i)this._remaining--,this._result[e]=t;else if(n===U){var o=new n(E);N(o,t,i),this._willSettleAt(o,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},t.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===x&&(this._remaining--,t===A?I(r,n):this._result[e]=n),0===this._remaining&&L(r,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;j(t,void 0,function(t){return n._settledAt(T,e,t)},function(t){return n._settledAt(A,e,t)})},t}(),U=function(){function e(t){this[_]=z++,this._result=this._state=void 0,this._subscribers=[],E!==t&&(\"function\"!=typeof t&&function(){throw new TypeError(\"You must pass a resolver function as the first argument to the promise constructor\")}(),this instanceof e?function(t,e){try{e(function(e){C(t,e)},function(e){I(t,e)})}catch(e){I(t,e)}}(this,t):function(){throw new TypeError(\"Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.\")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return U.prototype.then=y,U.all=function(t){return new M(this,t).promise},U.race=function(t){var n=this;return e(t)?new n(function(e,r){for(var i=t.length,o=0;o<i;o++)n.resolve(t[o]).then(e,r)}):new n(function(t,e){return e(new TypeError(\"You must pass an array to race.\"))})},U.resolve=b,U.reject=function(t){var e=new this(E);return I(e,t),e},U._setScheduler=function(t){i=t},U._setAsap=function(t){o=t},U._asap=o,U.polyfill=function(){var t=void 0;if(\"undefined\"!=typeof global)t=global;else if(\"undefined\"!=typeof self)t=self;else try{t=Function(\"return this\")()}catch(t){throw new Error(\"polyfill failed because global object is unavailable in this environment\")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if(\"[object Promise]\"===n&&!e.cast)return}t.Promise=U},U.Promise=U,U},t.exports=r()},function(t,e,n){var r=n(50);t.exports=new r(\"twttr\")},function(t,e,n){var r=n(1),i=n(0);function o(t){return i.isType(\"string\",t)?t.split(\".\"):i.isType(\"array\",t)?t:[]}function s(t,e){(e=e||r)[t]=e[t]||{},Object.defineProperty(this,\"base\",{value:e[t]}),Object.defineProperty(this,\"name\",{value:t})}i.aug(s.prototype,{get:function(t){return o(t).reduce(function(t,e){if(i.isObject(t))return t[e]},this.base)},set:function(t,e,n){var r=o(t),s=function(t,e){var n=o(e).slice(0,-1);return n.reduce(function(t,e,r){if(t[e]=t[e]||{},!i.isObject(t[e]))throw new Error(n.slice(0,r+1).join(\".\")+\" is already defined with a value.\");return t[e]},t)}(this.base,t),a=r.slice(-1);return n&&a in s?s[a]:s[a]=e},init:function(t,e){return this.set(t,e,!0)},unset:function(t){var e=o(t),n=this.get(e.slice(0,-1));n&&delete n[e.slice(-1)]},aug:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(e=void 0!==e?e:{},n.unshift(e),!n.every(i.isObject))throw new Error(\"Cannot augment non-object.\");return this.set(t,i.aug.apply(null,n))},call:function(t){var e=this.get(t),n=i.toRealArray(arguments).slice(1);if(!i.isType(\"function\",e))throw new Error(\"Function \"+t+\"does not exist.\");return e.apply(null,n)},fullPath:function(t){var e=o(t);return e.unshift(this.name),e.join(\".\")}}),t.exports=s},function(t,e,n){var r=n(0),i=n(7),o={bind:function(t,e){return this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||[],this._handlers[t].push(e)},unbind:function(t,e){var n;this._handlers&&this._handlers[t]&&(e?(n=this._handlers[t].indexOf(e))>=0&&this._handlers[t].splice(n,1):this._handlers[t]=[])},trigger:function(t,e){var n=this._handlers&&this._handlers[t];(e=e||{}).type=t,n&&n.forEach(function(t){r.async(i(t,this,e))})}};t.exports={Emitter:o,makeEmitter:function(){return r.aug(function(){},o)}}},function(t,e,n){var r=n(103),i=n(77),o=n(6),s=n(23),a=n(7),u=n(0),c=new i(function(t){var e=function(t){return t.reduce(function(t,e){return t[e._className]=t[e._className]||[],t[e._className].push(e),t},{})}(t.map(r.fromRawTask));u.forIn(e,function(t,e){s.allSettled(e.map(function(t){return t.initialize()})).then(function(){e.forEach(function(t){o.all([t.hydrate(),t.insertIntoDom()]).then(a(t.render,t)).then(a(t.success,t),a(t.fail,t))})})})});t.exports={addWidget:function(t){return c.add(t)}}},function(t,e,n){var r=n(18);t.exports=function(t){return r.write(function(){t&&t.parentNode&&t.parentNode.removeChild(t)})}},function(t,e,n){n(12),t.exports={log:function(t,e){}}},function(t,e,n){var r=n(1);function i(t){return(t=t||r).getSelection&&t.getSelection()}t.exports={getSelection:i,getSelectedText:function(t){var e=i(t);return e?e.toString():\"\"}}},function(t,e,n){var r=n(4),i=n(1),o=n(2),s=2e4;t.exports=function(t){var e=new o,n=r.createElement(\"img\");return n.onload=n.onerror=function(){i.setTimeout(e.resolve,50)},n.src=t,i.setTimeout(e.reject,s),e.promise}},function(t,e,n){var r=n(113);t.exports=function(t){t.define(\"createElement\",r),t.define(\"createFragment\",r),t.define(\"htmlToElement\",r),t.define(\"hasSelectedText\",r),t.define(\"addRootClass\",r),t.define(\"removeRootClass\",r),t.define(\"hasRootClass\",r),t.define(\"prependStyleSheet\",r),t.define(\"appendStyleSheet\",r),t.define(\"prependCss\",r),t.define(\"appendCss\",r),t.define(\"makeVisible\",r),t.define(\"injectWidgetEl\",r),t.define(\"matchHeightToContent\",r),t.define(\"matchWidthToContent\",r)}},function(t,e){t.exports=function(t){var e,n=!1;return function(){return n?e:(n=!0,e=t.apply(this,arguments))}}},function(t,e,n){var r=n(15),i=n(122),o=n(60),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.DM_BUTTON,t,e,n)}},function(t,e,n){var r=n(61),i=n(26);t.exports=r.isSupported()?r:i},function(t,e,n){var r=n(27),i=n(123);t.exports=r.build([i])},function(t,e,n){var r=n(15),i=n(126),o=n(38),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.FOLLOW_BUTTON,t,e,n)}},function(t,e,n){var r=n(15),i=n(134),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.MOMENT,t,e,n)}},function(t,e,n){var r=n(15),i=n(136),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.PERISCOPE,t,e,n)}},function(t,e,n){var r=n(83),i=n(138),o=n(142),s=n(144),a=n(146),u=n(148),c={collection:i,event:o,likes:s,list:a,profile:u,url:f},d=[u,s,i,a,o];function f(t){return r(d,function(e){try{return new e(t)}catch(t){}})}t.exports=function(t){return t?function(t){var e,n;return e=(t.sourceType+\"\").toLowerCase(),(n=c[e])?new n(t):null}(t)||f(t):null}},function(t,e,n){var r=n(15),i=n(150),o=n(26),s=n(16);t.exports=function(t,e,n){return new r(i,o,s.TIMELINE,t,e,n)}},function(t,e,n){var r=n(4),i=n(68),o=n(152),s=n(15),a=n(38),u=n(153),c=n(60),d=n(154),f=n(16);t.exports=function(t,e,n,l){var h,p=i.isHorizonTweetEnabled(l);return o(l,t.tweetId),p?(h=r.createElement(\"div\"),new s(u,a,f.TWEET,t,e,n,{sandboxWrapperEl:h})):new s(d,c,f.TWEET,t,e,n)}},function(t,e){var n=\"tfw_horizon_tweet_embed_9555\";t.exports={isHorizonTweetEnabled:function(t){return!(!t||!t[n]||\"hte\"!==t[n].bucket)}}},function(t,e,n){var r=n(15),i=n(156),o=n(38),s=n(16);t.exports=function(t,e,n){var a=t&&t.type||\"share\",u=\"hashtag\"==a?s.HASHTAG_BUTTON:\"mention\"==a?s.MENTION_BUTTON:s.SHARE_BUTTON;return new r(i,o,u,t,e,n)}},function(t,e,n){var r=n(37),i=n(39),o=n(0),s=n(68),a=n(31);t.exports=function(t){var e={widget_origin:i.rootDocumentLocation(),widget_frame:i.isFramed()?i.currentDocumentLocation():null,duration_ms:t.duration,item_ids:t.widgetIds||[]},n=o.aug(t.namespace,{page:\"page\",component:\"performance\"});return a.getExperiments().then(function(t){var i=s.isHorizonTweetEnabled(t)?o.aug(e,{context:\"horizon\"}):e;r.scribe(n,i)})}},function(t,e,n){var r=n(0),i=n(139),o=[\"ar\",\"fa\",\"he\",\"ur\"];t.exports={isRtlLang:function(t){return t=String(t).toLowerCase(),r.contains(o,t)},matchLanguage:function(t){return t=(t=(t||\"\").toLowerCase()).replace(\"_\",\"-\"),i(t)?t:(t=t.replace(/-.*/,\"\"),i(t)?t:\"en\")}}},function(t){t.exports={TWEET:0,RETWEET:10,CUSTOM_TIMELINE:17,LIVE_VIDEO_EVENT:28,QUOTE_TWEET:23}},function(t){t.exports={tweetButtonHtmlPath:\"/widgets/tweet_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",followButtonHtmlPath:\"/widgets/follow_button.d0f13be8321eb432fba28cfc1c3351b1.{{lang}}.html\",hubHtmlPath:\"/widgets/hub.html\",widgetIframeHtmlPath:\"/widgets/widget_iframe.d0f13be8321eb432fba28cfc1c3351b1.html\",resourceBaseUrl:\"https://platform.twitter.com\"}},function(t,e,n){var r=n(3),i=n(100),o=n(25),s=n(11),a={favorite:[\"favorite\",\"like\"],follow:[\"follow\"],like:[\"favorite\",\"like\"],retweet:[\"retweet\"],tweet:[\"tweet\"]};function u(t){this.srcEl=[],this.element=t}u.open=function(t,e,n){var u=(r.intentType(t)||\"\").toLowerCase();r.isTwitterURL(t)&&(function(t,e){i.open(t,{},e)}(t,n),e&&o.trigger(\"click\",{target:e,region:\"intent\",type:\"click\",data:{}}),e&&a[u]&&a[u].forEach(function(n){o.trigger(n,{target:e,region:\"intent\",type:n,data:function(t,e){var n=s.decodeURL(e);switch(t){case\"favorite\":case\"like\":return{tweet_id:n.tweet_id};case\"follow\":return{screen_name:n.screen_name,user_id:n.user_id};case\"retweet\":return{source_tweet_id:n.tweet_id};default:return{}}}(u,t)})}))},t.exports=u},function(t,e){t.exports={getTimezoneOffset:function(){var t=(new Date).toString().match(/(GMT[+-]?\\d+)/);return t&&t[0]||\"GMT\"}}},function(t,e,n){var r=n(4),i=n(9),o=n(2),s=n(0),a=n(11),u=\"cb\",c=0;t.exports={fetch:function(t,e,n,d){var f,l,h;return d=function(t){if(t)return t.replace(/[^\\w$]/g,\"_\")}(d||u+c++),f=i.fullPath([\"callbacks\",d]),l=r.createElement(\"script\"),h=new o,e=s.aug({},e,{callback:f,suppress_response_codes:!0}),i.set([\"callbacks\",d],function(t){var e;t=(e=n(t||!1)).resp,e.success?h.resolve(t):h.reject(t),l.onload=l.onreadystatechange=null,l.parentNode&&l.parentNode.removeChild(l),i.unset([\"callbacks\",d])}),l.onerror=function(){h.reject(new Error(\"failed to fetch \"+l.src))},l.src=a.url(t,e),l.async=\"async\",r.body.appendChild(l),h.promise}}},function(t,e,n){var r=n(2),i=n(105),o=n(7);function s(t){this._inputsQueue=[],this._task=t,this._hasFlushBeenScheduled=!1}s.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._hasFlushBeenScheduled||(this._hasFlushBeenScheduled=!0,i(o(this._flush,this))),e.promise},s.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._hasFlushBeenScheduled=!1},t.exports=s},function(t,e){t.exports=function(t,e){return t.reduce(function(t,n){var r=e(n);return t[r]=t[r]||[],t[r].push(n),t},{})}},function(t,e,n){var r=n(4),i=n(8),o=n(3);function s(t,e){var n,r;return e=e||i,/^https?:\\/\\//.test(t)?t:/^\\/\\//.test(t)?e.protocol+t:(n=e.host+(e.port.length?\":\"+e.port:\"\"),0!==t.indexOf(\"/\")&&((r=e.pathname.split(\"/\")).pop(),r.push(t),t=\"/\"+r.join(\"/\")),[e.protocol,\"//\",n,t].join(\"\"))}t.exports={absolutize:s,getCanonicalURL:function(){for(var t,e=r.getElementsByTagName(\"link\"),n=0;e[n];n++)if(\"canonical\"==(t=e[n]).rel)return s(t.href)},getScreenNameFromPage:function(){for(var t,e,n,i=[r.getElementsByTagName(\"a\"),r.getElementsByTagName(\"link\")],s=0,a=0,u=/\\bme\\b/;t=i[s];s++)for(a=0;e=t[a];a++)if(u.test(e.rel)&&(n=o.screenName(e.href)))return n}}},function(t,e,n){var r=n(8),i=/^[^#?]*\\.(gov|mil)(:\\d+)?([#?].*)?$/i,o={};function s(t){return t in o?o[t]:o[t]=i.test(t)}t.exports={isUrlSensitive:s,isHostPageSensitive:function(){return s(r.host)}}},function(t,e,n){var r=n(20),i=n(54),o=n(11),s=n(21),a=n(0),u=n(9).get(\"scribeCallback\"),c=2083,d=[],f=o.url(s.CLIENT_EVENT_ENDPOINT,{dnt:0,l:\"\"}),l=encodeURIComponent(f).length;function h(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);i||o||(u&&u(arguments),p(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r),s.CLIENT_EVENT_ENDPOINT))}function p(t,e,n){var r,u;n&&a.isObject(t)&&a.isObject(e)&&(i.log(t,e),r=s.flattenClientEventPayload(t,e),u={l:s.stringify(r)},s.noticeSeen(t)&&(u.notice_seen=!0),r.dnt&&(u.dnt=1),w(o.url(n,u)))}function m(t,e,n,r){var i=!a.isObject(t),o=!!e&&!a.isObject(e);if(!i&&!o)return v(s.flattenClientEventPayload(s.formatClientEventNamespace(t),s.formatClientEventData(e,n,r)))}function v(t){return d.push(t),d}function g(t){return encodeURIComponent(t).length+3}function w(t){return(new Image).src=t}t.exports={canFlushOneItem:function(t){var e=g(s.stringify(t));return l+e<c},_enqueueRawObject:v,scribe:p,clientEvent:h,clientEvent2:function(t,e,n){return h(t,e,n,2)},enqueueClientEvent:m,flushClientEvents:function(){var t;return d.length>1&&m({page:\"widgets_js\",component:\"scribe_pixel\",action:\"batch_log\"},{}),t=d,d=[],t.reduce(function(e,n,r){var i=e.length,o=i&&e[i-1];return r+1==t.length&&n.event_namespace&&\"batch_log\"==n.event_namespace.action&&(n.message=[\"entries:\"+r,\"requests:\"+i].join(\"/\")),function t(e){return Array.isArray(e)||(e=[e]),e.reduce(function(e,n){var r,i=s.stringify(n),o=g(i);return l+o<c?e=e.concat(i):(r=s.splitLogEntry(n)).length>1&&(e=e.concat(t(r))),e},[])}(n).forEach(function(t){var n=g(t);(!o||o.urlLength+n>c)&&(o={urlLength:l,items:[]},e.push(o)),o.urlLength+=n,o.items.push(t)}),e},[]).map(function(t){var e={l:t.items};return r.enabled()&&(e.dnt=1),w(o.url(s.CLIENT_EVENT_ENDPOINT,e))})},interaction:function(t,e,n,r){var i=s.extractTermsFromDOM(t.target||t.srcElement);i.action=r||\"click\",h(i,e,n)}}},function(t,e,n){var r=n(0),i=n(43);t.exports=function(t,e){return i(t,e)?[t]:r.toRealArray(t.querySelectorAll(e))}},function(t,e){t.exports=function(t,e,n){for(var r,i=0;i<t.length;i++)if(r=e.call(n,t[i],i,t))return r}},function(t,e){t.exports=function(){return Math.floor(+new Date/9e5)}},function(t,e,n){var r=n(12);t.exports=function(t){var e,n;return e=t.headers&&t.headers.status,!(n=t&&!t.error&&200===e)&&t.headers&&t.headers.message&&r.publicError(t.headers.message),{success:n,resp:t}}},function(t,e,n){var r=n(37),i=n(21);t.exports=function(t,e,n,o){r.scribe(i.formatClientEventNamespace({client:\"tfw\",page:\"ddg\",section:t,action:\"experiment\"}),{experiment_key:t,bucket:e,version:n,data:o},!0)}},function(t,e,n){var r,i=n(30),o=0;function s(){r&&r.length===o&&(i.emitter.trigger(i.ALL_WIDGETS_AND_IMAGES_LOADED,r),r=null)}i.emitter.bind(i.ALL_WIDGETS_RENDER_END,function(t){r=t.widgets,s()}),t.exports={reportImagesLoadForAWidget:function(){o++,s()}}},,,,,,,,,function(t,e,n){var r,i=n(2),o=n(4),s=n(98),a=n(49),u=n(9),c=n(99),d=n(25),f=n(102),l=n(157),h=n(165),p=n(166),m=n(30),v=n(31);n(167),m.emitter.trigger(m.START),u.set(\"widgets.init\",!0),a.set(\"init\",!0),p(),r=new i,s.exposeReadyPromise(r.promise,a.base,\"_e\"),a.set(\"widgets\",l),a.set(\"widgets.load\",f.load),a.set(\"events\",d),h(function(){v.load(),r.resolve(a.base),c.attachTo(o),f.loadPage()})},function(t,e){t.exports=navigator},function(t,e,n){var r=n(7);t.exports={exposeReadyPromise:function(t,e,n){e.ready=r(t.then,t),n&&Array.isArray(e[n])&&(e[n].forEach(r(t.then,t)),delete e[n])}}},function(t,e,n){var r=n(8),i=n(36),o=n(34),s=n(74),a=n(3);function u(t){var e,n,u;t.altKey||t.metaKey||t.shiftKey||(e=o.closest(function(t){return\"A\"===t.tagName||\"AREA\"===t.tagName},t.target))&&a.isIntentURL(e.href)&&(n=(n=(n=[u=e.href,\"original_referer=\"+r.href].join(-1==u.indexOf(\"?\")?\"?\":\"&\")).replace(/^http[:]/,\"https:\")).replace(/^\\/\\//,\"https://\"),s.open(n,e),i.preventDefault(t))}t.exports={attachTo:function(t){t.addEventListener(\"click\",u,!1)}}},function(t,e,n){var r,i=n(1),o=n(101),s=n(36),a=n(34),u=n(22),c=n(3),d=n(24),f=n(0),l=\"intent_\",h=i.screen.width,p=i.screen.height;function m(t,e){function n(t){return Math.round(t/2)}return t>e?{coordinate:0,size:e}:{coordinate:n(e)-n(t),size:t}}function v(t,e,n){var i,o;e=r.parse(e),n=n||{},i=m(e.width,n.width||h),e.left=i.coordinate,e.width=i.size,o=m(e.height,n.height||p),e.top=o.coordinate,e.height=o.size,this.win=t,this.features=function(t){var e=[];return f.forIn(t,function(t,n){e.push(t+\"=\"+n)}),e.join(\",\")}(e)}r=(new o).defaults({width:550,height:520,personalbar:\"0\",toolbar:\"0\",location:\"1\",scrollbars:\"1\",resizable:\"1\"}),v.prototype.open=function(t,e){var n=e&&\"click\"==e.type&&a.closest(\"a\",e.target),r=e&&(e.altKey||e.metaKey||e.shiftKey),i=n&&(u.ios()||u.android());if(c.isTwitterURL(t))return r||i?this:(this.name=l+d.generate(),this.popup=this.win.open(t,this.name,this.features),e&&s.preventDefault(e),this)},v.open=function(t,e,n){return new v(i,e).open(t,n)},t.exports=v},function(t,e,n){var r=n(5),i=n(0);function o(){this.assertions=[],this._defaults={}}o.prototype.assert=function(t,e){return this.assertions.push({fn:t,msg:e||\"assertion failed\"}),this},o.prototype.defaults=function(t){return this._defaults=t||this._defaults,this},o.prototype.require=function(t){var e=this;return(t=Array.isArray(t)?t:i.toRealArray(arguments)).forEach(function(t){e.assert(function(t){return function(e){return r.hasValue(e[t])}}(t),\"required: \"+t)}),this},o.prototype.parse=function(t){var e,n;if(e=i.aug({},this._defaults,t||{}),(n=this.assertions.reduce(function(t,n){return n.fn(e)||t.push(n.msg),t},[])).length>0)throw new Error(n.join(\"\\n\"));return e},t.exports=o},function(t,e,n){var r=n(4),i=n(6),o=n(23),s=n(52),a=n(35),u=n(9),c=n(37),d=n(25),f=n(5),l=n(0),h=n(31),p=n(119),m=n(30);function v(){var t=a.val(\"widgets:autoload\")||!0;return!f.isFalseValue(t)&&(f.isTruthValue(t)?r.body:r.querySelectorAll(t))}function g(t,e){var n,i;return t=(t=t||r.body).length?l.toRealArray(t):[t],c.pause(),i=function(t,e){return t.reduce(function(t,n){return t.concat(p.reduce(function(t,r){return t.concat(r(n,e))},[]))},[])}(t,e),m.emitter.trigger(m.ALL_WIDGETS_RENDER_START,{widgets:i}),n=o.allResolved(i.map(function(t){return s.addWidget(t)})).then(function(t){d.trigger(\"loaded\",{widgets:t}),t&&t.length&&m.emitter.trigger(m.ALL_WIDGETS_RENDER_END,{widgets:t})}),o.always(n,function(){c.resume()}),n}function w(t){return h.getExperiments().then(function(e){return g(t,e)})}t.exports={load:w,loadPage:function(){var t=v();return!1===t?i.resolve():(u.set(\"widgets.loaded\",!0),w(t))},_getPageLoadTarget:v}},function(t,e,n){var r=n(10),i=n(18),o=n(25),s=n(53),a=n(6),u=n(23);function c(t,e){this._widget=null,this._sandbox=null,this._hydrated=!1,this._insertedIntoDom=!1,this._Sandbox=t.Sandbox,this._factory=t.factory,this._widgetParams=t.parameters,this._resolve=e,this._className=t.className,this._renderedClassName=t.className+\"-rendered\",this._errorClassName=t.className+\"-error\",this._srcEl=t.srcEl,this._targetGlobal=function(t){return(t.srcEl||t.targetEl).ownerDocument.defaultView}(t),this._sandboxWrapperEl=t.options?t.options.sandboxWrapperEl:null,this._insertionStrategy=function(e){var n,r=t.srcEl,i=t.targetEl,o=t.options?t.options.sandboxWrapperEl:null;o?(o.appendChild(e),n=o):n=e,r?i.insertBefore(n,r):i.appendChild(n)}}c.fromRawTask=function(t){return new c(t.input,t.taskDoneDeferred.resolve)},c.prototype.initialize=function(){var t=this,e=new this._Sandbox(this._targetGlobal);return this._factory(this._widgetParams,e).then(function(n){return t._widget=n,t._sandbox=e,n._sandboxWrapperEl=t._sandboxWrapperEl,n})},c.prototype.insertIntoDom=function(){var t=this;return this._widget?this._sandbox.insert(this._widget.id,{class:[this._className,this._renderedClassName].join(\" \")},null,this._insertionStrategy).then(function(){t._insertedIntoDom=!0}):a.reject(new Error(\"cannot insert widget into DOM before it is initialized\"))},c.prototype.hydrate=function(){var t=this;return this._widget?this._widget.hydrate().then(function(){t._hydrated=!0}):a.reject(new Error(\"cannot hydrate widget before it is initialized\"))},c.prototype.render=function(){var t=this;function e(e){return s(t._sandbox.sandboxEl).then(function(){return a.reject(e)})}return this._hydrated?this._insertedIntoDom?t._widget.render(t._sandbox).then(function(){return t._sandbox.onResize(function(){return t._widget.resize().then(function(){o.trigger(\"resize\",{target:t._sandbox.sandboxEl})})}),t._widget.show()}).then(function(){return s(t._srcEl).then(function(){return t._sandbox.sandboxEl})},e):e(new Error(\"cannot render widget before DOM insertion\")):e(new Error(\"cannot render widget before hydration\"))},c.prototype.fail=function(){var t=this;return this._srcEl?u.always(i.write(function(){r.add(t._srcEl,t._errorClassName)}),function(){o.trigger(\"rendered\",{target:t._srcEl}),t._resolve(t._srcEl)}):(t._resolve(),a.resolve())},c.prototype.success=function(){o.trigger(\"rendered\",{target:this._sandbox.sandboxEl}),this._resolve(this._sandbox.sandboxEl)},t.exports=c},function(t,e,n){var r;!function(){\"use strict\";var i=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};function o(){this.frames=[],this.lastId=0,this.raf=i,this.batch={hash:{},read:[],write:[],mode:null}}o.prototype.read=function(t,e){var n=this.add(\"read\",t,e),r=n.id;return this.batch.read.push(n.id),\"reading\"===this.batch.mode||this.batch.scheduled?r:(this.scheduleBatch(),r)},o.prototype.write=function(t,e){var n=this.add(\"write\",t,e),r=this.batch.mode,i=n.id;return this.batch.write.push(n.id),\"writing\"===r||\"reading\"===r||this.batch.scheduled?i:(this.scheduleBatch(),i)},o.prototype.defer=function(t,e,n){\"function\"==typeof t&&(n=e,e=t,t=1);var r=this,i=t-1;return this.schedule(i,function(){r.run({fn:e,ctx:n})})},o.prototype.clear=function(t){if(\"function\"==typeof t)return this.clearFrame(t);t=Number(t);var e=this.batch.hash[t];if(e){var n=this.batch[e.type],r=n.indexOf(t);delete this.batch.hash[t],~r&&n.splice(r,1)}},o.prototype.clearFrame=function(t){var e=this.frames.indexOf(t);~e&&this.frames.splice(e,1)},o.prototype.scheduleBatch=function(){var t=this;this.schedule(0,function(){t.batch.scheduled=!1,t.runBatch()}),this.batch.scheduled=!0},o.prototype.uniqueId=function(){return++this.lastId},o.prototype.flush=function(t){for(var e;e=t.shift();)this.run(this.batch.hash[e])},o.prototype.runBatch=function(){try{this.batch.mode=\"reading\",this.flush(this.batch.read),this.batch.mode=\"writing\",this.flush(this.batch.write),this.batch.mode=null}catch(t){throw this.runBatch(),t}},o.prototype.add=function(t,e,n){var r=this.uniqueId();return this.batch.hash[r]={id:r,fn:e,ctx:n,type:t}},o.prototype.run=function(t){var e=t.ctx||this,n=t.fn;if(delete this.batch.hash[t.id],!this.onError)return n.call(e);try{n.call(e)}catch(t){this.onError(t)}},o.prototype.loop=function(){var t,e=this,n=this.raf,r=!1;function i(){var t=e.frames.shift();e.frames.length?n(i):e.looping=!1,t&&t()}this.looping||(t=setTimeout(function(){r=!0,i()},500),n(function(){r||(clearTimeout(t),i())}),this.looping=!0)},o.prototype.schedule=function(t,e){return this.frames[t]?this.schedule(t+1,e):(this.loop(),this.frames[t]=e)};var s=new o;void 0!==t&&t.exports?t.exports=s:void 0===(r=function(){return s}.call(e,n,e,t))||(t.exports=r)}()},function(t,e,n){var r=n(48).Promise;t.exports=r._asap},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=n(32),c=n(20),d=n(2),f=n(6),l=n(54),h=n(21),p=n(0),m=n(26),v=n(9).get(\"scribeCallback\"),g=Math.floor(1e3*Math.random())+\"_\",w=\"rufous-frame-\"+g+\"-\",y=\"rufous-form-\"+g+\"-\",b=0,_=!1,E=new d;function x(){var t=o.createElement(\"form\"),e=o.createElement(\"input\"),n=o.createElement(\"input\");return b++,t.action=h.CLIENT_EVENT_ENDPOINT,t.method=\"POST\",t.target=w+b,t.id=y+b,e.type=\"hidden\",e.name=\"dnt\",e.value=c.enabled(),n.type=\"hidden\",n.name=\"tfw_redirect\",n.value=h.RUFOUS_REDIRECT,t.appendChild(e),t.appendChild(n),t}function T(){var t=w+b;return u({id:t,name:t,width:0,height:0,border:0},{display:\"none\"},o.doc)}t.exports={clientEvent:function(t,e,n,i){(function(t,e){var n=!p.isObject(t),r=!!e&&!p.isObject(e),i=n||r;return i})(t,e)||(v&&v(arguments),E.promise.then(function(){!function(t,e){var n,i,s;p.isObject(t)&&p.isObject(e)&&(l.log(t,e),s=h.flattenClientEventPayload(t,e),(n=r.firstChild).value=+(+n.value||s.dnt||0),(i=o.createElement(\"input\")).type=\"hidden\",i.name=\"l\",i.value=h.stringify(s),r.appendChild(i))}(h.formatClientEventNamespace(t),h.formatClientEventData(e,n,i))}))},flush:function(){return E.promise.then(function(){var t;return r.children.length<=2?f.reject():(t=f.all([o.doc.body.appendChild(r),o.doc.body.appendChild(i)]).then(function(t){var e=t[0],n=t[1];return n.addEventListener(\"load\",function(){!function(t,e){return function(){var n=t.parentNode;n&&(n.removeChild(t),n.removeChild(e))}}(e,n)()}),e.submit(),t}),r=x(),i=T(),t)})},init:function(){return _?E.promise:((o=new m(a)).insert(\"rufous-sandbox\",null,{display:\"none\"},function(t){s.body.appendChild(t)}).then(function(){o.setTitle(\"Twitter analytics iframe\"),r=x(),i=T(),E.resolve([r,i])}),_=!0,E.promise)}}},function(t,e,n){var r=n(0);t.exports=function t(e){var n=[];return e.forEach(function(e){var i=r.isType(\"array\",e)?t(e):[e];n=n.concat(i)}),n}},function(t,e){t.exports=function(t){return t.filter(function(e,n){return t.indexOf(e)===n})}},function(t,e,n){var r=n(41),i=n(0),o=n(111);function s(){r.apply(this,arguments)}s.prototype=Object.create(r.prototype),i.aug(s.prototype,{factory:o}),t.exports=s},function(t,e,n){var r=n(23),i=n(0),o=n(7);t.exports={before:function(t,e){return function(){var n,i=this,o=arguments;return n=e.apply(this,arguments),r.isPromise(n)?n.then(function(){return t.apply(i,o)}):t.apply(this,arguments)}},after:function(t,e){return function(){var n,i=this,o=arguments;function s(t,e){return r.isPromise(e)?e.then(function(){return t}):t}return n=t.apply(this,arguments),r.isPromise(n)?n.then(function(t){return s(t,e.apply(i,o))}):s(n,e.apply(this,arguments))}},around:function(t,e){return function(){var n=i.toRealArray(arguments);return n.unshift(o(t,this)),e.apply(this,n)}}}},function(t,e,n){var r=n(10),i=n(18),o=n(42),s=n(6),a=n(0);t.exports=function(){var t=o();function e(e){t.apply(this,arguments),Object.defineProperty(this,\"targetGlobal\",{value:e})}return e.prototype=Object.create(t.prototype),a.aug(e.prototype,{id:null,initialized:!1,width:0,height:0,sandboxEl:null,insert:function(){return s.reject()},onResize:function(){},addClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.add(e,t)})})},removeClass:function(t){var e=this.sandboxEl;return t=Array.isArray(t)?t:[t],i.write(function(){t.forEach(function(t){r.remove(e,t)})})},styleSelf:function(t){var e=this;return i.write(function(){a.forIn(t,function(t,n){e.sandboxEl.style[t]=n})})}}),e}},function(t,e,n){var r=n(4),i=n(10),o=n(18),s=n(55),a=n(27),u=n(56),c=n(44),d=n(45),f=n(32),l=n(12),h=n(46),p=n(2),m=n(6),v=n(0),g=n(9),w=n(24),y=n(7),b={allowfullscreen:\"true\"},_={position:\"absolute\",visibility:\"hidden\",display:\"block\",width:\"0px\",height:\"0px\",padding:\"0\",border:\"none\"},E={position:\"static\",visibility:\"visible\"},x=\"SandboxRoot\",T=\".SandboxRoot { display: none; }\",A=50;function S(t,e,n,r){return e=v.aug({id:t},b,e),n=v.aug({},_,n),f(e,n,r)}function R(t,e,n,i,s){var a=new p,u=w.generate(),c=S(t,e,n,s);return g.set([\"sandbox\",u],function(){var t=c.contentWindow.document;o.write(function(){t.write(\"<!DOCTYPE html><html><head><\/head><body><\/body><\/html>\")}).then(function(){t.close(),a.resolve(c)})}),c.src=[\"javascript:\",'document.write(\"\");',\"try { window.parent.document; }\",'catch (e) { document.domain=\"'+r.domain+'\"; }',\"window.parent.\"+g.fullPath([\"sandbox\",u])+\"();\"].join(\"\"),c.addEventListener(\"error\",a.reject,!1),o.write(function(){i.parentNode.replaceChild(c,i)}),a.promise}t.exports=a.couple(n(57),function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.win}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"rootEl\",{get:function(){return this.doc&&this.doc.documentElement}}),t.defineProperty(\"widgetEl\",{get:function(){return this.doc&&this.doc.body.firstElementChild}}),t.defineProperty(\"win\",{get:function(){return this.iframeEl&&this.iframeEl.contentWindow}}),t.defineProperty(\"doc\",{get:function(){return this.win&&this.win.document}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return o.read(function(){var e,n=h(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=h(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_setTargetToBlank\",function(){var t=this.createElement(\"base\");t.target=\"_blank\",this.doc.head.appendChild(t)}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.override(\"createElement\",function(t){return this.doc.createElement(t)}),t.override(\"createFragment\",function(){return this.doc.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!s.getSelectedText(this.win)}),t.override(\"addRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this.rootEl;return t=Array.isArray(t)?t:[t],this.initialized?o.write(function(){t.forEach(function(t){i.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return i.present(this.rootEl,t)}),t.define(\"addStyleSheet\",function(t,e){var n,r=new p;return this.initialized?((n=this.createElement(\"link\")).type=\"text/css\",n.rel=\"stylesheet\",n.href=t,n.addEventListener(\"load\",r.resolve,!1),n.addEventListener(\"error\",r.reject,!1),o.write(y(e,null,n)).then(function(){return u(t).then(r.resolve,r.reject),r.promise})):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this.doc;return this.addStyleSheet(t,function(t){return e.head.appendChild(t)})}),t.define(\"addCss\",function(t,e){var n;return c.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.doc.createTextNode(t)),o.write(y(e,null,n))):(l.devError(\"CSP enabled; cannot embed inline styles\"),m.resolve())}),t.override(\"prependCss\",function(t){var e=this.doc;return this.addCss(t,function(t){var n=e.head.firstElementChild;return n?e.head.insertBefore(t,n):e.head.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this.doc;return this.addCss(t,function(t){return e.head.appendChild(t)})}),t.override(\"makeVisible\",function(){var t=this;return this.styleSelf(E).then(function(){t._updateCachedDimensions()})}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this.widgetEl?m.reject(new Error(\"widget already injected\")):o.write(function(){e.doc.body.appendChild(t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).height:0}),o.write(function(){e.sandboxEl.style.height=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.override(\"matchWidthToContent\",function(){var t,e=this;return o.read(function(){t=e.widgetEl?h(e.widgetEl).width:0}),o.write(function(){e.sandboxEl.style.width=t+\"px\"}).then(function(){return e._updateCachedDimensions()})}),t.after(\"initialize\",function(){this._iframe=null,this._width=this._height=0,this._resizeHandlers=[]}),t.override(\"insert\",function(t,e,n,r){var i=this,s=new p,a=this.targetGlobal.document,u=S(t,e,n,a);return o.write(y(r,null,u)),u.addEventListener(\"load\",function(){(function(t){try{t.contentWindow.document}catch(t){return m.reject(t)}return m.resolve(t)})(u).then(null,y(R,null,t,e,n,u,a)).then(s.resolve,s.reject)},!1),u.addEventListener(\"error\",s.reject,!1),s.promise.then(function(t){var e=d(i._didResize,A,i);return i._iframe=t,i.win.addEventListener(\"resize\",e,!1),m.all([i._setTargetToBlank(),i.addRootClass(x),i.prependCss(T)])})}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){t.exports=function(){throw new Error(\"unimplemented method\")}},function(t,e,n){var r=n(2),i=n(7),o=100,s=3e3;function a(t,e){this._inputsQueue=[],this._task=t,this._isPaused=!1,this._flushDelay=e&&e.flushDelay||o,this._pauseLength=e&&e.pauseLength||s,this._flushTimeout=void 0}a.prototype.add=function(t){var e=new r;return this._inputsQueue.push({input:t,taskDoneDeferred:e}),this._scheduleFlush(),e.promise},a.prototype._scheduleFlush=function(){this._isPaused||(clearTimeout(this._flushTimeout),this._flushTimeout=setTimeout(i(this._flush,this),this._flushDelay))},a.prototype._flush=function(){try{this._task.call(null,this._inputsQueue)}catch(t){this._inputsQueue.forEach(function(e){e.taskDoneDeferred.reject(t)})}this._inputsQueue=[],this._flushTimeout=void 0},a.prototype.pause=function(t){clearTimeout(this._flushTimeout),this._isPaused=!0,!t&&this._pauseLength&&setTimeout(i(this.resume,this),this._pauseLength)},a.prototype.resume=function(){this._isPaused=!1,this._scheduleFlush()},t.exports=a},function(t,e,n){var r,i=n(73),o=n(32),s=n(2),a=n(4),u=n(19),c=n(22),d=n(33),f=n(8),l=n(12),h=n(116),p=n(58),m=n(9),v=n(11),g=n(117),w=n(3),y=n(0),b=n(1),_=p(function(){return new s});function E(t){var e=t||{should_obtain_cookie_consent:!0,experiments:{}};return new g(e.should_obtain_cookie_consent,e.experiments)}t.exports={load:function(){var t,e,n,s;if(c.ie9()||c.ie10()||\"http:\"!==f.protocol&&\"https:\"!==f.protocol)return l.devError(\"Using default settings due to unsupported browser or protocol.\"),r=E(),void _().resolve();t={origin:f.origin},u.settings().indexOf(\"localhost\")>-1&&(t.localSettings=!0),e=v.url(i.resourceBaseUrl+i.widgetIframeHtmlPath,t),n=function(t){var n,i,o,s;if(i=w.isTwitterURL(t.origin),o=e.substr(0,t.origin.length)===t.origin,s=w.isTwimgURL(t.origin),o&&i||s)try{(n=\"string\"==typeof t.data?d.parse(t.data):t.data).namespace===h.settings&&(r=E(n.settings),_().resolve())}catch(t){l.devError(t)}},b.addEventListener(\"message\",n),s=o({src:e,title:\"Twitter settings iframe\"},{display:\"none\"}),a.body.appendChild(s)},settingsLoaded:function(){var t,e,n;return t=new s,e=m.get(\"experimentOverride\"),_().promise.then(function(){e&&e.name&&e.assignment&&((n={})[e.name]={bucket:e.assignment},r.experiments=y.aug(r.experiments,n)),t.resolve(r)}).catch(function(e){t.reject(e)}),t.promise}}},function(t,e){t.exports={settings:\"twttr.settings\"}},function(t,e){t.exports=function(t,e){this.shouldObtainCookieConsent=t,this.experiments=e||{}}},function(t,e){t.exports=function(t){return t.split(\"\").map(function(t){return t.charCodeAt(0).toString(16)}).join(\"\")}},function(t,e,n){t.exports=[n(120),n(125),n(133),n(135),n(137),n(151),n(155)]},function(t,e,n){var r=n(11),i=n(5),o=n(0),s=n(13),a=n(14)(),u=n(59),c=\"a.twitter-dm-button\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=t.getAttribute(\"data-show-screen-name\"),n=s(t),a=t.getAttribute(\"href\"),u=t.getAttribute(\"data-screen-name\"),c=e?i.asBoolean(e):null,d=t.getAttribute(\"data-size\"),f=r.decodeURL(a),l=f.recipient_id,h=t.getAttribute(\"data-text\")||f.text,p=t.getAttribute(\"data-welcome-message-id\")||f.welcomeMessageId;return o.aug(n,{screenName:u,showScreenName:c,size:d,text:h,userId:l,welcomeMessageId:p})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(0);t.exports=function t(e){var n;if(e)return n=e.lang||e.getAttribute(\"data-lang\"),r.isType(\"string\",n)?n:t(e.parentElement)}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(2).then(function(r){var o;try{o=n(88),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(124),i=n(1),o=n(10),s=n(36),a=n(18),u=n(55),c=n(27),d=n(56),f=n(44),l=n(46),h=n(7),p=n(45),m=n(6),v=n(0),g=50,w={position:\"absolute\",visibility:\"hidden\",display:\"block\",transform:\"rotate(0deg)\"},y={position:\"static\",visibility:\"visible\"},b=\"twitter-widget\",_=\"open\",E=\"SandboxRoot\",x=\".SandboxRoot { display: none; max-height: 10000px; }\";t.exports=c.couple(n(57),function(t){t.defineStatic(\"isSupported\",function(){return!!i.HTMLElement.prototype.attachShadow&&f.inlineStyle()}),t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this._shadowHost}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this._shadowHost}}),t.define(\"_updateCachedDimensions\",function(){var t=this;return a.read(function(){var e,n=l(t.sandboxEl);\"visible\"==t.sandboxEl.style.visibility?t._width=n.width:(e=l(t.sandboxEl.parentElement).width,t._width=Math.min(n.width,e)),t._height=n.height})}),t.define(\"_didResize\",function(){var t=this,e=this._resizeHandlers.slice(0);return this._updateCachedDimensions().then(function(){e.forEach(function(e){e(t)})})}),t.override(\"createElement\",function(t){return this.targetGlobal.document.createElement(t)}),t.override(\"createFragment\",function(){return this.targetGlobal.document.createDocumentFragment()}),t.override(\"htmlToElement\",function(t){var e;return(e=this.createElement(\"div\")).innerHTML=t,e.firstElementChild}),t.override(\"hasSelectedText\",function(){return!!u.getSelectedText(this.targetGlobal)}),t.override(\"addRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.add(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"removeRootClass\",function(t){var e=this._shadowRootBody;return t=Array.isArray(t)?t:[t],this.initialized?a.write(function(){t.forEach(function(t){o.remove(e,t)})}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"hasRootClass\",function(t){return o.present(this._shadowRootBody,t)}),t.override(\"addStyleSheet\",function(t,e){return this.addCss('@import url(\"'+t+'\");',e).then(function(){return d(t)})}),t.override(\"prependStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendStyleSheet\",function(t){var e=this._shadowRoot;return this.addStyleSheet(t,function(t){return e.appendChild(t)})}),t.override(\"addCss\",function(t,e){var n;return this.initialized?f.inlineStyle()?((n=this.createElement(\"style\")).type=\"text/css\",n.appendChild(this.targetGlobal.document.createTextNode(t)),a.write(h(e,null,n))):m.resolve():m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"prependCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){var n=e.firstElementChild;return n?e.insertBefore(t,n):e.appendChild(t)})}),t.override(\"appendCss\",function(t){var e=this._shadowRoot;return this.addCss(t,function(t){return e.appendChild(t)})}),t.override(\"makeVisible\",function(){return this.styleSelf(y)}),t.override(\"injectWidgetEl\",function(t){var e=this;return this.initialized?this._shadowRootBody.firstElementChild?m.reject(new Error(\"widget already injected\")):a.write(function(){e._shadowRootBody.appendChild(t)}).then(function(){return e._updateCachedDimensions()}).then(function(){var t=p(e._didResize,g,e);new r(e._shadowRootBody,t)}):m.reject(new Error(\"sandbox not initialized\"))}),t.override(\"matchHeightToContent\",function(){return m.resolve()}),t.override(\"matchWidthToContent\",function(){return m.resolve()}),t.override(\"insert\",function(t,e,n,r){var i=this.targetGlobal.document,o=this._shadowHost=i.createElement(b),u=this._shadowRoot=o.attachShadow({mode:_}),c=this._shadowRootBody=i.createElement(\"div\");return v.forIn(e||{},function(t,e){o.setAttribute(t,e)}),o.id=t,u.appendChild(c),s.delegate(c,\"click\",\"A\",function(t,e){e.hasAttribute(\"target\")||e.setAttribute(\"target\",\"_blank\")}),m.all([this.styleSelf(w),this.addRootClass(E),this.prependCss(x),a.write(r.bind(null,o))])}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"initialize\",function(){this._shadowHost=this._shadowRoot=this._shadowRootBody=null,this._width=this._height=0,this._resizeHandlers=[]}),t.after(\"styleSelf\",function(){return this._updateCachedDimensions()})})},function(t,e){var n;(n=function(t,e){function r(t,e){if(t.resizedAttached){if(t.resizedAttached)return void t.resizedAttached.add(e)}else t.resizedAttached=new function(){var t,e;this.q=[],this.add=function(t){this.q.push(t)},this.call=function(){for(t=0,e=this.q.length;t<e;t++)this.q[t].call()}},t.resizedAttached.add(e);t.resizeSensor=document.createElement(\"div\"),t.resizeSensor.className=\"resize-sensor\";var n=\"position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;\",r=\"position: absolute; left: 0; top: 0; transition: 0s;\";t.resizeSensor.style.cssText=n,t.resizeSensor.innerHTML='<div class=\"resize-sensor-expand\" style=\"'+n+'\"><div style=\"'+r+'\"><\/div><\/div><div class=\"resize-sensor-shrink\" style=\"'+n+'\"><div style=\"'+r+' width: 200%; height: 200%\"><\/div><\/div>',t.appendChild(t.resizeSensor),{fixed:1,absolute:1}[function(t,e){return t.currentStyle?t.currentStyle[e]:window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):t.style[e]}(t,\"position\")]||(t.style.position=\"relative\");var i,o,s=t.resizeSensor.childNodes[0],a=s.childNodes[0],u=t.resizeSensor.childNodes[1],c=(u.childNodes[0],function(){a.style.width=s.offsetWidth+10+\"px\",a.style.height=s.offsetHeight+10+\"px\",s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,u.scrollLeft=u.scrollWidth,u.scrollTop=u.scrollHeight,i=t.offsetWidth,o=t.offsetHeight});c();var d=function(t,e,n){t.attachEvent?t.attachEvent(\"on\"+e,n):t.addEventListener(e,n)},f=function(){t.offsetWidth==i&&t.offsetHeight==o||t.resizedAttached&&t.resizedAttached.call(),c()};d(s,\"scroll\",f),d(u,\"scroll\",f)}var i=Object.prototype.toString.call(t),o=\"[object Array]\"===i||\"[object NodeList]\"===i||\"[object HTMLCollection]\"===i||\"undefined\"!=typeof jQuery&&t instanceof jQuery||\"undefined\"!=typeof Elements&&t instanceof Elements;if(o)for(var s=0,a=t.length;s<a;s++)r(t[s],e);else r(t,e);this.detach=function(){if(o)for(var e=0,r=t.length;e<r;e++)n.detach(t[e]);else n.detach(t)}}).detach=function(t){t.resizeSensor&&(t.removeChild(t.resizeSensor),delete t.resizeSensor,delete t.resizedAttached)},void 0!==t&&void 0!==t.exports?t.exports=n:window.ResizeSensor=n},function(t,e,n){var r=n(3),i=n(0),o=n(13),s=n(14)(),a=n(62),u=n(5),c=\"a.twitter-follow-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:r.screenName(t.href),showScreenName:\"false\"!==t.getAttribute(\"data-show-screen-name\"),showCount:\"false\"!==t.getAttribute(\"data-show-count\"),size:t.getAttribute(\"data-size\"),count:t.getAttribute(\"data-count\"),preview:t.getAttribute(\"data-preview\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(89),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(18),i=n(128),o=n(58),s=n(32),a=n(2),u=n(6),c=n(7),d=n(0),f={allowfullscreen:\"true\"},l={position:\"absolute\",visibility:\"hidden\",width:\"0px\",height:\"0px\"},h={position:\"static\",visibility:\"visible\"},p={};i(function(t,e,n){var r=p[t];if(r)return e=e||1,n=n||1,r.styleSelf({width:e+\"px\",height:n+\"px\"}).then(function(){r.didResize()})},function(t){var e=p[t];if(e)return e._rendered.resolve()},function(t,e){var n=p[t];n&&e&&n.setIframeVersion(e)}),t.exports=function(t){t.overrideProperty(\"id\",{get:function(){return this.sandboxEl&&this.sandboxEl.id}}),t.overrideProperty(\"initialized\",{get:function(){return!!this.iframeEl}}),t.overrideProperty(\"width\",{get:function(){return this._width}}),t.overrideProperty(\"height\",{get:function(){return this._height}}),t.overrideProperty(\"sandboxEl\",{get:function(){return this.iframeEl}}),t.defineProperty(\"iframeEl\",{get:function(){return this._iframe}}),t.defineProperty(\"iframeVersion\",{get:function(){return this._iframeVersion}}),t.define(\"updateCachedDimensions\",function(){var t=this;return this.initialized?r.read(function(){t._width=t.sandboxEl.offsetWidth,t._height=t.sandboxEl.offsetHeight}):u.resolve()}),t.define(\"setTitle\",function(t){this.iframeEl.title=t}),t.define(\"setWaitToSwapUntilRendered\",function(t){this._waitToSwapUntilRendered=t}),t.define(\"setIframeVersion\",function(t){this._iframeVersion=t}),t.define(\"isRendered\",function(){return this._rendered.promise}),t.define(\"makeVisible\",function(){return this.styleSelf(h)}),t.define(\"didResize\",function(){var t=this,e=t._resizeHandlers.length>0;return this.updateCachedDimensions().then(function(){e&&t._resizeHandlers.forEach(function(e){e(t)})})}),t.define(\"loadDocument\",function(t){var e=new a;return this.initialized?this.iframeEl.src?u.reject(new Error(\"widget already loaded\")):(this.iframeEl.addEventListener(\"load\",e.resolve,!1),this.iframeEl.addEventListener(\"error\",e.reject,!1),this.iframeEl.src=t,e.promise):u.reject(new Error(\"sandbox not initialized\"))}),t.after(\"initialize\",function(){var t=new a;this._iframe=null,this._iframeVersion=null,this._width=this._height=0,this._resizeHandlers=[],this._rendered=t,this._waitToSwapUntilRendered=!1}),t.override(\"insert\",function(t,e,n,i){var a=this;return e=d.aug({id:t},f,e),n=d.aug({},l,n),this._iframe=s(e,n),p[t]=this,a._waitToSwapUntilRendered||this.onResize(o(function(){a.makeVisible()})),r.write(c(i,null,this._iframe))}),t.override(\"onResize\",function(t){this._resizeHandlers.push(t)}),t.after(\"styleSelf\",function(){return this.updateCachedDimensions()})}},function(t,e,n){var r=n(1),i=n(129),o=n(131),s=n(25),a=n(5),u=n(132);t.exports=function(t,e,n){function c(t,e){var n=u(this);s.trigger(t,{target:n,region:e,type:t,data:{}})}function d(e){var n=u(this),r=n&&n.id,i=a.asInt(e.width),o=a.asInt(e.height);r&&void 0!==i&&void 0!==o&&t(r,i,o)}(new i).attachReceiver(new o.Receiver(r,\"twttr.button\")).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.resizeButton\",d),(new i).attachReceiver(new o.Receiver(r,\"twttr.embed\")).bind(\"twttr.private.initialized\",function(t){var e=u(this),r=e&&e.id,i=t.iframe_version;r&&i&&n&&n(r,i)}).bind(\"twttr.private.trigger\",c).bind(\"twttr.private.rendered\",function(){var t=u(this),n=t&&t.id;n&&e&&e(n)}).bind(\"twttr.private.resize\",d)}},function(t,e,n){var r=n(33),i=n(130),o=n(0),s=n(6),a=n(23),u=\"2.0\";function c(t){this.registry=t||{}}function d(t){var e,n;return e=o.isType(\"string\",t),n=o.isType(\"number\",t),e||n||null===t}function f(t,e){return{jsonrpc:u,id:d(t)?t:null,error:e}}c.prototype._invoke=function(t,e){var n,r,i;n=this.registry[t.method],r=t.params||[],r=o.isType(\"array\",r)?r:[r];try{i=n.apply(e.source||null,r)}catch(t){i=s.reject(t.message)}return a.isPromise(i)?i:s.resolve(i)},c.prototype._processRequest=function(t,e){var n,r;return function(t){var e,n,r;return!!o.isObject(t)&&(e=t.jsonrpc===u,n=o.isType(\"string\",t.method),r=!(\"id\"in t)||d(t.id),e&&n&&r)}(t)?(n=\"params\"in t&&(r=t.params,!o.isObject(r)||o.isType(\"function\",r))?s.resolve(f(t.id,i.INVALID_PARAMS)):this.registry[t.method]?this._invoke(t,{source:e}).then(function(e){return n=t.id,{jsonrpc:u,id:n,result:e};var n},function(){return f(t.id,i.INTERNAL_ERROR)}):s.resolve(f(t.id,i.METHOD_NOT_FOUND)),null!=t.id?n:s.resolve()):s.resolve(f(t.id,i.INVALID_REQUEST))},c.prototype.attachReceiver=function(t){return t.attachTo(this),this},c.prototype.bind=function(t,e){return this.registry[t]=e,this},c.prototype.receive=function(t,e){var n,a,u,c=this;try{u=t,t=o.isType(\"string\",u)?r.parse(u):u}catch(t){return s.resolve(f(null,i.PARSE_ERROR))}return e=e||null,a=((n=o.isType(\"array\",t))?t:[t]).map(function(t){return c._processRequest(t,e)}),n?function(t){return s.all(t).then(function(t){return(t=t.filter(function(t){return void 0!==t})).length?t:void 0})}(a):a[0]},t.exports=c},function(t){t.exports={PARSE_ERROR:{code:-32700,message:\"Parse error\"},INVALID_REQUEST:{code:-32600,message:\"Invalid Request\"},INVALID_PARAMS:{code:-32602,message:\"Invalid params\"},METHOD_NOT_FOUND:{code:-32601,message:\"Method not found\"},INTERNAL_ERROR:{code:-32603,message:\"Internal error\"}}},function(t,e,n){var r=n(8),i=n(1),o=n(33),s=n(2),a=n(22),u=n(0),c=n(3),d=n(7),f=a.ie9();function l(t,e,n){var r;t&&t.postMessage&&(f?r=(n||\"\")+o.stringify(e):n?(r={})[n]=e:r=e,t.postMessage(r,\"*\"))}function h(t){return u.isType(\"string\",t)?t:\"JSONRPC\"}function p(t,e){return e?u.isType(\"string\",t)&&0===t.indexOf(e)?t.substring(e.length):t&&t[e]?t[e]:void 0:t}function m(t,e){var n=t.document;this.filter=h(e),this.server=null,this.isTwitterFrame=c.isTwitterURL(n.location.href),t.addEventListener(\"message\",d(this._onMessage,this),!1)}function v(t,e){this.pending={},this.target=t,this.isTwitterHost=c.isTwitterURL(r.href),this.filter=h(e),i.addEventListener(\"message\",d(this._onMessage,this),!1)}u.aug(m.prototype,{_onMessage:function(t){var e,n=this;this.server&&(this.isTwitterFrame&&!c.isTwitterURL(t.origin)||(e=p(t.data,this.filter))&&this.server.receive(e,t.source).then(function(e){e&&l(t.source,e,n.filter)}))},attachTo:function(t){this.server=t},detach:function(){this.server=null}}),u.aug(v.prototype,{_processResponse:function(t){var e=this.pending[t.id];e&&(e.resolve(t),delete this.pending[t.id])},_onMessage:function(t){var e;if((!this.isTwitterHost||c.isTwitterURL(t.origin))&&(e=p(t.data,this.filter))){if(u.isType(\"string\",e))try{e=o.parse(e)}catch(t){return}(e=u.isType(\"array\",e)?e:[e]).forEach(d(this._processResponse,this))}},send:function(t){var e=new s;return t.id?this.pending[t.id]=e:e.resolve(),l(this.target,t,this.filter),e.promise}}),t.exports={Receiver:m,Dispatcher:v,_stringifyPayload:function(t){return arguments.length>0&&(f=!!t),f}}},function(t,e,n){var r=n(4);t.exports=function(t){for(var e,n=r.getElementsByTagName(\"iframe\"),i=0;n[i];i++)if((e=n[i]).contentWindow===t)return e}},function(t,e,n){var r=n(5),i=n(0),o=n(3),s=n(13),a=n(14)(),u=n(63),c=\"a.twitter-moment\";t.exports=function(t){return a(t,c).map(function(t){return u(function(t){var e=s(t),n={momentId:o.momentId(t.href),chrome:t.getAttribute(\"data-chrome\"),limit:t.getAttribute(\"data-limit\")};return i.forIn(n,function(t,n){var i=e[t];e[t]=r.hasValue(i)?i:n}),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(4)]).then(function(r){var o;try{o=n(90),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0),i=n(13),o=n(14)(),s=n(64),a=\"a.periscope-on-air\",u=/^https?:\\/\\/(?:www\\.)?(?:periscope|pscp)\\.tv\\/@?([a-zA-Z0-9_]+)\\/?$/i;t.exports=function(t){return o(t,a).map(function(t){return s(function(t){var e=i(t),n=t.getAttribute(\"href\"),o=t.getAttribute(\"data-size\"),s=u.exec(n)[1];return r.aug(e,{username:s,size:o})}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(5).then(function(r){var o;try{o=n(91),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(5),i=n(0),o=n(65),s=n(13),a=n(14)(),u=n(66),c=n(3),d=n(12),f=\"a.twitter-timeline,div.twitter-timeline,a.twitter-grid\",l=\"Embedded Search timelines have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",h=\"You may have been affected by an update to settings in embedded timelines. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\",p=\"Embedded grids have been deprecated and will now render as timelines. Please update your embed code to use the twitter-timeline class. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\";t.exports=function(t){return a(t,f).map(function(t){return u(function(t){var e=s(t),n=t.getAttribute(\"data-show-replies\"),a={isPreconfigured:!!t.getAttribute(\"data-widget-id\"),chrome:t.getAttribute(\"data-chrome\"),tweetLimit:t.getAttribute(\"data-tweet-limit\")||t.getAttribute(\"data-limit\"),ariaLive:t.getAttribute(\"data-aria-polite\"),theme:t.getAttribute(\"data-theme\"),borderColor:t.getAttribute(\"data-border-color\"),showReplies:n?r.asBoolean(n):null,profileScreenName:t.getAttribute(\"data-screen-name\"),profileUserId:t.getAttribute(\"data-user-id\"),favoritesScreenName:t.getAttribute(\"data-favorites-screen-name\"),favoritesUserId:t.getAttribute(\"data-favorites-user-id\"),likesScreenName:t.getAttribute(\"data-likes-screen-name\"),likesUserId:t.getAttribute(\"data-likes-user-id\"),listOwnerScreenName:t.getAttribute(\"data-list-owner-screen-name\"),listOwnerUserId:t.getAttribute(\"data-list-owner-id\"),listId:t.getAttribute(\"data-list-id\"),listSlug:t.getAttribute(\"data-list-slug\"),customTimelineId:t.getAttribute(\"data-custom-timeline-id\"),staticContent:t.getAttribute(\"data-static-content\"),url:t.href};return a.isPreconfigured&&(c.isSearchUrl(a.url)?d.publicError(l,t):d.publicLog(h,t)),\"twitter-grid\"===t.className&&d.publicLog(p,t),(a=i.aug(a,e)).dataSource=o(a),a.id=a.dataSource&&a.dataSource.id,a}(t),t.parentNode,t)})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(141)])},function(t,e,n){var r=n(0),i=n(140);t.exports=function(t){return\"en\"===t||r.contains(i,t)}},function(t,e){t.exports=[\"hi\",\"zh-cn\",\"fr\",\"zh-tw\",\"msa\",\"fil\",\"fi\",\"sv\",\"pl\",\"ja\",\"ko\",\"de\",\"it\",\"pt\",\"es\",\"ru\",\"id\",\"tr\",\"da\",\"no\",\"nl\",\"hu\",\"fa\",\"ar\",\"ur\",\"he\",\"th\",\"cs\",\"uk\",\"vi\",\"ro\",\"bn\",\"el\",\"en-gb\",\"gu\",\"kn\",\"mr\",\"ta\",\"bg\",\"ca\",\"hr\",\"sr\",\"sk\"]},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"collection:\";function a(t,e){return r.collectionId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"collection\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{collection_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(143)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"event:\";function a(t,e){return r.eventId(t)||e}t.exports=function(t){t.params({id:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params.url,this.params.id);return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"event\"])}}),t.around(\"queryParams\",function(t){return i.aug(t(),{event_id:a(this.params.url,this.params.id)})}),t.before(\"initialize\",function(){if(!a(this.params.url,this.params.id))throw new Error(\"one of url or id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(145)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"likes:\";function a(t){return r.likesScreenName(t.url)||t.screenName}t.exports=function(t){t.params({screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=a(this.params)||this.params.userId;return s+t}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"likes\"])}}),t.define(\"_getLikesQueryParam\",function(){var t=a(this.params);return t?{screen_name:t}:{user_id:this.params.userId}}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getLikesQueryParam())}),t.before(\"initialize\",function(){if(!a(this.params)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(147)])},function(t,e,n){var r=n(3),i=n(0),o=n(19),s=\"list:\";function a(t){var e=r.listScreenNameAndSlug(t.url)||t;return i.compact({screen_name:e.ownerScreenName,user_id:e.ownerUserId,list_slug:e.slug})}t.exports=function(t){t.params({id:{},ownerScreenName:{},ownerUserId:{},slug:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t,e,n;return this.params.id?s+this.params.id:(e=(t=a(this.params))&&t.list_slug.replace(/-/g,\"_\"),n=t&&(t.screen_name||t.user_id),s+(n+\":\")+e)}}),t.overrideProperty(\"endpoint\",{get:function(){return o.timeline([\"list\"])}}),t.define(\"_getListQueryParam\",function(){return this.params.id?{list_id:this.params.id}:a(this.params)}),t.around(\"queryParams\",function(t){return i.aug(t(),this._getListQueryParam())}),t.before(\"initialize\",function(){var t=a(this.params);if(i.isEmptyObject(t)&&!this.params.id)throw new Error(\"qualified slug or list id required\")})}},function(t,e,n){var r=n(28);t.exports=r.build([n(29),n(149)])},function(t,e,n){var r=n(3),i=n(5),o=n(0),s=n(19),a=\"profile:\";function u(t,e){return r.screenName(t)||e}t.exports=function(t){t.params({showReplies:{fallback:!1,transform:i.asBoolean},screenName:{},userId:{},url:{}}),t.overrideProperty(\"id\",{get:function(){var t=u(this.params.url,this.params.screenName);return a+(t||this.params.userId)}}),t.overrideProperty(\"endpoint\",{get:function(){return s.timeline([\"profile\"])}}),t.define(\"_getProfileQueryParam\",function(){var t=u(this.params.url,this.params.screenName),e=t?{screen_name:t}:{user_id:this.params.userId};return o.aug(e,{with_replies:this.params.showReplies?\"true\":\"false\"})}),t.around(\"queryParams\",function(t){return o.aug(t(),this._getProfileQueryParam())}),t.before(\"initialize\",function(){if(!u(this.params.url,this.params.screenName)&&!this.params.userId)throw new Error(\"screen name or user id is required\")})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(6)]).then(function(r){var o;try{o=n(92),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(3),o=n(0),s=n(13),a=n(14)(),u=n(67),c=\"blockquote.twitter-tweet, blockquote.twitter-video\",d=/\\btw-align-(left|right|center)\\b/;t.exports=function(t,e){return a(t,c).map(function(t){return u(function(t){var e=s(t),n=t.getElementsByTagName(\"A\"),a=n&&n[n.length-1],u=a&&i.status(a.href),c=t.getAttribute(\"data-conversation\"),f=\"none\"==c||\"hidden\"==c||r.present(t,\"tw-hide-thread\"),l=t.getAttribute(\"data-cards\"),h=\"none\"==l||\"hidden\"==l||r.present(t,\"tw-hide-media\"),p=t.getAttribute(\"data-align\")||t.getAttribute(\"align\"),m=t.getAttribute(\"data-theme\");return!p&&d.test(t.className)&&(p=RegExp.$1),o.aug(e,{tweetId:u,hideThread:f,hideCard:h,align:p,theme:m,id:u})}(t),t.parentNode,t,e)})}},function(t,e,n){var r=n(86),i=n(21),o=\"tfw_horizon_tweet_embed_9555\";t.exports=function(t,e){var n;t&&(n=t[o])&&n.bucket&&r(o,n.bucket,n.version,i.formatHorizonTweetData(e))}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(7).then(function(r){var o;try{o=n(93),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return Promise.all([n.e(0),n.e(8)]).then(function(r){var o;try{o=n(94),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(10),i=n(0),o=n(13),s=n(14)(),a=n(69),u=n(5),c=\"a.twitter-share-button, a.twitter-mention-button, a.twitter-hashtag-button\",d=\"twitter-hashtag-button\",f=\"twitter-mention-button\";t.exports=function(t){return s(t,c).map(function(t){return a(function(t){var e=o(t),n={screenName:t.getAttribute(\"data-button-screen-name\"),text:t.getAttribute(\"data-text\"),type:t.getAttribute(\"data-type\"),size:t.getAttribute(\"data-size\"),url:t.getAttribute(\"data-url\"),hashtags:t.getAttribute(\"data-hashtags\"),via:t.getAttribute(\"data-via\"),buttonHashtag:t.getAttribute(\"data-button-hashtag\")};return i.forIn(n,function(t,n){var r=e[t];e[t]=u.hasValue(r)?r:n}),e.screenName=e.screenName||e.screen_name,e.buttonHashtag=e.buttonHashtag||e.button_hashtag||e.hashtag,r.present(t,d)&&(e.type=\"hashtag\"),r.present(t,f)&&(e.type=\"mention\"),e}(t),t.parentNode,t)})}},function(t,e,n){var r=n(2);t.exports=function(t,e){var i=new r;return n.e(3).then(function(r){var o;try{o=n(95),i.resolve(new o(t,e))}catch(t){i.reject(t)}}.bind(null,n)).catch(function(t){i.reject(t)}),i.promise}},function(t,e,n){var r=n(0);t.exports=r.aug({},n(158),n(159),n(160),n(161),n(162),n(163),n(164))},function(t,e,n){var r=n(59),i=n(17)([\"userId\"],{},r);t.exports={createDMButton:i}},function(t,e,n){var r=n(62),i=n(17)([\"screenName\"],{},r);t.exports={createFollowButton:i}},function(t,e,n){var r=n(63),i=n(17)([\"momentId\"],{},r);t.exports={createMoment:i}},function(t,e,n){var r=n(64),i=n(17)([\"username\"],{},r);t.exports={createPeriscopeOnAirButton:i}},function(t,e,n){var r=n(8),i=n(12),o=n(3),s=n(0),a=n(5),u=n(65),c=n(66),d=n(17)([],{},c),f=n(6),l=\"Embedded grids have been deprecated. Please use twttr.widgets.createTimeline instead. More info: https://twittercommunity.com/t/update-on-the-embedded-grid-display-type/119564.\",h={createTimeline:p,createGridFromCollection:function(t){var e=s.toRealArray(arguments).slice(1),n={sourceType:\"collection\",id:t};return e.unshift(n),i.publicLog(l),p.apply(this,e)}};function p(t){var e,n=s.toRealArray(arguments).slice(1);return a.isString(t)||a.isNumber(t)?f.reject(\"Embedded timelines with widget settings have been deprecated. See https://twittercommunity.com/t/deprecating-widget-settings/102295.\"):s.isObject(t)?(t=t||{},n.forEach(function(t){s.isType(\"object\",t)&&function(t){t.ariaLive=t.ariaPolite}(e=t)}),e||(e={},n.push(e)),t.lang=e.lang,t.tweetLimit=e.tweetLimit,t.showReplies=e.showReplies,e.dataSource=u(t),d.apply(this,n)):f.reject(\"data source must be an object.\")}o.isTwitterURL(r.href)&&(h.createTimelinePreview=function(t,e,n){var r={previewParams:t,useLegacyDefaults:!0,isPreviewTimeline:!0};return r.dataSource=u(r),d(e,r,n)}),t.exports=h},function(t,e,n){var r,i=n(0),o=n(67),s=n(17),a=(r=s([\"tweetId\"],{},o),function(){return i.toRealArray(arguments).slice(1).forEach(function(t){i.isType(\"object\",t)&&(t.hideCard=\"none\"==t.cards||\"hidden\"==t.cards,t.hideThread=\"none\"==t.conversation||\"hidden\"==t.conversation)}),r.apply(this,arguments)});t.exports={createTweet:a,createTweetEmbed:a,createVideo:a}},function(t,e,n){var r=n(0),i=n(69),o=n(17),s=o([\"url\"],{type:\"share\"},i),a=o([\"buttonHashtag\"],{type:\"hashtag\"},i),u=o([\"screenName\"],{type:\"mention\"},i);function c(t){return function(){return r.toRealArray(arguments).slice(1).forEach(function(t){r.isType(\"object\",t)&&(t.screenName=t.screenName||t.screen_name,t.buttonHashtag=t.buttonHashtag||t.button_hashtag||t.hashtag)}),t.apply(this,arguments)}}t.exports={createShareButton:c(s),createHashtagButton:c(a),createMentionButton:c(u)}},function(t,e,n){var r,i,o,s=n(4),a=n(1),u=0,c=[],d=s.createElement(\"a\");function f(){var t,e;for(u=1,t=0,e=c.length;t<e;t++)c[t]()}/^loade|c/.test(s.readyState)&&(u=1),s.addEventListener&&s.addEventListener(\"DOMContentLoaded\",i=function(){s.removeEventListener(\"DOMContentLoaded\",i,!1),f()},!1),d.doScroll&&s.attachEvent(\"onreadystatechange\",r=function(){/^c/.test(s.readyState)&&(s.detachEvent(\"onreadystatechange\",r),f())}),o=d.doScroll?function(t){a.self!=a.top?u?t():c.push(t):function(){try{d.doScroll(\"left\")}catch(e){return setTimeout(function(){o(t)},50)}t()}()}:function(t){u?t():c.push(t)},t.exports=o},function(t,e,n){var r=n(47),i=n(9);t.exports=function(){i.set(\"buildVersion\",r.version)}},function(t,e,n){n(168),n(87),n(171)},function(t,e,n){var r=n(169),i=n(30),o=n(70),s=new r,a=function(t){t.widgets&&1===t.widgets.length&&(s.start(),i.emitter.unbind(i.ALL_WIDGETS_RENDER_START,a))},u=function(t){var e;t.widgets&&1===t.widgets.length&&(e=t.widgets[0],s.end(),e.dataset&&e.dataset.tweetId&&o({duration:s.duration(),namespace:{element:\"tweet\",action:\"render\"},widgetIds:[e.dataset.tweetId]})),i.emitter.unbind(i.ALL_WIDGETS_RENDER_END,u)};i.emitter.bind(i.ALL_WIDGETS_RENDER_START,a),i.emitter.bind(i.ALL_WIDGETS_RENDER_END,u)},function(t,e,n){var r=n(170);function i(){}i.prototype.start=function(){this._startTime=r()},i.prototype.end=function(){this._duration=r()-this._startTime},i.prototype.duration=function(){return this._duration},t.exports=i},function(t,e,n){var r=n(1);t.exports=function(){return r.performance&&r.performance.now?r.performance.now():Date.now()}},function(t,e,n){var r=n(30),i=n(70),o=n(172),s=n(3),a=n(1),u=n(0),c=n(22),d=n(61);function f(t){return t.performance.getEntriesByType(\"resource\").filter(function(t){return s.isTwimgURL(t.name)||s.isTwitterURL(t.name)}).reduce(function(t,e){return t[e.name]=e.duration,t},{})}r.emitter.bind(r.ALL_WIDGETS_AND_IMAGES_LOADED,function(t){var e,n,r=[];c.hasPerformanceInformation()&&(e=f(a),d.isSupported()||(r=function(t){return t.reduce(function(t,e){return u.aug(t,f(e.contentDocument.defaultView))},{})}(t)),n=u.aug({},e,r),Object.keys(o).forEach(function(t){!function(t,e,n){var r=Object.keys(t).reduce(function(e,r){return n(r)?e+t[r]:e},0);i({duration:r,namespace:{element:e,action:\"resource\"}})}(n,t,o[t])}))})},function(t,e,n){var r=n(3),i={all:function(){return!0},image:function(t){return r.isTwimgURL(t)},settings:function(t){return r.isSettingsURL(t)},widget_iframe:function(t){return r.isWidgetIframeURL(t)}};t.exports=i}])));The idea is to compare the number of deceased people in 2020 with the trends in the past 10 years for the same time interval. Unusual spikes in the number of deceased people, particularly people with an age of 65 or above, in 2020 in a specific city or for a specific time interval can give an idea about when the virus started spreading.\r\nThe official government website (https://www.turkiye.gov.tr/) includes the raw data of every deceased individual for 11 major cities.\r\nBursa\r\nDenizli\r\nDiyarbakir\r\nErzurum\r\nIstanbul\r\nKahramanmaras\r\nKocaeli\r\nKonya\r\nMalatya\r\nSakarya\r\nTekirdag\r\nFor instance, this is how the webpage looks like for Istanbul. First, you enter the date in DD/MM/YYYY format and then submit the button.\r\nScreenshot from https://www.turkiye.gov.tr/istanbul-buyuksehir-belediyesi-vefat-sorgulamaIt returns a table with six columns with the following information:\r\nFirst Name, Last Name\r\nFather Name\r\nBirth Date\r\nAge when deceased\r\nDiagnosed cause of death\r\nDetail (gives more information about funeral when clicked)\r\nOutput table from the requestThese tables were scraped for each day for each city beginning from Jan 01, 2010 so users can explore the trends for any specific day or date range during the past 10 years. The app is being updated on a daily basis by continuously scraping data from the original source.\r\nhttps://cengiz-shiny.app/shiny/deceased_turkey/.\r\n\r\n\r\n",
    "preview": "posts/scraping-turkey.gov.tr/files/plot.jpg",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {}
  },
  {
    "path": "posts/grmint/",
    "title": "Intersection Points Between Two Adjacent Categories in the Graded Response Model",
    "description": "The interpretation of between-category thresholds in the Graded Response Model is different than the step difficulty parameters in the RSM/PCM/GPCM family due to a different functional form. While the step parameters in the RSM/PCM/GPCM family represent the point on the latent trait continuum where one category becomes more likely than the previous category, it is not the same for between-category thresholds in the Graded Response Model. So, this post is my response to a curious student who wondered at what point on the latent trait continuum the intersections occur between two adjacent categories for the Graded Response Model.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2020-02-26",
    "categories": [
      "2020",
      "item response theory",
      "graded response model"
    ],
    "contents": "\r\nOne of the IRT models available for polytomous response outcomes (response outcomes with more than two categories) is the Graded Response Model (GRM). GRM can be used for questionnaires with common rating scale items in which item responses are ordered categorical responses such as Strongly Disagree (0), Disagree (1), Agree (2), and Strongly Agree (3).\r\nIn GRM, for an item with \\(K\\) categories (k=0,1,2,…K), the probability of selecting a response category j (j=1,2,..K) or above is defined as:\r\n\\[\r\nP(y\\geq j)=\\frac{1}{1+e^{a(\\delta_j-\\theta)}},\r\n\\] where \\(a\\) is the item discrimination, \\(\\delta_j\\) is the between-category threshold between category \\(j-1\\) and category \\(j\\), and \\(\\theta\\) is the latent trait for the respondent. The number of between-category thresholds for each item is equal to K-1. The probability of selecting each response category is subsequently defined as:\r\n\\[\r\nP(y=0) = 1 - P(y\\geq 1)\r\n\\] \\[\r\nP(y=1) = P(y\\geq 1)  - P(y\\geq 2)\r\n\\] \\[\r\nP(y=2) = P(y\\geq 2)  - P(y\\geq 3)\r\n\\] \\[\r\n...\r\n\\] \\[\r\nP(y=K)=P(y\\geq K).\r\n\\]\r\nBelow is a plot called Category Response Curves for a hypothetical 5-point rating scale item with parameters \\(a=2\\), \\(\\delta_1=-3\\), \\(\\delta_2=-2\\), \\(\\delta_3=0\\), and \\(\\delta_4=1\\).\r\n\r\n\r\n\r\nFigure 1: Graded Response Model Category Response Curves\r\n\r\n\r\n\r\nCategory Response Curves display the probability of selecting each response category as a function of \\(\\theta\\). Vertical lines in Figure 1 represents the points on the latent trait continuum, where \\(\\theta=\\delta_1\\), \\(\\theta=\\delta_2\\), \\(\\theta=\\delta_3\\), and \\(\\theta=\\delta_4\\). The interpretation of between-category thresholds in GRM is that they represent the point on the latent trait continuum where the probability of responding to a certain category or above is equal to 0.5. For instance, \\(\\delta_2=-2\\) means that the probability of choosing Category 2 or above is equal to .5 when \\(\\theta=-2\\). In other words, the three blue dots on the vertical line where \\(\\theta=\\delta_2=-2\\) represent the probability of responding Category 2, Category 3, and Category 4 and the sum of these three probabilities is equal to 0.5. Or, similarly, the two blue dots on the vertical line where \\(\\theta=\\delta_3=0\\) represents the probability of choosing response category 3 and Category 4 and the sum is equal to 0.5.\r\nThe interpretation of the category thresholds (also called step difficulty) is different for a different family of models [Rating Scale Model(RSM), Partial Credit Model(PCM), and Generalized Partial Credit Model(GPCM)]. In GPCM, we can directly write the probability of responding to a certain category:\r\n\\[\r\nP(y=j)=\\frac{e^{\\sum_{h=0}^{j}a(\\theta-\\delta_j)}}{\\sum_{j=0}^{K}e^{\\sum_{h=0}^{j}a(\\theta-\\delta_j)}}\r\n\\]\r\nThe between-category thresholds in GPCM are easier to interpret. They are simply the intersection points between any two adjacent categories. For instance, suppose we plot the Category Response Curves for GPCM for the same set of parameters, \\(a=2\\), \\(\\delta_1=-3\\), \\(\\delta_2=-2\\), \\(\\delta_3=0\\), and \\(\\delta_4=1\\). You will see that the intersection points between two adjacent categories (the point where one category becomes more likely than the previous category) occur exactly when \\(\\theta=\\delta_j\\).\r\n\r\n\r\n\r\nFigure 2: Generalized Partial Credit Model Category Response Curves\r\n\r\n\r\n\r\nWhere do the intersection points occur for the Graded Response Model?\r\nLet’s go back to Figure 1. Notice that the intersection points in GRM are happening somewhere else, not necessarily when \\(\\theta=\\delta_j\\). As we talk about these things and the differences between GRM and GPCM, a student asked me “OK, so where do they occur, then?” I didn’t know. I said I would think about it and got back to them. I don’t remember I have ever read anything or seen any equation that would provide the intersection points for GRM. Are they important for any practical reason? Probably no! After the class, I have checked a few IRT textbooks to make sure it is not hidden somewhere as appendix or supplemental information. I couldn’t find anything. So, I decided to spend some time on it.\r\n\r\n\r\n\r\nFigure 3: Graded Response Model Category Response Curves\r\n\r\n\r\n\r\nTechnically, it should be simple. We know that the probability of responding category \\(j\\) is equal to the probability of responding category \\(j+1\\) at those intersection points. For instance, we can write the following for the first intersection point:\r\n\\[\r\nP(y=0) = P(y=1)\r\n\\] \\[\r\n1 - P(y\\geq 1) = P(y\\geq 1)  - P(y\\geq 2)\r\n\\] \\[\r\n2 P(y\\geq 1)  - P(y\\geq 2) - 1 = 0\r\n\\] \\[\r\n\\frac{2}{1+e^{a(\\delta_1-\\theta)}}  - \\frac{1}{1+e^{a(\\delta_2-\\theta)}} - 1 = 0\r\n\\]\r\nSimilarly, we can write the following for the second intersection point:\r\n\\[\r\nP(y=1) = P(y=2)\r\n\\] \\[\r\nP(y\\geq 1)  - P(y\\geq 2) = P(y\\geq 2)  - P(y\\geq 3)\r\n\\] \\[\r\nP(y\\geq 1)  - 2 P(y\\geq 2) - P(y\\geq 3) = 0\r\n\\] \\[\r\n\\frac{1}{1+e^{a(\\delta_1-\\theta)}}  - \\frac{2}{1+e^{a(\\delta_2-\\theta)}} - \\frac{1}{1+e^{a(\\delta_3-\\theta)}} = 0\r\n\\] Let’s do it one more time for the third intersection point because I want to see a pattern emerging before diving into it.\r\n\\[\r\nP(y=2) = P(y=3)\r\n\\] \\[\r\nP(y\\geq 2)  - P(y\\geq 3) = P(y\\geq 3)  - P(y\\geq 4)\r\n\\] \\[\r\nP(y\\geq 2)  - 2 P(y\\geq 3) - P(y\\geq 4) = 0\r\n\\] \\[\r\n\\frac{1}{1+e^{a(\\delta_2-\\theta)}}  - \\frac{2}{1+e^{a(\\delta_3-\\theta)}} - \\frac{1}{1+e^{a(\\delta_4-\\theta)}} = 0\r\n\\] Finally, for the last intersection point:\r\n\\[\r\nP(y=3) = P(y=4)\r\n\\] \\[\r\nP(y\\geq 3)  - P(y\\geq 4) = P(y\\geq 4)\r\n\\] \\[\r\nP(y\\geq 3)  - 2 P(y\\geq 4) = 0\r\n\\] \\[\r\n\\frac{1}{1+e^{a(\\delta_3-\\theta)}} - \\frac{2}{1+e^{a(\\delta_4-\\theta)}} = 0\r\n\\]\r\nAll we need to do is to solve these equations for \\(\\theta\\), and that solution should give us the point on the theta continuum where one category becomes more likely than the previous one for GRM. Sounds easy, right? Well, it was ugly.\r\nFirst, it seems that we can not find a general equation that works for all intersection points because the equation for the first intersection and the equation for the last intersection are structurally different. However, there should be a general equation for any intersection between the first and last intersection as they have similar form of equation. After spending a few hours, pulling my hairs and beard several times, I come up with some equations. For the first intersection:\r\n\\[I_{0,1}=\\frac{ln(\\frac{e^{a\\delta_1+a\\delta_2}}{e^{a\\delta_2}-2e^{a\\delta_1}})}{a}\\]\r\nFor the last intersection:\r\n\\[I_{K-1,K}=\\frac{ln(e^{a\\delta_k}-2e^{a\\delta_{k-1}})}{a}\\] For any other intersection between two adjacent categories (excluding the first and last intersection):\r\n\\[I_{j,j+1}=\\frac{ln(\r\n\\frac{e^{a\\delta_{j}+a\\delta_{j+1}}+e^{a\\delta_{j+1}+a\\delta_{j+2}}-2e^{a\\delta_{j}+a\\delta_{j+2}}}\r\n{e^{a\\delta_{j}}+e^{a\\delta_{j+2}}-2e^{a\\delta_{j+1}}})}\r\n{a}\\]\r\nI checked them numerically, and they seem to be holding together. I tried but couldn’t simplify them further. I wish I could put them in a nice-looking equation. For those who are interested, this file has some algebra starting from the equations above and solving them for \\(\\theta\\).\r\nAppendix\r\nR code for Figure 2\r\n\r\n\r\na  = 2\r\nd1 = -3\r\nd2 = -2\r\nd3 = 0\r\nd4 = 1\r\n\r\ntheta <- seq(from=-4,to=4,.01)\r\n\r\nexp0 = 1\r\nexp1 = exp(a*(theta-d1))\r\nexp2 = exp(a*(theta-d1)+a*(theta-d2))\r\nexp3 = exp(a*(theta-d1)+a*(theta-d2)+a*(theta-d3))\r\nexp4 = exp(a*(theta-d1)+a*(theta-d2)+a*(theta-d3)+a*(theta-d4))\r\n\r\np0 = exp0/(exp0+exp1+exp2+exp3+exp4)\r\np1 = exp1/(exp0+exp1+exp2+exp3+exp4)\r\np2 = exp2/(exp0+exp1+exp2+exp3+exp4)\r\np3 = exp3/(exp0+exp1+exp2+exp3+exp4)\r\np4 = exp4/(exp0+exp1+exp2+exp3+exp4)\r\n\r\nplot(theta,p0,type=\"l\",ylim=c(0,1),xlab=expression(theta),ylab=\"P(y=k)\",xaxt='n')\r\naxis(side=1,at=seq(-4,4,1))\r\npoints(theta,p1,type=\"l\")\r\npoints(theta,p2,type=\"l\")\r\npoints(theta,p3,type=\"l\")\r\npoints(theta,p4,type=\"l\")\r\ntext(-4,.93,\"Cat 0\")\r\ntext(-2.5,.6,\"Cat 1\")\r\ntext(-1,.81,\"Cat 2\")\r\ntext(.5,.61,\"Cat 3\")\r\ntext(3.5,.95,\"Cat 4\")\r\nabline(v=d1,lty=2,col=\"gray\")\r\nabline(v=d2,lty=2,col=\"gray\")\r\nabline(v=d3,lty=2,col=\"gray\")\r\nabline(v=d4,lty=2,col=\"gray\")\r\n\r\npoints(d1,p1[which(theta==d1)],type=\"p\",pch=16,cex=1,col=\"blue\")\r\npoints(d2,p2[which(theta==d2)],type=\"p\",pch=16,cex=1,col=\"blue\")\r\npoints(d3,p3[which(theta==d3)],type=\"p\",pch=16,cex=1,col=\"blue\")\r\npoints(d4,p4[which(theta==d4)],type=\"p\",pch=16,cex=1,col=\"blue\")\r\n\r\ntext(d1+.12,.95,expression(delta[1]))\r\ntext(d2+.12,.95,expression(delta[2]))\r\ntext(d3+.12,.95,expression(delta[3]))\r\ntext(d4+.12,.95,expression(delta[4]))\r\n\r\nR code for Figure 3\r\n\r\n\r\na  = 2\r\nd1 = -3\r\nd2 = -2\r\nd3 = 0\r\nd4 = 1\r\n\r\ntheta <- seq(from=-4,to=4,.01)\r\n\r\np1orabove = 1/(1+exp(a*(d1-theta)))\r\np2orabove = 1/(1+exp(a*(d2-theta)))\r\np3orabove = 1/(1+exp(a*(d3-theta)))\r\np4orabove = 1/(1+exp(a*(d4-theta)))\r\n\r\np0 = 1-p1orabove\r\np1 = p1orabove - p2orabove\r\np2 = p2orabove - p3orabove\r\np3 = p3orabove - p4orabove\r\np4 = p4orabove\r\n\r\nplot(theta,p0,type=\"l\",ylim=c(0,1),xlab=expression(theta),ylab=\"P(y=k)\",xaxt='n')\r\naxis(side=1,at=seq(-4,4,1))\r\npoints(theta,p1,type=\"l\")\r\npoints(theta,p2,type=\"l\")\r\npoints(theta,p3,type=\"l\")\r\npoints(theta,p4,type=\"l\")\r\ntext(-4,.93,\"Cat 0\")\r\ntext(-2.5,.49,\"Cat 1\")\r\ntext(-1,.79,\"Cat 2\")\r\ntext(.5,.49,\"Cat 3\")\r\ntext(3.5,.95,\"Cat 4\")\r\n\r\nint1 = log(exp(a*d1+a*d2)/(exp(a*d2)-2*exp(a*d1)))/a\r\nint2 = log((exp(a*d1+a*d2)+exp(a*d2+a*d3)-(2*exp(a*d1+a*d3)))/(exp(a*d1)+exp(a*d3)-(2*exp(a*d2))))/a\r\nint3 = log((exp(a*d2+a*d3)+exp(a*d3+a*d4)-(2*exp(a*d2+a*d4)))/(exp(a*d2)+exp(a*d4)-(2*exp(a*d3))))/a\r\nint4 = log(exp(a*d4)-2*exp(a*d3))/a\r\n\r\np1orabove = 1/(1+exp(a*(d1-int1)))\r\np0 = 1-p1orabove\r\npoints(int1,p0,type=\"p\",pch=16,cex=1,col=\"blue\")\r\n\r\np1orabove = 1/(1+exp(a*(d1-int2)))\r\np2orabove = 1/(1+exp(a*(d2-int2)))\r\np1 = p1orabove-p2orabove\r\npoints(int2,p1,type=\"p\",pch=16,cex=1,col=\"blue\")\r\n\r\np2orabove = 1/(1+exp(a*(d2-int3)))\r\np3orabove = 1/(1+exp(a*(d3-int3)))\r\np2 = p2orabove-p3orabove\r\npoints(int3,p2,type=\"p\",pch=16,cex=1,col=\"blue\")\r\n\r\np3orabove = 1/(1+exp(a*(d3-int4)))\r\np4orabove = 1/(1+exp(a*(d4-int4)))\r\np3 = p3orabove-p4orabove\r\npoints(int4,p3,type=\"p\",pch=16,cex=1,col=\"blue\")\r\n\r\nabline(v=d1,lty=2,col=\"gray\")\r\nabline(v=d2,lty=2,col=\"gray\")\r\nabline(v=d3,lty=2,col=\"gray\")\r\nabline(v=d4,lty=2,col=\"gray\")\r\n\r\n\r\ntext(d1+.12,.95,expression(delta[1]))\r\ntext(d2+.12,.95,expression(delta[2]))\r\ntext(d3+.12,.95,expression(delta[3]))\r\ntext(d4+.12,.95,expression(delta[4]))\r\n\r\n\r\n\r\n",
    "preview": "posts/grmint/files/grm.jpeg",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {}
  },
  {
    "path": "posts/shinyapp/",
    "title": "This is a test post with a Shiny App",
    "description": "Shiny app",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2020-01-07",
    "categories": [
      "2019"
    ],
    "contents": "\r\nThis is a post to test how to embed external Shiny apps in html posts, and whether or not it works.\r\nBelow is a shiny app I developed long time ago. I deployed it in a Shiny Server on cloud. If this works, I plan to develop interactive shiny apps for the concepts I am teaching and then prepare my course notes as interactive web pages with these apps embedded. A big dream I have no idea how long it would take me to complete.\r\nIf you want to test whether or not the app is working, enter your name and up to two more names (with the first letter capitalized) and it should create a trend plot based on a database from Social Security Administration. You should change the y-axis from the side bar to zoom for the trend of rare names.\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/shinyapp/images/image.png",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {},
    "preview_width": 1920,
    "preview_height": 978
  },
  {
    "path": "posts/crm-stan/",
    "title": "Measuring Oral Reading Fluency: A Case for Samejima's Continuous Response Model",
    "description": "I pitched the idea of using Samejima's Continuous Response Model (CRM) to measure the Oral Reading Fluency (ORF) a while ago when I published a paper in 2012. In that paper, I used an ORF dataset from the Minneapolis Public Schools District (MPS) as a real data example. Since then, I don't think anybody has bought the idea of using CRM to measure ORF, so here I am trying one more time with some accessible R code.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-12-31",
    "categories": [
      "item response theory",
      "continuous response model",
      "Stan",
      "R",
      "2019"
    ],
    "contents": "\r\n\r\n\r\nbody {\r\ntext-align: justify}\r\n\r\n\r\n\r\n\r\nI pitched the idea of using Samejima’s Continuous Response Model (CRM) to measure the Oral Reading Fluency (ORF) a while ago when I published a paper as a graduate student. In that paper, I used an ORF dataset from the Minneapolis Public Schools Disctrict (MPS) as a real data example. Since then, I don’t think anybody has bought the idea for using CRM to measure ORF, so here I am trying one more time with some accessible R code.\r\nThe ORF dataset from MPS was the only reason I was interested in CRM at all. During my second year in graduate school, I had a chance to complete a semester-long internship in MPS. The task I was assigned was to use IRT for scaling an ORF dataset they had. The dataset had three variables representing the number of words read correctly per minute for three different reading passages. There were 2594 students. Below is a little information about the dataset.\r\n\r\n\r\n\r\n\r\n\r\nstr(wpm)\r\n\r\n'data.frame':   2594 obs. of  3 variables:\r\n $ spas1wpm: num  66 33 101 14 22 47 67 49 35 41 ...\r\n $ spas2wpm: num  74 30 117 12 17 53 58 39 36 42 ...\r\n $ spas3wpm: num  74 29 110 11 23 38 71 36 26 45 ...\r\n - attr(*, \"na.action\")= 'omit' Named int  13 32 39 50 53 56 105 108 136 152 ...\r\n  ..- attr(*, \"names\")= chr  \"13\" \"32\" \"39\" \"50\" ...\r\n\r\nhead(wpm)\r\n\r\n  spas1wpm spas2wpm spas3wpm\r\n1       66       74       74\r\n2       33       30       29\r\n3      101      117      110\r\n4       14       12       11\r\n5       22       17       23\r\n6       47       53       38\r\n\r\nrequire(psych)\r\n\r\ndescribe(wpm)[,c(\"n\",\"mean\",\"sd\",\"min\",\"max\",\"skew\",\"kurtosis\")]\r\n\r\n            n  mean    sd min max skew kurtosis\r\nspas1wpm 2594 63.32 35.44   1 200 0.52    -0.22\r\nspas2wpm 2594 70.09 45.34   3 236 0.84     0.20\r\nspas3wpm 2594 64.93 42.95   2 230 0.86     0.27\r\n\r\ncor(wpm)\r\n\r\n          spas1wpm  spas2wpm  spas3wpm\r\nspas1wpm 1.0000000 0.9396532 0.9375107\r\nspas2wpm 0.9396532 1.0000000 0.9657391\r\nspas3wpm 0.9375107 0.9657391 1.0000000\r\n\r\nAt the time, I had taken an IRT course and knew a little bit about dichotomous and polytomous IRT models. It was a challenge because the measurement outcomes were kind of continuous. As I didn’t know much about CRM at that time and how to deal with this, I created discrete categories for each variable such that Level 1 (0-50 words), Level 2(51-100 words), Level 3 (101-150 words), Level 4 (151-200 words), and Level 5 (201-250 words). Then, I fit polytomous IRT models and did usual IRT modeling based on the best fitting model. I completed the internship but I was not satisfied as there was so much information thrown away by discretizing. That’s how I ended up exploring and discovering CRM and started working on it. I first briefly introduce the model before demonstrating how to use it for ORF data.\r\nContinuous Response Model\r\nBelow is the reparameterized version of the model by Wang and Zeng (1998). In this model, the probability of an individual with a latent parameter \\(\\theta_i\\) obtaining a score of \\(x\\) or higher on an item with three parameters (\\(a\\), \\(b\\), and \\(\\alpha\\)) is specified as,\r\n\\[P_{ij}(X\\geq x|\\theta_{i},a_j,b_j,\\alpha_j)=\\frac{1}{\\sqrt{2\\pi}}\\int_{-\\infty}^{v}{e^{-\\frac{t^2}{2}}dt}\\]\r\n\\[v=a_j\\times (\\theta_i-b_j-\\frac{1}{\\alpha_j}ln\\frac{x}{k-x})\\], where \\(k_j\\) is the maximum possible score for the item. The parameter \\(a\\) and \\(b\\) have a very similar interpretation as in the 2PL IRT model. The \\(a\\) parameter controls the steepness, and the \\(b\\) parameter controls the location of the operating characteristic curves. There is an extra \\(\\alpha\\) parameter called “scaling parameter,” and it controls the distance among the curves.\r\nLet’s create some plots to see it better. Suppose there is an item with ten categories, and this item has the following parameters: \\(a=1\\), \\(b=0\\), and \\(\\alpha=1\\).The figure below displays how the operating characteristic curves look like for this item. Note that there are nine lines in the plot indicating \\(P(X\\geq 1)\\), \\(P(X\\geq 2)\\), \\(P(X\\geq 3)\\), …, \\(P(X\\geq 9)\\).\r\n\r\n\r\n theta <- seq(-4,4,.01)\r\n\r\n a     = 1\r\n b     = 0\r\n alpha = 1\r\n\r\n x    <- 1\r\n k    <- 10\r\n v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n plot(theta,pnorm(v,0,1),type=\"l\",xlim=c(-4,4),ylim=c(0,1),\r\n      main=expression(paste(\"a=1, b=0, \",alpha,\"=1\")),\r\n      xlab=expression(theta),ylab=\"Cumulative Probability\")\r\n\r\n for(x in 2:(k-1)){\r\n     v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n     points(theta,pnorm(v,0,1),type=\"l\")\r\n }\r\n\r\n\r\nNow, let’s keep everything the same but increase the value of the parameter \\(a\\) to 3, and we see how steepness changes.\r\n\r\n\r\n theta <- seq(-4,4,.01)\r\n\r\n a     = 3\r\n b     = 0\r\n alpha = 1\r\n\r\n x    <- 1\r\n k    <- 10\r\n v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n plot(theta,pnorm(v,0,1),type=\"l\",xlim=c(-4,4),ylim=c(0,1),\r\n      main=expression(paste(\"a=3, b=0, \",alpha,\"=1\")),\r\n      xlab=expression(theta),ylab=\"Cumulative Probability\")\r\n\r\n for(x in 2:(k-1)){\r\n     v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n     points(theta,pnorm(v,0,1),type=\"l\")\r\n }\r\n\r\n\r\nOr, we can keep everything the same but change the value of the parameter \\(b\\) to -2, and we see the curves shift to left.\r\n\r\n\r\n theta <- seq(-4,4,.01)\r\n\r\n a     = 1\r\n b     = -2\r\n alpha = 1\r\n\r\n x    <- 1\r\n k    <- 10\r\n v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n plot(theta,pnorm(v,0,1),type=\"l\",xlim=c(-4,4),ylim=c(0,1),\r\n      main=expression(paste(\"a=1, b=-2, \",alpha,\"=1\")),\r\n      xlab=expression(theta),ylab=\"Cumulative Probability\")\r\n\r\n for(x in 2:(k-1)){\r\n     v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n     points(theta,pnorm(v,0,1),type=\"l\")\r\n }\r\n\r\n\r\nLastly, let’s change the value of the parameter \\(\\alpha\\) to 4, and we see the distance among curves gets smaller.\r\n\r\n\r\n theta <- seq(-4,4,.01)\r\n\r\n a     = 1\r\n b     = 0\r\n alpha = 4\r\n\r\n x    <- 1\r\n k    <- 10\r\n v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n plot(theta,pnorm(v,0,1),type=\"l\",xlim=c(-4,4),ylim=c(0,1),\r\n      main=expression(paste(\"a=1, b=0, \",alpha,\"=4\")),\r\n      xlab=expression(theta),ylab=\"Cumulative Probability\")\r\n\r\n for(x in 2:(k-1)){\r\n     v    <- a*(theta-b-(1/alpha)*log(x/(k-x)))\r\n     points(theta,pnorm(v,0,1),type=\"l\")\r\n }\r\n\r\n\r\nFor those who are familiar with the Graded Response Model (GRM) may see the difference. In GRM, we estimate a step parameter for each response category, and these step parameters control the location of the operating characteristic curves and hence the distance among the curves at the same time. So, if there is an item with ten categories, GRM estimates nine step parameters. Instead, CRM estimates only two parameters (\\(b\\) and \\(\\alpha\\)) per item to control the location and distance among the curves regardless of the number of categories. So, CRM is a restricted version of GRM where we control the distance among the curves with only one parameter. If we think the \\(b\\) parameter a kind of common difficulty parameter for an item, the term \\[\\frac{1}{\\alpha_j}ln\\frac{x}{k-x})\\] decides how much each score is away from that common difficulty after accounting for the distance between the score and the maximum possible score.\r\nWang & Zeng (1998) also simplifies the equation by transforming the observed response (this is like a logit transformation for the observed responses), \\[Z=ln\\frac{X}{k-X}\\] and provides the conditional PDF of Z as\r\n\\[f(z|\\theta_i,a_j,b_j,\\alpha_j)=\\frac{a}{\\alpha\\sqrt{2\\pi}}e^\\frac{-(a_j(\\theta_i-b_j-\\frac{z_i}{\\alpha_j}))^2}{2}\\], which is a normal density function with a mean of \\(\\alpha_j(\\theta_i - b_j)\\) and standard deviation of \\(\\alpha_j/a_j\\).\r\nFormatting Data for Stan\r\nThere are other tools we can use to fit CRM. I will focus here fitting the model using Stan, but I also provide two other tools at the very end as supplemental material. Before introducing the Stan model syntax, I should first reformat data as this is the only way to run Stan with missing data. Although I don’t have missing data in the ORF dataset used for this blog post, I force myself to use this procedure to get used to it.\r\n\r\n\r\n# Wide format data (2594 x 3) with rows representing a different individual and\r\n# columns represent a different outcome\r\n\r\nhead(wpm)\r\n\r\n  spas1wpm spas2wpm spas3wpm\r\n1       66       74       74\r\n2       33       30       29\r\n3      101      117      110\r\n4       14       12       11\r\n5       22       17       23\r\n6       47       53       38\r\n\r\ndim(wpm)\r\n\r\n[1] 2594    3\r\n\r\n# add an arbitrary individual id variable\r\n\r\nwpm$id <- 1:nrow(wpm)\r\n\r\n# Convert the wide format data to long format (7782 x 3)\r\n# This is like repeated measures data\r\n\r\nwpm.long <- reshape(data      = wpm,\r\n                  idvar       = \"id\",\r\n                  varying     = list(colnames(wpm)[1:3]),\r\n                  timevar     = \"Item\",\r\n                  times       = 1:3,\r\n                  v.names      = \"score\",\r\n                  direction   = \"long\")\r\n\r\n\r\nwpm.long <- wpm.long[order(wpm.long$id),]\r\n\r\nhead(wpm.long)\r\n\r\n    id Item score\r\n1.1  1    1    66\r\n1.2  1    2    74\r\n1.3  1    3    74\r\n2.1  2    1    33\r\n2.2  2    2    30\r\n2.3  2    3    29\r\n\r\ndim(wpm.long)\r\n\r\n[1] 7782    3\r\n\r\n  # Each individual is represented in three rows, one for each item\r\n  # There are extra two columns for item and person id\r\n\r\n\r\n# The next line doesn't change anything for this case as there is no\r\n# missing data but this is critical step if you have missing data \r\n\r\nwpm.long <- na.omit(wpm.long) \r\n\r\n\r\n# Transform the observed scores to logits(from X to Z in the above description)\r\n# This assumes each reading passage has 250 words so the\r\n# maximum possible score is 250\r\n\r\nwpm.long$score <- log(wpm.long$score/(250-wpm.long$score))\r\n\r\nhead(wpm.long)\r\n\r\n    id Item      score\r\n1.1  1    1 -1.0252810\r\n1.2  1    2 -0.8664189\r\n1.3  1    3 -0.8664189\r\n2.1  2    1 -1.8833898\r\n2.2  2    2 -1.9924302\r\n2.3  2    3 -2.0308669\r\n\r\n# Create each column in the long format data as separate vectors\r\n# These are what we will feed to Stan as our data\r\n\r\nid            <- wpm.long$id      \r\nitem          <- wpm.long$Item\r\nscore         <- wpm.long$score\r\nn_obs         <- length(wpm.long)\r\n\r\nStan Model Syntax\r\nBelow is the Stan model syntax for fitting CRM. I follow the guidelines in the Stan manual and imposes weakly-informative prior on model parameters.\r\n\r\n\r\ncrm <-'\r\n\r\n  data{\r\n    int  J;                    //  number of items\r\n    int  I;                    //  number of individuals\r\n    int  n_obs;                //  number of observed responses\r\n  int  item[n_obs];          //  item id\r\n  int  id[n_obs];            //  person id\r\n  real Y[n_obs];             //  vector of transformed outcome\r\n }\r\n\r\n  parameters {\r\n  \r\n    vector[J] b;                 // vector of b parameters forJ items\r\n      real mu_b;                 // mean of the b parameters\r\n      real<lower=0> sigma_b;     // standard dev. of the b parameters\r\n\r\n    vector<lower=0>[J] a;       // vector of a parameters for J items\r\n      real mu_a;                 // mean of the a parameters\r\n      real<lower=0> sigma_a;     // standard deviation of the a parameters\r\n      \r\n    vector<lower=0>[J] alpha;   // vector of alpha parameters for J items     \r\n      real mu_alpha;             // mean of alpha parameters\r\n      real<lower=0> sigma_alpha; // standard deviation of alpha parameters\r\n       \r\n    vector[I] theta;             // vector of theta parameters for I individuals      \r\n  }\r\n\r\n  model{\r\n\r\n     mu_b     ~ normal(0,5);\r\n     sigma_b  ~ cauchy(0,2.5);\r\n         b    ~ normal(mu_b,sigma_b);\r\n\r\n     mu_a    ~ normal(0,5);\r\n     sigma_a ~ cauchy(0,2.5);\r\n         a   ~ normal(mu_a,sigma_a);\r\n      \r\n     mu_alpha ~ normal(0,5);\r\n     sigma_alpha ~ cauchy(0,2.5);\r\n         alpha   ~ normal(mu_alpha,sigma_alpha);\r\n\r\n     theta   ~ normal(0,1);      // The mean and variance of theta is fixed to 0 and 1\r\n                                 // for model identification\r\n\r\n      for(i in 1:n_obs) {\r\n        Y[i] ~ normal(alpha[item[i]]*(theta[id[i]]-b[item[i]]),alpha[item[i]]/a[item[i]]);\r\n       }\r\n   }\r\n'\r\n\r\nFitting the Model\r\nThe code below fits the model with four chains and 50,000 iterations for each chain. By default, the first 50% of the iterations are used as warm-up and the remaining 50% of the iterations used for inference.\r\n\r\n\r\nrequire(rstan)\r\n\r\ndata <- list(I     = 2594,\r\n             J     = 3,\r\n             n_obs = 7782,\r\n             id    = id,\r\n             item  = item,\r\n             Y     = score)\r\n\r\nfit_crm <- stan(model_code = crm, \r\n                data       = data, \r\n                iter       = 50000,\r\n                chains     = 4,\r\n                control    = list(max_treedepth = 15,adapt_delta=0.9))\r\n\r\n\r\n\r\n\r\n\r\n\r\nprint(get_elapsed_time(fit_crm))\r\n\r\n         warmup  sample\r\nchain:1 1489.01 1916.66\r\nchain:2 1990.80 2096.78\r\nchain:3 1314.82 1904.00\r\nchain:4 1514.28 1902.68\r\n\r\nsum(get_elapsed_time(fit_crm))/3600    # how many hours it took to run the model with the \r\n\r\n[1] 3.924731\r\n\r\n                                       # above settings\r\n\r\nIt took about 4 hours to fit the model with the above settings with processor “Intel(R) Core(TM) i7-3840QM CPU @2.80GHz”. I used only one core, although this processor has four cores. Note that I could use all four cores, and the estimation time would be down to about an hour. However, my R kept crashing when I tried to do it for some reason I don’t know. That might be related to my computer settings.\r\nModel Convergence\r\n\r\n\r\nprint(fit_crm, \r\n      pars = c(\"b\",\"mu_b\",\"sigma_b\",\r\n               \"a\",\"mu_a\",\"sigma_a\",\r\n               \"alpha\",\"mu_alpha\",\"sigma_alpha\"), \r\n      probs = c(0.025,0.975), \r\n      digits = 3)\r\n\r\nInference for Stan model: ebc8a1e0d17f738279125cd2fac99954.\r\n4 chains, each with iter=50000; warmup=25000; thin=1; \r\npost-warmup draws per chain=25000, total post-warmup draws=1e+05.\r\n\r\n             mean se_mean    sd  2.5% 97.5% n_eff  Rhat\r\nb[1]        1.519   0.000 0.031 1.458 1.580  5303 1.001\r\nb[2]        1.130   0.000 0.026 1.079 1.181  4579 1.001\r\nb[3]        1.269   0.000 0.027 1.216 1.324  4759 1.001\r\nmu_b        1.294   0.003 0.477 0.374 2.152 28153 1.000\r\nsigma_b     0.569   0.004 0.674 0.121 2.322 24787 1.000\r\na[1]        3.202   0.001 0.075 3.059 3.352 15866 1.000\r\na[2]        5.164   0.001 0.174 4.837 5.521 16967 1.000\r\na[3]        4.605   0.001 0.137 4.347 4.882 19146 1.000\r\nmu_a        4.105   0.005 1.167 1.413 6.158 55990 1.000\r\nsigma_a     1.754   0.007 1.376 0.575 5.218 44028 1.000\r\nalpha[1]    0.825   0.000 0.013 0.801 0.850  7442 1.001\r\nalpha[2]    1.009   0.000 0.015 0.980 1.038  6693 1.001\r\nalpha[3]    0.997   0.000 0.015 0.969 1.026  6844 1.001\r\nmu_alpha    0.940   0.002 0.342 0.345 1.510 20320 1.000\r\nsigma_alpha 0.357   0.004 0.532 0.064 1.659 21627 1.000\r\n\r\nSamples were drawn using NUTS(diag_e) at Tue Dec 31 00:19:18 2019.\r\nFor each parameter, n_eff is a crude measure of effective sample size,\r\nand Rhat is the potential scale reduction factor on split chains (at \r\nconvergence, Rhat=1).\r\n\r\nIt seems that we have convergence, and all chains yield consistent results as all \\(\\hat{R}\\) values are less than 1.01, The figures below are the posterior distributions for all these parameters. They all look fine.\r\n\r\n\r\nplot(fit_crm, \r\n     plotfun = \"hist\", \r\n     pars = c(\"b[1]\",\"b[2]\",\"b[3]\",\r\n              \"a[1]\",\"a[2]\",\"a[3]\",\r\n              \"alpha[1]\",\"alpha[2]\",\"alpha[3]\"), \r\n     inc_warmup = FALSE)\r\n\r\n\r\nI also used the recommendations provided at this link to check some other things (seemed important). None of them indicated any red flag about the model convergence.\r\n\r\n\r\nsource(\"https://raw.githubusercontent.com/betanalpha/knitr_case_studies/master/qr_regression/stan_utility.R\")\r\n\r\ncheck_treedepth(fit_crm,15)\r\n\r\n[1] \"0 of 100000 iterations saturated the maximum tree depth of 15 (0%)\"\r\n\r\ncheck_energy(fit_crm)\r\n\r\n[1] \"E-BFMI indicated no pathological behavior\"\r\n\r\ncheck_div(fit_crm)\r\n\r\n[1] \"0 of 100000 iterations ended with a divergence (0%)\"\r\n\r\nParameter Interpretation\r\n\r\n\r\nb     <- summary(fit_crm)$summary[1:3,1]\r\n\r\nb\r\n\r\n    b[1]     b[2]     b[3] \r\n1.518873 1.129984 1.269457 \r\n\r\na     <- summary(fit_crm)$summary[6:8,1]\r\n\r\na\r\n\r\n    a[1]     a[2]     a[3] \r\n3.202239 5.164036 4.604971 \r\n\r\nalpha <- summary(fit_crm)$summary[11:13,1]\r\n\r\nalpha\r\n\r\n alpha[1]  alpha[2]  alpha[3] \r\n0.8251600 1.0086235 0.9969156 \r\n\r\nthetas = summary(fit_crm)$summary[16:2609,1]\r\n\r\nThe \\(b\\) parameters for three reading passages in this dataset were 1.52, 1.13, 1.27. I think it is fair to call them “reading passage difficulty” in this context. Given that we fix the mean and variance of the latent person parameter (\\(\\theta\\)) to 0 and 1, we can compare the passage difficulty relative to the levels of individuals. Note that \\(\\theta\\) represents here a latent variable indicating oral reading fluency. So, these three reading passages seem very difficult compared to the ORF levels of these individuals.\r\nThe \\(a\\) parameters were 3,20, 5.16, and 4.60. We can call them “reading passage discrimination” parameters. So, these reading passages are highly informative about the latent construct being measured. These very high discrimination parameters are not very surprising, given that the correlations among the three variables were 0.94, 0.94, and 0.96.\r\nThe \\(\\alpha\\) parameters were 0.83, 1.01, and 1.00. I think it would be wise to go back and fix all the \\(\\alpha\\) parameters to 1 in the model and then re-fit, but I will not do it. Note that the \\(\\alpha\\) scales the distance between the response categories.\r\nWe can plot the operating characteristic curves, but it would be too messy for all 250 score categories, However, I can draw it for \\(P(X\\geq 50)\\), \\(P(X\\geq 100)\\), \\(P(X\\geq 150)\\), …, \\(P(X\\geq 200)\\). Below is the plot for Item 1.\r\n\r\n\r\n theta <- seq(-4,4,.01)\r\n\r\n a1     = 3.20\r\n b1     = 1.52\r\n alpha1 = 0.83\r\n\r\n x    <- 50\r\n k    <- 250\r\n v    <- a1*(theta-b1-(1/alpha1)*log(x/(k-x)))\r\n \r\n plot(theta,pnorm(v,0,1),type=\"l\",xlim=c(-2,4),ylim=c(0,1),\r\n      main=expression(paste(\"a=3.2, b=1.5, \",alpha,\"= 0.8\")),\r\n      xlab=expression(theta),ylab=\"Cumulative Probability\")\r\n\r\n for(x in c(100,150,200)){\r\n     v    <- a1*(theta-b1-(1/alpha1)*log(x/(k-x)))\r\n     points(theta,pnorm(v,0,1),type=\"l\")\r\n }\r\n \r\n abline(h=.5,lty=2)\r\n \r\n text(-0.2,.8,\"P(X>50)\",cex=0.8)\r\n text(0.95,.8,\"P(X>100)\",cex=0.8)\r\n text(1.95,.8,\"P(X>150)\",cex=0.8)\r\n text(3.1,.8,\"P(X>200)\",cex=0.8)\r\n\r\n\r\nLet’s check the latent person parameter estimates.\r\n\r\n\r\nthetas = summary(fit_crm)$summary[16:2609,1]\r\n\r\npsych::describe(thetas)\r\n\r\n   vars    n mean   sd median trimmed  mad   min  max range skew\r\nX1    1 2594    0 0.99   0.05       0 1.07 -2.55 3.45     6 0.05\r\n   kurtosis   se\r\nX1     -0.4 0.02\r\n\r\nhist(thetas)\r\n\r\n\r\nAs expected, the estimates have a mean of 0 and a standard deviation of .99.\r\nLower estimates indicate lower levels of oral reading fluency, and higher estimates indicate higher levels of oral reading fluency.\r\nWe can have a better understanding if we check a few individuals.\r\n\r\n\r\nlow = order(thetas,decreasing=F)[1:5]\r\nhigh = order(thetas,decreasing=T)[1:5]\r\n\r\n# The individuals with the highest oral reading fluency and their reading scores\r\n\r\ncbind(wpm[high,],thetas[high])\r\n\r\n     spas1wpm spas2wpm spas3wpm   id thetas[high]\r\n1472      200      234      221 1298     3.450124\r\n800       183      236      212  708     3.321254\r\n2395      176      234      210 2165     3.206725\r\n1266      159      227      227 1108     3.193825\r\n2308      181      224      220 2084     3.111210\r\n\r\n# The individuals with the lowest oral reading fluency and their reading scores\r\n\r\ncbind(wpm[low,],thetas[low])\r\n\r\n     spas1wpm spas2wpm spas3wpm   id thetas[low]\r\n2349       18        6        3 2121   -2.553310\r\n1254       11        7        4 1097   -2.487285\r\n666         2        3       34  584   -2.422641\r\n1101       12        6        8  957   -2.283528\r\n502        11        7        7  437   -2.281563\r\n\r\nFor instance, the model provides an estimate of 3.11 for a student who had read 181 words, 224 words, and 220 words and an estimate of -2.28 for a student who had read 12 words, six words, and eight words in the three reading passages, respectively. We can check how the estimated theta is related to the scores from each reading passage for all examinees.\r\n\r\n\r\nplot(thetas,wpm[,1],xlab=expression(theta),ylab=\"Word per minute\",main=\"Reading Passage 1\")\r\n\r\n\r\nplot(thetas,wpm[,2],xlab=expression(theta),ylab=\"Word per minute\",main=\"Reading Passage 2\")\r\n\r\n\r\nplot(thetas,wpm[,3],xlab=expression(theta),ylab=\"Word per minute\",main=\"Reading Passage 3\")\r\n\r\n\r\nIt is not surprising to see that there is a strong relationship because of the high discrimination parameters. Note that the relationship is not linear as we model the relationship between \\(\\theta\\) and \\(ln\\frac{x}{k-x}\\)\r\nModel Fit Assessment\r\nThe first thing I would like to look at is how well the model predicts the observed ORF scores. Treating the item and person parameter estimates as known, we can calculate a predicted score on each item for each individual as well as a standardized residual.\r\nNote that I mentioned before that the conditional PDF of Z is a normal density function with a mean of \\(\\alpha_j(\\theta_i - b_j)\\) and standard deviation of \\(\\alpha_j/a_j\\), where Z is defined as \\[ln\\frac{X}{k-X}\\].\r\n\r\n\r\n# Remember the data with observed outcomes\r\n\r\nhead(wpm.long)\r\n\r\n    id Item      score\r\n1.1  1    1 -1.0252810\r\n1.2  1    2 -0.8664189\r\n1.3  1    3 -0.8664189\r\n2.1  2    1 -1.8833898\r\n2.2  2    2 -1.9924302\r\n2.3  2    3 -2.0308669\r\n\r\n# For each observation, compute the model prediction\r\n\r\nwpm.long$pred <- NA\r\nwpm.long$sres <- NA\r\n\r\nfor(i in 1:nrow(wpm.long)){\r\n  \r\n      wpm.long[i,]$pred = alpha[wpm.long[i,2]]*(thetas[wpm.long[i,1]]-b[wpm.long[i,2]])\r\n  \r\n      wpm.long[i,]$sres = (wpm.long[i,]$score-wpm.long[i,]$pred)/(alpha[wpm.long[i,2]]/a[wpm.long[i,2]])\r\n  \r\n}\r\n\r\nhead(wpm.long)\r\n\r\n    id Item      score       pred        sres\r\n1.1  1    1 -1.0252810 -0.9950415 -0.11735210\r\n1.2  1    2 -0.8664189 -0.8240327 -0.21701232\r\n1.3  1    3 -0.8664189 -0.9535104  0.40229444\r\n2.1  2    1 -1.8833898 -1.9046944  0.08267790\r\n2.2  2    2 -1.9924302 -1.9359350 -0.28924851\r\n2.3  2    3 -2.0308669 -2.0525060  0.09995587\r\n\r\nNote that the observed values and predicted values are on a logit metric because of the transformation. Let’s check the correlation between observed outcomes and model predicted outcomes for each item.\r\n\r\n\r\ncor(wpm.long[wpm.long$Item==1,c(\"score\",\"pred\")])\r\n\r\n          score      pred\r\nscore 1.0000000 0.9625963\r\npred  0.9625963 1.0000000\r\n\r\nplot(wpm.long[wpm.long$Item==1,c(\"score\",\"pred\")])\r\n\r\n\r\ncor(wpm.long[wpm.long$Item==2,c(\"score\",\"pred\")])\r\n\r\n          score      pred\r\nscore 1.0000000 0.9901734\r\npred  0.9901734 1.0000000\r\n\r\nplot(wpm.long[wpm.long$Item==2,c(\"score\",\"pred\")])\r\n\r\n\r\ncor(wpm.long[wpm.long$Item==3,c(\"score\",\"pred\")])\r\n\r\n          score      pred\r\nscore 1.0000000 0.9855802\r\npred  0.9855802 1.0000000\r\n\r\nplot(wpm.long[wpm.long$Item==3,c(\"score\",\"pred\")])\r\n\r\n\r\nIt looks like the model predicts the observed outcomes pretty well.\r\nWe can also check if there is any systematic relationship between residuals and the latent variable.\r\n\r\n\r\nplot(thetas,wpm.long[wpm.long$Item==1,c(\"sres\")])\r\n\r\n\r\nplot(thetas,wpm.long[wpm.long$Item==2,c(\"sres\")])\r\n\r\n\r\nplot(thetas,wpm.long[wpm.long$Item==3,c(\"sres\")])\r\n\r\n\r\nThere are some individuals with extreme residuals for each item; however, there doesn’t seem to be any systematic pattern between residuals and the latent variable.\r\nWe can also check the distribution of standardized residuals within each item.\r\n\r\n\r\npsych::describeBy(wpm.long$sres,wpm.long$Item)\r\n\r\n Descriptive statistics by group \r\ngroup: 1\r\n   vars    n mean   sd median trimmed  mad    min  max range  skew\r\nX1    1 2594    0 0.91   0.05    0.01 0.76 -10.27 4.06 14.33 -1.49\r\n   kurtosis   se\r\nX1    15.59 0.02\r\n---------------------------------------------------- \r\ngroup: 2\r\n   vars    n mean   sd median trimmed  mad   min  max range skew\r\nX1    1 2594    0 0.74  -0.01   -0.01 0.62 -4.24 12.6 16.84 2.14\r\n   kurtosis   se\r\nX1    34.15 0.01\r\n---------------------------------------------------- \r\ngroup: 3\r\n   vars    n mean  sd median trimmed  mad  min  max range  skew\r\nX1    1 2594    0 0.8   0.02    0.01 0.66 -9.2 8.46 17.66 -0.71\r\n   kurtosis   se\r\nX1    18.05 0.02\r\n\r\nhist(wpm.long[wpm.long$Item==1,]$sres)\r\n\r\n\r\nhist(wpm.long[wpm.long$Item==2,]$sres)\r\n\r\n\r\nhist(wpm.long[wpm.long$Item==3,]$sres)\r\n\r\n\r\nThere are some extreme residuals we may want to look deeper. So, let’s filter the observations with a standardized residual outside of the range [-4,4] and look at their response pattern.\r\n\r\n\r\noutliers = which(abs(wpm.long$sres)>4)\r\n\r\nlength(outliers)\r\n\r\n[1] 16\r\n\r\nwpm.long[outliers,]\r\n\r\n         id Item      score        pred       sres\r\n386.2   386    2 -2.1113349 -3.00179151   4.559036\r\n386.3   386    3 -4.8202816 -3.10599028  -7.918685\r\n584.1   584    1 -4.8202816 -3.25237974  -6.084634\r\n584.2   584    2 -4.4107760 -3.58326047  -4.236785\r\n584.3   584    3 -1.8489179 -3.68070970   8.461446\r\n591.1   591    1 -5.5174529 -3.10662063  -9.355835\r\n604.1   604    1 -4.1190372 -2.19139995  -7.480676\r\n919.1   919    1 -2.4423470 -0.67336558  -6.864973\r\n919.2   919    2  2.0308669 -0.43083644  12.603638\r\n919.3   919    3 -2.5563656 -0.56487820  -9.199114\r\n934.3   934    3 -3.4094962 -2.18880658  -5.638631\r\n1154.3 1154    3  2.4423470  1.34351106   5.075763\r\n1911.1 1911    1 -1.1093076  0.65735567  -6.855977\r\n1929.3 1929    3 -1.3129118 -0.01141806  -6.011883\r\n2032.1 2032    1 -0.7907857 -1.83717598   4.060778\r\n2222.1 2222    1 -2.9031108 -0.25793442 -10.265266\r\n\r\noutlier.ids <- unique(wpm.long[outliers,]$id)\r\n\r\noutlier.ids\r\n\r\n [1]  386  584  591  604  919  934 1154 1911 1929 2032 2222\r\n\r\nwpm[outlier.ids,]\r\n\r\n     spas1wpm spas2wpm spas3wpm   id\r\n443        33       27        2  386\r\n666         2        3       34  584\r\n673         1       13       14  591\r\n686         4       38       29  604\r\n1052       20      221       18  919\r\n1068       47       50        8  934\r\n1316      165      174      230 1154\r\n2122       62      211      207 1911\r\n2144      156      177       53 1929\r\n2253       78       30       20 2032\r\n2453       13      173      163 2222\r\n\r\nHere, we can see there are 12 individuals with observations yielding extreme outliers. A quick examination of their score pattern reveals that these are typically individuals that scored low for one or two reading passages while scoring relatively much higher in other reading passage. So, for instance, individual 919 read 20 and 18 words for Reading Passage 1 and 3 while reading 221 words for Reading Passage 2. This is extremely unusual and may be due to data coding error, scoring error, low effort, or low motivation for some reason. It might be a good idea to flag these individuals with inconsistent (or unreliable) scores, remove them from the dataset, and re-fit the model without these individuals.\r\nAfter removing the outliers, the standardized residuals follow an approximately normal distribution.\r\n\r\n\r\npsych::describeBy(wpm.long[-outliers,]$sres,wpm.long[-outliers,]$Item)\r\n\r\n Descriptive statistics by group \r\ngroup: 1\r\n   vars    n mean   sd median trimmed  mad   min  max range skew\r\nX1    1 2587 0.02 0.82   0.05    0.02 0.76 -3.28 3.62   6.9  0.1\r\n   kurtosis   se\r\nX1     1.25 0.02\r\n---------------------------------------------------- \r\ngroup: 2\r\n   vars    n mean   sd median trimmed  mad   min  max range skew\r\nX1    1 2591    0 0.69  -0.01   -0.02 0.62 -3.53 3.87  7.41  0.3\r\n   kurtosis   se\r\nX1     2.19 0.01\r\n---------------------------------------------------- \r\ngroup: 3\r\n   vars    n mean   sd median trimmed  mad   min  max range  skew\r\nX1    1 2588 0.01 0.72   0.02    0.01 0.66 -3.72 3.64  7.36 -0.03\r\n   kurtosis   se\r\nX1     1.61 0.01\r\n\r\nA final check could be the residual correlations. As we assume local independence (and/or unidimensionality), the correlations among the reading scores should be ideally 0 once we account for the latent oral reading fluency parameter in the model.\r\n\r\n\r\ncor(wpm.long[wpm.long$Item==1,c(\"sres\")],wpm.long[wpm.long$Item==2,c(\"sres\")])\r\n\r\n[1] -0.4148885\r\n\r\ncor(wpm.long[wpm.long$Item==1,c(\"sres\")],wpm.long[wpm.long$Item==3,c(\"sres\")])\r\n\r\n[1] -0.3441941\r\n\r\ncor(wpm.long[wpm.long$Item==2,c(\"sres\")],wpm.long[wpm.long$Item==3,c(\"sres\")])\r\n\r\n[1] -0.6772869\r\n\r\nThe high residual correlations were the only thing I was not happy about this model. I don’t know why the correlations among the residuals are unusually high. This suggests that there is still some variation left unexplained after accounting for one latent variable. This might suggest a second (latent) variable, but I don’t think there is much I can do here to improve the model with only three items. I guess I’ll just live with this.\r\nAPPENDIX A: Alternative Ways of Fitting the Continuous Response Model\r\n1. Heuristic Estimation through Linear Factor Model\r\nThe heuristic estimation is a method used by Bejar (1977) and also discussed in detail by Ferrando(2002). It is very convenient as you can fit this model with any SEM software, so it is also easy to extend the model to multiple-group, multidimensional, or mixture cases, see this paper I worked on for mixture extension of CRM.\r\nIn this approach, you can first transform the observed scores (\\(X\\)) using the equation \\(ln\\frac{X}{k-X}\\). Then, you can fit a simple linear factor model to the transformed scores. Finally, you put the model parameter estimates back to IRT metric. Below is a quick implementation in the lavaan package.\r\n\r\n\r\nwpm.transformed <- log(wpm[,1:3]/(250-wpm[,1:3]))\r\n\r\nhead(wpm.transformed)\r\n\r\n    spas1wpm   spas2wpm   spas3wpm\r\n1 -1.0252810 -0.8664189 -0.8664189\r\n2 -1.8833898 -1.9924302 -2.0308669\r\n3 -0.3888258 -0.1281752 -0.2411621\r\n4 -2.8247745 -2.9873640 -3.0785683\r\n5 -2.3383032 -2.6178251 -2.2894558\r\n6 -1.4630584 -1.3129118 -1.7190001\r\n\r\nrequire(lavaan)\r\n\r\n\r\nlfm <- 'f1 =~ NA*spas1wpm + l2*spas2wpm + l3*spas3wpm\r\n        \r\n        spas1wpm ~~ r1*spas1wpm   \r\n        spas2wpm ~~ r2*spas2wpm\r\n        spas3wpm ~~ r3*spas3wpm\r\n        \r\n        f1 ~~ 1*f1'\r\n\r\nfit <- cfa(model  = lfm,\r\n           data   = wpm.transformed)\r\n\r\nparameterEstimates(fit)\r\n\r\n       lhs op      rhs label   est    se      z pvalue ci.lower\r\n1       f1 =~ spas1wpm       0.824 0.013 65.728      0    0.800\r\n2       f1 =~ spas2wpm    l2 1.008 0.015 69.316      0    0.980\r\n3       f1 =~ spas3wpm    l3 0.996 0.015 68.688      0    0.968\r\n4 spas1wpm ~~ spas1wpm    r1 0.066 0.002 29.168      0    0.062\r\n5 spas2wpm ~~ spas2wpm    r2 0.038 0.002 16.793      0    0.034\r\n6 spas3wpm ~~ spas3wpm    r3 0.047 0.002 19.980      0    0.042\r\n7       f1 ~~       f1       1.000 0.000     NA     NA    1.000\r\n  ci.upper\r\n1    0.849\r\n2    1.037\r\n3    1.025\r\n4    0.071\r\n5    0.042\r\n6    0.052\r\n7    1.000\r\n\r\nintercepts <- colMeans(wpm.transformed)\r\n\r\nintercepts\r\n\r\n spas1wpm  spas2wpm  spas3wpm \r\n-1.252865 -1.139123 -1.264952 \r\n\r\nOnce you estimate the parameters from the linear factor model, then you can transform them back to the IRT metric.\r\nThe unstandardized factor loadings (0.824, 1.008, and 0.996) correspond to the \\(\\alpha\\) parameters in CRM. You can check back the estimates from Stan, and you will see that they are identical.\r\nIf you divide the unstandardized factor loadings by residual standard deviation, you will get the discrimination parameters (\\(a\\)) of CRM.\r\n\\[\\frac{0.824}{\\sqrt{0.066}} = 3.21\\] \\[\\frac{1.008}{\\sqrt{0.038}} = 5.18\\] \\[\\frac{0.996}{\\sqrt{0.047}} = 4.59\\]\r\nAgain, if you check the estimates for \\(a\\) parameters we obtained from Stan, they are almost identical.\r\nFinally, if you divide the intercepts by the unstandardized factor loadings and then multiply the result by -1, that should give you the difficulty parameters of CRM (\\(b\\)).\r\n\\[-\\frac{-1.253}{0.824} = 1.52\\] \\[-\\frac{-1.139}{1.008} = 1.13\\] \\[-\\frac{-1.265}{0.996} = 1.27\\]\r\nSimilarly, these values are almost identical to \\(b\\) parameters obtained from Stan fit.\r\nAnother bonus is that you can also extract the factor scores from the lavaan object for each individual, and these factor scores should be almost identical to the \\(\\theta\\) estimates obtained from Stan fit.\r\n\r\n\r\nfscores <- lavPredict(fit)\r\n\r\npsych::describe(fscores)\r\n\r\n   vars    n mean   sd median trimmed  mad   min  max range skew\r\nX1    1 2594    0 0.99   0.05       0 1.07 -2.56 3.45  6.01 0.05\r\n   kurtosis   se\r\nX1    -0.39 0.02\r\n\r\ncor(thetas,fscores)\r\n\r\n            f1\r\n[1,] 0.9999999\r\n\r\nplot(thetas,fscores)\r\n\r\n\r\n2, Full-information Marginal Maximum Likelihood Estimation\r\nThis approach is fully described in two papers, Wang and Zeng (1998) and Shojima(2005). Wang and Zeng (1998) is a classical implementation of EM algorithm. However, Shojima(2005) is a really interesting paper as he derives the closed-form equation for the marginal likelihood, so there is no integration needed for the E-step. When I was first interested in this model, I created an R package, EstCRM, that implements both approaches. Below is a code using this package to fit the model.\r\n\r\n\r\nrequire(EstCRM)\r\n\r\nCRM <- EstCRMitem(wpm[,1:3], \r\n                  max.item=c(250,250,250), \r\n                  min.item=c(0,0,0),\r\n                  max.EMCycle=500, \r\n                  converge=.01,\r\n                  type=\"Wang&Zeng\",\r\n                  BFGS=TRUE)\r\n\r\nCRM$param\r\n\r\n         [,1]     [,2]      [,3]\r\n[1,] 3.090524 1.598122 0.7918418\r\n[2,] 4.896383 1.192894 0.9677061\r\n[3,] 4.470768 1.336568 0.9575835\r\n\r\nHere it is! Again, we get almost identical estimates for item parameters. It is also possible to compute \\(\\theta\\) and compare them from the person parameter estimates from the previous two approaches (Stan and lavaan).\r\n\r\n\r\ntheta.CRM <- EstCRMperson(data     = wpm[,1:3],\r\n                          ipar     = CRM$param,\r\n                          max.item = c(250,250,250), \r\n                          min.item = c(0,0,0))\r\n\r\npsych::describe(theta.CRM[[1]][,2])\r\n\r\n   vars    n mean sd median trimmed  mad   min  max range skew\r\nX1    1 2594    0  1   0.05       0 1.08 -2.58 3.48  6.06 0.04\r\n   kurtosis   se\r\nX1     -0.4 0.02\r\n\r\ncor(cbind(thetas,fscores,theta.CRM[[1]][,2]))\r\n\r\n          thetas        f1          \r\nthetas 1.0000000 0.9999999 0.9999961\r\nf1     0.9999999 1.0000000 0.9999949\r\n       0.9999961 0.9999949 1.0000000\r\n\r\n\r\n\r\n",
    "preview": "posts/crm-stan/images/image.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 811,
    "preview_height": 461
  },
  {
    "path": "posts/hcm-stan/",
    "title": "Fitting Hyperbolic Cosine Model (HCM) For Unfolding Dichotomous Responses using Stan",
    "description": "In this post, I do a quick exercise on fitting the hyperbolic cosine model using Stan. The information about this model can be found in Andrich & Luo (1993). The most interesting part is an \"Aha!\" moment when I discover the bimodality of posterior distribution due to lack of directional constrain.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-12-15",
    "categories": [
      "item response theory",
      "hyperbolic cosine model",
      "Stan",
      "R",
      "2019"
    ],
    "contents": "\r\n\r\n\r\n\r\nIn this post, I do a quick exercise on fitting the hyperbolic cosine model using Stan. The information about this model can be found in Andrich & Luo (1993). The paper by Johnson and Junker (2003) also provide a detailed treatment of estimating this particular model.\r\nThe hyperbolic cosine model (HCM) is described as\r\n\\[P(X_{ij}=1)=\\frac{exp(\\gamma_j)}{exp(\\gamma_j)+2cosh(\\theta_i-\\beta_j)}.\\] In this model,\r\n\\(\\theta_i\\) is the latent variable for the person \\(i\\),\r\n\\(\\beta_j\\) is the location of item \\(j\\) on the latent continuum, and\r\n\\(\\gamma_j\\) is the unit parameter for the item \\(j\\).\r\nWhile \\(\\gamma_j\\) is an item specific parameter in the equation above, it can be fixed to the same value across items (Simplified HCM). The model was primarily developed to measure attitudes, and \\(P(X_{ij}=1)\\) is used as the probability of endorsing an item (endorsing=1, not endorsing = 0).\r\nIn order to understand the model, let’s check how the probability of endorsement changes as a function of the latent variable and how this is different than dichotomous IRT models for correct/incorrect scoring. Below are the item characteristic curve for three hypothetical items with \\(\\beta= -1\\) and different unit parameter (\\(\\gamma={1,2,3}\\)).\r\n\r\n\r\n gamma <- c(1,2,3)\r\n beta  <- -1\r\n theta <- seq(-4,4,.01)\r\n \r\n p1 <- exp(gamma[1])/(exp(gamma[1])+2*cosh(theta-beta))\r\n p2 <- exp(gamma[2])/(exp(gamma[2])+2*cosh(theta-beta))\r\n p3 <- exp(gamma[3])/(exp(gamma[3])+2*cosh(theta-beta))\r\n \r\n plot(theta,p1,xlab=\"Theta\",ylab=\"Probability of Agreement\",type=\"l\",ylim=c(0,1))\r\n points(theta,p2,xlab=\"Theta\",ylab=\"Probability of Agreement\",type=\"l\",lty=2)\r\n points(theta,p3,xlab=\"Theta\",ylab=\"Probability of Agreement\",type=\"l\",lty=3)\r\n\r\n\r\nThe most important distinction of HCM is that the probability of endorsement does not monotonically increase as the latent variable increases. The probability reaches to its maximum when \\(\\theta\\) is equal to \\(\\beta\\), and the maximum probability of endorsement is as a function of the unit parameter, \\[P_{max}(X_{ij}=1)=\\frac{1}{1 +2exp(-\\gamma_j)}\\]. The more the difference between person location (\\(\\theta\\)) and item location (\\(\\beta\\)) is, the lower \\(P(X_{ij}=1)\\) is. Also, note that \\(\\gamma\\) behaves like a discrimination parameter. The higher the value of the \\(\\gamma\\) parameter is, the more flat the item response function becomes. Higher values of \\(\\gamma\\) indicate less discrimination along the scale.\r\nSimulated Dataset\r\nData Generation\r\nFirst, I simulate a dataset based on HCM. I assume\r\nthe sample size is 500,\r\nthe number of items is 8,\r\n\\(\\beta\\) parameters are {-2,-1.5,-1,-.5,.5,1,1.5,2},\r\n\\(\\gamma\\) is equal to 0.7 for all items, and\r\n\\(\\theta\\) parameters are drawn from the standard normal distribution.\r\n\r\n\r\nrequire(purrr)\r\n\r\nset.seed(123456)\r\n\r\n  N = 500\r\n  k = 8\r\n\r\n  beta  <- c(-2,-1.5,-1,-.5,.5,1,1.5,2)\r\n  \r\n  gamma <- rep(0.7,k)\r\n\r\n  theta <- rnorm(N,0,1)                              \r\n\r\n  d <- matrix(NA,nrow=N,ncol=k)\r\n\r\n  for(i in 1:nrow(d)){\r\n    for(j in 1:ncol(d)){\r\n    \r\n      prob   = exp(gamma[j])/(exp(gamma[j])+2*cosh(theta[i] - beta[j]))\r\n      d[i,j] = (rbernoulli(1, p = prob))*1\r\n    \r\n    }\r\n  }\r\n  \r\n  head(d)\r\n\r\n     [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]\r\n[1,]    0    1    1    1    0    1    1    0\r\n[2,]    0    1    1    0    1    0    0    0\r\n[3,]    0    0    1    0    1    0    0    0\r\n[4,]    1    0    1    0    1    0    1    0\r\n[5,]    0    0    0    0    1    0    0    1\r\n[6,]    0    1    0    0    1    1    1    1\r\n\r\nFitting HCM using Stan\r\nWhen I first tried to fit the model, I started with the following model syntax. Following the conventional approach in other dichotomous and polytomous IRT models, I set the mean and variance of the latent scale to 0 and 1, respectively. I tried to estimate a separate \\(\\beta\\) and \\(\\gamma\\) for each item without any additional constraints.\r\n\r\n\r\nhcm <-'\r\n\r\n    data{\r\n     int I;                   //  number of individuals\r\n     int J;                   //  number of items\r\n     int <lower=0> Y[I,J];    //  data matrix  \r\n    }\r\n\r\n  parameters {\r\n      vector[J] beta;         \r\n    real mu_beta;\r\n    real<lower=0> sigma_beta;\r\n\r\n      vector[J] gamma;      \r\n     real mu_gamma;\r\n     real<lower=0> sigma_gamma;\r\n\r\n    vector[I] theta;      \r\n  }\r\n\r\n    model{\r\n\r\n     beta    ~ normal(mu_beta,sigma_beta);\r\n      mu_beta ~ normal(0,5);\r\n      sigma_beta ~ cauchy(0,2.5);\r\n\r\n     gamma   ~ normal(mu_gamma,sigma_gamma);\r\n      mu_gamma ~ normal(0,5);\r\n      sigma_gamma ~ cauchy(0,2.5);\r\n\r\n       theta   ~ normal(0,1);\r\n\r\n      for(i in 1:I) {\r\n       for(j in 1:J) {\r\n   \r\n        real p  = exp(gamma[j])/(exp(gamma[j])+2*cosh(theta[i] - beta[j]));\r\n\r\n        Y[i,j] ~ bernoulli(p);\r\n\r\n       }}\r\n    }\r\n'\r\n\r\nI fitted the model using four chains with the following settings.\r\n\r\n\r\nrequire(rstan)\r\n\r\ndata <- list(Y=d,\r\n             I=nrow(d),\r\n             J=ncol(d))\r\n\r\n\r\nfit_hcm <- stan(model_code = hcm, \r\n                 data       = data, \r\n                 iter       = 2000,\r\n                 chains     = 4,\r\n                 control    = list(max_treedepth = 15,adapt_delta=0.9))\r\n\r\n\r\n\r\n\r\nLet’s check the solution for item parameters.\r\n\r\n\r\nprint(fit_hcm, \r\n      pars = c(\"beta\",\"mu_beta\",\"sigma_beta\",\r\n               \"gamma\",\"mu_gamma\",\"sigma_gamma\"), \r\n      probs = c(0.025,0.975), \r\n      digits = 3)\r\n\r\nInference for Stan model: 5ba394328e7553d4461ee58a0ae9eb24.\r\n4 chains, each with iter=2000; warmup=1000; thin=1; \r\npost-warmup draws per chain=1000, total post-warmup draws=4000.\r\n\r\n              mean se_mean    sd   2.5% 97.5% n_eff  Rhat\r\nbeta[1]     -1.114   1.366 1.953 -2.815 2.594     2 6.579\r\nbeta[2]     -0.788   0.970 1.401 -2.146 1.932     2 4.720\r\nbeta[3]     -0.661   0.791 1.158 -2.013 1.616     2 3.746\r\nbeta[4]     -0.091   0.121 0.360 -0.775 0.635     9 1.152\r\nbeta[5]      0.281   0.365 0.587 -0.981 1.128     3 2.039\r\nbeta[6]      0.390   0.504 0.759 -1.180 1.336     2 2.824\r\nbeta[7]      0.789   0.962 1.391 -1.938 2.203     2 4.535\r\nbeta[8]      1.013   1.238 1.779 -2.359 2.676     2 5.516\r\nmu_beta     -0.040   0.011 0.661 -1.360 1.244  3729 1.001\r\nsigma_beta   1.797   0.012 0.571  1.039 3.275  2175 0.999\r\ngamma[1]     0.731   0.006 0.242  0.242 1.261  1537 1.001\r\ngamma[2]     0.756   0.007 0.217  0.383 1.184  1005 1.002\r\ngamma[3]     0.968   0.009 0.237  0.656 1.516   663 1.003\r\ngamma[4]     0.625   0.002 0.100  0.423 0.817  2421 1.001\r\ngamma[5]     0.749   0.003 0.119  0.545 1.014  1998 1.003\r\ngamma[6]     0.756   0.004 0.137  0.526 1.052  1246 1.001\r\ngamma[7]     0.770   0.006 0.215  0.404 1.264  1328 1.002\r\ngamma[8]     0.748   0.009 0.264  0.284 1.316   962 1.004\r\nmu_gamma     0.760   0.004 0.134  0.526 1.048  1033 1.002\r\nsigma_gamma  0.225   0.007 0.170  0.034 0.679   558 1.005\r\n\r\nSamples were drawn using NUTS(diag_e) at Fri Nov 29 17:58:33 2019.\r\nFor each parameter, n_eff is a crude measure of effective sample size,\r\nand Rhat is the potential scale reduction factor on split chains (at \r\nconvergence, Rhat=1).\r\n\r\nThis was very strange. The parameter estimates were absolutely bizarre, particularly the \\(\\beta\\) parameters. Let’s check the posterior distribution for the item parameters.\r\n\r\n\r\nplot(fit_hcm, \r\n     plotfun = \"hist\", \r\n     pars = c(\"beta[1]\",\"beta[2]\",\"beta[3]\",\"beta[4]\",\r\n              \"beta[5]\",\"beta[6]\",\"beta[7]\",\"beta[8]\"), \r\n     inc_warmup = FALSE)\r\n\r\n\r\nplot(fit_hcm, \r\n     plotfun = \"trace\", \r\n     pars = c(\"beta[1]\"), \r\n     inc_warmup = FALSE)\r\n\r\n\r\nThis clearly signaled a problem. It took me a whole day to figure out the issue, until I read the paper by Johnson and Junker (2003, page 209-211). Without any constraint on the sign of the beta parameters, the direction of the scale is arbitrary. Chains hang out on opposite side of the continuum, leading a bimodal posterior. One needs to add a directional constrain for the beta parameters. Johnson & Junker (2003) says “Constraining the sign of a single item’s location is one method for ensuring identifiability (e.g., β1 < 0).”\r\nI tried to do constrain the sign for one of the \\(\\beta\\) parameters but I realized this was also not enough. It sometimes works but most of the time the \\(\\beta\\) parameters with no constraint still suffer from the same issue. So, I think one has to put a constrain on each \\(\\beta\\) parameter. That means you have to guess the sign of the \\(\\beta\\) parameters before fitting the model. It is easy in this case since this is the simulated data and I know the sign of the \\(\\beta\\) parameter. However, in real data, this is an issue to deal with. I’ve come to a solution by first fitting the model with only one chain to have an idea about the sign of the \\(\\beta\\) parameters (there might be other and better ways of doing this). Once I have an idea about the sign of the parameters, then you modify the model syntax accordingly to fit the model with more chains. Let’s refit the model with only one chain and fewer iterations as all I want to see is the sign of the \\(\\beta\\) parameter.\r\n\r\n\r\nfit_hcm_onechain <- stan(model_code = hcm, \r\n                 data       = data, \r\n                 iter       = 200,\r\n                 chains     = 1,\r\n                 control    = list(max_treedepth = 15,adapt_delta=0.9))\r\n\r\n\r\n\r\nprint(fit_hcm_onechain, \r\n      pars = c(\"beta\",\"mu_beta\",\"sigma_beta\"), \r\n      probs = c(0.025,0.975), \r\n      digits = 3)\r\n\r\nInference for Stan model: 5ba394328e7553d4461ee58a0ae9eb24.\r\n1 chains, each with iter=200; warmup=100; thin=1; \r\npost-warmup draws per chain=100, total post-warmup draws=100.\r\n\r\n             mean se_mean    sd   2.5%  97.5% n_eff  Rhat\r\nbeta[1]     2.238   0.029 0.320  1.608  2.767   125 1.005\r\nbeta[2]     1.649   0.038 0.315  0.965  2.184    70 1.006\r\nbeta[3]     1.257   0.055 0.341  0.669  1.979    39 1.021\r\nbeta[4]     0.251   0.046 0.328 -0.383  0.819    51 1.004\r\nbeta[5]    -0.553   0.027 0.278 -1.138 -0.062   110 0.990\r\nbeta[6]    -0.815   0.038 0.291 -1.295 -0.163    58 0.992\r\nbeta[7]    -1.610   0.042 0.427 -2.485 -0.874   103 0.992\r\nbeta[8]    -1.987   0.031 0.301 -2.508 -1.327    97 1.002\r\nmu_beta    -0.034   0.102 0.842 -2.122  1.296    68 0.990\r\nsigma_beta  1.863   0.077 0.540  1.191  3.069    49 0.990\r\n\r\nSamples were drawn using NUTS(diag_e) at Fri Nov 29 18:01:15 2019.\r\nFor each parameter, n_eff is a crude measure of effective sample size,\r\nand Rhat is the potential scale reduction factor on split chains (at \r\nconvergence, Rhat=1).\r\n\r\nSo, this solution suggests that the \\(\\beta\\) parameters from Item 1 to Item 4 are positive and the parameters from Item 5 to Item 8 are negative. Note that this is exact opposite of the true signs I used when generating data. Again, the direction of the scale is totally arbitrary. So, all I need to know is that the Item 1 - Item 4 should have the same sign while Item 5 - Item 8 should have the opposite sign. It is up to me which sign I assign to which set of items. After having this information, I modified the syntax below accordingly and constrained the sign of each \\(\\beta\\) parameter.\r\n\r\n\r\nhcm2 <-'\r\n\r\n    data{\r\n     int I;                   //  number of individuals\r\n     int J;                   //  number of items\r\n     int <lower=0> Y[I,J];    //  data matrix  \r\n    }\r\n  parameters {\r\n      vector<upper=0>[4] beta1;\r\n      vector<lower=0>[4] beta2;\r\n       real mu_beta;\r\n     real<lower=0> sigma_beta;\r\n     \r\n      vector[J] gamma;      \r\n     real mu_gamma;\r\n     real<lower=0> sigma_gamma;\r\n     \r\n    vector[I] theta;    \r\n  }\r\n  \r\n    model{\r\n\r\n      mu_gamma ~ normal(0,5);\r\n      sigma_gamma ~ cauchy(0,2.5);\r\n       gamma   ~ normal(mu_gamma,sigma_gamma);\r\n\r\n      mu_beta ~ normal(0,5);\r\n      sigma_beta ~ cauchy(0,2.5);\r\n       beta1    ~ normal(mu_beta,sigma_beta);\r\n       beta2    ~ normal(mu_beta,sigma_beta);\r\n       \r\n     theta    ~ normal(0,1);\r\n      \r\n      for(i in 1:I) {\r\n       for(j in 1:4) {\r\n        real p1  = exp(gamma[j])/(exp(gamma[j])+2*cosh(theta[i] - beta1[j]));\r\n        Y[i,j] ~ bernoulli(p1);\r\n       }}\r\n        \r\n      for(i in 1:I) {\r\n       for(j in 5:8) {\r\n        real p2  = exp(gamma[j])/(exp(gamma[j])+2*cosh(theta[i] - beta2[j-4]));\r\n        Y[i,j] ~ bernoulli(p2);\r\n       }}\r\n       \r\n    }\r\n'\r\n\r\n\r\n\r\nfit_hcm2 <- stan(model_code = hcm2, \r\n                 data       = data, \r\n                 iter       = 2000,\r\n                 chains     = 4,\r\n                 control    = list(max_treedepth = 15,adapt_delta=0.9))\r\n\r\n\r\n\r\nprint(fit_hcm2, \r\n      pars = c(\"beta1\",\"beta2\",\"mu_beta\",\"sigma_beta\",\"gamma\"), \r\n      probs = c(0.025,0.975), \r\n      digits = 3)\r\n\r\nInference for Stan model: 47cab98047122166c612533d29d2f0ce.\r\n4 chains, each with iter=2000; warmup=1000; thin=1; \r\npost-warmup draws per chain=1000, total post-warmup draws=4000.\r\n\r\n             mean se_mean    sd   2.5%  97.5% n_eff  Rhat\r\nbeta1[1]   -2.237   0.008 0.300 -2.853 -1.618  1588 1.002\r\nbeta1[2]   -1.587   0.009 0.316 -2.278 -0.979  1128 1.005\r\nbeta1[3]   -1.270   0.012 0.318 -1.985 -0.731   727 1.005\r\nbeta1[4]   -0.339   0.006 0.222 -0.815 -0.020  1348 1.001\r\nbeta2[1]    0.595   0.009 0.278  0.077  1.170   864 1.005\r\nbeta2[2]    0.788   0.008 0.274  0.261  1.339  1067 1.009\r\nbeta2[3]    1.560   0.010 0.318  0.937  2.262   992 0.999\r\nbeta2[4]    1.994   0.010 0.324  1.323  2.640   981 1.003\r\nmu_beta    -0.080   0.015 0.678 -1.537  1.247  2083 1.001\r\nsigma_beta  1.792   0.012 0.582  1.005  3.253  2399 1.002\r\ngamma[1]    0.737   0.006 0.226  0.277  1.235  1487 1.003\r\ngamma[2]    0.762   0.006 0.214  0.398  1.276  1104 1.003\r\ngamma[3]    0.951   0.009 0.226  0.650  1.496   679 1.005\r\ngamma[4]    0.637   0.002 0.100  0.436  0.827  1884 1.000\r\ngamma[5]    0.748   0.003 0.113  0.548  0.989  1408 1.003\r\ngamma[6]    0.747   0.003 0.129  0.514  1.033  1451 1.005\r\ngamma[7]    0.768   0.006 0.204  0.411  1.265  1053 1.000\r\ngamma[8]    0.735   0.007 0.238  0.262  1.261  1008 1.004\r\n\r\nSamples were drawn using NUTS(diag_e) at Fri Nov 29 18:18:55 2019.\r\nFor each parameter, n_eff is a crude measure of effective sample size,\r\nand Rhat is the potential scale reduction factor on split chains (at \r\nconvergence, Rhat=1).\r\n\r\n\r\n\r\nplot(fit_hcm2, \r\n     plotfun = \"hist\", \r\n     pars = c(\"beta1[1]\",\"beta1[2]\",\"beta1[3]\",\"beta1[4]\",\r\n              \"beta2[1]\",\"beta2[2]\",\"beta2[3]\",\"beta2[4]\"), \r\n     inc_warmup = FALSE)\r\n\r\n\r\n\r\n\r\nplot(fit_hcm2, \r\n     plotfun = \"hist\", \r\n     pars = c(\"gamma[1]\",\"gamma[2]\",\"gamma[3]\",\"gamma[4]\",\r\n              \"gamma[5]\",\"gamma[6]\",\"gamma[7]\",\"gamma[8]\"), \r\n     inc_warmup = FALSE)\r\n\r\n\r\nNow, this looks very reasonable and much better. Rhat values are within the acceptable range and the posterior distributions look better. If we take the mean of posterior distributions as parameter estimates, they are all within a reasonable range compared to the true values used to generate data.\r\n\r\n\r\n",
    "preview": "posts/hcm-stan/images/image.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 645,
    "preview_height": 389
  },
  {
    "path": "posts/local-elections-2019-turkey2/",
    "title": "2019 Turkish Mayoral Elections – Scraping Ballot Box Level Data",
    "description": "A while ago, I compiled the election data for the 2019 mayoral elections in Turkey, which took place on March 31, 2019, through the Anadolu Agency website, only accessible information back then because the website for the Turkey's Higher Electoral Commission (YSK) was down and they did not make the official election data available until recently. This data was also limited as the Anadolu Agency only provided overall numbers (not for each ballot box). Now, it seems that YSK's website is alive back again and provides a nice-user friendly dashboard for the election data at the ballot box level. However, their dashboard is not very data-analyst friendly for those who has been starving for a more deeper analysis. Here, I provide the data and the R code I used to scrap this data from YSK's website.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-05-24",
    "categories": [
      "web scraping",
      "R",
      "elections",
      "Turkish elections",
      "2019"
    ],
    "contents": "\r\nA while ago, I compiled the election data for the 2019 mayoral elections in Turkey, which took place on March 31, 2019, through the Anadolu Agency website, only accessible information back then because the website for the Turkey’s Higher Electoral Commission (YSK) was down and they did not make the election data available until recently. The blog post about that attempt is here. This data was limited as the agency only provided overall numbers (not for each ballot box).\r\nNow, it seems that YSK’s website is alive back again and provides a nice-user friendly dashboard for the election data at the ballot box level. However, their dashboard is not very data-analyst friendly for those who has been starving for a more deeper analysis to look at the electrol irregularities (aka @abdaydgn, see his recent piece at the Washington Post).\r\nAs Turkey’s democracy is at stake for the last couple years, here is my share to support it. I provide the downloadable datasets below for metropolitan mayoral elections, district municipal mayoral elections, municipal council elections, and provincial council elections. For comparison purposes, I also compiled the exact same data from 2014 corresponding elections.\r\nAs a reference, I also added the links for the R code I used to compile each dataset below from YSK’s API. They are all very similar with a few tweaks required because of the different nature of each dataset.\r\nBelow are a list of variables common in these datasets:\r\nil_ID : city code\r\nil_ADI : city name\r\nilce_ID : district code\r\nilce_ADI : district name\r\nmuhtarlik_ID : neighborhood ID\r\nmuhtarlik_ADI : neighborhood name\r\nsandik_NO : ballot box number\r\nsecmen_SAYISI_ : the number of voters assigned to the ballot box\r\noy_KULLANAN_SECMEN_SAYISI_ : the number of voters came to vote\r\ngecerli_OY_TOPLAMI_ : the number of validated votes\r\ngecersiz_OY_TOPLAMI_ : the number of invalidated votes\r\nitirazsiz_GECERLI_OY_SAYISI_ : the number of validated votes with no objection\r\nitirazli_GECERLI_OY_SAYISI_ : the number of validated votes with objection\r\nBAGIMSIZ.TOPLAM.OY_ : the number of votes for all independent candidates\r\nson_ISLEM_TARIHI_ : the last date and time when there is an update for the ballot box\r\nThe rest of the columns are acronyms for the political parties participated in each election.\r\nPlease be mindful about the time spent to compile these datasets and give acknowledgement if you use these datasets for any publication (research papers, blogs, articles, etc.). A sample reference is provided at the bottom.\r\n2019 Mayoral Elections Ballot Box Level Data\r\nMetropolitan Mayoral Elections (Buyuksehir Belediye Baskanligi Secimleri)\r\nR code\r\nDistrict Municipial Mayoral Elections (Belediye Baskanligi Secimleri)\r\nR code\r\nMunicipial Council Elections (Belediye Meclis Uyeligi Secimleri)\r\nR code\r\nProvincial Council Elections (Il Genel Meclis Uyeligi Secimleri)\r\nR code\r\n2014 Mayoral Elections Ballot Box Level Data\r\nMetropolitan Mayoral Elections (Buyuksehir Belediye Baskanligi Secimleri)\r\nR code\r\nDistrict Municipial Mayoral Elections (Belediye Baskanligi Secimleri)\r\nR code\r\nMunicipial Council Elections (Belediye Meclis Uyeligi Secimleri)\r\nR code\r\nProvincial Council Elections (Il Genel Meclis Uyeligi Secimleri)\r\nR code\r\n",
    "preview": "posts/local-elections-2019-turkey2/images/image.jpg",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {}
  },
  {
    "path": "posts/xgboost/",
    "title": "XGBoost Analysis of Real Dataset to Predict Item Preknowledge",
    "description": "This post includes supplemental material to reproduce the real data analysis presented in the recently published EPM paper.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-04-18",
    "categories": [
      "XGBoost",
      "R",
      "item preknowledge",
      "2019"
    ],
    "contents": "\r\n\r\n\r\n\r\nThis post includes supplemental material for the real data analysis presented in the EPM paper. Another post that includes the R code to reproduce the numerical illustration in the paper can also be found here, How does XGBoost work?.\r\nThe two datasets for the real data analysis in the paper are available from the following links:\r\nDownload the Training Dataset\r\nDownload the Test Dataset\r\nPlease note that these datasets are made available by Drs. Gregory J. Cizek and James A. Wollack for the chapter I wrote in Handbook of Quantitative Methods for Detecting Cheating on Tests. If you ever decide to use these datasets for any purpose or future publication cite this book as a source of this dataset.\r\n\r\nCizek, G. J., & Wollack, J. A. (Eds.). (2017). Handbook of quantitative methods for detecting cheating on tests. New York, NY: Routledge.\r\nDatasets\r\nThe datasets are obtained by merging two test forms provided by Cizek and Wollack (2017). Each test form had 170 items and shared 87 common items, yielding a total of 253 unique items. Each item was a multiple-choice test item with four nominal options (A, B, C, and D). I recoded each item using something known as one-hot encoding such that each nominal response was represented by four binary indicator variables.\r\nA = {1,0,0,0}\r\nB = {0,1,0,0}\r\nC = {0,0,1,0}\r\nD = {0,0,0,1}\r\nTherefore, for instance, the first four columns in the dataset are the binary indicator variables for the nominal response given to the first item, the second four columns in the dataset are the binary indicator variables for the nominal response given to the second item, etc. The first 1012 columns correspond to the nominal responses given to all 253 items (4 x 253 = 1012). Then, the following 253 columns (column labels have the prefix idur.) are the response times for all items. For instance, idur.A4 indicates the response time for Item 4 in Form A or idur.B1 indicates the response time for Item 1 in Form B. The last column labeled as Flagged is the outcome variable of interest and indicates whether or not the individual had been identified as a potential cheater by the testing company. These individuals were believed to have prior access to the test items.\r\nNote that, each individual had taken only 170 items in the test form assigned. Therefore, the variables corresponding to 83 items unique to the other test form are missing for each individual, yielding a quite sparse dataset.\r\nThe test dataset was created by randomly selecting 20% of the whole dataset, and the remaining 80% was treated as the training dataset. Another thing to keep in mind is that the variables should be recognized as ‘numeric’ not as ‘integer’ in R. I don’t know the reason but I realized it made a slight difference in performance.\r\n\r\n\r\n# Import Data\r\n\r\n  train <- read.csv(\"data/train.csv\")\r\n\r\n  dim(train)\r\n\r\n[1] 2624 1266\r\n\r\n  test  <- read.csv(\"data/test.csv\")\r\n\r\n  dim(test)\r\n\r\n[1]  656 1266\r\n\r\n  str(train)\r\n\r\n'data.frame':   2624 obs. of  1266 variables:\r\n $ V1       : int  1 1 0 0 0 1 1 0 0 0 ...\r\n $ V2       : int  0 0 0 0 0 0 0 0 1 0 ...\r\n $ V3       : int  0 0 0 0 0 0 0 1 0 1 ...\r\n $ V4       : int  0 0 1 1 1 0 0 0 0 0 ...\r\n $ V5       : int  1 0 0 0 1 0 1 0 1 0 ...\r\n $ V6       : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V7       : int  0 0 1 0 0 1 0 0 0 0 ...\r\n $ V8       : int  0 1 0 1 0 0 0 1 0 1 ...\r\n $ V9       : int  0 0 0 0 1 0 0 0 0 0 ...\r\n $ V10      : int  1 1 1 1 0 0 1 1 0 1 ...\r\n $ V11      : int  0 0 0 0 0 0 0 0 1 0 ...\r\n $ V12      : int  0 0 0 0 0 1 0 0 0 0 ...\r\n $ V13      : int  1 0 1 0 0 0 0 0 0 0 ...\r\n $ V14      : int  0 1 0 0 1 0 0 0 0 1 ...\r\n $ V15      : int  0 0 0 1 0 0 0 0 0 0 ...\r\n $ V16      : int  0 0 0 0 0 1 1 1 1 0 ...\r\n $ V17      : int  0 0 0 0 0 0 0 1 0 0 ...\r\n $ V18      : int  0 0 1 1 0 0 0 0 0 1 ...\r\n $ V19      : int  1 1 0 0 1 1 0 0 0 0 ...\r\n....\r\n\r\n  str(test)\r\n\r\n'data.frame':   656 obs. of  1266 variables:\r\n $ V1       : int  0 0 0 1 0 0 0 0 0 0 ...\r\n $ V2       : int  0 0 0 0 0 0 1 0 0 0 ...\r\n $ V3       : int  1 1 1 0 0 1 0 1 1 1 ...\r\n $ V4       : int  0 0 0 0 1 0 0 0 0 0 ...\r\n $ V5       : int  1 1 1 1 1 1 1 1 0 1 ...\r\n $ V6       : int  0 0 0 0 0 0 0 0 1 0 ...\r\n $ V7       : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V8       : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V9       : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V10      : int  1 1 1 1 1 1 1 1 1 1 ...\r\n $ V11      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V12      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V13      : int  1 0 0 0 1 1 0 0 0 1 ...\r\n $ V14      : int  0 1 1 1 0 0 1 1 1 0 ...\r\n $ V15      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V16      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V17      : int  1 1 1 1 1 1 0 1 1 0 ...\r\n $ V18      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n $ V19      : int  0 0 0 0 0 0 0 0 0 0 ...\r\n....\r\n\r\n# Convert the variable type to numeric for all variables\r\n\r\n  for(i in 1:1266) { train[,i] = as.numeric(train[,i])}\r\n  for(i in 1:1266) {  test[,i] = as.numeric(test[,i])}\r\n\r\nFitting the XGBoost model and evaluating the model performance\r\n\r\n\r\n# install.packages('xgboost')\r\n# install.packages(pROC)\r\n\r\n  require(xgboost)\r\n  require(pROC)\r\n\r\n# Create the xgb.DMatrix objects \r\n\r\n  dtrain <- xgb.DMatrix(data = data.matrix(train[,1:1265]), label=train$Flagged)\r\n  dtest  <- xgb.DMatrix(data = data.matrix(test[,1:1265]),  label=test$Flagged)\r\n\r\n# Fit the XGBoost model with the tuned parameters\r\n  \r\n  # Tuning the parameters is a whole different story, and I tried to explain it in the paper.\r\n  # Maybe, I can do another post about it, but there is already a lot of resources on the web about it.\r\n  \r\n  watchlist <- list(train=dtrain, test=dtest)\r\n\r\n  bst <- xgb.train(data              = dtrain,\r\n                   nround            = 10000,\r\n                   eta               = .05,\r\n                   min_child_weight  = 1.2,\r\n                   max_depth         = 3,\r\n                   gamma             = 0,\r\n                   max_delta_step    = 0.5,\r\n                   subsample         = 1,\r\n                   colsample_bytree  = 1,\r\n                   lambda            = 0.6,\r\n                   alpha             = 0.3,\r\n                   scale_pos_weight  = 1,\r\n                   num_parallel_tree = 1,\r\n                   nthread           = 1, \r\n                   objective         = 'binary:logistic',\r\n                   eval_metric       = 'rmse',\r\n                   watchlist         = watchlist, \r\n                   early_stopping_round  = 1000,\r\n                   predict = TRUE,\r\n                   seed=123)\r\n\r\n[1] train-rmse:0.494065 test-rmse:0.494136 \r\nMultiple eval metrics are present. Will use test_rmse for early stopping.\r\nWill train until test_rmse hasn't improved in 1000 rounds.\r\n\r\n[2] train-rmse:0.488163 test-rmse:0.488282 \r\n[3] train-rmse:0.482251 test-rmse:0.482446 \r\n[4] train-rmse:0.476363 test-rmse:0.476622 \r\n[5] train-rmse:0.470485 test-rmse:0.470815 \r\n[6] train-rmse:0.464628 test-rmse:0.465032 \r\n[7] train-rmse:0.458775 test-rmse:0.459285 \r\n[8] train-rmse:0.452949 test-rmse:0.453562 \r\n[9] train-rmse:0.447161 test-rmse:0.447846 \r\n[10]    train-rmse:0.441386 test-rmse:0.442188 \r\n[11]    train-rmse:0.435633 test-rmse:0.436518 \r\n[12]    train-rmse:0.429931 test-rmse:0.430891 \r\n[13]    train-rmse:0.424241 test-rmse:0.425326 \r\n[14]    train-rmse:0.418598 test-rmse:0.419755 \r\n[15]    train-rmse:0.412991 test-rmse:0.414238 \r\n[16]    train-rmse:0.407403 test-rmse:0.408735 \r\n[17]    train-rmse:0.401869 test-rmse:0.403319 \r\n....\r\n\r\n# Predict the outcome for the test dataset based on the model \r\n  \r\n  test$prob <- predict(bst,dtest)\r\n\r\n# Create the plot for predicted scores for flagged and unflagged examinees\r\n\r\nplot(test$prob,\r\n     pch=ifelse(test$Flagged==0,1,17),\r\n     col=ifelse(test$Flagged==0,'gray','black'),\r\n     xlab='',\r\n     ylab='Predicted Probability-like Score',\r\n     main = '')\r\n\r\nlegend('topleft',\r\n       c('Flagged by Testing Agency (N=17)','Not Flagged by Testing Agency (N=639)'),\r\n       pch=c(17,1),\r\n       col=c('black','gray'))\r\n\r\n\r\n# AUROC\r\n  \r\n  auc(test$Flagged,test$prob)\r\n\r\nArea under the curve: 0.9278\r\n\r\n# Determine the thresholds for the false positive rates of 0.05 and 0.01\r\n\r\n  th = quantile(test[test$Flagged==0,]$prob,c(.95,.99))\r\n  th\r\n\r\n       95%        99% \r\n0.03151065 0.07820591 \r\n\r\n# Confusion matrix corresponding to .05 Type I error rate\r\n  \r\n  table(test$Flagged,test$prob>th[1])\r\n\r\n   \r\n    FALSE TRUE\r\n  0   607   32\r\n  1     4   13\r\n\r\n    # Type I error = 32/639 = 0.050\r\n    # Power        = 13/17  = 0.765\r\n    # Precision    = 13/45  = 0.288\r\n\r\n# Confusion matrix corresponding to .01 Type I error rate\r\n    \r\n  table(test$Flagged,test$prob>th[2])\r\n\r\n   \r\n    FALSE TRUE\r\n  0   632    7\r\n  1     7   10\r\n\r\n    # Type I error = 7/639  = 0.011\r\n    # Power        = 10/17  = 0.588\r\n    # Precision    = 10/17  = 0.588\r\n\r\nFeature importance\r\nThe code and figure below provides the most important 15 features in this model. On the x-axis, importance score indicates how valuable a feature is in the construction of boosted trees within the model. The importance score is calculated for a single tree by the amount that each attribute split point improves the performance (as measured by gain weighted by the number of observations in each leaf) and then averaged across all trees within the model. On the y-axis, there are labels for features. For instance, the most important feature turns out to be the response time for Item 58 in Form B (idur.B58), and the second most important feature is the response time for Item 30 in Form A (idur.A30). This plot is important as it may help contextualize why a certain individual’s predicted probability is high after combining the information presented in the next section.\r\n\r\n\r\n  imp = xgb.importance(model=bst)\r\n\r\n  xgb.plot.importance(importance_matrix = imp, \r\n                        top_n = 15,\r\n                        xlim=c(0,.04),\r\n                        xlab='Importance',\r\n                        ylab='Features')\r\n\r\n\r\nInterpreting the XGBoost prediction for an individual\r\n\r\n\r\n#install.packages(\"xgboostExplainer\")\r\n\r\nrequire(xgboostExplainer)\r\n\r\nexplainer = buildExplainer(xgb.model    = bst,\r\n                           trainingData = dtrain, \r\n                           type         = 'binary', \r\n                           base_score   = 0.5, \r\n                           trees_idx    = NULL)\r\n\r\n# Breakdown of model prediction for Examinee 84 into the impact of each individual feature on the logit scale \r\n\r\nshowWaterfall(xgb.model     = bst, \r\n              explainer     = explainer, \r\n              DMatrix       = dtest, \r\n              data.matrix   = data.matrix(test[,1:1265]),  \r\n              idx           = 84, \r\n              type          = 'binary',\r\n              threshold     = 0.2)\r\n\r\n\r\nThe model predicted a probability of 0.804 for Examinee 84 to have item preknowledge. Suppose one wants to understand why Examinee 84 has a high probability of item preknowledge. The code above provides a breakdown of this prediction into the impact of each individual feature on the logit scale. The first bar is the intercept displaying the logit value of -3.71 with a corresponding probability of 0.024. The second bar indicates that the base prediction changes by 1.28 based on the response time of Examinee 84 on Item 58 in Form B and the new prediction is now -2.43 with a corresponding probability of 0.081. Similarly, the third bar indicates that the prediction changes by 0.6 based on the response time of Examinee 84 on Item 145 in Form A and the new prediction becomes -1.83 with a corresponding probability of 0.138. This continues until each feature makes a negative or positive contribution to the prediction based on Examinee 84’s response data, and the final prediction for Examinee 84 is 1.41 corresponding to a probability of 0.804.\r\nNotice that the short response time on Items 4, 58, and 96 in Form B and Items 67, 81, 145, and 159 in Form A makes a positive contribution that increases the probability, while long response time on Items 14 and 22 in Form B and Item 114 in Form A makes a negative contribution that decreases the probability. It is no coincidence that most of these features can actually be seen in the figure above among the most important 15 features. Only features with an absolute impact larger than .2 are displayed here for the sake of simplicity. The collective contribution of all other features is displayed as ‘other’ on the x-axis.\r\nAnalyzing the relationship between a feature and the predicted outcome\r\nWe can also show how a certain value of a feature affects the logit as shown below. Each point in the figure below is an examinee in the test data set. The x-axis representsthe response time of the examinees in the test data set for Item 58 in Form B and the y-axis represents how much the predicted logit changes for each data point.\r\n\r\n\r\npred.breakdown = explainPredictions(xgb.model = bst, \r\n                                    explainer = explainer, \r\n                                    data      = dtest)\r\n\r\n\r\n\r\nplot(test[,'idur.B58'], \r\n     as.matrix(pred.breakdown[,'idur.B58'])[,1], \r\n     cex=0.4,\r\n     pch=16, \r\n     xlab = 'Response Time for Item 58 in Form B', \r\n     ylab = 'Change in Logit')\r\n\r\nabline(h=0,lty=2)\r\nabline(v=46,lty=2)\r\n\r\ntext(400,.05,'y = 0')\r\ntext(78,.5,'x = 46')\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/xgboost/images/image.png",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {},
    "preview_width": 706,
    "preview_height": 546
  },
  {
    "path": "posts/local-elections-2019-turkey/",
    "title": "Scraping Data for 2019 Local Elections in Turkey",
    "description": "A friend of mine, Dr. Abdullah Aydogan (https://twitter.com/abdaydgn), has asked me this morning if it is possible to pull the data for the 2019 local elections in Turkey. The only accessible information is through the Anadolu Agency (https://www.aa.com.tr/en) because the official election organization's website (http://www.ysk.gov.tr/) has not been working for a while. Here, I provide the code I used to scrap data from the Anadolu Agency, only available source for election results.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-04-05",
    "categories": [
      "web scraping",
      "R",
      "elections",
      "Turkish elections",
      "2019"
    ],
    "contents": "\r\nA friend of mine, @abdaydgn, has asked me this morning if it is possible to pull the data for the 2019 local elections in Turkey. The only accessible information is through the Anadolu Agency because the official election organization’s website (YSK) has not been working for a while.\r\nAfter doing some detective work about where the data is stored, I fount the the link http://secim.aa.com.tr/Handlers/IlBelediyeBaskanligi.ashx for the city results.\r\nFor the districts within each city, the link is http://secim.aa.com.tr/Handlers/IlceBelediye.ashx?il=citycode, where you have to replace a number in place of citycode for each city. For instance, city code for Istanbul is 34. So, the link http://secim.aa.com.tr/Handlers/IlceBelediye.ashx?il=34 will return the results for all districts of Istanbul.\r\nOnce the data source is found, the rest is a little bit JSON data processing. I don’t have time now to explain the code, but I will post the data files and the code below. Maybe, I can come back and update this post later to put more explanation about the code.\r\nLong Format\r\nDownload 2019 Turkish Local Elections Data - Cities\r\nDownload 2019 Turkish Local Elections Data - Districts\r\nWide Format\r\nDownload 2019 Turkish Local Elections Data - Cities\r\nDownload 2019 Turkish Local Elections Data - Districts\r\n\r\n\r\n# Install the following packages\r\n\r\n install.packages(\"jsonlite\")\r\n install.packages(\"mefa\")\r\n install.packages(\"car\")\r\n install.packages(\"plyr\")\r\n \r\n require(jsonlite)\r\n require(mefa)\r\n require(car)\r\n require(plyr)\r\n\r\n##########################################################################\r\n#\r\n#    Pulling Data for District Results\r\n#\r\n##########################################################################\r\n\r\ncity.code <- read.csv(\"il kod.csv\")\r\n \r\n # This is a 2-column data for each city and corresponding code\r\n # can be downloaded from the following link.\r\n # https://miami.box.com/s/gkwihhqgule7moxoabohwfgh6u74yhkl\r\n \r\n\r\nsecim2019 <- vector(\"list\",81)\r\n\r\n  for(city in 1:81){\r\n\r\n      a <- jsonlite::fromJSON(paste0(\"http://secim.aa.com.tr/Handlers/IlceBelediye.ashx?il=\",city))\r\n      info <- cbind(a$Ilce$Ad,a$Ilce$Sandik)\r\n      sonuc <- vector(\"list\",nrow(info))\r\n\r\n        for(i in 1:nrow(info)){\r\n          n = nrow(a$Ilce$PartiSonuclari$Parti[[i]])\r\n          sonuc[[i]] <- cbind(rep(info[i,],n),a$Ilce$PartiSonuclari$Parti[[i]])\r\n        }\r\n\r\n      il <- sonuc[[1]]\r\n    \r\n        for(i in 2:nrow(info)){\r\n            il <- rbind(il,sonuc[[i]])\r\n        }\r\n    \r\n      il$Il <- as.character(city.code[city,1])\r\n\r\n      secim2019[[city]] <- il\r\n  }\r\n\r\nsecim2019.all <- secim2019[[1]]\r\n\r\n    for(i in 2:81){\r\n        secim2019.all <- rbind(secim2019.all,secim2019[[i]])\r\n    }\r\n\r\n\r\nsecim2019.all$parti.kod <- recode(secim2019.all$Kod,\r\n       recodes=\"1 ='SP';\r\n                2 ='BTP';\r\n                3 ='TKP';\r\n                4 ='VP';\r\n                5 ='BBP';\r\n                6 ='HudaPar';\r\n                7 ='CHP';\r\n                8 ='AKP';\r\n                9 ='DP';\r\n               10 ='MHP';\r\n               11 ='IYI';\r\n               12 ='HDP';\r\n               13 ='DSP';\r\n             else ='Bagimsiz'\")\r\n\r\n  secim2019.all$ToplamSandik <- as.numeric(as.character(secim2019.all$ToplamSandik))\r\n  secim2019.all$ToplamSecmen <- as.numeric(as.character(secim2019.all$ToplamSecmen))\r\n  secim2019.all$AcilanSandikSecmenSayisi <- as.numeric(as.character(secim2019.all$AcilanSandikSecmenSayisi))\r\n  secim2019.all$AcilanSandik <- as.numeric(as.character(secim2019.all$AcilanSandik))\r\n\r\n  secim2019.all$KullanilanOy <- as.numeric(as.character(secim2019.all$KullanilanOy))\r\n  secim2019.all$GecerliOy <- as.numeric(as.character(secim2019.all$GecerliOy))\r\n  secim2019.all$Kod <- as.numeric(as.character(secim2019.all$Kod))\r\n  secim2019.all$Oy <- as.numeric(as.character(secim2019.all$Oy))\r\n  \r\n  secim2019.all$Turnout         <- secim2019.all$KullanilanOy/secim2019.all$ToplamSecmen\r\n  secim2019.all$GecerliOy.Orani <- secim2019.all$GecerliOy/secim2019.all$KullanilanOy\r\n  secim2019.all$Parti.Oran      <- secim2019.all$Oy/secim2019.all$GecerliOy\r\n\r\n\r\n  secim2019.all <- secim2019.all[,c(\"Il\",\"a.Ilce.Ad\",\"ToplamSandik\",\"ToplamSecmen\",\"KullanilanOy\",\r\n                                    \"GecerliOy\",\"parti.kod\",\"Oy\",\"Turnout\",\"GecerliOy.Orani\",\r\n                                    \"Parti.Oran\")]\r\n\r\n  colnames(secim2019.all)[2] <- \"Ilce\"\r\n  colnames(secim2019.all)[7] <- \"Parti\"\r\n\r\n  write.table(secim2019.all,\"Secim2019IlceBelediyeSonuc.csv\",row.names=FALSE,sep=\",\")\r\n\r\n\r\n  \r\n  # Wide Format\r\n  \r\n    # Aggregate the vote for \"Bagimsiz\" category for districts with more than\r\n    # \"Bagimsiz\" candidates\r\n  \r\n  \r\n    secim2019.all.wide <- ddply(secim2019.all,\r\n                                .(Il, Ilce,ToplamSandik,ToplamSecmen,KullanilanOy,\r\n                                  GecerliOy,Parti,Turnout,GecerliOy.Orani),\r\n                                summarise,Oy = sum(Oy))\r\n\r\n    secim2019.all.wide$Parti.Oran <- secim2019.all.wide$Oy/secim2019.all.wide$GecerliOy \r\n\r\n    secim2019.all.wide <- reshape(secim2019.all.wide,\r\n                                  timevar =c(\"Parti\"),\r\n                                  idvar   =c(\"Il\",\"Ilce\",\"ToplamSandik\",\r\n                                             \"ToplamSecmen\",\"KullanilanOy\",\r\n                                             \"GecerliOy\",\"Turnout\",\"GecerliOy.Orani\"),\r\n                                  direction=\"wide\")\r\n    \r\n    secim2019.all.wide[is.na(secim2019.all.wide)] <- 0\r\n  \r\n    write.table(secim2019.all.wide,\"Secim2019IlceBelediyeSonuc_wide.csv\",row.names=FALSE,sep=\",\")\r\n\r\n##########################################################################\r\n#\r\n#    Pulling Data for City Results\r\n#\r\n##########################################################################\r\n\r\n\r\na <- jsonlite::fromJSON(\"http://secim.aa.com.tr/Handlers/IlBelediyeBaskanligi.ashx\")\r\n\r\ninfo <- cbind(a[[1]][[3]]$Il$Ad,a[[1]][[3]]$Il$Sandik)\r\n\r\nsonuc <- vector(\"list\",nrow(info))\r\n\r\n    for(i in 1:nrow(info)){\r\n     n = nrow(a[[1]][[3]]$Il$PartiSonuclari$Parti[[i]])\r\n     sonuc[[i]] <- cbind(rep(info[i,],n),a[[1]][[3]]$Il$PartiSonuclari$Parti[[i]])\r\n    }\r\n\r\nil <- sonuc[[1]]\r\n    for(i in 2:nrow(info)){\r\n        il <- rbind(il,sonuc[[i]])\r\n    }\r\n\r\n\r\nil$parti.kod <- recode(il$Kod,\r\n       recodes=\"1 ='SP';\r\n                2 ='BTP';\r\n                3 ='TKP';\r\n                4 ='VP';\r\n                5 ='BBP';\r\n                6 ='HudaPar';\r\n                7 ='CHP';\r\n                8 ='AKP';\r\n                9 ='DP';\r\n               10 ='MHP';\r\n               11 ='IYI';\r\n               12 ='HDP';\r\n               13 ='DSP';\r\n             else ='Bagimsiz'\")\r\n\r\n\r\nil$ToplamSandik <- as.numeric(as.character(il$ToplamSandik))\r\nil$ToplamSecmen <- as.numeric(as.character(il$ToplamSecmen))\r\nil$AcilanSandikSecmenSayisi <- as.numeric(as.character(il$AcilanSandikSecmenSayisi))\r\nil$AcilanSandik <- as.numeric(as.character(il$AcilanSandik))\r\n\r\nil$KullanilanOy <- as.numeric(as.character(il$KullanilanOy))\r\nil$GecerliOy <- as.numeric(as.character(il$GecerliOy))\r\nil$Kod <- as.numeric(as.character(il$Kod))\r\nil$Oy <- as.numeric(as.character(il$Oy))\r\n\r\nil$Turnout         <- il$KullanilanOy/il$ToplamSecmen\r\nil$GecerliOy.Orani <- il$GecerliOy/il$KullanilanOy\r\nil$Parti.Oran      <- il$Oy/il$GecerliOy\r\n\r\ncolnames(il)[1] <- \"IL\"\r\ncolnames(il)[11] <- \"Parti\"\r\n\r\nil <- il[,c(\"IL\",\"ToplamSandik\",\"ToplamSecmen\",\"KullanilanOy\",\"GecerliOy\",\"Parti\",\r\n            \"Oy\",\"Turnout\",\"GecerliOy.Orani\",\"Parti.Oran\")]\r\n\r\nwrite.table(il,\"Secim2019IlBelediyeSonuc.csv\",row.names=FALSE,sep=\",\")\r\n\r\n # Wide Format\r\n  \r\n    # Aggregate the vote for \"Bagimsiz\" category for districts with more than\r\n    # \"Bagimsiz\" candidates\r\n  \r\n  \r\n    il.wide <- ddply(il,\r\n                     .(IL,ToplamSandik,ToplamSecmen,KullanilanOy,\r\n                       GecerliOy,Parti,Turnout,GecerliOy.Orani),\r\n                     summarise,Oy = sum(Oy))\r\n\r\n    il.wide$Parti.Oran <- il.wide$Oy/il.wide$GecerliOy \r\n\r\n    il.wide <- reshape(il.wide,\r\n                       timevar =c(\"Parti\"),\r\n                       idvar   =c(\"IL\",\"ToplamSandik\",\r\n                                  \"ToplamSecmen\",\"KullanilanOy\",\r\n                                  \"GecerliOy\",\"Turnout\",\"GecerliOy.Orani\"),\r\n                                  direction=\"wide\")\r\n    \r\n    il.wide[is.na(il.wide)] <- 0\r\n  \r\n    write.table(il.wide,\"Secim2019IlBelediyeSonuc_wide.csv\",row.names=FALSE,sep=\",\")\r\n\r\n\r\n\r\n",
    "preview": "posts/local-elections-2019-turkey/images/image.jpg",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {}
  },
  {
    "path": "posts/epm-keywords/",
    "title": "Compiling Keywords from the Published Articles in Educational and Pscyhological Measurement",
    "description": "What are the most commonly used keywords in published articles in educational measurement journals? Is there any trending topic in educational measurement journals? I decided to do a sample analysis in the context of Educational and Psychological Measurement (EPM). However, I had figure out first how to compile a dataset of keywords used in EPM. It turned out to be another web scraping story.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-04-01",
    "categories": [
      "web scraping",
      "R",
      "2019"
    ],
    "contents": "\r\nWhat are the most commonly used keywords in published articles in educational measurement journals? Is there any trending topic in educational measurement journals? I decided to do a sample analysis in the context of Educational and Psychological Measurement (EPM). Initially, I was planning to do a comparison across journals including Journal of Educational Measurement (JEM), Applied Measurement in Education (AME), and Educational Measurement: Issues and Practices (EM:IP). However, I realized JEM and AME do not require keywords for the papers they publish. So, I focus on only EPM for now, and this can be replicated with a few tweaks in the code for EM:IP. This post will include some coding about how to automate scraping the desired information from the EPM webpage and I plan to write a follow-up post later with some analysis of the dataset compiled in this post.\r\n\r\n\r\nrequire(rvest)\r\nrequire(xml2)\r\nrequire(knitr)\r\nrequire(kableExtra)\r\n\r\nScraping Keywords from the EPM Website\r\nFirst, let’s look at what information one needs to scrap from the EPM website and how this information is stored at the EPM website. Table of Contents for a certain volume and issue can be accessed using a link https://journals.sagepub.com/toc/epma/i/j, where i is the volume number and j is the issue number. For instance, if one wants to access Volume 79 Issue 2, the link is https://journals.sagepub.com/toc/epma/79/2. On this webpage, there is a list of titles for the papers published in this issue, and there is a link for Abstract under each title. At the link for Abstract, one can access the information about the title, authors, publication date, abstract, references, and keywords.\r\nA sample webpage for the table of contents from an EPM issueAt the link for Abstract, one can access the information about the title, authors, publication date, abstract, references, and keywords for each paper.\r\nA sample webpage for the abstract from a EPM paperBased on my exploration, EPM has been publishing keywords starting from Volume 63 and Issue 1 published in February 2003. That makes 98 issues published with keywords. If there is on average 10 articles published per issue, there may be about 1000 papers. One alternative is to extract this information manually one by one by visiting each paper published, which will probably take days and weeks. Therefore, it is wise to try to automate this process.\r\nStep 1: Retrieving keywords for an article from an abstract link\r\nFor the example above, the link for the Abstract is https://journals.sagepub.com/doi/abs/10.1177/0013164418773494. Let’s read this webpage into R.\r\n\r\n\r\nlink = \"https://journals.sagepub.com/doi/abs/10.1177/0013164418773494\"\r\narticle <- read_html(link)\r\n\r\narticle\r\n\r\n{html_document}\r\n<html lang=\"en\" class=\"pb-page\" data-request-id=\"76c746d0-aee4-4faa-8964-1b5e3a49f30e\">\r\n[1] <head data-pb-dropzone=\"head\">\\n<meta http-equiv=\"Content-Type\" ...\r\n[2] <body class=\"pb-ui\">\\n<div class=\"totoplink\">\\n<a id=\"skiptocon ...\r\n\r\nThe object article simply contains all html source code for this specific webpage. If you want to see it, you can check from this link\r\nview-source:https://journals.sagepub.com/doi/abs/10.1177/0013164418773494\r\nThe information we are looking is somewhere in this source text, and the trick is how to pull that information. At this point, you would need some help from SelectorGadget app which can be installed as a Chrome extension. There is a good number of video tutorials on the web about how to use it, so I will skip that. When you open the SelectorGadget on the link for the paper and click the box where Keywords are listed, it will show you the CSS selector for that element. As can be seen in the screen shot below, we learn that the CSS selector for Keywords box in this page is “.hlFld-KeywordText”.\r\nFinding the CSS selector for the Keyword box in the Abstract pageNow, we can pull that specific piece from the whole html page we read to R before..\r\n\r\n\r\nkeywords <- html_text(html_nodes(article,\".hlFld-KeywordText\"))\r\n\r\nkeywords\r\n\r\n[1] \"Keywords multilevel modeling, fixed effects modeling, random coefficients, small samples\"\r\n\r\nIt looks like we got what we want, but it needs some polishing. First, we need to get rid of the word “Keywords” at the beginning, transform each keyword separated by comma to different strings, and then delete the white spaces.\r\n\r\n\r\nkeywords  <- substring(keywords,10) \r\n\r\nkeywords\r\n\r\n[1] \"multilevel modeling, fixed effects modeling, random coefficients, small samples\"\r\n\r\nkeywords <- strsplit(keywords,\",\")[[1]]\r\n\r\nkeywords\r\n\r\n[1] \"multilevel modeling\"     \" fixed effects modeling\"\r\n[3] \" random coefficients\"    \" small samples\"         \r\n\r\nkeywords <- trimws(keywords)\r\n\r\nkeywords\r\n\r\n[1] \"multilevel modeling\"    \"fixed effects modeling\"\r\n[3] \"random coefficients\"    \"small samples\"         \r\n\r\nNice! So, given a link for a paper abstract, we just retrieved a vector of keywords for that specific paper. Below is a simple function to organize the code above. It takes an abstract link as input and returns the keywords on that link as an output.\r\n\r\n\r\nkey.words <- function(link){\r\n  \r\n  article  <- read_html(link)\r\n  keywords <- html_text(html_nodes(article,\".hlFld-KeywordText\"))\r\n  keywords <- substring(keywords,10)\r\n  if(length(keywords)!=0){\r\n    out      <- trimws(strsplit(keywords,\",\")[[1]])\r\n  } else {\r\n    out <- NULL\r\n    }\r\n  return(out)\r\n  \r\n}\r\n\r\n\r\nlink = \"https://journals.sagepub.com/doi/abs/10.1177/0013164418773494\"\r\n\r\nkey.words(link)\r\n\r\n[1] \"multilevel modeling\"    \"fixed effects modeling\"\r\n[3] \"random coefficients\"    \"small samples\"         \r\n\r\nStep 2: Retrieving abstract links fo papers published in an issue\r\nThe next important task is to extract the information about the abstract links for all papers published for an issue. As mentioned before, the table of contents for EPM issues follows the following format https://journals.sagepub.com/toc/epma/i/j. Suppose, we look at the latest issue https://journals.sagepub.com/toc/epma/79/2. If you select Abstract for any paper on this page using the SelectorGadget, it will show the CSS selector as “.abstract-link”.\r\nLet’s look at what we can retrieve from this page using the “.abstract-link” node.\r\n\r\n\r\nlink = \"https://journals.sagepub.com/toc/epma/79/2\"\r\n\r\nissue <- read_html(link)\r\n\r\n\r\nabstract.links <- html_attr(html_nodes(issue,\".abstract-link\"),\"href\")\r\n\r\nabstract.links\r\n\r\n[1] \"/doi/abs/10.1177/0013164418773494\"\r\n[2] \"/doi/abs/10.1177/0013164418773851\"\r\n[3] \"/doi/abs/10.1177/0013164418777569\"\r\n[4] \"/doi/abs/10.1177/0013164418777854\"\r\n[5] \"/doi/abs/10.1177/0013164418783530\"\r\n[6] \"/doi/abs/10.1177/0013164418790634\"\r\n[7] \"/doi/abs/10.1177/0013164418791673\"\r\n[8] \"/doi/abs/10.1177/0013164418777784\"\r\n[9] \"/doi/abs/10.1177/0013164417733305\"\r\n\r\nThis looks good! It shows there are 9 papers published in Volume 79 Issue 2, and these are the part of the links to access their abstract pages.\r\nAll we need to do is to put “https://journals.sagepub.com/” in front of these texts.\r\n\r\n\r\nabstract.links <- paste0(\"https://journals.sagepub.com\",abstract.links)\r\n\r\nabstract.links\r\n\r\n[1] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418773494\"\r\n[2] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418773851\"\r\n[3] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418777569\"\r\n[4] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418777854\"\r\n[5] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418783530\"\r\n[6] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418790634\"\r\n[7] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418791673\"\r\n[8] \"https://journals.sagepub.com/doi/abs/10.1177/0013164418777784\"\r\n[9] \"https://journals.sagepub.com/doi/abs/10.1177/0013164417733305\"\r\n\r\nAgain, let’s organize this code in a simple function. This function takes the volume number and issue number as numeric inputs, and then returns the list of abstract page links as a character vector.\r\n\r\n\r\ndoi <- function(volume,issue){\r\n  \r\n  link            <- paste0(\"https://journals.sagepub.com/toc/epma/\",volume,\"/\",issue)\r\n  issue           <- read_html(link)\r\n  abstract.links  <- html_attr(html_nodes(issue,\".abstract-link\"),\"href\")\r\n  out             <- paste0(\"https://journals.sagepub.com\",abstract.links)\r\n  \r\n  return(out)\r\n  \r\n}\r\n\r\n\r\ndoi(volume=70,issue=3) # Returns the links for abstract pages from papers published in Volume 70 Issue 3\r\n\r\n [1] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355694\"\r\n [2] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355690\"\r\n [3] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355692\"\r\n [4] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355693\"\r\n [5] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355696\"\r\n [6] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409344510\"\r\n [7] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409344517\"\r\n [8] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409344520\"\r\n [9] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355685\"\r\n[10] \"https://journals.sagepub.com/doi/abs/10.1177/0013164409355687\"\r\n[11] \"https://journals.sagepub.com/doi/abs/10.1177/0013164410367480\"\r\n\r\nStep 3: Retrieving all keywords published in an issue\r\nAfter creating two functions in Step 1 and Step 2, this will be easier. Suppose we are looking at Volume 70 Issue 3. First, extract the links using the function in Step 2. Then, run a for loop to extract the keywords from each link using the function in Step 1. We will also organize them in a nice looking data frame.\r\n\r\n\r\n\r\ni = 70  # volume number\r\nj = 3   # issue number\r\n\r\ndoi.links <- doi(volume=i,issue=j) \r\n\r\nKeywords <- data.frame(article=NULL,keywords=NULL)\r\n\r\nfor(r in 1:length(doi.links)){\r\n  \r\n  link     <- doi.links[r]\r\n  keywords <- key.words(link)\r\n  if(is.null(keywords)==FALSE){\r\n    sub.data <- data.frame(article=r,keywords=keywords)\r\n    Keywords <- rbind(Keywords,sub.data)\r\n  }\r\n}\r\n\r\nKeywords$volume <- i\r\nKeywords$issue  <- j\r\n\r\n\r\nkable(Keywords,format=\"html\",row.names=FALSE,align=\"cccc\")\r\n\r\narticle\r\n\r\n\r\nkeywords\r\n\r\n\r\nvolume\r\n\r\n\r\nissue\r\n\r\n\r\n1\r\n\r\n\r\nobjective level scores\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n1\r\n\r\n\r\nsubscore augmentation\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n1\r\n\r\n\r\nreliability\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n2\r\n\r\n\r\ncoefficient alpha\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n2\r\n\r\n\r\nreliability\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n2\r\n\r\n\r\nconfidence intervals\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n2\r\n\r\n\r\nsimulation studies\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n2\r\n\r\n\r\nFisher’s Z transformation\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n3\r\n\r\n\r\npilot study\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n3\r\n\r\n\r\nsample size\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n3\r\n\r\n\r\ninstrument development\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\ncrossed random effects\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\nteacher effects\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\nmultilevel\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\ngrowth model\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\npiecewise\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\nsummer learning\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\nvalue added\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n4\r\n\r\n\r\nBayesian\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nGraded Response Model\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nMultilevel Item Response Theory\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nhealth-related quality of life\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nExplanatory Item Response Model\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nnonlinear mixed model\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n5\r\n\r\n\r\nPedsQL\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n6\r\n\r\n\r\nuniversity attachment\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n6\r\n\r\n\r\ngroup attachment\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n6\r\n\r\n\r\nbelonging\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n6\r\n\r\n\r\nconstruct validity\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n7\r\n\r\n\r\nhomework purpose\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n7\r\n\r\n\r\nscale development\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n7\r\n\r\n\r\nfactor analysis\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n7\r\n\r\n\r\nhigh school students\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n8\r\n\r\n\r\nconfirmatory factor analysis\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n8\r\n\r\n\r\nordinal data\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n8\r\n\r\n\r\nstructural equation modeling\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n8\r\n\r\n\r\nmultilevel modeling\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n8\r\n\r\n\r\nAPCCS II-HST\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n9\r\n\r\n\r\ntest score validity\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n9\r\n\r\n\r\nfactor analysis\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n9\r\n\r\n\r\ncross-validation\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n9\r\n\r\n\r\nmultisample confirmatory factor analysis\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n10\r\n\r\n\r\nwork/family conflict\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n10\r\n\r\n\r\ncoworker support\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n10\r\n\r\n\r\norganizational citizenship\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\n10\r\n\r\n\r\ncoworker backup\r\n\r\n\r\n70\r\n\r\n\r\n3\r\n\r\n\r\nLet’s also organize this in a single function. This function takes the volume number and issue number as numeric inputs, and then returns the keywords published in that issue.\r\n\r\n\r\nextract.Keywords <- function(i,j){\r\n  \r\ndoi.links <- doi(volume=i,issue=j) \r\n\r\nKeywords <- data.frame(article=NULL,keywords=NULL)\r\n\r\nfor(r in 1:length(doi.links)){\r\n  \r\n  link     <- doi.links[r]\r\n  keywords <- key.words(link)\r\n  if(is.null(keywords)==FALSE){\r\n    sub.data <- data.frame(article=r,keywords=keywords)\r\n    Keywords <- rbind(Keywords,sub.data)\r\n  }\r\n}\r\n\r\n  Keywords$volume <- i\r\n  Keywords$issue  <- j\r\n\r\n  return(Keywords)\r\n}\r\n\r\nextract.Keywords(i=70,j=3)\r\n\r\n   article                                 keywords volume issue\r\n1        1                   objective level scores     70     3\r\n2        1                    subscore augmentation     70     3\r\n3        1                              reliability     70     3\r\n4        2                        coefficient alpha     70     3\r\n5        2                              reliability     70     3\r\n6        2                     confidence intervals     70     3\r\n7        2                       simulation studies     70     3\r\n8        2                Fisher’s Z transformation     70     3\r\n9        3                              pilot study     70     3\r\n10       3                              sample size     70     3\r\n11       3                   instrument development     70     3\r\n12       4                   crossed random effects     70     3\r\n13       4                          teacher effects     70     3\r\n14       4                               multilevel     70     3\r\n15       4                             growth model     70     3\r\n16       4                                piecewise     70     3\r\n17       4                          summer learning     70     3\r\n18       4                              value added     70     3\r\n19       4                                 Bayesian     70     3\r\n20       5                    Graded Response Model     70     3\r\n21       5          Multilevel Item Response Theory     70     3\r\n22       5           health-related quality of life     70     3\r\n23       5          Explanatory Item Response Model     70     3\r\n24       5                    nonlinear mixed model     70     3\r\n25       5                                   PedsQL     70     3\r\n26       6                    university attachment     70     3\r\n27       6                         group attachment     70     3\r\n28       6                                belonging     70     3\r\n29       6                       construct validity     70     3\r\n30       7                         homework purpose     70     3\r\n31       7                        scale development     70     3\r\n32       7                          factor analysis     70     3\r\n33       7                     high school students     70     3\r\n34       8             confirmatory factor analysis     70     3\r\n35       8                             ordinal data     70     3\r\n36       8             structural equation modeling     70     3\r\n37       8                      multilevel modeling     70     3\r\n38       8                             APCCS II-HST     70     3\r\n39       9                      test score validity     70     3\r\n40       9                          factor analysis     70     3\r\n41       9                         cross-validation     70     3\r\n42       9 multisample confirmatory factor analysis     70     3\r\n43      10                     work/family conflict     70     3\r\n44      10                         coworker support     70     3\r\n45      10               organizational citizenship     70     3\r\n46      10                          coworker backup     70     3\r\n\r\nStep 4: Retrieving all keywords published since 2003\r\nAs mentioned at the beginning, EPM has been publishing keywords starting from Volume 63 and Issue 1 published in February 2003. Also, each volume has six issues since then.\r\nNow, let’s create a data frame for the volume and issue information since 2003.\r\n\r\n\r\nEPM.issues <- expand.grid(volume=63:79,issue=1:6)\r\n\r\n# Add year as a column\r\n\r\nEPM.issues$year <- 2003:2019\r\nEPM.issues <- EPM.issues[order(EPM.issues$volume),]\r\n\r\n# The last four rows are not published yet.\r\n\r\n\r\nEPM.issues <- EPM.issues[1:98,]\r\n\r\nEPM.issues\r\n\r\n    volume issue year\r\n1       63     1 2003\r\n18      63     2 2003\r\n35      63     3 2003\r\n52      63     4 2003\r\n69      63     5 2003\r\n86      63     6 2003\r\n2       64     1 2004\r\n19      64     2 2004\r\n36      64     3 2004\r\n53      64     4 2004\r\n70      64     5 2004\r\n87      64     6 2004\r\n3       65     1 2005\r\n20      65     2 2005\r\n37      65     3 2005\r\n54      65     4 2005\r\n71      65     5 2005\r\n88      65     6 2005\r\n4       66     1 2006\r\n21      66     2 2006\r\n38      66     3 2006\r\n55      66     4 2006\r\n72      66     5 2006\r\n89      66     6 2006\r\n5       67     1 2007\r\n22      67     2 2007\r\n39      67     3 2007\r\n56      67     4 2007\r\n73      67     5 2007\r\n90      67     6 2007\r\n6       68     1 2008\r\n23      68     2 2008\r\n40      68     3 2008\r\n57      68     4 2008\r\n74      68     5 2008\r\n91      68     6 2008\r\n7       69     1 2009\r\n24      69     2 2009\r\n41      69     3 2009\r\n58      69     4 2009\r\n75      69     5 2009\r\n92      69     6 2009\r\n8       70     1 2010\r\n25      70     2 2010\r\n42      70     3 2010\r\n59      70     4 2010\r\n76      70     5 2010\r\n93      70     6 2010\r\n9       71     1 2011\r\n26      71     2 2011\r\n43      71     3 2011\r\n60      71     4 2011\r\n77      71     5 2011\r\n94      71     6 2011\r\n10      72     1 2012\r\n27      72     2 2012\r\n44      72     3 2012\r\n61      72     4 2012\r\n78      72     5 2012\r\n95      72     6 2012\r\n11      73     1 2013\r\n28      73     2 2013\r\n45      73     3 2013\r\n62      73     4 2013\r\n79      73     5 2013\r\n96      73     6 2013\r\n12      74     1 2014\r\n29      74     2 2014\r\n46      74     3 2014\r\n63      74     4 2014\r\n80      74     5 2014\r\n97      74     6 2014\r\n13      75     1 2015\r\n30      75     2 2015\r\n47      75     3 2015\r\n64      75     4 2015\r\n81      75     5 2015\r\n98      75     6 2015\r\n14      76     1 2016\r\n31      76     2 2016\r\n48      76     3 2016\r\n65      76     4 2016\r\n82      76     5 2016\r\n99      76     6 2016\r\n15      77     1 2017\r\n32      77     2 2017\r\n49      77     3 2017\r\n66      77     4 2017\r\n83      77     5 2017\r\n100     77     6 2017\r\n16      78     1 2018\r\n33      78     2 2018\r\n50      78     3 2018\r\n67      78     4 2018\r\n84      78     5 2018\r\n101     78     6 2018\r\n17      79     1 2019\r\n34      79     2 2019\r\n\r\nNow, I will use a for loop to run extract.Keywords() function from Step 3 for every issue of EPM, and compile them in one data frame. Note that this took about an hour to run, so be patient if you are replicating this.\r\n\r\n\r\nall.Keywords <- c()\r\n\r\nfor(rep in 1:nrow(EPM.issues)){\r\n\r\n  key      <- extract.Keywords(i=EPM.issues[rep,]$volume,\r\n                          j=EPM.issues[rep,]$issue)\r\n\r\n  key$year <- EPM.issues[rep,]$year\r\n  \r\n  all.Keywords <- rbind(all.Keywords,key)\r\n}\r\n\r\nThe dataset obtained from the code above can be downloaded from this link. This includes a total of 4,061 keywords from 901 published articles published in 98 issues since February 2003. Now, we can dive into this dataset and see what it reveals!\r\n\r\n\r\n",
    "preview": "posts/epm-keywords/images/EPM2.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 1221,
    "preview_height": 920
  },
  {
    "path": "posts/extreme-gradient-boosting/",
    "title": "How Does Extreme Gradient Boosting (XGBoost) Work?",
    "description": "In one of the working papers under review, I am using the Extreme Gradient Boosting (XGBoost) to identify examinees with potential item preknowledge in a certification exam. In the original paper, one of the reviewers asked more description of the XGBoost to help readers get a conceptual understanding of how XGBoost works. After spending a few weeks on the original paper, I finally felt that I had a good grasp of it. In this post, I provide an informal introduction of XGboost using an illustration with accompanying R code.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2019-01-15",
    "categories": [
      "XGBoost",
      "R",
      "2019"
    ],
    "contents": "\r\nIn one of the working papers under review, I am using the Extreme Gradient Boosting (XGBoost) to identify examinees with potential item preknowledge in a certification exam. In the first draft I submitted, I did not talk much about the technical aspects of XGBoost and went straight to my application. However, one of the reviewers asked more description of the XGBoost to help readers get a conceptual understanding of how XGBoost works.\r\nAfter spending a few weeks and going over the original XGBoost paper and this presentation so many times, I finally felt that I had a good grasp of it. Then, I came up with a small numerical illustration in the context of the problem I am working on. Here, I provide an informal introduction of this illustration with accompanying R code, so that anyone can play with it.\r\nYou can download the illustration dataset from this link.\r\nDataset\r\nSuppose, we have 30 observations with three variables, \\(RT_1\\), \\(RT_2\\), and \\(y\\). \\(RT_1\\) and \\(RT_2\\) are the response time (in seconds) for two test items and our features (predictors). \\(y\\) is a binary outcome variable with 0 indicating that the individual did not have item preknowledge and 1 indicating that the individual had item preknowledge. The goal is to develop a tree ensemble model to predict the outcome given the feature variables.\r\n\r\n\r\n\r\nd <- read.csv(\"data/illustration2.csv\")\r\nd$Obs <- 1:30\r\nd <- d[,c(4,1,2,3)]\r\n\r\nrequire(knitr)\r\nrequire(kableExtra)\r\n\r\nt = kable(d,digits=1,row.names=FALSE)\r\ncolumn_spec(t,column=1:4,width=\"1em\")\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\nFirst, we need an objective function to optimize. So, we can look back and check if we are improving our model. In the context of predicting a binary outcome, XGBoost is using a logistic loss function.\r\n\\[\\ell(y_i,\\hat{y}_i)=y_i ln(1+e^{-\\hat{y}_i})+(1-y_i)ln(1+e^{\\hat{y}_i}),\\]\r\nwhere \\(y_i\\) and \\(\\hat{y}_i\\) are the observed and predicted outcome for the \\(i^{th}\\) observation. Before we start iterations, XGBoost assigns a predicted value of 0 for each observation as our initial prediction. Let’s call this Iteration 0.\r\n\r\n\r\n\r\nd$y0 <- 0\r\ncolnames(d)[5] <- \"$\\\\hat{y}^0$\"\r\n  \r\nt = kable(d,digits=1,row.names=FALSE)\r\ncolumn_spec(t,column=1:5,width=\"1em\")\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\nThe value of the loss function based on \\(y_i\\) and \\(\\hat{y}^0\\) at Iteration 0 is 20.79442.\r\n\r\n\r\ny  <- d[,4]\r\ny0 <- d[,5]\r\n\r\nloss0 <- sum(y*log(1+exp(-y0)) + (1-y)*log(1+exp(y0)))\r\nloss0\r\n\r\n[1] 20.79442\r\n\r\nIteration 1\r\nTo build the first tree, we need the first and second order gradient statistics of the loss function from Iteration 0. Chen and Guestrin (2016) used a second-order Taylor approximation for the loss function and derived the equations for the first- and second-order gradient statistics. In this case, we can compute the first- and second-order gradient statistics for each observation as the following:\r\n\\[g_i^{(1)} = -\\frac{(y_i-1)e^{\\hat{y_i}^{(0)}}+y_i}{e^{\\hat{y_i}^{(0)}}+1}\\]\r\n\\[h_i^{(1)} = \\frac{e^{\\hat{y_i}^{(0)}}}{(e^{\\hat{y_i}^{(0)}}+1)^2}\\]\r\n\r\n\r\n\r\nd$g1 <- -((y-1)*exp(y0)+y)/(exp(y0)+1)\r\nd$h1 <- exp(y0)/((exp(y0)+1)^2)\r\n\r\nt = kable(d,digits=1,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 2))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.2\r\n\r\n\r\nNow the tricky part here is to find the best split of these observations that would improve the predictions most (reduce the value of loss function most). The observations can be split based on the RT1 or RT2 features. For instance, suppose we divide the observations into two groups based on whether the RT1 value is below or above 58.5 seconds. Below is a hypothetical tree structure with two leaves. There are 16 observations in the first leaf (\\(S_1\\)), and 14 observations in the second leaf (\\(S_2\\)).\r\nA hypothetical split of observations based on the RT1 featureThere are many potential splits available. We can say the number of possible theoretical splits are \\(2^{30}\\). However, most of them are not relevant here. In this case, there are only 53 possible splits of interest, 27 based on RT1 and 26 based on RT2 (as many as the number of unique elements for RT1 and RT2).\r\nSo, how could we know if this particular split is good or bad? Or, how could we know the best split that would improve our predictions most? To evaluate a tree structure like this, we need a quantity to measure its quality. Chen and Guestrin (2016) derived the Gain score for evaluating a fixed tree structure.\r\n\\[\r\nGain = \\left [  \r\n\\sum_{l=1}^{L}\r\n\\left ( \\frac{\\sum_{i \\epsilon S_l}g_i)^2}{\\sum_{i \\epsilon S_l}h_i+\\lambda} - \r\n\\frac{(\\sum_{i}g_i)^2}{\\sum_{i}h_i+\\lambda} \\right )\r\n\\right ]-\\gamma\r\n\\]\r\nHere, \\(l\\) indexes the leaf, \\(L\\) is the number of leaves in the tree structure, and \\(S_l\\) indicates the set of observations in the \\(l^{th}\\) leaf. \\(\\lambda\\) and \\(\\gamma\\) are the parameters to penalize the complexity of the tree structure and should be set to specific values. In practice, these values are typically determined through a parameter tuning procedure. For the sake of this illustration, I set the values to 1.5 and 1 for \\(\\lambda\\) and \\(\\gamma\\), respectively.\r\nNow, we will compute the gain score for each possible split based on the RT1 and RT2 features, and then check which one gives the best solution.\r\n\r\n\r\n\r\ng <- d$g1\r\nh <- d$h1\r\n\r\nlambda = 1.5\r\ngamma = 1\r\n\r\n# All Splits based on RT1\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT1))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split  <- (d$RT1<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\ncolnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n# All Splits for RT2\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT2))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split <- (d$RT2<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp2 = cbind(as.data.frame(cbind(s,gain)),\"RT2\")\r\ncolnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\npp <- rbind(pp1,pp2)\r\npp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\nkable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n38.5\r\n\r\n\r\n3.512\r\n\r\n\r\nRT2\r\n\r\n\r\n36.5\r\n\r\n\r\n3.081\r\n\r\n\r\nRT2\r\n\r\n\r\n30.5\r\n\r\n\r\n2.742\r\n\r\n\r\nRT2\r\n\r\n\r\n47.5\r\n\r\n\r\n2.444\r\n\r\n\r\nRT2\r\n\r\n\r\n37.5\r\n\r\n\r\n2.011\r\n\r\n\r\nRT2\r\n\r\n\r\n31.5\r\n\r\n\r\n1.651\r\n\r\n\r\nRT2\r\n\r\n\r\nAs we can see, the split with the largest gain is the one based on a threshold level of 38.5 for the RT2 feature. So, the first branch of the first tree is developed.\r\nThe first branch of Tree 1The algorithm will be repeated for the observations on each leaf. The algorithm will compute a gain score for all potential splits on each leaf separately to see if there is a new branch with a positive gain that can be added to any of the two leaves (or to both leaves). Let’s first look at all potential splits on the first leaf (RT2 < 38.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2<38.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2<38.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT2<38.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2<38.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2<38.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT2<38.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n49.5\r\n\r\n\r\n0.148\r\n\r\n\r\nRT1\r\n\r\n\r\n58.5\r\n\r\n\r\n-0.105\r\n\r\n\r\nRT1\r\n\r\n\r\n114.5\r\n\r\n\r\n-0.275\r\n\r\n\r\nRT1\r\n\r\n\r\n172.5\r\n\r\n\r\n-0.387\r\n\r\n\r\nRT1\r\n\r\n\r\n40.5\r\n\r\n\r\n-0.529\r\n\r\n\r\nRT1\r\n\r\n\r\n55.5\r\n\r\n\r\n-0.711\r\n\r\n\r\nRT1\r\n\r\n\r\nThe results indicate that there is only one potential split with a positive gain, a split based on a threshold level of 49.5 for the RT1 feature. Now, let’s check all potential splits on the second leaf (RT2 > 38.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2>38.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2>38.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT2>38.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2>38.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2>38.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT2>38.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n30.5\r\n\r\n\r\n-0.412\r\n\r\n\r\nRT1\r\n\r\n\r\n139.5\r\n\r\n\r\n-1.000\r\n\r\n\r\nRT1\r\n\r\n\r\n200.5\r\n\r\n\r\n-1.000\r\n\r\n\r\nRT1\r\n\r\n\r\n34.5\r\n\r\n\r\n-1.103\r\n\r\n\r\nRT1\r\n\r\n\r\n64.5\r\n\r\n\r\n-1.512\r\n\r\n\r\nRT1\r\n\r\n\r\n37.5\r\n\r\n\r\n-1.598\r\n\r\n\r\nRT1\r\n\r\n\r\nIt seems none of the possible splits on the second leaf yield a positive gain score. In this case, the search algorithm suggests adding a new branch on the first leaf based on a threshold level of 49.5 for the RT1 feature. Our first tree structure now looks like this.\r\nThe first tree structure with a depth of 2The depth of our tree is now 2. As you can imagine, we can continue to search, and add even more branches to the tree by picking the best split as long as there is a positive gain. This would increase the depth of the tree. The more depth a tree structure has, the more complex interactions it accounts for when predicting the outcome. For the sake of this illustration, we stop and end Iteration 1 here.\r\nOnce, the tree structure is determined, we can now compute the weights for each leaf. Our first tree structure has three leaves now. Chen and Guestrin (2016) derived that the optimal leaf weight for a fixed tree structure is equal to\r\n\\[w_l=- \\frac{\\sum_{i \\epsilon S_l}g_i}{\\sum_{i \\epsilon S_l}h_i+\\lambda}\\]\r\nLet’s compute the leaf weights on the first tree structure.\r\n\r\n\r\n  gr1 <- which(d$RT2 > 38.5)\r\n  gr1\r\n\r\n [1]  2  6  7 12 13 15 16 17 18 19 20 21 22 23 24 25 27 28 30\r\n\r\n  gr2 <- which(d$RT2 <38.5 & d$RT1<49.5)\r\n  gr2\r\n\r\n[1] 3 5 8 9\r\n\r\n  gr3 <- which(d$RT2 <38.5 & d$RT1>49.5)\r\n  gr3\r\n\r\n[1]  1  4 10 11 14 26 29\r\n\r\n        w1 = -sum(g[gr1])/(sum(h[gr1])+lambda)\r\n        w2 = -sum(g[gr2])/(sum(h[gr2])+lambda)\r\n        w3 = -sum(g[gr3])/(sum(h[gr3])+lambda)\r\n        \r\n        w1\r\n\r\n[1] -1.04\r\n\r\n        w2\r\n\r\n[1] 0.8\r\n\r\n        w3\r\n\r\n[1] -0.1538462\r\n\r\nThese weights represent how we will improve our predictions at the end of Iteration 1 before we move on to Iteration 2. Each observation in our dataset is now assigned to one of these weights depending on which leaf they belong to. In the end, we add these estimated leaf weights to the previous predictions (\\(\\hat{y}^0\\)) and obtain the new predictions at the end of Iteration 1 (\\(\\hat{y}^1\\)).\r\n\r\n\r\n\r\n d$w  <- NA\r\n d$y1 <- NA\r\n \r\n d[gr1,]$w = w1\r\n d[gr2,]$w = w2\r\n d[gr3,]$w = w3\r\n \r\n d$y1 <- d[,5] + d$w\r\n \r\n colnames(d)[8] <- \"$w^{1}$\"\r\n colnames(d)[9] <- \"$\\\\hat{y}^1$\"\r\n   \r\n   \r\nt = kable(d,digits=3,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 4))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n\\(w^{1}\\)\r\n\r\n\r\n\\(\\hat{y}^1\\)\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\nThe value of the loss function based on \\(y_i\\) and \\(\\hat{y}^1\\) at the end of Iteration 1 is 15.15 (reduced from 20.79)\r\n\r\n\r\ny  <- d[,4]\r\ny1 <- d[,9]\r\n\r\nloss1 <- sum(y*log(1+exp(-y1)) + (1-y)*log(1+exp(y1)))\r\nloss1\r\n\r\n[1] 15.15075\r\n\r\nIteration 2\r\nThe remaining of this analysis is simply a repetition of Iteration 1. At the end of Iteration 1, we developed the first tree in our model. Now, we will develop the second one. First, we have to update our first- and second-order gradient statistics based on the new predictions at the end of Iteration 1.\r\n\\[g_i^{(2)} = -\\frac{(y_i-1)e^{\\hat{y_i}^{(1)}}+y_i}{e^{\\hat{y_i}^{(1)}}+1}\\]\r\n\\[h_i^{(2)} = \\frac{e^{\\hat{y_i}^{(1)}}}{(e^{\\hat{y_i}^{(1)}}+1)^2}\\]\r\n\r\n\r\n\r\nd$g2 <- -((y-1)*exp(y1)+y)/(exp(y1)+1)\r\nd$h2 <- exp(y1)/((exp(y1)+1)^2)\r\n\r\nt = kable(d,digits=3,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 4, \"Iteration 2\" = 2))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\n\r\nIteration 2\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n\\(w^{1}\\)\r\n\r\n\r\n\\(\\hat{y}^1\\)\r\n\r\n\r\ng2\r\n\r\n\r\nh2\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\nThe algorithm computes the same search as in the Iteration 1 for all possible splits based on the RT1 and RT2 features using the updated gradient statistics.\r\n\r\n\r\n\r\ng <- d$g2\r\nh <- d$h2\r\n\r\n# All Splits based on RT1\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT1))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split  <- (d$RT1<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\ncolnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n# All Splits for RT2\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT2))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split <- (d$RT2<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp2 = cbind(as.data.frame(cbind(s,gain)),\"RT2\")\r\ncolnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\npp <- rbind(pp1,pp2)\r\npp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\nkable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n33.5\r\n\r\n\r\n0.009\r\n\r\n\r\nRT1\r\n\r\n\r\n79.5\r\n\r\n\r\n0.001\r\n\r\n\r\nRT2\r\n\r\n\r\n38.5\r\n\r\n\r\n-0.124\r\n\r\n\r\nRT2\r\n\r\n\r\n36.5\r\n\r\n\r\n-0.248\r\n\r\n\r\nRT2\r\n\r\n\r\n40.5\r\n\r\n\r\n-0.315\r\n\r\n\r\nRT1\r\n\r\n\r\n30.5\r\n\r\n\r\n-0.350\r\n\r\n\r\nRT2\r\n\r\n\r\nIt seems the best split for the first branch of the second tree is based on a threshold value of 33.5 for the RT1 feature.\r\nThe first branch of the second treeSimilar to Iteration 1, the algorithm will compute a gain score for all potential splits on each leaf of the second tree to see if there is a new branch with a positive gain that can be added to any of the two leaves (or to both leaves).\r\nLet’s first look at all potential splits on the first leaf (RT1 > 33.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT1>33.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT1>33.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT1>33.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT1>33.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT1>33.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT1>33.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n38.5\r\n\r\n\r\n-0.319\r\n\r\n\r\nRT1\r\n\r\n\r\n36.5\r\n\r\n\r\n-0.517\r\n\r\n\r\nRT1\r\n\r\n\r\n47.5\r\n\r\n\r\n-0.567\r\n\r\n\r\nRT1\r\n\r\n\r\n66.5\r\n\r\n\r\n-0.631\r\n\r\n\r\nRT1\r\n\r\n\r\n30.5\r\n\r\n\r\n-0.680\r\n\r\n\r\nRT1\r\n\r\n\r\n83.5\r\n\r\n\r\n-0.702\r\n\r\n\r\nRT1\r\n\r\n\r\nThe results indicate that there is no split with a positive gain that can be added to the first leaf. Let’s check the second leaf (RT1 < 33.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT1<33.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT1<33.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT1<33.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT1<33.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT1<33.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT1<33.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n79.5\r\n\r\n\r\n-0.610\r\n\r\n\r\nRT1\r\n\r\n\r\n29.5\r\n\r\n\r\n-0.943\r\n\r\n\r\nRT1\r\n\r\n\r\n33.5\r\n\r\n\r\n-1.000\r\n\r\n\r\nRT1\r\n\r\n\r\n90.5\r\n\r\n\r\n-1.000\r\n\r\n\r\nRT1\r\n\r\n\r\n19.5\r\n\r\n\r\n-1.169\r\n\r\n\r\nRT1\r\n\r\n\r\n30.5\r\n\r\n\r\n-1.169\r\n\r\n\r\nRT1\r\n\r\n\r\nThere is also no split with a positive gain that can be added to the second leaf. Therefore, we stop and Iteration 2 ends. Our second tree has a depth of one. Let’s compute the leaf weights on the second tree structure.\r\n\r\n\r\ngr1 <- which(d$RT1 > 33.5)\r\ngr2 <- which(d$RT1 < 33.5)\r\n\r\nw1 = -sum(g[gr1])/(sum(h[gr1])+lambda)\r\nw2 = -sum(g[gr2])/(sum(h[gr2])+lambda)\r\n\r\nw1\r\n\r\n[1] -0.2951779\r\n\r\nw2\r\n\r\n[1] 0.4744527\r\n\r\nThese weights similarly represent how we will improve our predictions at the end of Iteration 2 before we move on to Iteration 3. Each observation in our dataset is now assigned to one of these weights depending on which leaf they belong to in Tree 2. In the end, we add these estimated leaf weights to the previous predictions (\\(\\hat{y}^1\\)) and obtain the new predictions at the end of Iteration 2 (\\(\\hat{y}^2\\)).\r\n\r\n\r\n\r\n d$w  <- NA\r\n d$y2 <- NA\r\n \r\n d[gr1,]$w = w1\r\n d[gr2,]$w = w2\r\n \r\n d$y2 <- d[,9] + d$w\r\n \r\n colnames(d)[12] <- \"$w^{2}$\"\r\n colnames(d)[13] <- \"$\\\\hat{y}^2$\"\r\n   \r\n   \r\nt = kable(d,digits=3,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 4, \"Iteration 2\" = 4))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\n\r\nIteration 2\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n\\(w^{1}\\)\r\n\r\n\r\n\\(\\hat{y}^1\\)\r\n\r\n\r\ng2\r\n\r\n\r\nh2\r\n\r\n\r\n\\(w^{2}\\)\r\n\r\n\r\n\\(\\hat{y}^2\\)\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\nThe value of the loss function based on \\(y_i\\) and \\(\\hat{y}^2\\) at the end of Iteration 2 is 14.35 (reduced from 15.15).\r\n\r\n\r\ny  <- d[,4]\r\ny2 <- d[,13]\r\n\r\nloss2 <- sum(y*log(1+exp(-y2)) + (1-y)*log(1+exp(y2)))\r\nloss2\r\n\r\n[1] 14.34646\r\n\r\nOur tree ensemble model at the end of Iteration 2 now looks like this.\r\nTree ensemble model at the end of Iteration 2Iteration 3\r\nWe keep repeating the same cycle. First, we update our first- and second-order gradient statistics based on the new predictions at the end of Iteration 2.\r\n\\[g_i^{(3)} = -\\frac{(y_i-1)e^{\\hat{y_i}^{(2)}}+y_i}{e^{\\hat{y_i}^{(2)}}+1}\\]\r\n\\[h_i^{(3)} = \\frac{e^{\\hat{y_i}^{(2)}}}{(e^{\\hat{y_i}^{(2)}}+1)^2}\\]\r\n\r\n\r\n\r\nd$g3 <- -((y-1)*exp(y2)+y)/(exp(y2)+1)\r\nd$h3 <- exp(y2)/((exp(y2)+1)^2)\r\n\r\nt = kable(d,digits=3,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 4, \"Iteration 2\" = 4, \"Iteration 3\" = 2))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\n\r\nIteration 2\r\n\r\n\r\n\r\n\r\nIteration 3\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n\\(w^{1}\\)\r\n\r\n\r\n\\(\\hat{y}^1\\)\r\n\r\n\r\ng2\r\n\r\n\r\nh2\r\n\r\n\r\n\\(w^{2}\\)\r\n\r\n\r\n\\(\\hat{y}^2\\)\r\n\r\n\r\ng3\r\n\r\n\r\nh3\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n-0.792\r\n\r\n\r\n0.165\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n-0.376\r\n\r\n\r\n0.235\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n-0.376\r\n\r\n\r\n0.235\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n-0.792\r\n\r\n\r\n0.165\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n-0.638\r\n\r\n\r\n0.231\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n-0.218\r\n\r\n\r\n0.171\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n-0.218\r\n\r\n\r\n0.171\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n0.362\r\n\r\n\r\n0.231\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\nThe algorithm searches among all possible splits based on the RT1 and RT2 features using the updated gradient statistics.\r\n\r\n\r\n\r\ng <- d$g3\r\nh <- d$h3\r\n\r\n# All Splits based on RT1\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT1))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split  <- (d$RT1<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\ncolnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n# All Splits for RT2\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT2))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split <- (d$RT2<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp2 = cbind(as.data.frame(cbind(s,gain)),\"RT2\")\r\ncolnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\npp <- rbind(pp1,pp2)\r\npp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\nkable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n79.5\r\n\r\n\r\n0.116\r\n\r\n\r\nRT2\r\n\r\n\r\n38.5\r\n\r\n\r\n-0.131\r\n\r\n\r\nRT2\r\n\r\n\r\n36.5\r\n\r\n\r\n-0.356\r\n\r\n\r\nRT2\r\n\r\n\r\n47.5\r\n\r\n\r\n-0.382\r\n\r\n\r\nRT2\r\n\r\n\r\n66.5\r\n\r\n\r\n-0.436\r\n\r\n\r\nRT2\r\n\r\n\r\n30.5\r\n\r\n\r\n-0.542\r\n\r\n\r\nRT2\r\n\r\n\r\nThe best split was found based on a threshold value of 79..5 for the RT2 feature.\r\nThe first branch of the third treeThe algorithm computes a gain score for all potential splits on each leaf of the third tree to see if there is a new branch with a positive gain that can be added to any of the two leaves (or to both leaves).\r\nLet’s first look at all potential splits on the first leaf (RT2 > 79.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2>79.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2>79.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT2>79.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 1\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2>79.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2>79.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT2>79.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n68.5\r\n\r\n\r\n-0.399\r\n\r\n\r\nRT1\r\n\r\n\r\n68.5\r\n\r\n\r\n-0.399\r\n\r\n\r\nRT1\r\n\r\n\r\n117.5\r\n\r\n\r\n-0.650\r\n\r\n\r\nRT1\r\n\r\n\r\n58.5\r\n\r\n\r\n-0.846\r\n\r\n\r\nRT1\r\n\r\n\r\n104.5\r\n\r\n\r\n-0.846\r\n\r\n\r\nRT1\r\n\r\n\r\n48.5\r\n\r\n\r\n-0.995\r\n\r\n\r\nRT1\r\n\r\n\r\nThe results indicate that there is no split with a positive gain that can be added to the first leaf. Let’s check the second leaf (RT2 < 79.5).\r\n\r\n\r\n\r\n# All RT1 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2<79.5,]$RT1)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2<79.5 & d$RT1<s[i])\r\n     gr2 <- which(d$RT2<79.5 & d$RT1>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n# All RT2 Splits on Leaf 2\r\n\r\n    gain  <- c()\r\n    s     <- sort(d[d$RT2<79.5,]$RT2)+.5\r\n\r\n    for(i in 1:length(s)) {\r\n\r\n       gr1 <- which(d$RT2<79.5 & d$RT2<s[i])\r\n     gr2 <- which(d$RT2<79.5 & d$RT2>s[i])\r\n\r\n       GL     <- sum(g[gr1])\r\n       GR     <- sum(g[gr2])\r\n       HL     <- sum(h[gr1])\r\n       HR     <- sum(h[gr2])\r\n       gain[i] <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma            \r\n    }\r\n\r\n    pp2 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\n    colnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n\r\n    pp <- rbind(pp1,pp2)\r\n  pp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\n  kable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n172.5\r\n\r\n\r\n-0.610\r\n\r\n\r\nRT1\r\n\r\n\r\n67.5\r\n\r\n\r\n-0.687\r\n\r\n\r\nRT1\r\n\r\n\r\n62.5\r\n\r\n\r\n-0.743\r\n\r\n\r\nRT1\r\n\r\n\r\n114.5\r\n\r\n\r\n-0.784\r\n\r\n\r\nRT1\r\n\r\n\r\n40.5\r\n\r\n\r\n-0.842\r\n\r\n\r\nRT1\r\n\r\n\r\n33.5\r\n\r\n\r\n-0.879\r\n\r\n\r\nRT1\r\n\r\n\r\nThere is also no split with a positive gain that can be added to the second leaf. Therefore, we stop and Iteration 3 ends. Our third tree has a depth of one as the second tree. Let’s compute the leaf weights on the third tree structure.\r\n\r\n\r\ngr1 <- which(d$RT2 > 79.5)\r\ngr2 <- which(d$RT2 < 79.5)\r\n\r\nw1 = -sum(g[gr1])/(sum(h[gr1])+lambda)\r\nw2 = -sum(g[gr2])/(sum(h[gr2])+lambda)\r\n\r\nw1\r\n\r\n[1] -0.4275847\r\n\r\nw2\r\n\r\n[1] 0.3063322\r\n\r\nWe use these weights to update the predictions at the end of Iteration 3 before we move on to Iteration 4. Each observation in our dataset is assigned to one of these weights depending on which leaf they belong to in Tree 3. Then, we add these estimated leaf weights to the previous predictions (\\(\\hat{y}^2\\)) and obtain the new predictions at the end of Iteration 3 (\\(\\hat{y}^3\\)).\r\n\r\n\r\n\r\n d$w  <- NA\r\n d$y3 <- NA\r\n \r\n d[gr1,]$w = w1\r\n d[gr2,]$w = w2\r\n \r\n d$y3 <- d[,13] + d$w\r\n \r\n colnames(d)[16] <- \"$w^{3}$\"\r\n colnames(d)[17] <- \"$\\\\hat{y}^3$\"\r\n   \r\n   \r\nt = kable(d,digits=3,row.names=FALSE)\r\ncolumn_spec(t,column=1:7,width=\"1em\") %>%\r\nadd_header_above(c(\" \",\" \",\" \",\" \",\" \",\"Iteration 1\" = 4, \"Iteration 2\" = 4, \"Iteration 3\" = 4))\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nIteration 1\r\n\r\n\r\n\r\n\r\nIteration 2\r\n\r\n\r\n\r\n\r\nIteration 3\r\n\r\n\r\n\r\nObs\r\n\r\n\r\nRT1\r\n\r\n\r\nRT2\r\n\r\n\r\ny\r\n\r\n\r\n\\(\\hat{y}^0\\)\r\n\r\n\r\ng1\r\n\r\n\r\nh1\r\n\r\n\r\n\\(w^{1}\\)\r\n\r\n\r\n\\(\\hat{y}^1\\)\r\n\r\n\r\ng2\r\n\r\n\r\nh2\r\n\r\n\r\n\\(w^{2}\\)\r\n\r\n\r\n\\(\\hat{y}^2\\)\r\n\r\n\r\ng3\r\n\r\n\r\nh3\r\n\r\n\r\n\\(w^{3}\\)\r\n\r\n\r\n\\(\\hat{y}^3\\)\r\n\r\n\r\n1\r\n\r\n\r\n114\r\n\r\n\r\n36\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n2\r\n\r\n\r\n92\r\n\r\n\r\n121\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n-0.792\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n3\r\n\r\n\r\n49\r\n\r\n\r\n24\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n-0.376\r\n\r\n\r\n0.235\r\n\r\n\r\n0.306\r\n\r\n\r\n0.811\r\n\r\n\r\n4\r\n\r\n\r\n58\r\n\r\n\r\n30\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n5\r\n\r\n\r\n40\r\n\r\n\r\n17\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n-0.295\r\n\r\n\r\n0.505\r\n\r\n\r\n-0.376\r\n\r\n\r\n0.235\r\n\r\n\r\n0.306\r\n\r\n\r\n0.811\r\n\r\n\r\n6\r\n\r\n\r\n67\r\n\r\n\r\n66\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n-0.792\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n7\r\n\r\n\r\n30\r\n\r\n\r\n79\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n-0.739\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n-0.638\r\n\r\n\r\n0.231\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.259\r\n\r\n\r\n8\r\n\r\n\r\n19\r\n\r\n\r\n14\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n-0.218\r\n\r\n\r\n0.171\r\n\r\n\r\n0.306\r\n\r\n\r\n1.581\r\n\r\n\r\n9\r\n\r\n\r\n33\r\n\r\n\r\n8\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n0.800\r\n\r\n\r\n0.800\r\n\r\n\r\n-0.310\r\n\r\n\r\n0.214\r\n\r\n\r\n0.474\r\n\r\n\r\n1.274\r\n\r\n\r\n-0.218\r\n\r\n\r\n0.171\r\n\r\n\r\n0.306\r\n\r\n\r\n1.581\r\n\r\n\r\n10\r\n\r\n\r\n172\r\n\r\n\r\n38\r\n\r\n\r\n1\r\n\r\n\r\n0\r\n\r\n\r\n-0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.538\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n-0.610\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n11\r\n\r\n\r\n55\r\n\r\n\r\n37\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n12\r\n\r\n\r\n103\r\n\r\n\r\n79\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n13\r\n\r\n\r\n68\r\n\r\n\r\n117\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n14\r\n\r\n\r\n194\r\n\r\n\r\n17\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n15\r\n\r\n\r\n68\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n16\r\n\r\n\r\n48\r\n\r\n\r\n127\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n17\r\n\r\n\r\n48\r\n\r\n\r\n200\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n18\r\n\r\n\r\n61\r\n\r\n\r\n47\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n19\r\n\r\n\r\n37\r\n\r\n\r\n155\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n20\r\n\r\n\r\n58\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n21\r\n\r\n\r\n139\r\n\r\n\r\n97\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n22\r\n\r\n\r\n99\r\n\r\n\r\n84\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n23\r\n\r\n\r\n47\r\n\r\n\r\n50\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n24\r\n\r\n\r\n41\r\n\r\n\r\n54\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n25\r\n\r\n\r\n29\r\n\r\n\r\n90\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n0.474\r\n\r\n\r\n-0.566\r\n\r\n\r\n0.362\r\n\r\n\r\n0.231\r\n\r\n\r\n-0.428\r\n\r\n\r\n-0.993\r\n\r\n\r\n26\r\n\r\n\r\n117\r\n\r\n\r\n31\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n27\r\n\r\n\r\n44\r\n\r\n\r\n104\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n-0.428\r\n\r\n\r\n-1.763\r\n\r\n\r\n28\r\n\r\n\r\n34\r\n\r\n\r\n62\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\n29\r\n\r\n\r\n83\r\n\r\n\r\n20\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-0.154\r\n\r\n\r\n-0.154\r\n\r\n\r\n0.462\r\n\r\n\r\n0.249\r\n\r\n\r\n-0.295\r\n\r\n\r\n-0.449\r\n\r\n\r\n0.390\r\n\r\n\r\n0.238\r\n\r\n\r\n0.306\r\n\r\n\r\n-0.143\r\n\r\n\r\n30\r\n\r\n\r\n64\r\n\r\n\r\n57\r\n\r\n\r\n0\r\n\r\n\r\n0\r\n\r\n\r\n0.5\r\n\r\n\r\n0.25\r\n\r\n\r\n-1.040\r\n\r\n\r\n-1.040\r\n\r\n\r\n0.261\r\n\r\n\r\n0.193\r\n\r\n\r\n-0.295\r\n\r\n\r\n-1.335\r\n\r\n\r\n0.208\r\n\r\n\r\n0.165\r\n\r\n\r\n0.306\r\n\r\n\r\n-1.029\r\n\r\n\r\nThe value of the loss function based on \\(y_i\\) and \\(\\hat{y}^3\\) at the end of Iteration 3 is 13.57 (reduced from 14.35).\r\n\r\n\r\ny  <- d[,4]\r\ny3 <- d[,17]\r\n\r\nloss3 <- sum(y*log(1+exp(-y3)) + (1-y)*log(1+exp(y3)))\r\nloss3\r\n\r\n[1] 13.5685\r\n\r\nOur tree ensemble model at the end of Iteration 3 looks like this.\r\nTree ensemble model at the end of Iteration 3Iteration 4\r\nWe update our first- and second-order gradient statistics based on the new predictions at the end of Iteration 3. As can be seen below, the search process did not find any split with a positive gain score. Therefore, the whole search process ended because there is no fourth tree structure that can be added with an improvement in our predictions. So, our final model remains the structure at the end of Iteration 3.\r\n\\[g_i^{(4)} = -\\frac{(y_i-1)e^{\\hat{y_i}^{(3)}}+y_i}{e^{\\hat{y_i}^{(3)}}+1}\\]\r\n\\[h_i^{(4)} = \\frac{e^{\\hat{y_i}^{(3)}}}{(e^{\\hat{y_i}^{(3)}}+1)^2}\\]\r\n\r\n\r\n\r\nd$g4 <- -((y-1)*exp(y3)+y)/(exp(y3)+1)\r\nd$h4 <- exp(y3)/((exp(y3)+1)^2)\r\n\r\ng <- d$g4\r\nh <- d$h4\r\n\r\n# All Splits based on RT1\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT1))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split  <- (d$RT1<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp1 = cbind(as.data.frame(cbind(s,gain)),\"RT1\")\r\ncolnames(pp1) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\n# All Splits for RT2\r\n\r\ngain <- c()\r\ns <- sort(unique(d$RT2))+.5\r\n\r\nfor(i in 1:length(s)) {\r\n  \r\n  split <- (d$RT2<s[i])*1\r\n  GL     <- sum(g[which(split==1)])\r\n  GR     <- sum(g[which(split==0)])\r\n  HL     <- sum(h[which(split==1)])\r\n  HR     <- sum(h[which(split==0)])\r\n  \r\n  gain[i]  <- ((GL^2/(HL+lambda)) + (GR^2/(HR+lambda)) - (((GL+GR)^2)/(HL+HR+lambda))) - gamma\r\n}\r\n\r\npp2 = cbind(as.data.frame(cbind(s,gain)),\"RT2\")\r\ncolnames(pp2) <- c(\"Threshold\",\"Gain\",\"Feature\")\r\n\r\npp <- rbind(pp1,pp2)\r\npp <- pp[order(pp$Gain,decreasing=TRUE),]\r\n\r\nkable(head(pp),digits=3,row.names=FALSE)\r\n\r\nThreshold\r\n\r\n\r\nGain\r\n\r\n\r\nFeature\r\n\r\n\r\n38.5\r\n\r\n\r\n-0.662\r\n\r\n\r\nRT2\r\n\r\n\r\n33.5\r\n\r\n\r\n-0.690\r\n\r\n\r\nRT1\r\n\r\n\r\n36.5\r\n\r\n\r\n-0.721\r\n\r\n\r\nRT2\r\n\r\n\r\n30.5\r\n\r\n\r\n-0.769\r\n\r\n\r\nRT2\r\n\r\n\r\n40.5\r\n\r\n\r\n-0.787\r\n\r\n\r\nRT1\r\n\r\n\r\n79.5\r\n\r\n\r\n-0.797\r\n\r\n\r\nRT2\r\n\r\n\r\nUsing the tree model to predict the outcome for a new observation\r\nSince we just developed (trained) our model, we can now use it to predict the probability of the outcome for a new observation. Suppose a new test taker comes and responds the first item and second item in 80 and 40 seconds, respectively (RT1 = 80, RT2= 40). We first place this examinee on the corresponding leaf for each tree depending on these inputs.\r\nFor Tree 1, this person is on the first leaf since RT2 > 38.5, so the corresponding leaf weight is -1.040.\r\nFor Tree 2, this person is on the first leaf since RT1 > 33.5, so the corresponding leaf weight is -0.295.\r\nFor Tree 3, this person is on the second leaf since RT2 < 79.5, so the corresponding leaf weight is 0.306.\r\nWe sum the weights for this person from all trees, \\[(-1.040) + (-0.295) + (-0.306)= -1.029.\\] Note that this is on the logit scale, and we can transform it to a probability as \\[\\frac{e^{-1.641}}{e^{-1.641}+1} = 0.263.\\] So, a person with this pattern of response time, our model predicts that there is a 26% chance that this person had item preknowledge.\r\nLet’s do another example. Suppose another test taker comes and responds the first item and second item in 25 and 15 seconds, respectively (RT1 = 25, RT2= 15). This pattern corresponds to a weight of 0.800 (RT2 < 38.5 and RT1 < 49.5) for the first tree, a weight of 0.474 (RT1 < 33.5) for the second tree, and a weight of 0.306 (RT < 79.5) for the third tree. The sum of the weights is 1.58, corresponding to a probability of 0.83. So, a person with this particular pattern of response time, our model predicts that there is a 83% chance that this person had item preknowledge.\r\nNotice that the smaller the response time is (and exceeds certain threshold levels in the model), the more likely the predicted probability of item preknowledge is. This makes sense in this context, so the model works as it is supposed to.\r\nRunning the analysis using the xgboost package in R\r\n\r\n\r\nrequire(xgboost)\r\n\r\ndtrain <- xgb.DMatrix(data = data.matrix(d[,2:3]), label=d$y)\r\n\r\nfit <- xgb.train(data=dtrain,\r\n                 nround = 5,\r\n                 eta = 1,\r\n                 min_child_weight = 0,\r\n                 max_depth = 2,\r\n                 gamma = 1,\r\n                 max_delta_step=0,\r\n                 subsample = 1,\r\n                 colsample_bytree = 1,\r\n                 lambda = 1.5,\r\n                 alpha =0,\r\n                 scale_pos_weight =1,\r\n                 num_parallel_tree = 1,\r\n                 nthread = 1, \r\n                 objective = \"binary:logistic\",\r\n                 eval_metric=\"rmse\",predict=TRUE)\r\n\r\nFirst, let me briefly comment on some of the parameters here, and you can find many other webpage to give you more information about them.\r\nAs you can see, I set the gamma = 1 and lambda = 1.5. These are the same numbers I set the value for gamma and lambda in my demonstration above.\r\nnround = 5 is the number of maximum iterations you want to run, so this is technically the maximum number of trees you want to have in your tree ensemble model.\r\neta is the learning parameter. In the above demonstration, I use eta=1 without explicitly saying because I added the exact amount of weight to update the prediction at each iteration. Instead, one can decide to add a smaller fraction of the weight (such as half of it, or 10% of it) to update the prediction. In this case, for instance, you can set eta=.1, and this tells the algorithm to add 10% of the leaf weight estimated at each iteration when updating the predictions.\r\nmin_child_weight is the minimum sum of the second-order gradient statistics to add a new branch.\r\nmax_depth is the maximum depth of a tree. I set it to 2 as in my demo above.\r\nalpha is another regularization parameter such as lambda and gamma. The original paper does not mention it, so I am not quite sure how it changes the formulas I provided in this tutorial, but it can be in the source code the algorithm is using (https://github.com/dmlc/xgboost/blob/master/src/tree/param.h, see Line 45, Line 142-145, Line 303-310). I set it to 0, so the XGBoost runs the same way in my demonstration.\r\nNow, let’s check the tree structure the original XGBoost algorithm comes up.\r\n\r\n\r\nxgb.plot.tree(model = fit)\r\n\r\nTree Model Calibrated by the Original XGBoost functionLet’s try to understand the numbers in this model calibrated by the XGboost function and check if it is aligned with the numbers in our illustration above. I will briefly go over the numbers for the first tree and will leave it to you to check the numbers for the other two trees.\r\nTree 0\r\n\r\nThere are two numbers listed in the first box of Tree 0.\r\nCover: 7.5\r\nGain: 4.51163387\r\nWhat Cover: 7.5 here refers is the sum of the second order gradient statistics for all 30 observations in the first iteration. So, if you go back to the big table reported above and sum the values of h1, that gives you 7.5. The Gain score reported is 4.5116. If we go back and check the gain score we found, it is 3.512. If you check the formula for the Gain above, you will see the \\(\\gamma\\) is substracted at the end in our computation. So, the difference of 1 (after rounding to the third decimal) between the Gain Score I computed and the Gain Score XGBoost reported is probably due to the \\(\\gamma\\) parameter used, \\(\\gamma = 1\\).\r\nI believe the original XGBoost must be using the regularization term for the search as we specify \\(\\gamma = 1\\) in the function; however, it is probably reporting the Gain Score without substracting \\(\\gamma\\) when it comes to reporting in this plot.\r\n\r\nFirst, the threshold to split the first branch based on RT2 value is reported as 42.5. In my search, I found it as 38.5. So, this is a bit confusing. However, if we sort the values available on RT2, we see that there is no value in the data available between 38 and 47.\r\n\r\n\r\nsort(d$RT2)\r\n\r\n [1]   8  14  17  17  20  24  30  31  36  37  38  47  50  54  57  62\r\n[17]  66  79  79  84  84  84  90  97 104 117 121 127 155 200\r\n\r\nSo, practically, there is no difference in splitting this training sample based on a threshold value of 38.5 or a threshold value of 42.5. The number comes up in my computation by design. In my naive search, I added .5 to each unique value in the dataset and then did a brute-force search for every possible score. That’s why 38.5 came up in my search as the threshold value. I am not sure how XGBoost comes up with 42.5, but I guess it is picking the middle of the interval. I don’t think it is coincidence that 42.5 is the mean of 38 and 47. In short, there is no difference between choosing 38.5 as threshold or 42.5 as threshold for this small training sample.\r\nWithin the ellipse, there are two values Cover:4.75 and Value:-1.03999996. Cover is again the sum of the second gradient statistics for those observations on this particular leaf (RT2 > 42.5), and Value corresponds to the leaf weight for those observations on this leaf. Note that, the leaf weight we computed above in my computation is -1.04. So, we got the same weight in our computation.\r\nWithin the box, there are two values Cover:2.75 and Gain:1.14751124. Cover is the sum of the second gradient statistics for those observations on this particular leaf (RT2 < 42.5), and Gain is the gain score obtained for the next additional best split on this leaf. Note that the gain score for this split I computed above is 0.148. Again, there is a difference of 1 (\\(\\gamma = 1\\)) because it seems XGBoost doesn’t care about the regularization parameter when it comes to reporting the gain scores in this plot.\r\n\r\nAgain, the threshold value for the second split on the RT1 variable is 52. In my naive search, I came up with 49.5. Similarly, there is no value in the data between 49 and 55 for the RT1 variable, and it is no coincidence that XGBoost is reporting the middle of 49 and 55 as threshold. So, practically, there is no difference picking a threshold of 49.5 or 52 for this training sample.\r\n\r\n\r\nsort(d$RT1)\r\n\r\n [1]  19  29  30  33  34  37  40  41  44  47  48  48  49  55  58  58\r\n[17]  61  64  67  68  68  83  92  99 103 114 117 139 172 194\r\n\r\nWithin the first ellipse above, we see Cover:1 and Value:0.80000000012. Cover is the sum of the second gradient statistics for those observations on this particular leaf (RT2 < 42.5 and RT1 < 52) and Value corresponds to the leaf weight. Note that we computed the same weight in our computation for this leaf.\r\nWithin the second ellipse above, we see Cover:1.75 and Value:-0.15384616. Cover is the sum of the second gradient statistics for those observations on this particular leaf (RT2 < 42.5 and RT1 > 52) and Value corresponds to the leaf weight. Again, note that we computed the exact same weight for this leaf as well.\r\nFinal Word\r\nI hope this detailed illustration helps interested people understand better the mechanics of XGBoost. It certainly helped me. I have a better grasp of what is happening behind the scene whenever I use XGBoost for most complex problems, and the numbers make more sense whenever I look at the calibrated tree ensemble model.\r\nPlease feel free to send me any feedback and comments. I am happy to address any errors/typos in the post.\r\nThanks for reading.\r\n\r\n\r\n",
    "preview": "posts/extreme-gradient-boosting/images/tree.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 737,
    "preview_height": 786
  },
  {
    "path": "posts/creating-maps-with-2018-election-data/",
    "title": "Learning how to create maps in R",
    "description": "Using the elections 2018 data, I practiced how to create a map for an outcome variable,",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2018-11-16",
    "categories": [
      "elections",
      "US elections",
      "R",
      "2018"
    ],
    "contents": "\r\nIn this post, I tried to create county level maps to understand the change in difference between two parties from Gubernatorial 2014 election to Gubernatorial 2018 election or from Presidential 2016 election to Gubernatorial 2018 election. In order to reproduce the plots and numbers on this post, you have to download the following two datasets. I provide the R code for reproducing the numbers and plots at the end of each section.\r\nelection-context-2018.csv\r\nelection2018.csv\r\nI calculated a variable to compare 2014 and 2018 gubernatorial elections and to compare 2016 presidential and 2018 gubernatorial elections at the county level. This variable is the change in % difference between democratic and republican party (dem - rep). Positive numbers indicates there was a net shift in favor of Democratic party and negative numbers indicate there was a net shift in favor of Republican party.\r\nFor instance, suppose Democrats got 55% and Republicans got 45% of the vote in the 2014 Gubernatorial elections. So, there was a 10% difference in favor of Democrats. In 2018, Democrats got 40% and Republicans got 60% of the vote. So, there was a 20% difference in favor of Republicans. This means there is a 30% shift in favor of Republicans.\r\nIn another example, for instance, suppose Democrats got 60% and Republicans got 40% of the vote in the 2016 Presidential election. So, there was a 20% difference in favor of Democrats. In 2018 gubernatorial election, Democrats got 65% and Republicans got 35% of the vote. So, there was a 30% difference in favor of Democrats. This means there is a 10% shift in favor of Democrats.\r\nIn addition to computing this difference, I also created a binary variable based on this variable. (0) indicates there is a net shift in favor of Republicans and (1) indicates there is a net shift in favor of Democrats.\r\nBelow are the county level plots for these variables and the R code to produce these plots.\r\nGubernatorial 2018 - Gubernatorial 2014 (US)\r\n\r\n\r\n\r\n\r\n\r\nlibrary(ggplot2)\r\nlibrary(maps)\r\nlibrary(mapdata)\r\nlibrary(Hmisc)\r\nlibrary(grid)\r\noptions(scipen=999)\r\n##############################\r\npast    <- read.csv(\"data/election-context-2018.csv\")\r\npresent <- read.csv(\"data/election2018.csv\")\r\nd       <- merge(past,present,by=c(\"state\",\"county\"),all=TRUE)\r\n####################################\r\n\r\n  d$total.vote2016pres  <- d$trump16 + d$clinton16 + d$otherpres16\r\n  d$total.vote2014gov   <- d$demgov14 + d$repgov14 + d$othergov14\r\n  d$total.vote2018gov   <- d$demgov18 + d$repgov18 + d$othergov18\r\n  d$total.vote2018sen   <- d$repsen18 + d$demsen18 + d$othersen18\r\n  \r\n  \r\n  d$p.trump16   <- d$trump16/d$total.vote2016pres\r\n  d$p.clinton16 <- d$clinton16/d$total.vote2016pres\r\n  d$p.demgov14  <- d$demgov14/d$total.vote2014gov\r\n  d$p.repgov14  <- d$repgov14/d$total.vote2014gov\r\n  d$p.demgov18  <- d$demgov18/d$total.vote2018gov\r\n  d$p.repgov18  <- d$repgov18/d$total.vote2018gov\r\n  \r\n  d$p.diffgov14  <- d$p.demgov14 - d$p.repgov14 \r\n  d$p.diffgov18  <- d$p.demgov18 - d$p.repgov18 \r\n  d$p.diffpres16 <- d$p.clinton16- d$p.trump16 \r\n  \r\n  d$p.diffgov     <- (d$p.diffgov18 - d$p.diffgov14 )*100\r\n  d$p.diffpresgov <- (d$p.diffgov18 - d$p.diffpres16 )*100\r\n  \r\n  d$county <- as.character(d$county)\r\n  d$state <- as.character(d$state)\r\n  \r\n  d <- d[,c(\"state\",\"county\",\"p.diffgov\",\"p.diffpresgov\")]\r\n  \r\n  \r\n  all.counties <- map_data(\"county\")\r\n  all.counties$region    <- capitalize(all.counties$region)\r\n  all.counties$subregion <- capitalize(all.counties$subregion)\r\n  colnames(all.counties)[5:6] <- c(\"state\",\"county\")\r\n\r\n  \r\n  # Below are just some fixes to standardize the state and county names between two datasets\r\n  \r\n  d = d[-which(d$state==\"Hawaii\"),]\r\n  d = d[-which(d$state==\"Alaska\"),]\r\n  d[which(d$state==\"District of Columbia\"),]$county = \"Washington\"\r\n  \r\n  all.counties[which(all.counties$state==\"District of columbia\"),]$state = \"District of Columbia\"\r\n  all.counties[which(all.counties$state==\"New hampshire\"),]$state = \"New Hampshire\"\r\n  all.counties[which(all.counties$state==\"New jersey\"),]$state = \"New Jersey\"\r\n  all.counties[which(all.counties$state==\"New mexico\"),]$state = \"New Mexico\"\r\n  all.counties[which(all.counties$state==\"New york\"),]$state = \"New York\"\r\n  all.counties[which(all.counties$state==\"North carolina\"),]$state = \"North Carolina\"\r\n  all.counties[which(all.counties$state==\"North dakota\"),]$state = \"North Dakota\"\r\n  all.counties[which(all.counties$state==\"Rhode island\"),]$state = \"Rhode Island\"\r\n  all.counties[which(all.counties$state==\"South carolina\"),]$state = \"South Carolina\"\r\n  all.counties[which(all.counties$state==\"South dakota\"),]$state = \"South Dakota\"\r\n  all.counties[which(all.counties$state==\"West virginia\"),]$state = \"West Virginia\"\r\n \r\n  states = unique(all.counties$state)\r\n \r\n    # For every state, check the consistency of county names\r\n    # fix any inconsistency\r\n  \r\n    for(i in 1:length(states)){\r\n    \r\n      c.names = unique(all.counties[which(all.counties$state==states[i]),]$county)\r\n      d.names = unique(d[which(d$state==states[i]),]$county)\r\n    \r\n      flag = which(c.names %in% d.names==FALSE)\r\n\r\n      for(j in 1:length(flag)){\r\n        all.counties[which(all.counties$state==states[i] & \r\n                             all.counties$county==c.names[flag[j]] ),]$county = \r\n          d.names[which.min(adist(c.names[flag[j]],d.names))]\r\n      }\r\n    \r\n    }\r\n  \r\n  \r\n  # Merge mapping data and voting data\r\n  \r\n  us.mapping <- merge(all.counties,d,by=c(\"state\",\"county\"),all=TRUE)\r\n  \r\n  # Create the binary variable for the net shift\r\n  \r\n  us.mapping$p.diffgov.binary     <- factor(ifelse(us.mapping$p.diffgov>0,1,0))\r\n  us.mapping$p.diffpresgov.binary <- factor(ifelse(us.mapping$p.diffpresgov>0,1,0))\r\n  \r\n  \r\n  # Plot the continuous shift\r\n  \r\n  ggplot() + \r\n    geom_polygon(data=us.mapping, aes(x=long, y=lat, group = group, fill=p.diffgov),color=\"white\") + \r\n    coord_fixed(1.5) +\r\n    scale_fill_continuous(low = \"red\", high = \"blue\", \r\n                          na.value = \"black\",guide=\"colorbar\",\r\n                          limits=c(-60,80),breaks=c(-60,-50,-40,-30,-20,-10,0,10,20,30,40,50,60,70,80),\r\n                          labels = c(\"60%\",\"50%\",\"40%\",\"30%\",\"20%\",\"10%\",\"0%\",\r\n                                     \"10%\",\"20%\",\"30%\",\"40%\",\"50%\",\"60%\",\"70%\",\"80%\"))+\r\n    guides(fill = guide_colorbar(barwidth = 0.2, barheight = 15))+\r\n    theme_bw() + \r\n    theme(\r\n      plot.title   = element_text(size=rel(0.7)),\r\n      axis.text = element_blank(),\r\n      axis.line = element_blank(),\r\n      axis.ticks = element_blank(),\r\n      panel.border = element_blank(),\r\n      panel.grid = element_blank(),\r\n      axis.title = element_blank()\r\n    )+\r\n    labs(fill = \"\",title = \"% Change in Difference Between Democratic and Republican Party in the U.S. (Gubernatorial 2018 - Gubernotarial 2014)\", x=\"\", y=\"\")\r\n  \r\n  grid.text(\"Blue indicates voter shift (%) in favor of Democratic Party\",\r\n            x = unit(0.05, \"npc\"), y = unit(.08, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"blue\"))\r\n  \r\n  grid.text(\"Red indicates voter shift (%) in favor of Republican Party\",\r\n            x = unit(0.05, \"npc\"), y = unit(.04, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"red\"))\r\n  \r\n  grid.text(\"Black indicates no data.\",\r\n            x = unit(0.05, \"npc\"), y = unit(0.0, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"black\"))\r\n  \r\n  \r\n  \r\n  # Plot the binary net shift\r\n   \r\n  \r\n  ggplot() + \r\n    geom_polygon(data=us.mapping, aes(x=long, y=lat, group = group, fill=p.diffgov.binary),color=\"white\") + \r\n    coord_fixed(1.5) +\r\n    scale_fill_manual(values = c(\"red\",\"blue\"),na.value=\"black\",breaks=c(0,1),labels=c(\"Republican\",\"Democrat\"),name=\"\")+\r\n    theme_bw() + \r\n    theme(\r\n      plot.title   = element_text(size=rel(0.8)),\r\n      axis.text = element_blank(),\r\n      axis.line = element_blank(),\r\n      axis.ticks = element_blank(),\r\n      panel.border = element_blank(),\r\n      panel.grid = element_blank(),\r\n      axis.title = element_blank()\r\n    )+\r\n    labs(fill = \"\",title = \"\", x=\"\", y=\"\")\r\n  \r\n  grid.text(\"Blue indicates there is a net shift in favor of Democratic Party.\",\r\n            x = unit(0.05, \"npc\"), y = unit(.08, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"blue\"))\r\n  \r\n  grid.text(\"Red indicates there is a net shift in favor of  Republican Party.\",\r\n            x = unit(0.05, \"npc\"), y = unit(.04, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"red\"))\r\n  \r\n  grid.text(\"Black indicates no data.\",\r\n            x = unit(0.05, \"npc\"), y = unit(0.00, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"black\"))\r\n\r\nGubernatorial 2018 - Presidential 2016 (US)\r\n\r\n\r\n\r\n\r\n\r\n  ggplot() + \r\n    geom_polygon(data=us.mapping, aes(x=long, y=lat, group = group, fill=p.diffpresgov),color=\"white\") + \r\n    coord_fixed(1.5) +\r\n    scale_fill_continuous(low = \"red\", high = \"blue\", \r\n                          na.value = \"black\",guide=\"colorbar\",\r\n                          limits=c(-60,60),breaks=c(-60,-50,-40,-30,-20,-10,0,10,20,30,40,50,60),\r\n                          labels = c(\"60%\",\"50%\",\"40%\",\"30%\",\"20%\",\"10%\",\"0%\",\r\n                                     \"10%\",\"20%\",\"30%\",\"40%\",\"50%\",\"60%\"))+\r\n    guides(fill = guide_colorbar(barwidth = 0.2, barheight = 15))+\r\n    theme_bw() + \r\n    theme(\r\n      plot.title   = element_text(size=rel(0.7)),\r\n      axis.text = element_blank(),\r\n      axis.line = element_blank(),\r\n      axis.ticks = element_blank(),\r\n      panel.border = element_blank(),\r\n      panel.grid = element_blank(),\r\n      axis.title = element_blank()\r\n    )+\r\n    labs(fill = \"\",title = \"% Change in Difference Between Democratic and Republican Party in the U.S. (Gubernatorial 2018 - Presidential 2016)\", x=\"\", y=\"\")\r\n  \r\n  grid.text(\"Blue indicates voter shift (%) in favor of Democratic Party\",\r\n            x = unit(0.05, \"npc\"), y = unit(.08, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"blue\"))\r\n  \r\n  grid.text(\"Red indicates voter shift (%) in favor of Republican Party\",\r\n            x = unit(0.05, \"npc\"), y = unit(.04, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"red\"))\r\n  \r\n  grid.text(\"Black indicates no data.\",\r\n            x = unit(0.05, \"npc\"), y = unit(0.0, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"black\"))\r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  ggplot() + \r\n    geom_polygon(data=us.mapping, aes(x=long, y=lat, group = group, fill=p.diffpresgov.binary),color=\"white\") + \r\n    coord_fixed(1.5) +\r\n    scale_fill_manual(values = c(\"red\",\"blue\"),na.value=\"black\",breaks=c(0,1),labels=c(\"Republican\",\"Democrat\"),name=\"\")+\r\n    theme_bw() + \r\n    theme(\r\n      plot.title   = element_text(size=rel(0.8)),\r\n      axis.text = element_blank(),\r\n      axis.line = element_blank(),\r\n      axis.ticks = element_blank(),\r\n      panel.border = element_blank(),\r\n      panel.grid = element_blank(),\r\n      axis.title = element_blank()\r\n    )+\r\n    labs(fill = \"\",title = \"\", x=\"\", y=\"\")\r\n  \r\n  grid.text(\"Blue indicates there was a net shift in favor of Democratic Party.\",\r\n            x = unit(0.05, \"npc\"), y = unit(.08, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"blue\"))\r\n  \r\n  grid.text(\"Red indicates there was a net shift in favor of  Republican Party\",\r\n            x = unit(0.05, \"npc\"), y = unit(.04, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"red\"))\r\n  \r\n  grid.text(\"Black indicates no data.\",\r\n            x = unit(0.05, \"npc\"), y = unit(0.0, \"npc\"), just = c(\"left\", \"bottom\"), \r\n            gp = gpar(fontface = \"plain\", fontsize = 8, col = \"black\"))\r\n\r\n\r\n\r\n",
    "preview": "posts/creating-maps-with-2018-election-data/images/image.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 973,
    "preview_height": 599
  },
  {
    "path": "posts/a-quick-look-at-the-elections-2018/",
    "title": "A Quick Look at the Election 2018",
    "description": "Some quick insights about 2018 elections",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2018-11-12",
    "categories": [
      "elections",
      "US elections",
      "R",
      "2018"
    ],
    "contents": "\r\nDisclaimer: I am not a political analyst and have no intention to be one. The things I look are not necessarily great insights to elections. My goal in these posts is just to show how to use R for some data analytics.\r\nAccording to the news, midterm voter turnout hit 50-year high. I was curious about whether or not this increase in the number of votes favored any particular party. So, I decided to have a a first look at the election data. In order to reproduce the plots and numbers on this post, you have to download the following two datasets. I provide the R code for reproducing the numbers and plots at the end of each section.\r\nelection-context-2018.csv\r\nelection2018.csv\r\nGovernor Race - 2014 vs. 2018\r\nFirst, I compared gubernatorial election results in 2014 and 2018 using the 36 states that had a governor race. In this comparison, I defined two variables:\r\nThe percent change in the # of votes from 2014 to 2018\r\nThe change in percent difference between democratic and republican party.\r\nIn the below picture, there are four zones created by a vertical line (x=0) and horizontal line (y=0). The states at the upper right are the ones with an increase in the number of votes in 2018 compared to 2014 while there is a net shift in favor of the Democratic party. The states at the bottom right are the ones with an increase in the number of votes in 2018 compared to 2014 while there is a net shift in favor of the Republican Party. The states at the upper left are the ones with a decrease in the number of votes in 2018 compared to 2014 while there is a net shift in favor of the Democratic Party. I labeled some states that is most interesting (to me).\r\n\r\n\r\n\r\nThe most striking shift appears in Nevada. Nevada is the state that most increased the number votes in 2018 compared to 2014 (76.4%). The increase clearly favored the Democratic party. While the difference was 46.7% with the Republican party leading in 2014, it was 4.1% with the Democratic Party leading, indicating a net 50.8% shift in favor of Democrats.\r\nA similar big shift occurs in South Dakota(42.5%), Ohio (26.8%), Tennessee (26.8%), and Illinois (19.6%) in favor of the Democratic party with a considerable amount of increase in the number of votes in South Dakota(23.5%), Ohio (43.4%), Tennessee (61.6%), and Illinois (24.5%).\r\nThere is a big increase in the number of votes in Texas (76.0%), New York (59.6%), and Georgia (54.2%). However, the shift in favor of the Democratic party was in smaller degree, Texas (7.0%), New York (8.9%), and Georgia (6.3%).\r\nIn California and Florida, there is almost 0% shift indicating the difference in % votes remain same between the two parties although there is an increase in the number of votes, Florida by 37.1% and California by 7.8%.\r\nMassachusetts is another interesting one. That is the one with the most shift in favor of Republican party (31.7%) while increasing the number of votes by 20.4%.\r\nYou can look at the rest and dig deeper by yourself.\r\n\r\nState\r\nShift (%)\r\nChange in Votes (%)\r\nNevada\r\n50.8\r\n76.4\r\nSouth Dakota\r\n42.5\r\n23.5\r\nNew Mexico\r\n28.5\r\n34.7\r\nTennessee\r\n26.8\r\n61.6\r\nOhio\r\n26.8\r\n43.4\r\nIllinois\r\n19.6\r\n24.4\r\nIowa\r\n18.8\r\n16.8\r\nHawaii\r\n16.6\r\n6.7\r\nMaine\r\n13.4\r\n-4.0\r\nMichigan\r\n13.1\r\n32.1\r\nRhode Island\r\n10.9\r\n15.3\r\nNew York\r\n8.9\r\n59.6\r\nKansas\r\n8.4\r\n20.8\r\nAlabama\r\n8.1\r\n45.7\r\nTexas\r\n7.1\r\n76.0\r\nPennsylvania\r\n7.0\r\n42.0\r\nWisconsin\r\n6.9\r\n10.9\r\nMinnesota\r\n6.4\r\n33.8\r\nGeorgia\r\n6.3\r\n54.2\r\nSouth Carolina\r\n6.1\r\n36.5\r\nColorado\r\n3.8\r\n-2.7\r\nOklahoma\r\n2.7\r\n44.0\r\nFlorida\r\n0.4\r\n37.2\r\nCalifornia\r\n0.1\r\n7.7\r\nNebraska\r\n-0.1\r\n29.3\r\nOregon\r\n-0.2\r\n25.5\r\nConnecticut\r\n-0.6\r\n25.2\r\nArizona\r\n-5.7\r\n15.1\r\nWyoming\r\n-6.2\r\n28.8\r\nIdaho\r\n-7.1\r\n36.5\r\nMaryland\r\n-8.8\r\n29.7\r\nNew Hampshire\r\n-12.1\r\n17.3\r\nVermont\r\n-16.1\r\n40.9\r\nArkansas\r\n-19.7\r\n4.5\r\nMassachusetts\r\n-31.7\r\n20.4\r\n\r\n\r\n\r\nrequire(ggrepel)\r\nrequire(ggplot2)\r\nrequire(scales)\r\nrequire(knitr)\r\noptions(scipen=999)\r\n\r\n#########################\r\npast    <- read.csv(\"data/election-context-2018.csv\")\r\npresent <- read.csv(\"data/election2018.csv\")\r\nd       <- merge(past,present,by=c(\"state\",\"county\"),all=TRUE)\r\n#########################\r\n\r\nstates <- aggregate(cbind(repsen18,demsen18,othersen18,\r\n                          trump16,clinton16,otherpres16,\r\n                          demgov14,repgov14,othergov14,\r\n                          demgov18,repgov18,othergov18) ~ state,\r\n                          data = d, sum,na.action=NULL,na.rm=TRUE)\r\n\r\nstates$total.vote2016pres   <- states$trump16 + states$clinton16 + states$otherpres16\r\nstates$total.vote2014gov    <- states$demgov14 + states$repgov14 + states$othergov14\r\nstates$total.vote2018gov    <- states$demgov18 + states$repgov18 + states$othergov18\r\nstates$total.vote2018sen   <- states$repsen18 + states$demsen18 + states$othersen18\r\n\r\n\r\nstates$p.trump16   <- states$trump16/states$total.vote2016pres\r\nstates$p.clinton16 <- states$clinton16/states$total.vote2016pres\r\nstates$p.demgov14   <- states$demgov14/states$total.vote2014gov\r\nstates$p.repgov14   <- states$repgov14/states$total.vote2014gov\r\nstates$p.demgov18   <- states$demgov18/states$total.vote2018gov\r\nstates$p.repgov18   <- states$repgov18/states$total.vote2018gov\r\n\r\nstates$p.diffgov14 <- states$p.demgov14 - states$p.repgov14 \r\nstates$p.diffgov18 <- states$p.demgov18 - states$p.repgov18 \r\n\r\nstates$p.diffgov   <- (states$p.diffgov18 - states$p.diffgov14 )*100\r\nstates$p.increase.vote.gov <- (states$total.vote2018gov/states$total.vote2014gov)*100-100\r\n\r\nlabels = as.character(states[,1])\r\nlabels[-c(4,5,9,10,13,19,20,21,28,32,35,41,42,43)] = \"\"\r\n\r\nggplot(states,aes(p.increase.vote.gov,p.diffgov)) +\r\n  geom_point(aes(size=total.vote2018gov,color=total.vote2014gov)) +\r\n  theme_bw() + \r\n  theme(plot.title   = element_text(size=10),\r\n        axis.title.y = element_text(size=rel(0.7)),\r\n        axis.title.x = element_text(size=rel(0.7)),\r\n        axis.text.y  = element_text(size=rel(0.7)),\r\n        axis.text.x  = element_text(size=rel(0.7)),\r\n        legend.text  = element_text(size=rel(0.5)),\r\n        legend.title = element_text(size=rel(0.5)))+\r\n  xlab(\"% Change in the Number of Total Votes\")+\r\n  ylab(\"% Change in Difference between Democratic and Republican Party\")+\r\n  xlim(c(-10,90))+\r\n  geom_hline(yintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  geom_vline(xintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  labs(title=\"Gubernatorial Elections (2014 vs. 2018)\",\r\n       size =\"Total Votes in 2018\",\r\n       color=\"Total Votes in 2014\")+\r\n  geom_label_repel(aes(label=labels),hjust=0.5,vjust=-0.5,size=2)\r\n\r\n\r\ntab.states <- na.omit(states[,c(1,26,27)])\r\ntab.states <- tab.states[order(tab.states[,2],decreasing=TRUE),]\r\ncolnames(tab.states) <- c(\"State\",\"Shift (%)\",\"Change in Votes (%)\")\r\nkable(tab.states,digits=1,row.names=FALSE) \r\n\r\nGovernor Race 2018 vs. Presidential Race 2016\r\nSome may argue this would be a better comparison to understand the dynamics after President #45. This will be also limited to 36 states that had a governor race. I looked at the same two variables.\r\nSouth Dakota seems one of the least loss in the number of votes (-8.4%) while the net shift of 26.4% in favor of the Democratic Party. Simlar level of shift in favor of Democratic Party also occurred in Kansas (25.1%) and Oklahoma (24.3%) with larger amount of reduction in the number of votes, Kansas (-13.5%) and Oklahoma (-18.4%).\r\nIn Florida and New York, there is not a noticable shift in favor of neither party.\r\nIn Massachusetts, there is a net shift of 61.2% in favor of Republican Party while the reduction in the number of votes is 20.9%. Maryland, Vermont, Arizona, Connecticut, and California are other states with a net shift in favor of Republican party more than 10%.\r\n\r\n\r\n\r\n\r\nState\r\nShift (%)\r\nChange in Votes (%)\r\nSouth Dakota\r\n26.4\r\n-8.4\r\nKansas\r\n25.1\r\n-13.5\r\nOklahoma\r\n24.3\r\n-18.4\r\nPennsylvania\r\n17.5\r\n-19.7\r\nMinnesota\r\n10.1\r\n-10.5\r\nIdaho\r\n9.7\r\n-13.1\r\nMichigan\r\n9.2\r\n-13.6\r\nAlabama\r\n8.6\r\n-19.4\r\nWyoming\r\n6.6\r\n-21.0\r\nIowa\r\n6.4\r\n-16.1\r\nNebraska\r\n6.3\r\n-19.7\r\nMaine\r\n5.8\r\n-21.3\r\nSouth Carolina\r\n5.8\r\n-20.0\r\nNew Mexico\r\n5.6\r\n-15.1\r\nTennessee\r\n5.3\r\n-12.9\r\nOhio\r\n3.9\r\n-21.4\r\nGeorgia\r\n3.5\r\n-4.8\r\nWisconsin\r\n1.9\r\n-10.2\r\nColorado\r\n1.7\r\n-30.3\r\nNevada\r\n1.7\r\n-14.2\r\nFlorida\r\n0.5\r\n-13.5\r\nRhode Island\r\n0.0\r\n-19.8\r\nNew York\r\n-0.3\r\n-26.4\r\nIllinois\r\n-2.3\r\n-21.5\r\nHawaii\r\n-3.2\r\n-8.9\r\nTexas\r\n-4.3\r\n-7.6\r\nOregon\r\n-6.0\r\n-15.8\r\nArkansas\r\n-6.7\r\n-21.9\r\nNew Hampshire\r\n-7.4\r\n-23.5\r\nCalifornia\r\n-11.3\r\n-50.6\r\nConnecticut\r\n-11.8\r\n-17.7\r\nArizona\r\n-14.2\r\n-34.6\r\nMaryland\r\n-39.9\r\n-23.5\r\nVermont\r\n-41.4\r\n-13.4\r\nMassachusetts\r\n-61.2\r\n-20.9\r\n\r\n\r\n\r\nstates$p.diffpres16 <- states$p.clinton16 - states$p.trump16\r\nstates$p.diffgov18  <- states$p.demgov18 - states$p.repgov18 \r\n\r\nstates$p.diffpresgov       <- (states$p.diffgov18 - states$p.diffpres16)*100\r\nstates$p.increase.vote.gov <- (states$total.vote2018gov/states$total.vote2016pres)*100-100\r\n\r\nlabels = as.character(states[,1])\r\nlabels[-c(2,4,6,9,16,20,21,23,32,36,38,41,45)] = \"\"\r\n\r\nggplot(states,aes(p.increase.vote.gov,p.diffpresgov)) +\r\n  geom_point(aes(size=total.vote2018gov,color=total.vote2016pres)) +\r\n  theme_bw() + \r\n  theme(plot.title   = element_text(size=10),\r\n        axis.title.y = element_text(size=rel(0.7)),\r\n        axis.title.x = element_text(size=rel(0.7)),\r\n        axis.text.y  = element_text(size=rel(0.7)),\r\n        axis.text.x  = element_text(size=rel(0.7)),\r\n        legend.text  = element_text(size=rel(0.5)),\r\n        legend.title = element_text(size=rel(0.5)))+\r\n  xlab(\"% Change in the Number of Total Votes\")+\r\n  ylab(\"% Change in Difference between Democratic and Republican Party\")+\r\n  xlim(c(-55,0))+\r\n  geom_hline(yintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  geom_vline(xintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  labs(title=\"Gubernatorial Election 2018 vs. Presidential Election in 2016\",\r\n       size =\"Total Votes in 2018\",\r\n       color=\"Total Votes in 2016\")+\r\n  geom_label_repel(aes(label=labels),hjust=0.5,vjust=-0.5,size=2)\r\n\r\ntab.states2 <- na.omit(states[,c(1,29,27)])\r\ntab.states2 <- tab.states2[order(tab.states2[,2],decreasing=TRUE),]\r\ncolnames(tab.states2) <- c(\"State\",\"Shift (%)\",\"Change in Votes (%)\")\r\nkable(tab.states2,digits=1,row.names=FALSE)\r\n\r\nFocusing FL Counties - Gubernatorial Race 2014 vs. 2018\r\nI looked at the same comparison between 2014 and 2018 gubernatorial elections at the county level in Fl.\r\nThere is a net shift in favor of Republican party for the majority of counties, particularly small ones.\r\nIn three relatively large counties, Duval, Orange, and Osceola are the ones with the most net shift in favor of Democratic party with a significant amount of increase in the number of votes.\r\nIn Hillsborough, there is also a net shift in favor of Democratic party at a smaller level with a significant amount of increase in the number of votes.\r\nIn Miami-Dade, the net shift of 1.8% in favor of Democratic party is not noticeable, though there is a 53% increase in the number of votes.\r\nIn other three large counties, there is a net shift in favor of Republican Party: Palm Beach (3.9%), Broward (1.8), and Pinellas (8.3%).\r\n\r\n\r\n\r\n\r\nCounty\r\nShift (%)\r\nChange in Votes (%)\r\nDuval\r\n17.2\r\n40.2\r\nOrange\r\n13.8\r\n54.7\r\nOsceola\r\n12.1\r\n68.0\r\nEscambia\r\n10.9\r\n32.0\r\nOkaloosa\r\n10.9\r\n37.1\r\nAlachua\r\n10.6\r\n46.9\r\nClay\r\n10.2\r\n37.2\r\nSt. Johns\r\n9.8\r\n51.4\r\nSeminole\r\n9.1\r\n37.6\r\nHillsborough\r\n6.2\r\n40.5\r\nCollier\r\n5.2\r\n36.9\r\nSanta Rosa\r\n4.4\r\n41.9\r\nBay\r\n3.3\r\n11.0\r\nNassau\r\n2.0\r\n41.9\r\nMiami-Dade\r\n1.8\r\n53.5\r\nLeon\r\n1.7\r\n30.8\r\nWalton\r\n0.5\r\n48.7\r\nIndian River\r\n-0.3\r\n41.4\r\nSumter\r\n-0.8\r\n34.9\r\nLee\r\n-1.5\r\n38.0\r\nBroward\r\n-1.8\r\n42.7\r\nHendry\r\n-2.0\r\n32.5\r\nLake\r\n-2.9\r\n38.1\r\nPolk\r\n-3.6\r\n27.3\r\nPalm Beach\r\n-3.9\r\n35.4\r\nBrevard\r\n-5.3\r\n27.0\r\nManatee\r\n-5.4\r\n36.4\r\nSarasota\r\n-5.6\r\n30.7\r\nPutnam\r\n-5.6\r\n23.8\r\nSt. Lucie\r\n-5.8\r\n39.2\r\nGadsden\r\n-5.9\r\n14.0\r\nGulf\r\n-6.9\r\n14.2\r\nVolusia\r\n-7.0\r\n30.1\r\nMarion\r\n-7.6\r\n29.2\r\nFlagler\r\n-8.0\r\n39.5\r\nMonroe\r\n-8.0\r\n26.8\r\nPinellas\r\n-8.3\r\n23.7\r\nMartin\r\n-9.0\r\n27.0\r\nHighlands\r\n-9.5\r\n24.5\r\nColumbia\r\n-10.0\r\n35.0\r\nLevy\r\n-11.3\r\n29.0\r\nWashington\r\n-11.4\r\n9.6\r\nFranklin\r\n-11.4\r\n25.8\r\nMadison\r\n-12.8\r\n20.5\r\nBradford\r\n-13.5\r\n23.0\r\nCharlotte\r\n-14.0\r\n29.5\r\nJefferson\r\n-14.0\r\n17.2\r\nPasco\r\n-14.5\r\n31.2\r\nGlades\r\n-14.9\r\n26.8\r\nHardee\r\n-15.0\r\n18.7\r\nJackson\r\n-16.0\r\n5.7\r\nSuwannee\r\n-17.3\r\n24.7\r\nTaylor\r\n-18.8\r\n19.0\r\nGilchrist\r\n-19.4\r\n23.6\r\nHamilton\r\n-19.9\r\n22.4\r\nHolmes\r\n-20.0\r\n18.4\r\nBaker\r\n-20.1\r\n24.8\r\nOkeechobee\r\n-20.2\r\n26.4\r\nHernando\r\n-22.0\r\n26.0\r\nCitrus\r\n-22.1\r\n21.6\r\nCalhoun\r\n-22.5\r\n9.7\r\nWakulla\r\n-23.2\r\n23.0\r\nDesoto\r\n-24.1\r\n18.4\r\nDixie\r\n-31.5\r\n8.2\r\nLafayette\r\n-32.1\r\n7.8\r\nLiberty\r\n-32.4\r\n0.3\r\nUnion\r\n-41.4\r\n-2.8\r\n\r\n\r\n\r\n#########################\r\npast    <- read.csv(\"data/election-context-2018.csv\")\r\npresent <- read.csv(\"data/election2018.csv\")\r\nd       <- merge(past,present,by=c(\"state\",\"county\"),all=TRUE)\r\nfl      <- d[which(d$state==\"Florida\"),]\r\n##########################\r\nfl$total.vote2016pres  <- fl$trump16 + fl$clinton16 + fl$otherpres16\r\nfl$total.vote2014gov   <- fl$demgov14 + fl$repgov14 + fl$othergov14\r\nfl$total.vote2018gov   <- fl$demgov18 + fl$repgov18 + fl$othergov18\r\nfl$total.vote2018sen   <- fl$repsen18 + fl$demsen18 + fl$othersen18\r\n\r\n\r\nfl$p.trump16   <- fl$trump16/fl$total.vote2016pres\r\nfl$p.clinton16 <- fl$clinton16/fl$total.vote2016pres\r\nfl$p.demgov14  <- fl$demgov14/fl$total.vote2014gov\r\nfl$p.repgov14  <- fl$repgov14/fl$total.vote2014gov\r\nfl$p.demgov18  <- fl$demgov18/fl$total.vote2018gov\r\nfl$p.repgov18  <- fl$repgov18/fl$total.vote2018gov\r\n\r\nfl$p.diffgov14 <- fl$p.demgov14 - fl$p.repgov14 \r\nfl$p.diffgov18 <- fl$p.demgov18 - fl$p.repgov18 \r\n\r\nfl$p.diffgov   <- (fl$p.diffgov18 - fl$p.diffgov14 )*100\r\nfl$p.increase.vote.gov <- (fl$total.vote2018gov/fl$total.vote2014gov)*100-100\r\n\r\nlabels = as.character(fl[,2])\r\nlabels[-c(6,13,15,16,29,34,39,44,49,50,51,53,64,66)] = \"\"\r\n\r\nggplot(fl,aes(p.increase.vote.gov,p.diffgov)) +\r\n  geom_point(aes(size=total.vote2018gov,color=total.vote2014gov)) +\r\n  theme_bw() + \r\n  theme(plot.title   = element_text(size=10),\r\n        axis.title.y = element_text(size=rel(0.7)),\r\n        axis.title.x = element_text(size=rel(0.7)),\r\n        axis.text.y  = element_text(size=rel(0.7)),\r\n        axis.text.x  = element_text(size=rel(0.7)),\r\n        legend.text  = element_text(size=rel(0.5)),\r\n        legend.title = element_text(size=rel(0.5)))+\r\n  xlab(\"% Change in the Number of Total Votes\")+\r\n  ylab(\"% Change in Difference between Democratic and Republican Party\")+\r\n  xlim(c(-10,75))+\r\n  geom_hline(yintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  geom_vline(xintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  labs(title=\"FL Gubernatorial Elections (2014 vs. 2018)\",\r\n       size =\"Total Votes in 2018\",\r\n       color=\"Total Votes in 2014\")+\r\n  geom_label_repel(aes(label=labels),hjust=0.5,vjust=-0.5,size=2)\r\n\r\n\r\ntab.fl <- na.omit(fl[,c(\"county\",\"p.diffgov\",\"p.increase.vote.gov\")])\r\ntab.fl <- tab.fl[order(tab.fl[,2],decreasing=TRUE),]\r\ncolnames(tab.fl) <- c(\"County\",\"Shift (%)\",\"Change in Votes (%)\")\r\nkable(tab.fl,digits=1,row.names=FALSE) \r\n\r\nFocusing FL Counties - Gubernatorial Race 2018 vs. Presidential Race 2016\r\n\r\n\r\n\r\n\r\nCounty\r\nShift (%)\r\nChange in Votes (%)\r\nFranklin\r\n7.9\r\n-10.0\r\nSt. Lucie\r\n6.0\r\n-12.2\r\nDuval\r\n5.8\r\n-12.8\r\nClay\r\n5.5\r\n-12.3\r\nPasco\r\n5.2\r\n-12.6\r\nSt. Johns\r\n4.8\r\n-4.1\r\nAlachua\r\n4.6\r\n-11.1\r\nPinellas\r\n4.1\r\n-11.7\r\nHernando\r\n3.9\r\n-14.1\r\nNassau\r\n3.7\r\n-6.6\r\nEscambia\r\n3.6\r\n-15.3\r\nWalton\r\n3.6\r\n-9.9\r\nUnion\r\n3.5\r\n-14.5\r\nSeminole\r\n3.3\r\n-11.5\r\nSanta Rosa\r\n3.2\r\n-14.0\r\nMonroe\r\n3.2\r\n-15.0\r\nColumbia\r\n2.9\r\n-13.6\r\nBrevard\r\n2.9\r\n-10.6\r\nSarasota\r\n2.9\r\n-8.0\r\nOkaloosa\r\n2.9\r\n-16.9\r\nGulf\r\n2.9\r\n-19.3\r\nMartin\r\n2.8\r\n-9.4\r\nLeon\r\n2.5\r\n-8.0\r\nVolusia\r\n2.3\r\n-12.4\r\nCitrus\r\n2.3\r\n-11.1\r\nIndian River\r\n2.3\r\n-7.4\r\nLake\r\n2.2\r\n-9.1\r\nFlagler\r\n2.0\r\n-8.2\r\nHillsborough\r\n2.0\r\n-12.9\r\nMarion\r\n2.0\r\n-11.4\r\nPutnam\r\n1.8\r\n-15.1\r\nBradford\r\n1.7\r\n-13.2\r\nLevy\r\n1.6\r\n-11.9\r\nBroward\r\n1.6\r\n-19.8\r\nCharlotte\r\n1.5\r\n-9.9\r\nManatee\r\n1.4\r\n-8.9\r\nJackson\r\n1.3\r\n-24.2\r\nPalm Beach\r\n1.2\r\n-14.4\r\nHolmes\r\n1.0\r\n-20.7\r\nMadison\r\n1.0\r\n-10.4\r\nOrange\r\n1.0\r\n-13.0\r\nWakulla\r\n0.7\r\n-7.4\r\nPolk\r\n0.7\r\n-14.1\r\nBay\r\n0.4\r\n-27.7\r\nTaylor\r\n0.3\r\n-14.6\r\nLiberty\r\n0.2\r\n-18.7\r\nOkeechobee\r\n0.2\r\n-17.8\r\nDixie\r\n0.2\r\n-19.5\r\nWashington\r\n0.2\r\n-18.9\r\nSuwannee\r\n0.0\r\n-14.8\r\nGadsden\r\n-0.1\r\n-9.4\r\nHamilton\r\n-0.8\r\n-16.7\r\nGlades\r\n-0.9\r\n-12.1\r\nBaker\r\n-1.0\r\n-16.6\r\nGilchrist\r\n-1.0\r\n-12.5\r\nSumter\r\n-1.0\r\n-3.0\r\nHardee\r\n-1.2\r\n-15.7\r\nLee\r\n-1.3\r\n-11.4\r\nLafayette\r\n-1.4\r\n-17.4\r\nCalhoun\r\n-1.5\r\n-24.5\r\nDesoto\r\n-1.6\r\n-17.9\r\nJefferson\r\n-1.7\r\n-3.7\r\nHighlands\r\n-2.0\r\n-13.1\r\nCollier\r\n-4.1\r\n-9.0\r\nOsceola\r\n-4.2\r\n-18.1\r\nHendry\r\n-4.5\r\n-20.2\r\nMiami-Dade\r\n-8.7\r\n-18.5\r\n\r\n\r\n\r\n#########################\r\npast    <- read.csv(\"data/election-context-2018.csv\")\r\npresent <- read.csv(\"data/election2018.csv\")\r\nd       <- merge(past,present,by=c(\"state\",\"county\"),all=TRUE)\r\nfl      <- d[which(d$state==\"Florida\"),]\r\n##########################\r\nfl$total.vote2016pres  <- fl$trump16 + fl$clinton16 + fl$otherpres16\r\nfl$total.vote2014gov   <- fl$demgov14 + fl$repgov14 + fl$othergov14\r\nfl$total.vote2018gov   <- fl$demgov18 + fl$repgov18 + fl$othergov18\r\nfl$total.vote2018sen   <- fl$repsen18 + fl$demsen18 + fl$othersen18\r\n\r\n\r\nfl$p.trump16   <- fl$trump16/fl$total.vote2016pres\r\nfl$p.clinton16 <- fl$clinton16/fl$total.vote2016pres\r\nfl$p.demgov14  <- fl$demgov14/fl$total.vote2014gov\r\nfl$p.repgov14  <- fl$repgov14/fl$total.vote2014gov\r\nfl$p.demgov18  <- fl$demgov18/fl$total.vote2018gov\r\nfl$p.repgov18  <- fl$repgov18/fl$total.vote2018gov\r\n\r\nfl$p.diffpres16 <- fl$p.clinton16 - fl$p.trump16 \r\nfl$p.diffgov18  <- fl$p.demgov18 - fl$p.repgov18 \r\n\r\nfl$p.diffgovpress      <- (fl$p.diffgov18 - fl$p.diffpres16)*100\r\nfl$p.increase.vote.gov <- (fl$total.vote2018gov/fl$total.vote2016pres)*100-100\r\n\r\nlabels = as.character(fl[,2])\r\nlabels[-c(6,10,11,16,19,26,28,44,50,51,52,53,60)] = \"\"\r\n\r\nggplot(fl,aes(p.increase.vote.gov,fl$p.diffgovpress)) +\r\n  geom_point(aes(size=total.vote2018gov,color=total.vote2016pres)) +\r\n  theme_bw() + \r\n  theme(plot.title   = element_text(size=10),\r\n        axis.title.y = element_text(size=rel(0.7)),\r\n        axis.title.x = element_text(size=rel(0.7)),\r\n        axis.text.y  = element_text(size=rel(0.7)),\r\n        axis.text.x  = element_text(size=rel(0.7)),\r\n        legend.text  = element_text(size=rel(0.5)),\r\n        legend.title = element_text(size=rel(0.5)))+\r\n  xlab(\"% Change in the Number of Total Votes\")+\r\n  ylab(\"% Change in Difference between Democratic and Republican Party\")+\r\n  xlim(c(-30,0))+\r\n  geom_hline(yintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  geom_vline(xintercept=0, linetype=2, color=\"black\", size=.5)+\r\n  labs(title=\"FL - Gubernatorial Elections 2018 vs. Presidential Election 2016)\",\r\n       size =\"Total Votes in 2018\",\r\n       color=\"Total Votes in 2016\")+\r\n  geom_label_repel(aes(label=labels),hjust=0.5,vjust=-0.5,size=2)\r\n\r\ntab.fl <- na.omit(fl[,c(\"county\",\"p.diffgovpress\",\"p.increase.vote.gov\")])\r\ntab.fl <- tab.fl[order(tab.fl[,2],decreasing=TRUE),]\r\ncolnames(tab.fl) <- c(\"County\",\"Shift (%)\",\"Change in Votes (%)\")\r\nkable(tab.fl,digits=1,row.names=FALSE) \r\n\r\n\r\n\r\n",
    "preview": "posts/a-quick-look-at-the-elections-2018/images/image.png",
    "last_modified": "2020-12-04T16:11:48-08:00",
    "input_file": {},
    "preview_width": 692,
    "preview_height": 500
  },
  {
    "path": "posts/scraping-2018-election-data/",
    "title": "Scraping Election 2018 Data",
    "description": "This post includes some follow-up R code to scrap 2018 election data from New York Times webpage.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2018-11-07",
    "categories": [
      "web scraping",
      "R",
      "elections",
      "US elections",
      "2018"
    ],
    "contents": "\r\nYesterday, I scrapped data for the 2014 gubernatorial election from New York Times webpage. Since the reporting is almost complete in many locations, I also scrapped the 2018 election data from this year’s New York Times election webpage, which is pulling the data from the JSON file at this link..\r\nThe whole dataset for house, senate, and governor elections can be downloaded from this link as a CSV file Once this file is merged with the dataset from the MIT Election Data and Science Lab, you are all good to go to dive in. I will post some R code in the following days for some basic analysis and graphs using the FL dataset.\r\nFor those interested, below is the source code for scrapping the 2018 elections data.\r\n\r\n\r\nrequire(jsonlite)\r\nrequire(Hmisc)\r\n\r\n\r\na = fromJSON(\"https://int.nyt.com/applications/elections/2018/api/1/races/2018-11-06.json\")\r\n\r\n\r\nraces      = a[[6]]\r\ncandidates = a[[6]]$candidates\r\ncounties   = a[[6]]$counties\r\n\r\n\r\n# Pulling Results for Governors\r\n\r\n  gov <- which(races$race_type==\"governor\")\r\n  governor.race <- vector(\"list\",length(gov))\r\n\r\n  for(i in 1:length(gov)) {\r\n\r\n      name    = races[gov[i],]$state_slug\r\n      info    = candidates[[gov[i]]]\r\n      rep.key = info[which(info$party_id==\"republican\"),]$candidate_key\r\n      dem.key = info[which(info$party_id==\"democrat\"),]$candidate_key\r\n      others   = info$candidate_key[! info$candidate_key %in% c(rep.key,dem.key)]\r\n\r\n      if(nrow(info)>1){\r\n\r\n        state    = cbind(counties[[gov[i]]]$name,counties[[gov[i]]]$results)\r\n        colnames(state)[1] <- \"county\"\r\n        \r\n        if(length(rep.key)>=1) { \r\n          repu   = rowSums(as.matrix(state[,rep.key])) \r\n        } else {\r\n            repu   = as.matrix(rep(0,nrow(state)))\r\n        }\r\n        \r\n        if(length(dem.key)>=1) { \r\n          dem    = rowSums(as.matrix(state[,dem.key])) \r\n        } else {\r\n            dem    = as.matrix(rep(0,nrow(state)))\r\n        }\r\n        \r\n        if(length(others)>=1) { \r\n          other  = rowSums(as.matrix(state[,others]))  \r\n        } else {\r\n            other  = as.matrix(rep(0,nrow(state)))\r\n        }\r\n        \r\n          state <- cbind(state$county,as.data.frame(cbind(repu,dem,other)))\r\n          state <- cbind(capitalize(name),state)\r\n          colnames(state) <- c(\"state\",\"county\",\"repgov18\",\"demgov18\",\"othergov18\")\r\n\r\n          governor.race[[i]] = state\r\n          \r\n       } \r\n  }\r\n\r\n\r\n  electiongov2018 <- governor.race[[1]]\r\n\r\n  for(i in 2:length(gov)) {\r\n    electiongov2018 <- rbind(electiongov2018,governor.race[[i]])\r\n    }\r\n\r\n# Pulling Results for Senate\r\n\r\n  sen <- which(races$race_type==\"senate\")\r\n\r\n  senate.race <- vector(\"list\",length(sen))\r\n\r\n  for(i in 1:length(sen)) {\r\n\r\n      name    = races[sen[i],]$state_slug\r\n      info    = candidates[[sen[i]]]\r\n      rep.key = info[which(info$party_id==\"republican\"),]$candidate_key\r\n      dem.key = info[which(info$party_id==\"democrat\"),]$candidate_key\r\n      others   = info$candidate_key[! info$candidate_key %in% c(rep.key,dem.key)]\r\n\r\n      if(nrow(info)>1){\r\n        \r\n        state    = cbind(counties[[sen[i]]]$name,counties[[sen[i]]]$results)\r\n        colnames(state)[1] <- \"county\"\r\n      \r\n        if(length(rep.key)>=1) { \r\n          repu   = rowSums(as.matrix(state[,rep.key])) \r\n        } else {\r\n            repu   = as.matrix(rep(0,nrow(state)))\r\n        }\r\n        \r\n      if(length(dem.key)>=1) { \r\n        dem    = rowSums(as.matrix(state[,dem.key])) \r\n      } else {\r\n          dem    = as.matrix(rep(0,nrow(state)))\r\n      }\r\n        \r\n      if(length(others)>=1)  { \r\n        other  = rowSums(as.matrix(state[,others]))  \r\n      } else {\r\n          other  = as.matrix(rep(0,nrow(state)))\r\n      }\r\n        \r\n       state <- cbind(state$county,as.data.frame(cbind(repu,dem,other)))\r\n       state <- cbind(capitalize(name),state)\r\n       colnames(state) <- c(\"state\",\"county\",\"repsen18\",\"demsen18\",\"othersen18\")\r\n\r\n       senate.race[[i]] = state\r\n\r\n    } \r\n}\r\n\r\n  \r\n  electionsen2018 <- senate.race[[1]]\r\n\r\n  for(i in 2:length(sen)) {\r\n    electionsen2018 <- rbind(electionsen2018,senate.race[[i]])\r\n  }\r\n\r\n\r\n# Pulling Results for House\r\n\r\n  house <- which(races$race_type==\"house\")\r\n\r\n  house.race <- vector(\"list\",length(house))\r\n\r\n  for(i in 1:length(house)) {\r\n\r\n      name    = races[house[i],]$state_slug\r\n      info    = candidates[[house[i]]]\r\n      rep.key = info[which(info$party_id==\"republican\"),]$candidate_key\r\n      dem.key = info[which(info$party_id==\"democrat\"),]$candidate_key\r\n      others   = info$candidate_key[! info$candidate_key %in% c(rep.key,dem.key)]\r\n\r\n      if(nrow(info)>1){\r\n\r\n        state    = cbind(counties[[house[i]]]$name,counties[[house[i]]]$results)\r\n        colnames(state)[1] <- \"county\"\r\n      \r\n        if(length(rep.key)>=1) { \r\n          repu   = rowSums(as.matrix(state[,rep.key])) \r\n        } else {\r\n            repu   = as.matrix(rep(0,nrow(state)))\r\n        }\r\n        \r\n      if(length(dem.key)>=1) { \r\n        dem    = rowSums(as.matrix(state[,dem.key])) \r\n      } else {\r\n          dem    = as.matrix(rep(0,nrow(state)))\r\n      }\r\n        \r\n      if(length(others)>=1) { \r\n        other  = rowSums(as.matrix(state[,others]))  \r\n      } else {\r\n        other  = as.matrix(rep(0,nrow(state)))\r\n      }\r\n        \r\n        state <- cbind(state$county,as.data.frame(cbind(repu,dem,other)))\r\n        state <- cbind(capitalize(name),state)\r\n        colnames(state) <- c(\"state\",\"county\",\"rephouse18\",\"demhouse18\",\"otherhouse18\")\r\n\r\n        house.race [[i]] = state\r\n\r\n  } \r\n}\r\n\r\n\r\nelectionhouse2018 <- house.race[[1]]\r\n\r\nfor(i in 2:length(house)) {\r\n if(is.null(house.race[[i]])==FALSE){\r\n  electionhouse2018 <- rbind(electionhouse2018,house.race[[i]])\r\n }\r\n}\r\n\r\n\r\nelectionhouse2018 <- aggregate(cbind(rephouse18,demhouse18,otherhouse18) ~ state + county,\r\n                               data = electionhouse2018, sum)\r\n\r\nelectionhouse2018 <- electionhouse2018[order(electionhouse2018[,1]),]\r\n\r\n\r\n##########################################################################################\r\n\r\n# Merge Senate, House, and Governor Data\r\n\r\nelection2018 <- merge(electiongov2018,electionsen2018,by=c(\"state\",\"county\"),all=TRUE)\r\nelection2018 <- merge(election2018,electionhouse2018,by=c(\"state\",\"county\"),all=TRUE)\r\n\r\n\r\n\r\n",
    "preview": "posts/scraping-2018-election-data/images/vote2.jpg",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {}
  },
  {
    "path": "posts/scraping-data-for-2014-gubernatorial-elections/",
    "title": "Scraping Data for 2014 Gubernatorial Elections",
    "description": "This post includes some R code to scrap 2014 election data from New York Times webpage.",
    "author": [
      {
        "name": "Cengiz Zopluoglu",
        "url": {}
      }
    ],
    "date": "2018-11-06",
    "categories": [
      "web scraping",
      "R",
      "elections",
      "US elections",
      "2018"
    ],
    "contents": "\r\nPeople are excited about elections, me too! I have decided to play with election data and I plan to create some plots meaningful to me to make comparisons with the previous years. I have found this webpage for the MIT Election Data and Science Lab that did a tremendous job of merging election data from 2012 and 2016 presidential elections and 2016 state elections (Senate, House, and Governor). I was thrilled when I found it because they saved a lot of time for me. However, I realized it was missing data from 2014 gubernatorial elections. Based on a quick search on the web, I found that 12 states with a gubernatorial election in 2016 included in their datasets while 36 states with a gubernatorial election in 2014 missing. For the sake of comparison between the 2014 and 2018 gubernatorial elections, I think it is important to have 2014 data.\r\nThere may be official sources for the 2014 gubernatorial election, but I don’t have time to dig deeper. So, the fastest source I could access was the New York Times webpage for the 2014 elections. They have nice interactive plots at the county and state level, but the raw data is hidden somewhere. After some detective work in their source page, I found the page was pulling data from the JSON file at this link.\r\nThe rest was a little bit of R programming. I don’t have much time to explain what it does, but I put the code below. For those interested, they can dig into the code deeper. For those who are not interested in the coding piece, here is the CSV file you can download for 2014 gubernatorial elections at the state and county level. I structured data exactly same as in the MIT Election Data and Science Lab page, so both can be merged into one file.\r\n\r\n\r\nrequire(jsonlite)\r\nrequire(Hmisc)\r\nrequire(rmarkdown)\r\nrequire(knitr)\r\n\r\n# Read the JSON file from the New York Times link\r\n\r\na = fromJSON(\"https://int.nyt.com/applications/elections/2014/data/2014-11-04/supermap/governor.json\")\r\n\r\n# For all states except Alaska, restructure the data in a 5 column dataframe\r\n\r\nstate.vote <- vector(\"list\",35)\r\n\r\nfor(i in 3:37) {\r\n\r\n    info = a[[i]][[3]]\r\n    rep.name = info[which(info$party_id==\"REP\"),]$slug\r\n    dem.name = info[which(info$party_id==\"DEM\"),]$slug\r\n\r\n  if(nrow(info) > 3) { \r\n\r\n        others   = info$slug[! info$slug %in% c(rep.name,dem.name)]\r\n        state = a[[i]][[2]][,c(\"name\",rep.name,dem.name,others)]\r\n        state$othergov14 <- rowSums(state[,4:ncol(state)])\r\n        state <- state[,c(1,2,3,ncol(state))]\r\n        state <- cbind(capitalize(a[[i]]$state$state_slug),state)\r\n        colnames(state) <- c(\"state\",\"county\",\"repgov14\",\"demgov14\",\"othergov14\")\r\n\r\n    } \r\n\r\n  if(nrow(info) == 3 ) { \r\n\r\n        others   = info$slug[! info$slug %in% c(rep.name,dem.name)]\r\n        state = a[[i]][[2]][,c(\"name\",rep.name,dem.name,others)]\r\n        state <- cbind(capitalize(a[[i]]$state$state_slug),state)\r\n        colnames(state) <- c(\"state\",\"county\",\"repgov14\",\"demgov14\",\"othergov14\")\r\n\r\n    } \r\n\r\n    if(nrow(info) == 2) {\r\n\r\n        state = a[[i]][[2]][,c(\"name\",rep.name,dem.name)]\r\n        state$othergov14 <- 0\r\n        state <- state[,c(1,2,3,ncol(state))]\r\n        state <- cbind(capitalize(a[[i]]$state$state_slug),state)\r\n        colnames(state) <- c(\"state\",\"county\",\"repgov14\",\"demgov14\",\"othergov14\")\r\n\r\n\r\n    }\r\n\r\n      state.vote[[i-2]] = state\r\n}\r\n\r\n# Combine all in one data frame\r\n\r\nelectiongov2014 <- state.vote[[1]]\r\n\r\nfor(i in 2:35) {\r\n electiongov2014 <- rbind(electiongov2014,state.vote[[i]])\r\n}\r\n\r\n\r\n#######################\r\n\r\ndim(electiongov2014)\r\n\r\n[1] 2149    5\r\n\r\nstr(electiongov2014)\r\n\r\n'data.frame':   2149 obs. of  5 variables:\r\n $ state     : Factor w/ 35 levels \"Alabama\",\"Arkansas\",..: 1 1 1 1 1 1 1 1 1 1 ...\r\n $ county    : chr  \"Autauga\" \"Baldwin\" \"Barbour\" \"Bibb\" ...\r\n $ repgov14  : int  9427 37650 3111 3525 12074 747 3148 17688 3635 5007 ...\r\n $ demgov14  : int  3638 8416 3651 1368 2178 2440 2741 9082 4587 1868 ...\r\n $ othergov14: num  0 0 0 0 0 0 0 0 0 0 ...\r\n\r\n\r\n\r\n",
    "preview": "posts/scraping-data-for-2014-gubernatorial-elections/images/image.jpg",
    "last_modified": "2020-12-04T16:11:49-08:00",
    "input_file": {}
  }
]
